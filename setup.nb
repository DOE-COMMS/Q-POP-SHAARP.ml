(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    903635,      21069]
NotebookOptionsPosition[    895811,      20948]
NotebookOutlinePosition[    896305,      20967]
CellTagsIndexPosition[    896262,      20964]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Protect", " ", "the", " ", "keys", " ", "for", " ", "all", " ", 
    "associations"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Unprotect", "[", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "latcon", ",", "\[Lambda]", 
      ",", "\[Omega]", ",", "k", ",", "k0", ",", "\[Theta]", ",", "EE", ",", 
      "H", ",", "neff", ",", "n\[Omega]", ",", "n2\[Omega]", ",", 
      "\[CurlyEpsilon]\[Omega]C", ",", "\[CurlyEpsilon]2\[Omega]C", ",", 
      "\[CurlyEpsilon]\[Omega]L", ",", "\[CurlyEpsilon]\[Omega]2L", ",", 
      "\[CurlyEpsilon]\[Omega]P", ",", "\[CurlyEpsilon]\[Omega]2P", ",", 
      "QP\[Omega]", ",", "QP2\[Omega]", ",", "QC", ",", "t", ",", "x", ",", 
      "y", ",", "z", ",", "phase", ",", "intensity", ",", "dL", ",", "dC", 
      ",", "h", ",", "S"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Protect", "[", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "latcon", ",", "\[Lambda]", 
      ",", "\[Omega]", ",", "k", ",", "k0", ",", "\[Theta]", ",", "EE", ",", 
      "H", ",", "neff", ",", "n\[Omega]", ",", "n2\[Omega]", ",", 
      "\[CurlyEpsilon]\[Omega]C", ",", "\[CurlyEpsilon]2\[Omega]C", ",", 
      "\[CurlyEpsilon]\[Omega]L", ",", "\[CurlyEpsilon]\[Omega]2L", ",", 
      "\[CurlyEpsilon]\[Omega]P", ",", "\[CurlyEpsilon]\[Omega]2P", ",", 
      "QP\[Omega]", ",", "QP2\[Omega]", ",", "QC", ",", "t", ",", "x", ",", 
      "y", ",", "z", ",", "phase", ",", "intensity", ",", "dL", ",", "dC", 
      ",", "h", ",", "S"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Meaning", " ", "of", " ", 
       RowBox[{"symbols", ":"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]", " ", "-", " ", 
       RowBox[{"wave", " ", "frequency"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"k", " ", "-", " ", 
       RowBox[{"wave", " ", "vector"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"k0", " ", "-", " ", 
       RowBox[{"wave", " ", "vector", " ", "amplitude"}]}], ";", " ", 
      RowBox[{"may", " ", "be", " ", "complex", " ", "scalar"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", " ", "-", " ", 
       RowBox[{"wave", " ", "angle"}]}], ";", " ", 
      RowBox[{"may", " ", "be", " ", "complex", " ", "scalar"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"H", " ", "-", " ", 
       RowBox[{"magnetic", " ", "field", " ", "of", " ", "waves"}]}], ";", 
      "\[IndentingNewLine]", "n\[Omega]"}], ",", 
     RowBox[{
      RowBox[{"n2\[Omega]", " ", "-", " ", 
       RowBox[{
       "refractive", " ", "indices", " ", "of", " ", "\[Omega]", " ", "and", 
        " ", "2", "\[Omega]", " ", "waves", " ", "in", " ", "Principal", " ", 
        "coordinates", " ", "of", " ", "a", " ", "material"}]}], ";", " ", 
      RowBox[{
       RowBox[{"so", " ", "they", " ", "are", " ", "3"}], "-", "tuples"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"neff", " ", "-", " ", 
       RowBox[{
       "effective", " ", "refractive", " ", "index", " ", "of", " ", "the", 
        " ", "wave", " ", "in", " ", "the", " ", "mater"}]}], ";", " ", 
      RowBox[{
      "it", " ", "is", " ", "an", " ", "attribute", " ", "of", " ", "the", 
       " ", "wave"}]}], ",", " ", 
     RowBox[{
      RowBox[{"not", " ", "the", " ", 
       RowBox[{"mater", "!"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"c", " ", "-", " ", 
       RowBox[{
       "effective", " ", "refractive", " ", "index", " ", "of", " ", "a", " ",
         "wave"}]}], ";", " ", 
      RowBox[{"it", " ", "is", " ", "scalar"}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"EE", " ", "-", " ", 
       RowBox[{"the", " ", "electric", " ", "field", " ", "vector"}]}], ";", 
      "\[IndentingNewLine]", "\[CurlyEpsilon]\[Omega]C"}], ",", 
     RowBox[{
      RowBox[{"\[CurlyEpsilon]2\[Omega]C", " ", "-", " ", 
       RowBox[{
       "the", " ", "relative", " ", "dielectric", " ", "tensors", " ", 
        "expressed", " ", "in", " ", "the", " ", "Crystal", " ", "physics", 
        " ", "coordinate", " ", "system"}]}], ";", " ", "\[IndentingNewLine]",
       "\[CurlyEpsilon]\[Omega]P"}], ",", 
     RowBox[{
      RowBox[{"\[CurlyEpsilon]2\[Omega]P", " ", "-", " ", 
       RowBox[{
       "the", " ", "relative", " ", "dielectric", " ", "tensors", " ", 
        "expressed", " ", "in", " ", "the", " ", "Principal", " ", 
        "coordinate", " ", "system"}]}], ";", " ", 
      RowBox[{
      "they", " ", "are", " ", "the", " ", "same", " ", "as", " ", "Crystal", 
       " ", "physics", " ", "coordinate", " ", "except", " ", "for", " ", 
       RowBox[{"monoclinic", "/", "triclinic"}], " ", "crystal", " ", 
       "systems"}], ";", "\[IndentingNewLine]", "\[CurlyEpsilon]\[Omega]L"}], 
     ",", 
     RowBox[{
      RowBox[{"\[CurlyEpsilon]\[Omega]2L", " ", "-", " ", 
       RowBox[{
       "the", " ", "relative", " ", "dielectric", " ", "tensors", " ", 
        "expressed", " ", "in", " ", "the", " ", "Lab", " ", "coordinate", 
        " ", "system"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"QP", " ", "-", " ", 
       RowBox[{
       "the", " ", "rotation", " ", "matrix", " ", "from", " ", "Principal", 
        " ", "to", " ", "Lab"}]}], ";", " ", 
      RowBox[{"for", " ", "eigenvalue", " ", "problem", " ", "of", " ", 
       RowBox[{"Snell", "'"}], "s", " ", "law", " ", "only"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"QC", " ", "-", " ", 
       RowBox[{
       "the", " ", "rotation", " ", "matrix", " ", "from", " ", "Crystal", 
        " ", "physics", " ", "to", " ", "Lab"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"A", " ", "-", " ", 
       RowBox[{
       "the", " ", "electric", " ", "field", " ", "vector", " ", "of", " ", 
        "a", " ", "wave", " ", "expressed", " ", "in", " ", "a", " ", "the", 
        " ", "analyzer", " ", "plane", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"z", "//", 
           RowBox[{"k", " ", "vector"}]}], ",", " ", 
          RowBox[{"y", "//", 
           RowBox[{"y", " ", "of", " ", "Lab"}]}], ",", " ", 
          RowBox[{
          "x", " ", "in", " ", "the", " ", "plane", " ", "of", " ", 
           "incidence"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "x"}], ",",
      "y", ",", 
     RowBox[{
      RowBox[{"z", " ", "-", " ", 
       RowBox[{
       "for", " ", "denoting", " ", "the", " ", "lab", " ", "coordinate", " ",
         "system", " ", "directions"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"phase", " ", "-", " ", 
       RowBox[{"phase", " ", "term", " ", "of", " ", "the", " ", "wave"}]}], 
      ";", " ", "\[IndentingNewLine]", 
      RowBox[{"dL", " ", "-", " ", 
       RowBox[{
       "SHG", " ", "tensor", " ", "d", " ", "expressed", " ", "in", " ", 
        "the", " ", "Lab", " ", "coordiante", " ", "system"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"dC", " ", "-", " ", 
       RowBox[{
       "SHG", " ", "tensor", " ", "d", " ", "expressed", " ", "in", " ", 
        "the", " ", "Crystal", " ", "physics", " ", "coordinate", " ", 
        "system"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"h", " ", "-", " ", 
       RowBox[{"thickness", " ", "of", " ", "a", " ", "layer"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"S", " ", "-", " ", 
       RowBox[{"Poynting", " ", "vector"}]}], ";"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"For", " ", "details", " ", "of", " ", "the", " ", "theory"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"please", " ", "refer", " ", 
       RowBox[{"to", ":", " ", "https", ":"}]}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{"arxiv", ".", "org"}], "/", "abs"}], "/", "2307.01368"}]}]}], 
    " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.835650966103658*^9, 3.835650972264577*^9}, {
   3.836899627764406*^9, 3.8368996812769423`*^9}, 3.836910447907883*^9, {
   3.836926436393945*^9, 3.8369264480375795`*^9}, {3.836926485475146*^9, 
   3.836926501203877*^9}, {3.836926551233517*^9, 3.8369265552462273`*^9}, {
   3.836930097356699*^9, 3.8369301002950864`*^9}, {3.837808327089145*^9, 
   3.837808341193586*^9}, {3.837810169124052*^9, 3.837810181142291*^9}, {
   3.83789496395544*^9, 3.837894997571883*^9}, {3.8544893542856627`*^9, 
   3.8544893696652365`*^9}, {3.854490626984989*^9, 3.8544907297335153`*^9}, {
   3.8544915241707525`*^9, 3.85449183857032*^9}, {3.8863631331198506`*^9, 
   3.886363152481841*^9}, {3.886364070564902*^9, 3.886364074945816*^9}, {
   3.886449732293904*^9, 3.88644973527702*^9}, 3.887850587097185*^9, 
   3.887853250132854*^9, {3.88852297680593*^9, 3.888522979622653*^9}, {
   3.889007490987355*^9, 3.88900749480194*^9}, {3.8890137184531155`*^9, 
   3.889013725764912*^9}, 3.8890137692659626`*^9, {3.889014376267557*^9, 
   3.889014388706135*^9}, {3.889016555379466*^9, 3.8890165630903597`*^9}, {
   3.8933352279945097`*^9, 3.89333525191485*^9}, {3.89335182604932*^9, 
   3.8933518327347283`*^9}, {3.893352855940297*^9, 3.89335285631689*^9}, {
   3.8946722534426975`*^9, 3.89467225982658*^9}, 3.895837464665057*^9, {
   3.895838206947111*^9, 3.89583820761733*^9}, {3.895861657636712*^9, 
   3.895861660410586*^9}, {3.895861789447469*^9, 3.895861833838258*^9}, {
   3.895861866473256*^9, 3.895861872762532*^9}, {3.895862014973028*^9, 
   3.895862134128826*^9}, {3.89744081899312*^9, 3.897440902559707*^9}, {
   3.897440951874722*^9, 3.8974410747403545`*^9}, {3.897441508388521*^9, 
   3.8974415213363647`*^9}, {3.897441577406584*^9, 3.897441633260468*^9}, {
   3.89760816659741*^9, 3.897608189552846*^9}, {3.89785473503031*^9, 
   3.8978547383911314`*^9}, {3.897858350225738*^9, 3.897858389523212*^9}, {
   3.908747150690553*^9, 3.9087471541297927`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"ed974761-9dcc-4ef1-9668-ef13d8042673"],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Constants and control flags", "Title"]], "Title",
 CellChangeTimes->{{3.8368559613446946`*^9, 3.8368559621411247`*^9}, {
  3.83832142787162*^9, 3.838321433324609*^9}, {3.8383739872383795`*^9, 
  3.838373987747495*^9}, {3.84261861813048*^9, 3.8426186213708706`*^9}, {
  3.854489238595169*^9, 3.854489239418007*^9}, {3.8960569501829157`*^9, 
  3.896056952861331*^9}, {3.897174243059548*^9, 
  3.8971742607882786`*^9}},ExpressionUUID->"88d8a200-e326-437a-a2b1-\
0a7877842aa5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Before", " ", "normalization"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"n0", "=", "1"}], ";", "\[IndentingNewLine]", 
    RowBox[{"c0", "=", 
     RowBox[{"2.998", "*", 
      SuperscriptBox["10", "8"]}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"m", "/", "s"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[CurlyEpsilon]0", "=", 
     RowBox[{"8.854", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "12"}]]}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"C", "/", 
      RowBox[{"(", 
       RowBox[{"m", " ", "V"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[Mu]0", "=", 
     RowBox[{"1.2566", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"N", "/", 
      RowBox[{"A", "^", "2"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[Lambda]0", "=", 
     RowBox[{"0.8", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}]}], ";", " ", 
    RowBox[{"(*", "m", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"dSI", "=", "1"}], 
    RowBox[{"(*", 
     SuperscriptBox["10", 
      RowBox[{"-", "6"}]], "*)"}], ";", "\[IndentingNewLine]", 
    RowBox[{"\[Omega]0", "=", 
     RowBox[{"2", "Pi", " ", 
      RowBox[{"c0", "/", 
       RowBox[{"(", "\[Lambda]0", ")"}]}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"E0", "=", "1"}], 
    RowBox[{"(*", 
     RowBox[{
      SuperscriptBox["10", "6"], " ", 
      RowBox[{"V", "/", "m"}]}], "*)"}], ";"}], "*)"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"After", " ", "normalization"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Lambda]0", "=", "0.8"}], ";"}], 
   RowBox[{"(*", "\[Mu]m", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n0", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"c0", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Omega]0", "=", 
     RowBox[{"N", "@", 
      RowBox[{"(", 
       RowBox[{"2", " ", "Pi", " ", 
        RowBox[{"c0", "/", "\[Lambda]0"}]}], ")"}]}]}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Mu]0", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CurlyEpsilon]0", "=", "1"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Lab1", " ", "=", 
     RowBox[{"{", 
      RowBox[{"1", " ", ",", "0", ",", "0"}], "}"}]}], ";", "    ", 
    RowBox[{"Lab2", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", "    ", 
    RowBox[{"Lab3", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"so", " ", "E0"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"10", "^", "12"}], " ", 
      RowBox[{"V", "/", "m"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"dSI", "=", "1"}], ";"}], " ", "*)"}], 
   RowBox[{"(*", 
    RowBox[{"so", " ", "d", " ", "coefficients", " ", 
     RowBox[{"pm", "/", "V"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"eigenStandard", "=", "True"}], ";"}], " ", "*)"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Change", " ", "how", " ", "the", " ", "eigensystem", " ", "is", " ", 
       "evaluated"}], ";", " ", 
      RowBox[{"True", " ", "for", " ", "standard", " ", "EVP"}], ";", " ", 
      RowBox[{"False", " ", "for", " ", "generalized", " ", "EVP"}], ";", " ", 
      RowBox[{
      "Depending", " ", "on", " ", "whether", " ", "the", " ", "dielectric", 
       " ", "tensor", " ", "has", " ", "imaginary", " ", "part"}]}], ",", " ", 
     RowBox[{"i", ".", "e", "."}], ",", " ", 
     RowBox[{"absorption", ";", " ", 
      RowBox[{"if", " ", "so"}]}], ",", " ", 
     RowBox[{"use", " ", "False"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagBackward", "=", "True"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"flagHorizPhaseShift", "=", "False"}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"debug", "=", "False"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagLinearSolve", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagNSolve", "=", "True"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"noAnalytical", "=", "True"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagStandingWave", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagJK", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagHH", "=", "False"}], ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.838130262356327*^9, {3.838399443573641*^9, 3.838399449152543*^9}, {
   3.838844461927244*^9, 3.838844496899636*^9}, {3.842013437480895*^9, 
   3.842013460996214*^9}, {3.842013528721349*^9, 3.842013580350273*^9}, {
   3.842014153628293*^9, 3.842014182175217*^9}, {3.8420149311463385`*^9, 
   3.842014934466958*^9}, {3.84201503676776*^9, 3.84201503790974*^9}, {
   3.842015145392124*^9, 3.842015147165065*^9}, 3.84201519346814*^9, 
   3.842015315003934*^9, {3.842015630457619*^9, 3.842015675313863*^9}, {
   3.842016130052949*^9, 3.8420161323549547`*^9}, {3.842016372048893*^9, 
   3.8420163772103586`*^9}, {3.8426097896716337`*^9, 3.842609792957*^9}, {
   3.842609854543292*^9, 3.842609869351006*^9}, {3.842610963839002*^9, 
   3.842610987054261*^9}, {3.8426127492754607`*^9, 3.842612750114885*^9}, {
   3.842613448167435*^9, 3.8426134661523905`*^9}, {3.842613672424838*^9, 
   3.842613681751517*^9}, {3.842613726483088*^9, 3.842613727104783*^9}, {
   3.842615094838896*^9, 3.842615095744261*^9}, 3.842615286376325*^9, {
   3.842615353554594*^9, 3.842615353781355*^9}, {3.842621857670888*^9, 
   3.8426218936561394`*^9}, 3.84264660926844*^9, {3.842646643245229*^9, 
   3.842646646563602*^9}, {3.842646908750248*^9, 3.842646949484202*^9}, {
   3.8426497555529013`*^9, 3.8426497628320775`*^9}, {3.842649794972939*^9, 
   3.842649817173744*^9}, {3.842650651095855*^9, 3.84265065120641*^9}, 
   3.8426550592492466`*^9, {3.842655799104016*^9, 3.842655799678192*^9}, {
   3.8428154389579287`*^9, 3.842815443988274*^9}, {3.844158634511166*^9, 
   3.844158643444953*^9}, {3.844158757403498*^9, 3.844158763785598*^9}, {
   3.845062922835438*^9, 3.845062924761401*^9}, {3.845064754611592*^9, 
   3.845064758036474*^9}, {3.8452888764183474`*^9, 3.845288880023301*^9}, 
   3.845288913998796*^9, {3.854489569254717*^9, 3.854489770942683*^9}, {
   3.8852152050192747`*^9, 3.885215242130677*^9}, {3.885592606654632*^9, 
   3.885592610119428*^9}, {3.885593278156595*^9, 3.885593295639739*^9}, {
   3.885593343343672*^9, 3.885593343763165*^9}, {3.885688457380814*^9, 
   3.885688458057515*^9}, {3.886362602985248*^9, 3.886362607165965*^9}, {
   3.887930061360459*^9, 3.887930065892145*^9}, {3.892462386605009*^9, 
   3.892462387105171*^9}, {3.8924908863873606`*^9, 3.8924908969917927`*^9}, {
   3.892501957694131*^9, 3.8925019627661834`*^9}, {3.892502169323886*^9, 
   3.892502221865057*^9}, {3.8936961551206703`*^9, 3.89369616052936*^9}, {
   3.8945886493625116`*^9, 3.894588649691876*^9}, {3.894591091445889*^9, 
   3.894591094476129*^9}, 3.894672036442945*^9, {3.895861089544914*^9, 
   3.8958610924039154`*^9}, {3.8958811607203293`*^9, 3.895881164563575*^9}, {
   3.896045137252825*^9, 3.896045172625966*^9}, {3.896045204650752*^9, 
   3.896045206875878*^9}, {3.896056932304902*^9, 3.896056940916666*^9}, {
   3.896096342870319*^9, 3.896096347301057*^9}, {3.896106327333043*^9, 
   3.896106327899317*^9}, {3.896655723288972*^9, 3.896655723883175*^9}, {
   3.8971063278488784`*^9, 3.897106331030901*^9}, {3.897172968715532*^9, 
   3.897172969096471*^9}, 3.908216706851205*^9, {3.909021224583887*^9, 
   3.9090212269401255`*^9}, 3.909095854479189*^9, {3.909881247442745*^9, 
   3.909881248478554*^9}, {3.9098813374802966`*^9, 3.909881338144337*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"51b750df-eb29-443b-bf24-7fd7f2ec808e"],

Cell[BoxData[{
 RowBox[{"Off", "[", 
  RowBox[{"PolynomialGCD", "::", "lrgexp"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Off", "[", 
  RowBox[{"General", "::", "munfl"}], "]"}]}], "Input",
 CellChangeTimes->{{3.845064855331528*^9, 3.845064862912162*^9}, {
   3.845064899396927*^9, 3.845064904554807*^9}, {3.845065138511583*^9, 
   3.845065150046914*^9}, {3.893714713369342*^9, 3.8937147234706182`*^9}, 
   3.895884973595166*^9, {3.897174220343539*^9, 3.8971742204883456`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"c90f9cda-7762-43b7-9062-eed522c003c5"]
}, Closed]],

Cell[CellGroupData[{

Cell["Setup functions", "Title",
 CellChangeTimes->{{3.854489014864281*^9, 3.854489031571971*^9}, {
  3.897174164867919*^9, 
  3.8971741758568954`*^9}},ExpressionUUID->"2da296c2-29d5-4aef-b5be-\
57b13251ffe6"],

Cell[CellGroupData[{

Cell["Auxiliary functions", "Chapter",
 CellChangeTimes->{{3.845062987548371*^9, 
  3.845062996557543*^9}},ExpressionUUID->"9aede281-19c4-4f37-b5d7-\
bf6c4ce47068"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"m2t3", ",", "t2m3"}], "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "matrix", " ", "notation", " ", "to", " ", "tensor", " ", "for", " ", 
     "tensor", " ", "of", " ", "rank", " ", "3"}], ",", " ", "m2t3"}], "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "tensor", " ", "to", " ", "matrix", " ", "notation", " ", "for", " ", 
     "tensor", " ", "of", " ", "rank", " ", "3"}], ",", " ", "t2m3"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"m2t3", "[", 
    RowBox[{"A_", ",", 
     RowBox[{"factor_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ip", ",", "i", ",", "j", ",", "k"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ip", "=", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{
          RowBox[{"ToString", "[", "11", "]"}], "\[Rule]", "1"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "22", "]"}], "\[Rule]", "2"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "33", "]"}], "\[Rule]", "3"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ToString", "[", "23", "]"}], "\[Rule]", "4"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "32", "]"}], "\[Rule]", "4"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "13", "]"}], "\[Rule]", "5"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "31", "]"}], "\[Rule]", "5"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "21", "]"}], "\[Rule]", "6"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "12", "]"}], "\[Rule]", "6"}]}], "|>"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", 
            RowBox[{"ip", "[", 
             RowBox[{
              RowBox[{"ToString", "[", "j", "]"}], "<>", 
              RowBox[{"ToString", "[", "k", "]"}]}], "]"}]}], "]"}], "]"}], 
         " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"4", "\[LessEqual]", " ", 
            RowBox[{"ip", "[", 
             RowBox[{
              RowBox[{"ToString", "[", "j", "]"}], "<>", 
              RowBox[{"ToString", "[", "k", "]"}]}], "]"}], "\[LessEqual]", 
            " ", "6"}], ",", 
           RowBox[{"1", "/", "factor"}], ",", "1"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "3"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"t2m3", "[", 
    RowBox[{"A_", ",", 
     RowBox[{"factor_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ip", ",", "i", ",", "j"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ip", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", 
            RowBox[{"ip", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"ip", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "2"}], "]"}], "]"}]}], "]"}], "]"}], "*", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"4", "\[LessEqual]", "j", "\[LessEqual]", "6"}], ",", 
           "factor", ",", "1"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "6"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.753287390741014*^9, 3.753287509306856*^9}, {
   3.753287554398059*^9, 3.753287599045537*^9}, {3.771592684584158*^9, 
   3.771592715715247*^9}, {3.771681278916122*^9, 3.771681286037646*^9}, {
   3.797612433547504*^9, 3.7976124695458364`*^9}, 3.797613106559743*^9, {
   3.797613215925797*^9, 3.797613227820726*^9}, {3.797613284550693*^9, 
   3.797613286489273*^9}, 3.802011450461224*^9, {3.802116661188183*^9, 
   3.802116689880628*^9}, {3.802963315382929*^9, 3.802963342939323*^9}, {
   3.805550849260888*^9, 3.8055508606744156`*^9}, {3.805551368566444*^9, 
   3.805551377306875*^9}, {3.8119555159082956`*^9, 3.811955523092436*^9}, {
   3.837894153692382*^9, 3.837894161379652*^9}, {3.838844503218507*^9, 
   3.838844514366094*^9}, {3.8544900129831953`*^9, 3.854490078993662*^9}, 
   3.8958375686833496`*^9},
 CellLabel->"In[21]:=",ExpressionUUID->"14f2bc0a-ec4e-4c7b-9794-7aa3b3a234d3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"setWave", ",", "extWave", ",", "setMater", ",", "extMater"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"setWave", ":", " ", 
     RowBox[{"create", " ", "a", " ", "wave", " ", "object", " ", 
      RowBox[{"(", "Association", ")"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"extWave", ":", " ", 
     RowBox[{
     "extend", " ", "a", " ", "created", " ", "wave", " ", "object", " ", 
      "to", " ", "obtain", " ", "the", " ", "other", " ", "attributes"}]}], 
    ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"setMater", ":", " ", 
     RowBox[{"create", " ", "a", " ", "material", " ", "object", " ", 
      RowBox[{"(", "Association", ")"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"extMater", ":", " ", 
     RowBox[{
     "extend", " ", "a", " ", "created", " ", "material", " ", "object", " ", 
      "to", " ", "obtain", " ", "the", " ", "other", " ", 
      RowBox[{"attributes", "."}]}]}]}], " ", "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"extWave", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"extMater", ",", "HoldAll"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setWave", ":=", 
   RowBox[{
    RowBox[{"AssociationThread", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Omega]", ",", "k", ",", "k0", ",", "\[Theta]", ",", "EE"}], 
       "}"}], "\[Rule]", " ", "#"}], "]"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"extWave", "[", "wav_", "]"}], ":=", 
    RowBox[{"AppendTo", "[", 
     RowBox[{"wav", ",", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Lambda]", ":>", 
         RowBox[{"N", "@", 
          RowBox[{"(", 
           RowBox[{"2", " ", "Pi", " ", 
            RowBox[{"c0", "/", 
             RowBox[{"wav", "[", "\[Omega]", "]"}]}]}], ")"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"H", "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"wav", "[", "\[Omega]", "]"}], "\[Mu]0"}], ")"}]}], 
           ")"}], 
          RowBox[{"Cross", "[", 
           RowBox[{
            RowBox[{"wav", "[", "k", "]"}], ",", 
            RowBox[{"wav", "[", "EE", "]"}]}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"neff", "\[RuleDelayed]", " ", 
         RowBox[{
          RowBox[{"wav", "[", "k0", "]"}], " ", 
          RowBox[{"c0", "/", 
           RowBox[{"wav", "[", "\[Omega]", "]"}]}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"A", "\[RuleDelayed]", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"RotationMatrix", "[", 
            RowBox[{
             RowBox[{"wav", "[", "\[Theta]", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], 
           "\[Transpose]"}], ".", 
          RowBox[{"wav", "[", "EE", "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"phase", ":>", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"wav", "[", "\[Omega]", "]"}], "t"}], "-", 
             RowBox[{
              RowBox[{"wav", "[", "k", "]"}], ".", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], "]"}]}],
         ",", 
        RowBox[{"(*", 
         RowBox[{"pay", " ", "attention", " ", "to", " ", "Re"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"intensity", ":>", 
         RowBox[{
          RowBox[{"Conjugate", "[", 
           RowBox[{"wav", "[", "EE", "]"}], "]"}], ".", 
          RowBox[{"wav", "[", "EE", "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"S", ":>", 
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{"wav", "[", "EE", "]"}], ",", 
           RowBox[{"wav", "[", "H", "]"}]}], "]"}]}]}], " ", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "To", " ", "define", " ", "the", " ", "direction", " ", "of", " ", 
          "D"}], ",", " ", 
         RowBox[{
         "we", " ", "need", " ", "both", " ", "the", " ", "wave", " ", "and", 
          " ", "the", " ", "materials"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setMater", ":=", 
   RowBox[{
    RowBox[{"AssociationThread", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "name", ",", "orientation", ",", "pg", ",", "latcon", ",", 
        "\[CurlyEpsilon]\[Omega]C", ",", "\[CurlyEpsilon]2\[Omega]C", ",", 
        "dC", ",", "h", ",", "QC"}], "}"}], "\[Rule]", "#"}], "]"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"extMater", "[", "mat_", "]"}], ":=", 
   RowBox[{"AppendTo", "[", 
    RowBox[{"mat", ",", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n\[Omega]", "\[RuleDelayed]", 
        RowBox[{"Sort", "@", 
         RowBox[{"Sqrt", "@", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]C", "]"}], "]"}]}]}]}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"n2\[Omega]", "\[RuleDelayed]", 
        RowBox[{"Sort", "@", 
         RowBox[{"Sqrt", "@", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]C", "]"}], 
           "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"QP\[Omega]", ":>", 
        RowBox[{"QC2QP", "[", 
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], ",", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]C", "]"}], ",", 
          RowBox[{
           RowBox[{"mat", "[", "orientation", "]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"QP2\[Omega]", ":>", 
        RowBox[{"QC2QP", "[", 
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], ",", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]C", "]"}], ",", 
          RowBox[{
           RowBox[{"mat", "[", "orientation", "]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]\[Omega]L", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"mat", "[", "QC", "]"}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]C", "]"}], ".", 
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QC", "]"}]}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]2\[Omega]L", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"mat", "[", "QC", "]"}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]C", "]"}], ".", 
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QC", "]"}]}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]\[Omega]P", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QP\[Omega]", "]"}]}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]L", "]"}], ".", 
          RowBox[{"mat", "[", "QP\[Omega]", "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]2\[Omega]P", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QP2\[Omega]", "]"}]}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}], ".", 
          RowBox[{"mat", "[", "QP2\[Omega]", "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"dL", ":>", 
        RowBox[{"t2m3", "@", 
         RowBox[{"TensorContract", "[", 
          RowBox[{
           RowBox[{"TensorProduct", "[", 
            RowBox[{
             RowBox[{"mat", "[", "QC", "]"}], ",", 
             RowBox[{"mat", "[", "QC", "]"}], ",", 
             RowBox[{"mat", "[", "QC", "]"}], ",", 
             RowBox[{"m2t3", "[", 
              RowBox[{"mat", "[", "dC", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "7"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"4", ",", "8"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"6", ",", "9"}], "}"}]}], "}"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.837808083329999*^9, 3.837808109038223*^9}, {
   3.8378100807529697`*^9, 3.83781008287507*^9}, {3.837810201360888*^9, 
   3.837810203112071*^9}, {3.8378938227994432`*^9, 3.837893967735532*^9}, {
   3.8378940187388024`*^9, 3.837894038102308*^9}, {3.837894087405347*^9, 
   3.83789411981152*^9}, {3.837894186183688*^9, 3.83789422136145*^9}, {
   3.837894740902835*^9, 3.837894871506814*^9}, {3.8378951600907564`*^9, 
   3.837895162126977*^9}, {3.837895316094494*^9, 3.837895336003446*^9}, 
   3.8378954094701977`*^9, {3.8379009995929213`*^9, 3.837901001420617*^9}, {
   3.838080102004238*^9, 3.838080106238412*^9}, 3.838121355225505*^9, 
   3.8381302861964*^9, {3.838132384699938*^9, 3.838132394562888*^9}, {
   3.838141888790603*^9, 3.838141889536482*^9}, {3.838477733688236*^9, 
   3.838477799858054*^9}, {3.838478998768882*^9, 3.838479004834486*^9}, {
   3.83847914025099*^9, 3.838479142179*^9}, {3.838479260792677*^9, 
   3.83847926211395*^9}, {3.838480160968072*^9, 3.8384801672139177`*^9}, {
   3.838496074826474*^9, 3.8384960876170664`*^9}, {3.8385080912443027`*^9, 
   3.8385080914603105`*^9}, {3.838844588886248*^9, 3.8388446507205873`*^9}, {
   3.838844684372948*^9, 3.838844815887065*^9}, {3.841739598257861*^9, 
   3.8417396277690554`*^9}, {3.842015073838548*^9, 3.842015078091406*^9}, 
   3.8426236906736164`*^9, 3.842623724056247*^9, {3.842646674400347*^9, 
   3.842646692049489*^9}, {3.854490210392347*^9, 3.854490447642463*^9}, {
   3.854490499358527*^9, 3.8544906223045197`*^9}, {3.8544919493563414`*^9, 
   3.854491964217675*^9}, {3.886384565099035*^9, 3.886384565802201*^9}, {
   3.88793430804221*^9, 3.887934309789757*^9}, {3.887934930925497*^9, 
   3.887934938996603*^9}, 3.888233460993658*^9, {3.8885228000648346`*^9, 
   3.8885228101335278`*^9}, {3.888522842718642*^9, 3.888522851029481*^9}, {
   3.889007505169984*^9, 3.889007505525813*^9}, 3.889013789389907*^9, 
   3.8890144000505834`*^9, {3.889016571281604*^9, 3.889016571659999*^9}, {
   3.893335207966735*^9, 3.8933352086832514`*^9}, 3.8946600559508033`*^9, {
   3.895837439056285*^9, 3.895837441221644*^9}, 3.8958374783316526`*^9, 
   3.895837577412596*^9, {3.895840412108913*^9, 3.895840412633013*^9}, {
   3.895861886359099*^9, 3.8958618918789463`*^9}, {3.895861944867728*^9, 
   3.895861956703132*^9}, 3.895880086578993*^9, {3.8958815628137293`*^9, 
   3.895881566114777*^9}, {3.896043277531657*^9, 3.896043278133692*^9}, {
   3.89604331494793*^9, 3.89604332480977*^9}, {3.896918627988633*^9, 
   3.896918673529722*^9}, 3.897095165003289*^9, {3.897331187816922*^9, 
   3.897331188468194*^9}, {3.8973312300536222`*^9, 3.897331249941637*^9}, {
   3.897331478126912*^9, 3.897331485505226*^9}, {3.89744098492497*^9, 
   3.897440985268732*^9}, {3.89744108963216*^9, 3.897441100165827*^9}, {
   3.897441553695788*^9, 3.8974415541925545`*^9}, {3.897441640280963*^9, 
   3.897441676606819*^9}, {3.8978545798554735`*^9, 3.897854581952622*^9}, 
   3.9087470354062223`*^9, {3.908747080214864*^9, 3.9087471229835863`*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"05d4e82c-14bc-4894-b398-d36d23b22167"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "QC2QP", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"QC2QP", "[", 
   RowBox[{"PointGroup_", ",", "\[CurlyEpsilon]\[Omega]C_", ",", "QC_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Inv", ",", "aCryToPrin"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", " ", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<1\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<m\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<mm2\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Inv", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"aCryToPrin", " ", "=", " ", 
         RowBox[{"Inv", ".", 
          RowBox[{"Eigenvectors", "[", 
           RowBox[{"Re", "[", 
            RowBox[{"MatrixPower", "[", 
             RowBox[{"\[CurlyEpsilon]\[Omega]C", ",", "0.5"}], "]"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", " ", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"SetPrecision", "[", 
            RowBox[{
             RowBox[{"aCryToPrin", ".", "\[CurlyEpsilon]\[Omega]C", ".", 
              RowBox[{"Transpose", "[", "aCryToPrin", "]"}]}], ",", "6"}], 
            "]"}], "==", 
           RowBox[{"SetPrecision", "[", 
            RowBox[{"\[CurlyEpsilon]\[Omega]C", ",", "6"}], "]"}]}], ",", 
          RowBox[{"aCryToPrin", " ", "=", " ", 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"aCryToPrin", " ", "=", " ", 
         RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"aCryToPrin", ".", 
      RowBox[{"Inverse", "[", "QC", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{
  3.895837578146972*^9, {3.895838090414108*^9, 3.895838113705183*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"24039ff0-d77e-4d2b-8ea7-48805393bf98"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "setwInc", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Set", " ", "up", " ", "incident", " ", "wave"}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setwInc", "[", 
   RowBox[{
   "\[Omega]_", ",", "\[Theta]inc_", ",", "\[CapitalDelta]\[Delta]_", ",", 
    "\[CurlyPhi]_", ",", "n0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Ainc", ",", "Einc", ",", "m1", ",", "wInc", ",", "ax", ",", "ay", ",", 
      "\[Delta]x", ",", "\[Delta]y", ",", 
      RowBox[{"E0", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "@", "\[Theta]inc"}], "\[Equal]", " ", "Symbol"}], 
       ",", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Error! Incident light angle needs to be specified!\>\"", "]"}], 
        ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Ainc", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ax", " ", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", " ", "\[Delta]x"}], "]"}]}], ",", 
         RowBox[{"ay", " ", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", " ", "\[Delta]y"}], "]"}]}], ",", "0"}], "}"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ax", "\[Rule]", " ", 
          RowBox[{"E0", " ", 
           RowBox[{"Cos", "[", "\[CurlyPhi]", "]"}]}]}], ",", 
         RowBox[{"ay", "\[Rule]", 
          RowBox[{"E0", " ", 
           RowBox[{"Sin", "[", "\[CurlyPhi]", "]"}]}]}], ",", 
         RowBox[{"\[Delta]x", "\[Rule]", "0"}], ",", 
         RowBox[{"\[Delta]y", "\[Rule]", "\[CapitalDelta]\[Delta]"}]}], 
        "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Einc", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"RotationMatrix", "[", 
         RowBox[{
          RowBox[{"-", "\[Theta]inc"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], 
        "\[Transpose]"}], ".", "Ainc"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wInc", "=", 
      RowBox[{"setWave", "[", 
       RowBox[{"{", 
        RowBox[{"\[Omega]", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"n0", " ", 
            RowBox[{"\[Omega]", "/", "c0"}]}], ")"}], 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Sin", "@", "\[Theta]inc"}], ",", "0", ",", 
            RowBox[{"Cos", "@", "\[Theta]inc"}]}], "}"}]}], ",", 
         RowBox[{"(", 
          RowBox[{"n0", " ", 
           RowBox[{"\[Omega]", "/", "c0"}]}], ")"}], ",", "\[Theta]inc", ",", 
         "Einc"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "wInc", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.837808083329999*^9, 3.837808109038223*^9}, {
   3.8378100807529697`*^9, 3.83781008287507*^9}, {3.837810201360888*^9, 
   3.837810203112071*^9}, {3.8378938227994432`*^9, 3.837893967735532*^9}, {
   3.8378940187388024`*^9, 3.837894038102308*^9}, {3.837894087405347*^9, 
   3.83789411981152*^9}, {3.837894186183688*^9, 3.83789422136145*^9}, {
   3.837894740902835*^9, 3.837894871506814*^9}, {3.8378951600907564`*^9, 
   3.837895162126977*^9}, {3.837895316094494*^9, 3.837895336003446*^9}, 
   3.8378954094701977`*^9, {3.8379009995929213`*^9, 3.837901001420617*^9}, {
   3.838080102004238*^9, 3.838080106238412*^9}, 3.838121355225505*^9, 
   3.8381302861964*^9, {3.838132384699938*^9, 3.838132394562888*^9}, {
   3.838141888790603*^9, 3.838141889536482*^9}, {3.838477733688236*^9, 
   3.838477799858054*^9}, {3.838478998768882*^9, 3.838479004834486*^9}, {
   3.83847914025099*^9, 3.838479142179*^9}, {3.838479260792677*^9, 
   3.83847926211395*^9}, {3.838480160968072*^9, 3.8384801672139177`*^9}, {
   3.838496074826474*^9, 3.8384960876170664`*^9}, {3.8385080912443027`*^9, 
   3.8385080914603105`*^9}, {3.838844588886248*^9, 3.8388446507205873`*^9}, {
   3.838844684372948*^9, 3.838844815887065*^9}, {3.841739598257861*^9, 
   3.8417396277690554`*^9}, {3.842015073838548*^9, 3.842015078091406*^9}, 
   3.8426236906736164`*^9, {3.842623724056247*^9, 3.8426237589482794`*^9}, {
   3.854491982033924*^9, 3.854492189427499*^9}, 3.8958375791622453`*^9, {
   3.895860517656083*^9, 3.895860527710758*^9}, {3.895860659244032*^9, 
   3.89586067095911*^9}, {3.895861052053163*^9, 3.895861083083092*^9}, {
   3.8958612937229834`*^9, 3.895861295541204*^9}, {3.897331347985426*^9, 
   3.897331351660962*^9}, {3.897331545223548*^9, 3.897331548340597*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"03473d21-890c-40c2-aa2c-6155a0c7e300"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "dsym", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "dsym", " ", "read", " ", "in", " ", "a", " ", "mater", " ", "object", 
     " ", "and", " ", "modify", " ", "its", " ", 
     RowBox[{"Key", "[", "dC", "]"}], " ", "by", " ", "the", " ", "symmetry", 
     " ", "constraint", " ", "according", " ", "to", " ", 
     RowBox[{"Key", "[", "pg", "]"}]}], ";", " ", 
    RowBox[{
    "it", " ", "is", " ", "useful", " ", "for", " ", "single", " ", "run", 
     " ", "outside", " ", "the", " ", "GUI"}], ";", " ", 
    RowBox[{
    "it", " ", "is", " ", "also", " ", "useful", " ", "when", " ", "define", 
     " ", "materials", " ", "function"}], ";"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"dsym", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dsym", "[", "mat_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "fsym", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"fsym", "[", 
        RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"i", "\[NotEqual]", 
           RowBox[{
            RowBox[{"IntegerDigits", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "pg", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "\[Or]", 
          RowBox[{"j", "\[NotEqual]", 
           RowBox[{
            RowBox[{"IntegerDigits", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "pg", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", "pg", "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "0"}], ",", 
           "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Sign", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "pg", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "dC", "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"IntegerDigits", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"mat", "[", "pg", "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"IntegerDigits", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"mat", "[", "pg", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ")"}]}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", "dC", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mat", "[", "dC", "]"}], "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"fsym", "@@", "#"}], "&"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "6"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "form", " ", "is", " ", "useful", " ", "when", " ", "define",
      " ", "materials", " ", "function"}], ";", " ", 
    RowBox[{
    "read", " ", "in", " ", "pg", " ", "and", " ", "the", " ", "initial", " ",
      "dC", " ", "and", " ", "return", " ", "the", " ", "symmetrized", " ", 
     "dC"}], ";"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dsym", "[", 
   RowBox[{"pg_", ",", "dC_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "fsym", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"fsym", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"i", "\[NotEqual]", 
          RowBox[{
           RowBox[{"IntegerDigits", "[", 
            RowBox[{"pg", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "\[Or]", 
         RowBox[{"j", "\[NotEqual]", 
          RowBox[{
           RowBox[{"IntegerDigits", "[", 
            RowBox[{"pg", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pg", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "0"}], ",", 
          "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Sign", "[", 
            RowBox[{"pg", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"dC", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"IntegerDigits", "[", 
                 RowBox[{"pg", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"IntegerDigits", "[", 
                RowBox[{"pg", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ")"}]}]}], 
         "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"dC", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"fsym", "@@", "#"}], "&"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "6"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->"In[35]:=",ExpressionUUID->"f1fff8d2-bdfa-4a84-abc8-6acb06a5406e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Setup materials ", "Chapter",
 CellChangeTimes->{{3.840467011689859*^9, 
  3.840467014669623*^9}},ExpressionUUID->"f675d733-5e58-4b94-9785-\
948947b52d1d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Air", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Air", "[", 
   RowBox[{"\[Lambda]_", ":", "1.064"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\[Infinity]\[Infinity]m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Air\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "1"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "1"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.845332766484323*^9, 3.845332795921921*^9}, {
   3.845332834136978*^9, 3.84533283436*^9}, {3.888523009176219*^9, 
   3.888523012485235*^9}, {3.889007570627358*^9, 3.8890075742101464`*^9}, 
   3.8890080269899735`*^9, {3.889013881265599*^9, 3.889013895660239*^9}, {
   3.889014415049775*^9, 3.889014439414218*^9}, 3.889016342374221*^9, {
   3.889016639641178*^9, 3.8890166590573606`*^9}, {3.8890167025931683`*^9, 
   3.8890167044693413`*^9}, {3.889016781840267*^9, 3.889016782381955*^9}, 
   3.89143630012029*^9, {3.89143753400932*^9, 3.891437541130016*^9}, {
   3.8914376961554303`*^9, 3.891437710635779*^9}, {3.892563831444539*^9, 
   3.892563832286707*^9}, 3.892564085493104*^9, {3.892817233534154*^9, 
   3.892817282728448*^9}, {3.89281732013386*^9, 3.892817324126648*^9}, {
   3.8933535200567417`*^9, 3.893353520697375*^9}, 3.894586628549274*^9, {
   3.8945922433283415`*^9, 3.894592250177868*^9}, {3.8946712557012253`*^9, 
   3.8946712661713095`*^9}, {3.894671300367953*^9, 3.894671405388463*^9}, {
   3.894671438824549*^9, 3.894671443379579*^9}, {3.894671478528617*^9, 
   3.8946714922094307`*^9}, {3.8946715315307274`*^9, 3.894671649546376*^9}, {
   3.894671711882967*^9, 3.894671715987898*^9}, {3.8946718431045976`*^9, 
   3.894671939082777*^9}, 3.89467200315673*^9, {3.8946721687559366`*^9, 
   3.894672172328909*^9}, 3.8946727551305776`*^9, {3.894672897499561*^9, 
   3.894672900335682*^9}, {3.894672931358403*^9, 3.894672944243925*^9}, {
   3.8946803365593185`*^9, 3.894680337187819*^9}, 3.895837520371959*^9, {
   3.895863637129712*^9, 3.895863638576*^9}, {3.895865767250534*^9, 
   3.895865797748279*^9}, {3.895865836148788*^9, 3.895865853882175*^9}, {
   3.896043354581947*^9, 3.896043431239033*^9}, {3.896043468789647*^9, 
   3.896043484190863*^9}, {3.89604389668793*^9, 3.8960438981103663`*^9}, 
   3.896665035863579*^9, {3.8966697549047*^9, 3.896669755051424*^9}, 
   3.896750376930528*^9, {3.909067626839009*^9, 3.909067629263108*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"6901761b-5a2a-4c42-9da7-8a0b80534fbd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "blankMaterL", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"blankMaterL", "[", 
   RowBox[{"\[Lambda]_", ":", "1.0"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<m3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"5", ",", "5", ",", "5", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Blank Linear Material\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "2"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "3"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.896748927484727*^9, 3.896748945693947*^9}, {
   3.896748990940816*^9, 3.8967491043081055`*^9}, 3.8967492279913254`*^9, 
   3.896750379953296*^9, {3.896752120120945*^9, 3.896752148848276*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"adb0f516-59df-4b0f-a7ad-3612735eacfa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "blankMaterNL", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"blankMaterNL", "[", 
   RowBox[{"\[Lambda]_", ":", "1.0"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "14", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "14"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"5", ",", "5", ",", "5", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Blank Nonlinear Material\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "2"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "3"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "1"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.896749112362629*^9, 3.896749158267877*^9}, {
   3.896749199220036*^9, 3.896749225304435*^9}, 3.896750381830434*^9, {
   3.89675208281847*^9, 3.896752115081943*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"423403c9-ffce-4ced-b379-9ac057f69afe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "LiNbO3", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LiNbO3", "[", 
   RowBox[{"\[Lambda]_", ":", "1.064"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "15", ",", "0", 
            ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.14", ",", "5.14", ",", "13.50", ",", "90", ",", "90", ",", "120"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "name", "=", "\"\<Z-cut \!\(\*SubscriptBox[\(LiNbO\), \(3\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", "2.294778"}]}], ";", 
     RowBox[{"n3\[Omega]", "=", "2.185673"}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", "2.474147"}]}], ";", 
     RowBox[{"n32\[Omega]", "=", "2.338687"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d22", ",", "d15"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"6.2", ",", "1.0", ",", 
        RowBox[{"-", "0.3"}], ",", "1.2"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.842655080381226*^9, 3.8426550841901236`*^9}, {
   3.842655145821518*^9, 3.8426551671723833`*^9}, {3.842655531211684*^9, 
   3.842655593243911*^9}, {3.884303876663249*^9, 3.884303951649772*^9}, {
   3.888523044568395*^9, 3.888523046283479*^9}, 3.888523077422176*^9, {
   3.889007788333742*^9, 3.889007791424331*^9}, 3.889013903867638*^9, {
   3.889013948103441*^9, 3.889013993729333*^9}, {3.8890144902618313`*^9, 
   3.889014495779154*^9}, {3.889016710674968*^9, 3.8890167108138127`*^9}, {
   3.889016767057283*^9, 3.889016775990918*^9}, {3.891437731054139*^9, 
   3.8914377370654488`*^9}, {3.8925638457328*^9, 3.8925638463521814`*^9}, 
   3.892564094274437*^9, 3.8933535528481054`*^9, {3.89338418536973*^9, 
   3.893384208382173*^9}, {3.894317120027052*^9, 3.894317153073374*^9}, {
   3.8943172548628635`*^9, 3.89431725592747*^9}, {3.894582341075609*^9, 
   3.8945823489967604`*^9}, {3.894585624726663*^9, 3.894585638250597*^9}, 
   3.894585792894455*^9, {3.894586353347005*^9, 3.894586401784198*^9}, {
   3.894592227618774*^9, 3.8945922356884713`*^9}, {3.894658724670315*^9, 
   3.8946587553550777`*^9}, {3.8946721558854384`*^9, 3.894672223974753*^9}, 
   3.8946723424152136`*^9, {3.894672782183144*^9, 3.894672789356727*^9}, {
   3.894672886053246*^9, 3.894672923088453*^9}, {3.894680321757895*^9, 
   3.894680323528154*^9}, {3.895747764457614*^9, 3.895747778192709*^9}, 
   3.89574786122812*^9, 3.895837522047835*^9, {3.8958636178436847`*^9, 
   3.895863624216496*^9}, {3.895865627066858*^9, 3.8958657273127375`*^9}, 
   3.895865858604431*^9, {3.895925180093006*^9, 3.89592519341943*^9}, {
   3.896043546055239*^9, 3.896043555558252*^9}, 3.896665034152508*^9, 
   3.896669758706303*^9, 3.896750384026079*^9},
 CellLabel->"In[45]:=",ExpressionUUID->"3eb09a4c-65d5-4c80-a5a5-6df6f7eacfd7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "LiNbO3xCut\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LiNbO3xCut\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "538.1"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "15", ",", "0", 
            ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.1378", ",", "5.1378", ",", "13.4987", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "name", "=", "\"\<X-cut \!\(\*SubscriptBox[\(LiNbO\), \(3\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Cry1", "  ", "=", " ", 
        RowBox[{"-", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", 
            RowBox[{"Cos", "[", 
             RowBox[{"Pi", "/", "6"}], "]"}]}], ",", 
           RowBox[{"-", 
            RowBox[{"Sin", "[", 
             RowBox[{"Pi", "/", "6"}], "]"}]}]}], "}"}]}]}], ";", "   ", 
       RowBox[{"Cry2", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"Pi", "/", "3"}], "]"}], ",", 
          RowBox[{"-", 
           RowBox[{"Sin", "[", 
            RowBox[{"Pi", "/", "3"}], "]"}]}]}], "}"}]}], ";", "   ", 
       RowBox[{"Cry3", " ", "=", " ", 
        RowBox[{"Cross", "[", 
         RowBox[{"Cry1", ",", "Cry2"}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Cry1", "  ", "=", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", 
          RowBox[{"Sqrt", "@", "2"}]}], ",", 
         RowBox[{"Sqrt", "@", "2"}]}], "}"}], "/", "2"}]}], ";", "   ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"Sqrt", "@", "2"}], ",", 
         RowBox[{"Sqrt", "@", "2"}]}], "}"}], "/", "2"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry1", ",", "Cry2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.02047"}], ")"}]}]}], 
        "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.0666"}], ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "416.08"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.02047"}], 
           ")"}]}]}], "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.0666"}], 
           ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "416.08"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"D", ".", "E", ".", "Zelmon"}], ",", 
       RowBox[{"D", ".", "L", ".", "Small"}], ",", 
       RowBox[{
        RowBox[{"and", " ", 
         RowBox[{"D", ".", "Jundt", ".", "Infrared"}], " ", "corrected", " ", 
         "Sellmeier", " ", "coefficients", " ", "for", " ", "congruently", 
         " ", "grown", " ", "lithium", " ", "niobate", " ", "and", " ", "5", 
         " ", 
         RowBox[{"mol", ".", "%"}], " ", "magnesium", " ", "oxide"}], "-", 
        RowBox[{"doped", " ", "lithium", " ", "niobate"}]}], ",", 
       RowBox[{
        RowBox[{"J", ".", "Opt", ".", "Soc", ".", "Am", ".", "B"}], " ", 
        "14"}], ",", 
       RowBox[{"3319", "-", 
        RowBox[{"3322", " ", 
         RowBox[{"(", "1997", ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d22", ",", "d15"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"5.454", ",", "1", ",", 
         RowBox[{"-", "0.388"}], ",", "1.173"}], "}"}], "*", "3.539"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894582363259985*^9, 3.8945823639389324`*^9}, {
   3.8945825494868917`*^9, 3.8945825949157925`*^9}, {3.8945826932271967`*^9, 
   3.8945827013442326`*^9}, {3.8945827998176785`*^9, 
   3.8945828174161825`*^9}, {3.894582905975268*^9, 3.894582922087063*^9}, {
   3.894582959673998*^9, 3.894583030215909*^9}, {3.89458307637948*^9, 
   3.894583123816849*^9}, {3.8945831900265026`*^9, 3.894583191953596*^9}, {
   3.894583236978216*^9, 3.894583242897235*^9}, {3.8945833058739386`*^9, 
   3.8945833158176126`*^9}, 3.894583514961479*^9, 3.894586694495343*^9, {
   3.894592213789039*^9, 3.894592223149113*^9}, {3.89465741099002*^9, 
   3.894657422828217*^9}, 3.894657860575767*^9, {3.8946587650116143`*^9, 
   3.894658825763139*^9}, {3.894658856533873*^9, 3.894658863920725*^9}, {
   3.894658951819721*^9, 3.894659197492869*^9}, {3.894659249186803*^9, 
   3.89465925215044*^9}, 3.894660950924752*^9, {3.89466102663854*^9, 
   3.894661039023792*^9}, {3.894661124131369*^9, 3.894661128085573*^9}, {
   3.894661165270389*^9, 3.894661171200652*^9}, {3.894661494710918*^9, 
   3.89466154629911*^9}, 3.89466187951642*^9, {3.894664134057277*^9, 
   3.894664145993089*^9}, {3.8946728006275043`*^9, 3.8946728735684*^9}, {
   3.894672963616661*^9, 3.8946729664284163`*^9}, {3.8946803157726746`*^9, 
   3.894680318092904*^9}, {3.895747783540684*^9, 3.895747784757304*^9}, 
   3.89574785818042*^9, 3.895837522992565*^9, 3.8958375810218153`*^9, {
   3.895863646273452*^9, 3.895863647995695*^9}, {3.89586586489486*^9, 
   3.895865872861824*^9}, {3.8959251649968967`*^9, 3.8959251716919203`*^9}, {
   3.8960435010727763`*^9, 3.896043511894735*^9}, 3.896665031979083*^9, 
   3.8966697607897*^9, {3.896750389516585*^9, 3.89675040587534*^9}, {
   3.897176848351478*^9, 3.897176850992095*^9}, {3.909065209322581*^9, 
   3.909065246437378*^9}, {3.909065304123862*^9, 3.909065306169897*^9}, {
   3.9090671980109034`*^9, 3.90906720001088*^9}, 3.909069103136941*^9, {
   3.909069146295218*^9, 3.9090691501344175`*^9}, 3.909069230062849*^9},
 CellLabel->"In[47]:=",ExpressionUUID->"ffe736ff-305b-4fe9-b58a-df11515970fb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "LiNbO3zCut\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LiNbO3zCut\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "119.4"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "15", ",", "0", 
            ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.1378", ",", "5.1378", ",", "13.4987", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "name", "=", "\"\<Z-cut \!\(\*SubscriptBox[\(LiNbO\), \(3\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.02047"}], ")"}]}]}], 
        "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.0666"}], ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "416.08"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.02047"}], 
           ")"}]}]}], "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.0666"}], 
           ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "416.08"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"D", ".", "E", ".", "Zelmon"}], ",", 
       RowBox[{"D", ".", "L", ".", "Small"}], ",", 
       RowBox[{
        RowBox[{"and", " ", 
         RowBox[{"D", ".", "Jundt", ".", "Infrared"}], " ", "corrected", " ", 
         "Sellmeier", " ", "coefficients", " ", "for", " ", "congruently", 
         " ", "grown", " ", "lithium", " ", "niobate", " ", "and", " ", "5", 
         " ", 
         RowBox[{"mol", ".", "%"}], " ", "magnesium", " ", "oxide"}], "-", 
        RowBox[{"doped", " ", "lithium", " ", "niobate"}]}], ",", 
       RowBox[{
        RowBox[{"J", ".", "Opt", ".", "Soc", ".", "Am", ".", "B"}], " ", 
        "14"}], ",", 
       RowBox[{"3319", "-", 
        RowBox[{"3322", " ", 
         RowBox[{"(", "1997", ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d22", ",", "d15"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"5.454", ",", "1", ",", 
         RowBox[{"-", "0.388"}], ",", "1.173"}], "}"}], "*", "3.539"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8946801951441727`*^9, 3.89468022089438*^9}, {
   3.8946803075576687`*^9, 3.894680311420179*^9}, {3.894680589271468*^9, 
   3.8946806302543397`*^9}, {3.894680699066939*^9, 3.8946807020272*^9}, {
   3.8957477965671883`*^9, 3.895747812102058*^9}, 3.895747854220705*^9, 
   3.8958375242474585`*^9, 3.895837581595019*^9, {3.89586365507965*^9, 
   3.895863656683738*^9}, {3.895865878703206*^9, 3.895865888638618*^9}, {
   3.895925156793741*^9, 3.895925160571821*^9}, {3.896043780249897*^9, 
   3.896043780395897*^9}, {3.89604388248248*^9, 3.896043887049894*^9}, 
   3.8966650298054996`*^9, 3.8966697626573386`*^9, {3.896750410248633*^9, 
   3.896750412141355*^9}, {3.8971768615747485`*^9, 3.897176864099617*^9}, {
   3.909067220150881*^9, 3.909067229733935*^9}, 3.909880811306929*^9},
 CellLabel->"In[49]:=",ExpressionUUID->"eda09f38-171f-486c-861e-2ef0036d1ecf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "KTPxCut", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"KTPxCut", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "370.1"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<mm2\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "24", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "32", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "6.40", ",", "10.62", ",", "12.81", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<X-cut KTP\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], " ", ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.03978"}], ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "31.45571"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04597"}], ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "39.43799"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04763"}], ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "86.12171"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.03978"}], 
         ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "31.45571"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04597"}], 
         ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "39.43799"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04763"}], 
         ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "86.12171"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d32", ",", "d31", ",", "d24", ",", "d15"}], "}"}],
       "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4.178", ",", "1", ",", "0.805", ",", "0.997", ",", "0.365"}],
         "}"}], "*", "1.333"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680245949854*^9, 3.8946802945543084`*^9}, {
   3.8946805892871013`*^9, 3.894680630270318*^9}, {3.894680692238202*^9, 
   3.894680696644707*^9}, {3.895747842448019*^9, 3.895747847696395*^9}, 
   3.895837525236875*^9, 3.895837582688763*^9, {3.89586366265184*^9, 
   3.895863665264708*^9}, {3.895881413398962*^9, 3.895881423212115*^9}, {
   3.895925144396271*^9, 3.895925153273678*^9}, {3.8960437839573507`*^9, 
   3.896043784137828*^9}, {3.896043872538624*^9, 3.896043876911891*^9}, 
   3.8966650274331207`*^9, 3.8966697649804025`*^9, {3.896750421442798*^9, 
   3.896750424537697*^9}, 3.89701666655156*^9},
 CellLabel->"In[51]:=",ExpressionUUID->"282025b0-d1ba-4d84-aa03-7c5c8beff868"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "KTPyCut", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"KTPyCut", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "571.4"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<mm2\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "24", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "32", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "6.40", ",", "10.62", ",", "12.81", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Y-cut KTP\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], " ", ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", " ", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry2", ",", "Cry3"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.03978"}], ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "31.45571"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04597"}], ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "39.43799"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04763"}], ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "86.12171"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.03978"}], 
         ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "31.45571"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04597"}], 
         ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "39.43799"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04763"}], 
         ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "86.12171"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d32", ",", "d31", ",", "d24", ",", "d15"}], "}"}],
       "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4.178", ",", "1", ",", "0.805", ",", "0.997", ",", "0.365"}],
         "}"}], "*", "1.333"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{
  3.8946803642279873`*^9, {3.894680589302722*^9, 3.894680630270318*^9}, {
   3.894680686125657*^9, 3.894680689648843*^9}, {3.894681123262018*^9, 
   3.8946811251534348`*^9}, {3.895747867736511*^9, 3.895747871346724*^9}, 
   3.895837526094018*^9, 3.895837583313742*^9, {3.89586366971431*^9, 
   3.895863671849382*^9}, {3.895881425646021*^9, 3.8958814387321944`*^9}, {
   3.895925134886552*^9, 3.89592514117666*^9}, {3.896043787088994*^9, 
   3.896043787272547*^9}, {3.896043866520846*^9, 3.896043870215077*^9}, 
   3.896665025491535*^9, 3.896669767707314*^9, {3.896750429540289*^9, 
   3.896750430658438*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"a2056cca-1ec8-4bef-8b38-d6985ff4b1e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "ZnO001", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ZnO001", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.159"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<6mm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "15", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "3.2342", ",", "3.2342", ",", "5.1772", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<ZnO\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Axo", " ", "=", " ", "1.9289"}], ",", " ", 
         RowBox[{"Bxo", " ", "=", " ", "0.010689"}], ",", " ", 
         RowBox[{"Cxo", " ", "=", "0.00530"}], ",", 
         RowBox[{"Axe", " ", "=", "1.848"}], ",", " ", 
         RowBox[{"Bxe", " ", "=", " ", "0.08447"}], ",", " ", 
         RowBox[{"Cxe", " ", "=", 
          RowBox[{"-", "0.00818"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n1\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox["\[Lambda]", "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox["\[Lambda]", "4"]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"n2\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox["\[Lambda]", "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox["\[Lambda]", "4"]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"n3\[Omega]", "=", 
         RowBox[{"Axe", "+", 
          RowBox[{"Bxe", "/", 
           SuperscriptBox["\[Lambda]", "2"]}], "+", 
          RowBox[{"Cxe", "/", 
           SuperscriptBox["\[Lambda]", "4"]}]}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Axo", " ", "=", " ", "1.917"}], ",", " ", 
         RowBox[{"Bxo", " ", "=", " ", "0.02730"}], ",", " ", 
         RowBox[{"Cxo", " ", "=", "0.002"}], ",", 
         RowBox[{"Axe", " ", "=", " ", "1.917"}], ",", " ", 
         RowBox[{"Bxe", " ", "=", " ", "0.02730"}], ",", 
         RowBox[{"Cxe", " ", "=", "0.002"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n12\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "4"]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n22\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "4"]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n32\[Omega]", "=", 
         RowBox[{"Axe", "+", 
          RowBox[{"Bxe", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"]}], "+", 
          RowBox[{"Cxe", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "4"]}]}]}]}]}], "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d15"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "6.654"}], ",", "0.830", ",", "1.079"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8946803778195314`*^9, 3.894680394227428*^9}, {
   3.894680589302722*^9, 3.894680630285942*^9}, {3.894680681545948*^9, 
   3.894680683426842*^9}, {3.895747875698756*^9, 3.895747878068119*^9}, 
   3.895837526797143*^9, 3.895837584094641*^9, {3.8958636778523326`*^9, 
   3.895863679553733*^9}, {3.89588144505348*^9, 3.895881452598207*^9}, {
   3.895925130345343*^9, 3.895925131148031*^9}, {3.89604379066364*^9, 
   3.896043791558778*^9}, {3.896043857582008*^9, 3.896043864744508*^9}, 
   3.896665022538132*^9, 3.8966697693143597`*^9, {3.896750438795487*^9, 
   3.896750450754822*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"9981114f-ed8d-496c-a589-3cac37e71ab9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Pt111\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Pt111\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.2"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<m3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "3.944", ",", "3.944", ",", "3.944", ",", "90", ",", "90", ",", "90"}],
        "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Pt\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Cry1", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "0.408248"}], ",", "0.707107", ",", "0.57735"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Cry2", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "0.408248"}], ",", 
          RowBox[{"-", "0.707107"}], ",", "0.57735"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Cry3", "=", 
        RowBox[{"Cross", "[", 
         RowBox[{"Cry1", ",", "Cry2"}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Cry1", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "/", 
            RowBox[{"(", 
             RowBox[{"\[Sqrt]", "2"}], ")"}]}], ")"}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", "  ", 
       RowBox[{"Cry2", "=", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"-", 
           RowBox[{"\[Sqrt]", 
            RowBox[{"(", 
             RowBox[{"2", "/", "3"}], ")"}]}]}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", " ", 
       RowBox[{"Cry3", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"\[Sqrt]", "2"}], ")"}]}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"orientation", "=", 
        RowBox[{"{", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"-", "2"}], ",", "1"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], 
       ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", 
        RowBox[{"1.7719", "+", 
         RowBox[{"16.193", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", 
        RowBox[{"0.55572", "+", 
         RowBox[{"7.7907", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680414620223*^9, 3.8946804326369905`*^9}, {
   3.894680589318348*^9, 3.894680630301571*^9}, {3.8957478859556828`*^9, 
   3.895747889877687*^9}, 3.8958375277208643`*^9, 3.895837584673145*^9, {
   3.895863684257454*^9, 3.89586368535365*^9}, {3.8958814566994743`*^9, 
   3.8958814623702974`*^9}, {3.895925125464131*^9, 3.895925126213408*^9}, 
   3.895931023517821*^9, {3.896043795248493*^9, 3.896043795686414*^9}, {
   3.896043851453687*^9, 3.896043854924721*^9}, 3.8966650207274733`*^9, 
   3.896669772301193*^9, {3.896750444481723*^9, 3.896750454368113*^9}, {
   3.909067689947498*^9, 3.9090677302987137`*^9}, {3.9090677607357607`*^9, 
   3.909067807062454*^9}, {3.909067855023007*^9, 3.909067856038633*^9}, {
   3.9158869277606783`*^9, 3.915886931591642*^9}, {3.915887394785593*^9, 
   3.9158873951204777`*^9}, {3.91588744741914*^9, 3.9158874527737503`*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"a377865e-d91b-4b72-bcbc-7ba18c1e943b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Al2O3$0001\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Al2O3$0001\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "100"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<6/mmm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.7606", ",", "4.7606", ",", "12.994", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "name", "=", 
      "\"\<\!\(\*SubscriptBox[\(Al\), \(2\)]\)\!\(\*SubscriptBox[\(O\), \
\(3\)]\)\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", "1.7462"}]}], ";", 
     RowBox[{"n3\[Omega]", "=", "1.7384"}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", "1.7608"}]}], ";", 
     RowBox[{"n32\[Omega]", "=", "1.7529"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680450820321*^9, 3.8946804572137175`*^9}, {
   3.894680589333973*^9, 3.894680630301571*^9}, {3.895747926508278*^9, 
   3.8957479391713157`*^9}, 3.8958375289240065`*^9, 3.895837585341518*^9, 
   3.895863690761427*^9, {3.895881469323343*^9, 3.895881476975786*^9}, {
   3.8959251220759335`*^9, 3.8959251229607763`*^9}, {3.896043798550697*^9, 
   3.896043798901049*^9}, {3.896043845367012*^9, 3.896043849060902*^9}, 
   3.896665018864329*^9, 3.896669776970318*^9},
 CellLabel->"In[59]:=",ExpressionUUID->"aa7e4467-99fe-495d-8e26-34dab5319814"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Quartz$xCut\[Lambda]1064", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Quartz$xCut\[Lambda]1064", "[", 
   RowBox[{"\[Lambda]_", ":", "1.064"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "300"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<32\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"11", ",", 
            RowBox[{"-", "11"}], ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", 
            RowBox[{"-", "14"}], ",", 
            RowBox[{"-", "11"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.913", ",", "4.913", ",", "5.405", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<X-cut Quartz\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Cry1", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", "   ", 
       RowBox[{"Cry2", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", "   ", 
       RowBox[{"Cry2", " ", "=", " ", 
        RowBox[{"Cross", "[", 
         RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"orientation", "=", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"2", ",", 
              RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"isotropic", " ", "assumption", " ", "following", " ", "HH"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "1.53413"}]}]}], " ", ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "1.54702"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "0.0"}], ";", 
     RowBox[{"d11", "=", "0.3"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680469343038*^9, 3.894680492906515*^9}, {
   3.894680589349596*^9, 3.894680630317193*^9}, {3.894680666931269*^9, 
   3.894680668102784*^9}, {3.895747949271001*^9, 3.8957479560860534`*^9}, 
   3.8958375319638925`*^9, 3.8958375859506884`*^9, {3.895863699474267*^9, 
   3.895863701486473*^9}, {3.895881479724919*^9, 3.895881486883256*^9}, {
   3.896043801470464*^9, 3.8960438019255533`*^9}, {3.896043839582748*^9, 
   3.896043842773583*^9}, 3.896665015752559*^9, 3.896669778942253*^9, {
   3.896750465184737*^9, 3.896750465609867*^9}, {3.8970986411504874`*^9, 
   3.897098641370947*^9}, {3.8971758141743517`*^9, 3.897175834683059*^9}, {
   3.9090231878752775`*^9, 3.909023222832971*^9}, {3.9090232642316847`*^9, 
   3.909023283918393*^9}, {3.909067562511897*^9, 3.909067593794855*^9}, {
   3.909067997857256*^9, 3.9090679980624995`*^9}, 3.909068039506214*^9},
 CellLabel->"In[61]:=",ExpressionUUID->"c6b72c7a-8011-4118-b60d-4c51f1e44794"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Quartz$zCut\[Lambda]800", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Quartz$zCut\[Lambda]800", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "121.1"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<32\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"11", ",", 
            RowBox[{"-", "11"}], ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", 
            RowBox[{"-", "14"}], ",", 
            RowBox[{"-", "11"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.913", ",", "4.913", ",", "5.405", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Z-cut Quartz\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"co1", " ", "=", " ", "0.663044"}], ",", " ", 
         RowBox[{"co2", " ", "=", " ", "0.060"}], ",", " ", 
         RowBox[{"co3", " ", "=", "0.517852"}], ",", 
         RowBox[{"co4", " ", "=", " ", "0.106"}], ",", " ", 
         RowBox[{"co5", "  ", "=", "0.175912"}], ",", 
         RowBox[{"co6", " ", "=", "0.119"}], ",", 
         RowBox[{"co7", "=", "0.565380"}], " ", ",", 
         RowBox[{"co8", " ", "=", "8.844"}], ",", 
         RowBox[{"co9", "=", "1.675299"}], ",", 
         RowBox[{"co10", " ", "=", "20.742"}], ",", 
         RowBox[{"ce1", " ", "=", " ", "0.665721"}], ",", " ", 
         RowBox[{"ce2", " ", "=", " ", "0.060"}], ",", " ", 
         RowBox[{"ce3", " ", "=", "0.503511"}], ",", 
         RowBox[{"ce4", " ", "=", "0.106"}], ",", " ", 
         RowBox[{"ce5", "  ", "=", "0.214792"}], ",", 
         RowBox[{"ce6", " ", "=", "0.119"}], ",", 
         RowBox[{"ce7", "=", "0.539173"}], " ", ",", 
         RowBox[{"ce8", " ", "=", "8.792"}], ",", 
         RowBox[{"ce9", "=", "1.807613"}], ",", 
         RowBox[{"ce10", " ", "=", "19.70"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n1\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n2\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n3\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"ce1", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce3", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce5", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce7", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce9", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"n12\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n22\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n32\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"ce1", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce3", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce5", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce7", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce9", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce10", "2"]}], ")"}]}]}]}], "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"n1\[Omega]", "=", 
        RowBox[{"n2\[Omega]", "=", "1.538360"}]}], ";", 
       RowBox[{"n3\[Omega]", "=", "1.5473"}], ";", "\[IndentingNewLine]", 
       RowBox[{"n12\[Omega]", "=", 
        RowBox[{"n22\[Omega]", "=", "1.5577"}]}], ";", 
       RowBox[{"n32\[Omega]", "=", "1.5673"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "0.0"}], ";", 
     RowBox[{"d11", "=", "0.3"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680511029557*^9, 3.894680539080276*^9}, {
   3.894680589373266*^9, 3.894680660929772*^9}, {3.895747962025387*^9, 
   3.895747965481039*^9}, 3.8958375340374117`*^9, 3.895837586922251*^9, {
   3.8958637102672477`*^9, 3.8958637124649506`*^9}, {3.895881490175833*^9, 
   3.895881497788248*^9}, {3.895925106721271*^9, 3.895925117564095*^9}, {
   3.896043804709467*^9, 3.896043835759937*^9}, 3.896665011372362*^9, 
   3.896669780801416*^9, {3.8967505419711447`*^9, 3.896750558941663*^9}, {
   3.89691428513926*^9, 3.8969142874111633`*^9}, {3.89691489297744*^9, 
   3.896914896097435*^9}, {3.896915237845811*^9, 3.896915240889225*^9}, {
   3.8969171547041173`*^9, 3.896917156763828*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"346979b3-54f5-4a44-b833-82392ea2670b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Au\[Lambda]800", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Au\[Lambda]800", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.0139"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\[Infinity]\[Infinity]m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.07", ",", "4.07", ",", "4.07", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Au Coating\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", 
        RowBox[{"3.479500", "+", 
         RowBox[{"2.921145", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", 
        RowBox[{"2.251755", "+", 
         RowBox[{"1.596650", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "0.0"}], ";", 
     RowBox[{"d11", "=", "0.3"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8946805554435964`*^9, 3.894680653497801*^9}, {
   3.89574797037466*^9, 3.89574797507477*^9}, 3.895837536974988*^9, 
   3.895837587812747*^9, 3.895863718872358*^9, {3.8958815017946424`*^9, 
   3.8958815084015217`*^9}, {3.89604380903773*^9, 3.896043827758664*^9}, {
   3.896665003529061*^9, 3.896665004607565*^9}, 3.896669783440449*^9, {
   3.8967505493939753`*^9, 3.8967505503297524`*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"d3f1f024-15ad-4152-8c84-cca002cb4693"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "GaAs111\[Lambda]800", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GaAs111\[Lambda]800", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "14", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "14"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.65", ",", "5.65", ",", "5.65", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<GaAs\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "/", 
          RowBox[{"(", 
           RowBox[{"\[Sqrt]", "2"}], ")"}]}], ")"}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", "  ", 
     RowBox[{"Cry2", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", 
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{"2", "/", "3"}], ")"}]}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", " ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "2"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "2"}], ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"3.666", "+", 
       RowBox[{"I", " ", "0.059"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"3.666", "+", 
       RowBox[{"I", " ", "0.059"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"3.666", "+", 
       RowBox[{"I", " ", "0.059"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"4.509", "+", " ", 
       RowBox[{"I", " ", "1.948"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"4.509", "+", " ", 
       RowBox[{"I", " ", "1.948"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"4.509", "+", " ", 
       RowBox[{"I", " ", "1.948"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "270"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"SetPrecision", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"{", 
            RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], 
            "}"}], "2"], ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"SetPrecision", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"{", 
            RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
            "}"}], "2"], ",", "2"}], "]"}], "]"}], ",", "dC", ",", 
       "thickness", ",", "QC"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8959244814176254`*^9, 3.8959245642889643`*^9}, {
   3.895924594331517*^9, 3.8959248044584074`*^9}, {3.89592484607351*^9, 
   3.895924955499893*^9}, {3.8959249978470216`*^9, 3.8959250256096964`*^9}, {
   3.896043813816211*^9, 3.896043822446688*^9}, 3.8966649985782*^9, 
   3.896669785873277*^9, {3.8967505689544673`*^9, 3.896750570552704*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"e656aca1-870f-40c0-9b93-4b128951c607"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "GaAs111\[Lambda]1064", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GaAs111\[Lambda]1064", "[", 
   RowBox[{"\[Lambda]_", ":", "1.064"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.01"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "14", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "14"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.65", ",", "5.65", ",", "5.65", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<GaAs(111)@1064nm\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "/", 
          RowBox[{"(", 
           RowBox[{"\[Sqrt]", "2"}], ")"}]}], ")"}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", "  ", 
     RowBox[{"Cry2", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", 
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{"2", "/", "3"}], ")"}]}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", " ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "2"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", "3.468429039204925`"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", "3.468429039204925`"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", "3.468429039204925`"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"4.115823125451335`", "\[VeryThinSpace]", "+", 
       RowBox[{"2.73`", " ", "\[ImaginaryI]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"4.115823125451335`", "\[VeryThinSpace]", "+", 
       RowBox[{"2.73`", " ", "\[ImaginaryI]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"4.115823125451335`", "\[VeryThinSpace]", "+", 
       RowBox[{"2.73`", " ", "\[ImaginaryI]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", 
      RowBox[{"165", "-", 
       RowBox[{"475", "I"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"SetPrecision", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"{", 
            RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], 
            "}"}], "2"], ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"SetPrecision", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"{", 
            RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
            "}"}], "2"], ",", "2"}], "]"}], "]"}], ",", "dC", ",", 
       "thickness", ",", "QC"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8959244814176254`*^9, 3.8959245642889643`*^9}, {
   3.895924594331517*^9, 3.8959248044584074`*^9}, {3.89592484607351*^9, 
   3.895924955499893*^9}, {3.8959249978470216`*^9, 3.8959250256096964`*^9}, {
   3.896043813816211*^9, 3.896043822446688*^9}, 3.8966649985782*^9, 
   3.896669785873277*^9, {3.8967505689544673`*^9, 3.896750570552704*^9}, {
   3.909094773065096*^9, 3.909094834564039*^9}, {3.909094878059495*^9, 
   3.909094947180898*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"66978982-1041-49f3-aa3e-da692dc3a573"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "BTOrhombo", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BTOrhombo", "[", 
   RowBox[{"\[Lambda]_", ":", "1.073"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "dielectricTensor", ",", 
      "\[IndentingNewLine]", "d11", ",", "d12", ",", "d13", ",", "d14", ",", 
      "d15", ",", "d16", ",", "d21", ",", "d22", ",", "d23", ",", "d24", ",", 
      "d25", ",", "d26", ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", 
      "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1.0"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<m3mm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.03", ",", "4.03", ",", "4.03", ",", "89.84", ",", "89.84", ",", 
        "89.84"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<BaTiO3\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2507"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2507"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2507"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2507"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2507"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2507"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"dielectricTensor", "=", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}], 
        "^", "2"}], "]"}]}], ";", 
     RowBox[{
      RowBox[{"dielectricTensor", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", 
         RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "=", 
      RowBox[{"{", 
       RowBox[{"0.1224", ",", "0.1224"}], "}"}]}], ";", 
     RowBox[{
      RowBox[{"dielectricTensor", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}], "=", "0.1224"}], ";", 
     RowBox[{
      RowBox[{"dielectricTensor", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "3"}], "]"}], "]"}], "=", 
      RowBox[{"-", "0.1224"}]}], ";", 
     RowBox[{
      RowBox[{"dielectricTensor", "[", 
       RowBox[{"[", 
        RowBox[{"3", ",", 
         RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "=", 
      RowBox[{"{", 
       RowBox[{"0.1224", ",", 
        RowBox[{"-", "0.1224"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"(*", 
        RowBox[{"DiagonalMatrix", "[", 
         SuperscriptBox[
          RowBox[{"{", 
           RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], 
           "}"}], "2"], "]"}], "*)"}], "dielectricTensor", ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.89700903142362*^9, 3.89700903423113*^9}, {
  3.897009109336186*^9, 3.897009120847371*^9}, {3.89700915266514*^9, 
  3.897009300800527*^9}, {3.897009515992498*^9, 3.897009533829266*^9}, {
  3.897009579544096*^9, 3.89700961790901*^9}, {3.89700978670242*^9, 
  3.897009788916156*^9}, {3.897010071485079*^9, 3.897010100233639*^9}, {
  3.91089037038723*^9, 3.910890435179271*^9}, {3.910890468475318*^9, 
  3.910890535568411*^9}, {3.9108905840060387`*^9, 3.910890597454523*^9}, {
  3.910890635885158*^9, 3.9108906477791014`*^9}, {3.910890735528483*^9, 
  3.910890735780139*^9}, {3.910907639435784*^9, 3.9109076538901434`*^9}, {
  3.9118605707081137`*^9, 3.911860607884734*^9}, {3.914760004534403*^9, 
  3.914760009176742*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"35dcb8f3-79e8-43ac-af55-cb7fe16d27e0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "BTO", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BTO", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<4mm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "15", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.0", ",", "4.0", ",", "4.02", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<BaTiO3\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.3787"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.3787"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2316"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "6.0757"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "6.0757"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.8234"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d15", "=", "35"}], ";", 
     RowBox[{"d31", "=", "37"}], ";", 
     RowBox[{"d33", "=", "14"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.89700903142362*^9, 3.89700903423113*^9}, {
  3.897009109336186*^9, 3.897009120847371*^9}, {3.89700915266514*^9, 
  3.897009300800527*^9}, {3.897009515992498*^9, 3.897009533829266*^9}, {
  3.897009579544096*^9, 3.89700961790901*^9}, {3.89700978670242*^9, 
  3.897009788916156*^9}, {3.897010071485079*^9, 3.897010100233639*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"f020739b-0177-430b-bd1b-e2d44d46dc07"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "MoS2", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MoS2", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.00065"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "0", ",", "0", ",",
             "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "3.19", ",", "3.19", ",", "6.50", ",", "90", ",", "90", ",", "120"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<\!\(\*SubscriptBox[\(MoS\), \(2\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"Sqrt", "@", "10.776"}]}]}], ";", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "1.9395"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"0.2489", "+", 
         RowBox[{"14.57", " ", "I"}]}], "]"}]}]}], ";", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "[", "1.9395", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "d22", "}"}], "=", 
      RowBox[{"{", "158.19", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.842655080381226*^9, 3.8426550841901236`*^9}, {
   3.842655145821518*^9, 3.8426551671723833`*^9}, {3.842655531211684*^9, 
   3.842655593243911*^9}, {3.884303876663249*^9, 3.884303951649772*^9}, {
   3.888523044568395*^9, 3.888523046283479*^9}, 3.888523077422176*^9, {
   3.889007788333742*^9, 3.889007791424331*^9}, 3.889013903867638*^9, {
   3.889013948103441*^9, 3.889013993729333*^9}, {3.8890144902618313`*^9, 
   3.889014495779154*^9}, {3.889016710674968*^9, 3.8890167108138127`*^9}, {
   3.889016767057283*^9, 3.889016775990918*^9}, {3.891437731054139*^9, 
   3.8914377370654488`*^9}, {3.8925638457328*^9, 3.8925638463521814`*^9}, 
   3.892564094274437*^9, 3.8933535528481054`*^9, {3.89338418536973*^9, 
   3.893384208382173*^9}, {3.894317120027052*^9, 3.894317153073374*^9}, {
   3.8943172548628635`*^9, 3.89431725592747*^9}, {3.894582341075609*^9, 
   3.8945823489967604`*^9}, {3.894585624726663*^9, 3.894585638250597*^9}, 
   3.894585792894455*^9, {3.894586353347005*^9, 3.894586401784198*^9}, {
   3.894592227618774*^9, 3.8945922356884713`*^9}, {3.894658724670315*^9, 
   3.8946587553550777`*^9}, {3.8946721558854384`*^9, 3.894672223974753*^9}, 
   3.8946723424152136`*^9, {3.894672782183144*^9, 3.894672789356727*^9}, {
   3.894672886053246*^9, 3.894672923088453*^9}, {3.894680321757895*^9, 
   3.894680323528154*^9}, {3.895747764457614*^9, 3.895747778192709*^9}, 
   3.89574786122812*^9, 3.895837522047835*^9, {3.8958636178436847`*^9, 
   3.895863624216496*^9}, {3.895865627066858*^9, 3.8958657273127375`*^9}, 
   3.895865858604431*^9, {3.895925180093006*^9, 3.89592519341943*^9}, {
   3.896043546055239*^9, 3.896043555558252*^9}, 3.896665034152508*^9, 
   3.896669758706303*^9, 3.896750384026079*^9, {3.904176054109989*^9, 
   3.904176077575979*^9}, {3.9041761155012717`*^9, 3.9041761195293274`*^9}, {
   3.904176163565367*^9, 3.904176223996493*^9}, {3.904176368134694*^9, 
   3.9041764176611757`*^9}, 3.904176550009095*^9, {3.904176660128357*^9, 
   3.9041766702794275`*^9}, {3.9041772355200806`*^9, 3.904177238701792*^9}, {
   3.906757273977559*^9, 3.906757290208516*^9}, {3.906760111834385*^9, 
   3.906760122661182*^9}, {3.906761426258911*^9, 3.9067614296953583`*^9}, {
   3.906761689148563*^9, 3.906761690375826*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"189a9a34-e96d-4c88-b4fb-962a05f5a3ae"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Visualization ", "Chapter",
 CellChangeTimes->{{3.845062987548371*^9, 3.845062996557543*^9}, {
  3.848922903111269*^9, 3.8489229050578566`*^9}, {3.854489241892913*^9, 
  3.854489247367448*^9}},ExpressionUUID->"6c361ee8-c60a-4774-93ea-\
8e8a4864c6a7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "pltWav", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"plot", " ", "wave", " ", "quickly"}], ";", " ", 
    RowBox[{"use", " ", "with", " ", "Graphics3D"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"pltWav", "[", 
    RowBox[{"wav_", ",", "pos_", ",", "color_", ",", 
     RowBox[{"thickness_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"thscale", "=", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"color", ",", 
       RowBox[{"Arrow", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"pos", ",", "pos"}], "}"}], "+", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"thscale", " ", 
            RowBox[{"Normalize", "@", 
             RowBox[{"Re", "@", 
              RowBox[{"wav", "[", "k", "]"}]}]}]}]}], "}"}]}], "]"}]}], 
      "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.837895929941512*^9, 3.837895938170895*^9}, {
   3.838844520765436*^9, 3.838844550187666*^9}, {3.846525129243972*^9, 
   3.846525132271109*^9}, {3.846528873103463*^9, 3.8465288831197968`*^9}, {
   3.848011267251758*^9, 3.84801127307761*^9}, {3.848011331445773*^9, 
   3.848011360637872*^9}, {3.848011452221977*^9, 3.8480115151241617`*^9}, {
   3.8480116492784204`*^9, 3.848011678226552*^9}, {3.848011805949533*^9, 
   3.8480118104248266`*^9}, {3.8544898661809025`*^9, 3.854489890108968*^9}, {
   3.854489933681674*^9, 3.854489934083889*^9}, {3.8863653109571223`*^9, 
   3.886365323124114*^9}, 3.886365491440099*^9, {3.886365576316636*^9, 
   3.886365589349431*^9}, 3.886365620155194*^9, {3.886365699845317*^9, 
   3.886365714494313*^9}, {3.893337626357515*^9, 3.893337626795015*^9}, {
   3.893338768304279*^9, 3.8933387718749046`*^9}, {3.893339097959325*^9, 
   3.893339100927888*^9}, {3.894592451034591*^9, 3.8945924920889387`*^9}, 
   3.894592598339398*^9, {3.89459269075128*^9, 3.8945927205004854`*^9}, {
   3.8945927762091093`*^9, 3.894592808443256*^9}, {3.894593213072794*^9, 
   3.8945932189332457`*^9}, {3.894593315030353*^9, 3.894593320010736*^9}, {
   3.894593350434316*^9, 3.894593377579097*^9}, {3.894593447706217*^9, 
   3.894593448581365*^9}, {3.894593652464726*^9, 3.8945936631493874`*^9}, 
   3.894593744496228*^9, {3.895365541436553*^9, 3.895365546760451*^9}, 
   3.895366685410787*^9, {3.895367291353115*^9, 3.895367291702284*^9}, {
   3.8953673945717063`*^9, 3.895367399256281*^9}, {3.89586068733958*^9, 
   3.895860718400699*^9}, {3.895866208684989*^9, 3.895866208765851*^9}},
 CellLabel->"In[77]:=",ExpressionUUID->"b6ae3fa6-73c0-476f-92c5-395265f1e96b"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Basic core functions ", "Title",
 CellChangeTimes->{{3.854489048361622*^9, 3.854489050570813*^9}, {
  3.8971741723745356`*^9, 
  3.897174173019218*^9}},ExpressionUUID->"1a7c80c2-7a75-461d-b5f3-\
4f54257b8e10"],

Cell[CellGroupData[{

Cell["Solver for Snell\[CloseCurlyQuote]s law ", "Chapter",
 CellChangeTimes->{{3.8368559613446946`*^9, 3.8368559621411247`*^9}, {
  3.83832142787162*^9, 3.838321433324609*^9}, {3.8383739872383795`*^9, 
  3.838373987747495*^9}, {3.84261861813048*^9, 3.8426186401152368`*^9}, {
  3.8544892737836533`*^9, 3.854489300893743*^9}, {3.8924904918959723`*^9, 
  3.892490505189441*^9}},ExpressionUUID->"ba179bfb-303a-47b6-8653-\
fccc4defc35a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Solve", " ", "for", " ", "the", " ", "wave", " ", "vector", " ", "and", 
    " ", "electric", " ", "field", " ", "direction", " ", "of", " ", "the", 
    " ", 
    RowBox[{"reflective", "/", "transmitive"}], " ", "waves"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", "solveSnell", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"solveSnell", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Inputs", ":"}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"mat", " ", "-", " ", 
       RowBox[{"the", " ", "material"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wIn", " ", "-", " ", 
       RowBox[{"the", " ", "incident", " ", "wave"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wOut1", " ", "-", " ", 
       RowBox[{"the", " ", "output", " ", 
        RowBox[{"(", 
         RowBox[{"reflective", " ", "or", " ", "transmitive"}], ")"}], " ", 
        "wave", " ", "1"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"wOut2", " ", "-", " ", 
       RowBox[{"the", " ", "output", " ", 
        RowBox[{"(", 
         RowBox[{"reflective", " ", "or", " ", "transmitive"}], ")"}], " ", 
        "wave", " ", "2"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"reflect", " ", "-", " ", 
       RowBox[{"if", " ", "True"}]}]}], ",", " ", 
     RowBox[{
      RowBox[{"compute", " ", "reflective", " ", "wave"}], ";", " ", 
      RowBox[{"if", " ", "False"}]}], ",", " ", 
     RowBox[{
      RowBox[{"compute", " ", "transmitive", " ", "wave"}], ";", " ", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Outputs", ":"}], ";", "\[IndentingNewLine]", 
      RowBox[{"k", " ", "and", " ", "E", " ", "vectors", " ", 
       RowBox[{"(", 
        RowBox[{
        "only", " ", "direction", " ", "with", " ", "normalized", " ", 
         "magnitude"}], ")"}], " ", "for", " ", "wOut1", " ", "and", " ", 
       "wOut2"}]}], ",", " ", 
     RowBox[{
      RowBox[{
      "stored", " ", "in", " ", "the", " ", "objects", " ", "wOut1", " ", 
       "and", " ", 
       RowBox[{"wOut2", "."}]}], " ", ";"}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"solveSnell", "[", 
     RowBox[{"mat_", ",", "wIn_", ",", "wOut1_", ",", "wOut2_", ",", 
      RowBox[{"reflect_", ":", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Theta]t", ",", "n0", ",", "ux", ",", "uy", ",", "uz", ",", "L", ",",
         "R", ",", "V", ",", "W", ",", "\[CapitalLambda]", ",", "C", ",", 
        "\[Theta]i", ",", "m", ",", "QP0", ",", "\[IndentingNewLine]", 
        "nfast", ",", "nslow", ",", "\[Theta]tfast", ",", "\[Theta]tslow", 
        ",", "kfast", ",", "kslow", ",", "sol", ",", "equs", ",", "\[Eta]", 
        ",", "v", ",", "pos", ",", "vfast", ",", "vslow", ",", 
        "\[Theta]guess", ",", "\[Theta]bounds", ",", 
        RowBox[{"\[Theta]small", "=", "0.001"}], ",", "nmax", ",", "nmin", 
        ",", "\[CurlyEpsilon]P", ",", "\[CurlyEpsilon]L", ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"debug", "=", "True"}], ","}], "*)"}], 
        RowBox[{"normalIncidence", "=", "False"}], ",", 
        RowBox[{"crit0strong", "=", 
         SuperscriptBox["10", 
          RowBox[{"-", "6"}]]}], ",", 
        RowBox[{"crit0weak", "=", 
         SuperscriptBox["10", 
          RowBox[{"-", "3"}]]}], ",", 
        RowBox[{"complexPermittivity", "=", "False"}], ",", 
        RowBox[{"complexIsotropic", "=", "False"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Find", " ", "incident", " ", "angle", " ", "from", " ", "wIn"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Theta]i", "=", 
        RowBox[{"wIn", "[", "\[Theta]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Re", "@", "\[Theta]i"}], "<=", "crit0weak"}], ",", 
         RowBox[{"normalIncidence", "=", "True"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "Find", " ", "refractive", " ", "index", " ", "of", " ", "wIn"}], 
          ";", " ", 
          RowBox[{
          "this", " ", "is", " ", "the", " ", "refractive", " ", "index", " ",
            "of", " ", "the", " ", "prior", " ", "material"}]}], ",", " ", 
         RowBox[{
          RowBox[{"not", " ", "the", " ", "current", " ", 
           RowBox[{"one", "!"}]}], " ", ";"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"n0", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"c0", "/", 
           RowBox[{"wIn", "[", "\[Omega]", "]"}]}], ")"}], 
         RowBox[{"wIn", "[", "k0", "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\\n \[Theta]i = \>\"", ",", 
           RowBox[{
            RowBox[{"\[Theta]i", "/", "Pi"}], " ", "180"}]}], "]"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<n0 = \>\"", ",", "n0"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\[Omega] = \>\"", ",", 
           RowBox[{
            RowBox[{"wOut1", "[", "\[Omega]", "]"}], "/", "\[Omega]0"}]}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Determine", " ", "whether", " ", "to", " ", "compute", " ", "the", 
          " ", "\[Omega]", " ", "or", " ", "2", "\[Omega]", " ", "waves"}], 
         ",", " ", 
         RowBox[{"from", " ", "the", " ", "wOut"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"wOut1", "[", "\[Omega]", "]"}], "-", "\[Omega]0"}], 
           "]"}], "\[LessEqual]", " ", "crit0weak"}], ",", 
         RowBox[{
          RowBox[{"\[CurlyEpsilon]P", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]P", "]"}]}], ";", 
          RowBox[{"\[CurlyEpsilon]L", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]L", "]"}]}], ";", 
          RowBox[{"QP0", "=", 
           RowBox[{"mat", "[", "QP\[Omega]", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "@", 
             RowBox[{"Element", "[", 
              RowBox[{
               RowBox[{"Flatten", "@", " ", 
                RowBox[{"Chop", "[", 
                 RowBox[{"\[CurlyEpsilon]P", ",", "crit0strong"}], "]"}]}], 
               ",", "Reals"}], "]"}]}], ",", 
            RowBox[{"complexPermittivity", "=", "True"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "@", "complexPermittivity"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"nmax", "=", 
              RowBox[{"Max", "@", 
               RowBox[{"mat", "[", "n\[Omega]", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"nmin", "=", 
              RowBox[{"Min", "@", 
               RowBox[{"mat", "[", "n\[Omega]", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Theta]bounds", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"ArcSin", "[", 
                 RowBox[{"n0", " ", 
                  RowBox[{
                   RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", "nmax"}]}], 
                 "]"}], ",", 
                RowBox[{"ArcSin", "[", 
                 RowBox[{"n0", " ", 
                  RowBox[{
                   RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", "nmin"}]}], 
                 "]"}]}], "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"wOut1", "[", "\[Omega]", "]"}], "-", 
            RowBox[{"2", "\[Omega]0"}]}], "]"}], "\[LessEqual]", " ", 
          "crit0weak"}], ",", 
         RowBox[{
          RowBox[{"\[CurlyEpsilon]P", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]P", "]"}]}], ";", 
          RowBox[{"\[CurlyEpsilon]L", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}]}], ";", 
          RowBox[{"QP0", "=", 
           RowBox[{"mat", "[", "QP2\[Omega]", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "@", 
             RowBox[{"Element", "[", 
              RowBox[{
               RowBox[{"Flatten", "@", " ", 
                RowBox[{"Chop", "[", 
                 RowBox[{"\[CurlyEpsilon]P", ",", "crit0strong"}], "]"}]}], 
               ",", "Reals"}], "]"}]}], ",", 
            RowBox[{"complexPermittivity", "=", "True"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "@", "complexPermittivity"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"nmax", "=", 
              RowBox[{"Max", "@", 
               RowBox[{"mat", "[", "n2\[Omega]", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"nmin", "=", 
              RowBox[{"Min", "@", 
               RowBox[{"mat", "[", "n2\[Omega]", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Theta]bounds", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"ArcSin", "[", 
                 RowBox[{"n0", " ", 
                  RowBox[{
                   RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", "nmax"}]}], 
                 "]"}], ",", 
                RowBox[{"ArcSin", "[", 
                 RowBox[{"n0", " ", 
                  RowBox[{
                   RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", "nmin"}]}], 
                 "]"}]}], "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Follow", " ", "the", " ", "routine"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ux", "=", 
        RowBox[{"Sin", "[", "\[Theta]t", "]"}]}], ";", "  ", 
       RowBox[{"uy", "=", "0.0"}], ";", "  ", 
       RowBox[{"uz", "=", 
        RowBox[{"Cos", "[", "\[Theta]t", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"L", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"uy", "^", "2"}], "+", 
             RowBox[{"uz", "^", "2"}]}], ",", 
            RowBox[{
             RowBox[{"-", "ux"}], "*", "uy"}], ",", 
            RowBox[{
             RowBox[{"-", "ux"}], "*", "uz"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "ux"}], "*", "uy"}], ",", 
            RowBox[{
             RowBox[{"ux", "^", "2"}], "+", 
             RowBox[{"uz", "^", "2"}]}], ",", 
            RowBox[{
             RowBox[{"-", "uy"}], "*", "uz"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "uz"}], "*", "ux"}], ",", 
            RowBox[{
             RowBox[{"-", "uz"}], "*", "uy"}], ",", 
            RowBox[{
             RowBox[{"ux", "^", "2"}], "+", 
             RowBox[{"uy", "^", "2"}]}]}], "}"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"R", "=", 
        RowBox[{
         RowBox[{"MatrixPower", "[", 
          RowBox[{"\[CurlyEpsilon]P", ",", 
           RowBox[{"1", "/", "2"}]}], "]"}], ".", 
         RowBox[{"Transpose", "@", "QP0"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"Pay", " ", 
         RowBox[{"attention", "!"}], " ", "My", " ", "Q", " ", "is", " ", 
         "the", " ", "transpose", " ", "of", " ", "the", " ", "Q", " ", 
         "defined", " ", "in", " ", 
         RowBox[{"Chang", "'"}], "s", " ", "paper"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"C", "=", 
        RowBox[{"Inverse", "[", "R", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalLambda]", "=", 
        RowBox[{
         RowBox[{"Transpose", "[", "C", "]"}], ".", "L", ".", "C"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"V", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "2"}], ")"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[CapitalLambda]", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
           RowBox[{"\[CapitalLambda]", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", 
           RowBox[{"\[CapitalLambda]", "[", 
            RowBox[{"[", 
             RowBox[{"3", ",", "3"}], "]"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"W", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "1"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "3"}], "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "3"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "2"}], "]"}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<QP0,\[CurlyEpsilon]P,R,C,\[CapitalLambda],V,W\>\"", ",", 
             RowBox[{"Simplify", "@", 
              RowBox[{"{", 
               RowBox[{
               "QP0", ",", "\[CurlyEpsilon]P", ",", "R", ",", "C", ",", 
                "\[CapitalLambda]", ",", "V", ",", "W"}], "}"}]}]}], "]"}]}], 
          "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"For", " ", "aniso", " ", "in", " ", "general"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"nfast", "=", 
        RowBox[{"(*", 
         RowBox[{"Chop", "@"}], "*)"}], 
        RowBox[{"Simplify", "@", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", "-", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"V", "^", "2"}], "-", "W"}], "]"}]}], ")"}], "/", 
           "W"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nslow", "=", 
        RowBox[{"(*", 
         RowBox[{"Chop", "@"}], "*)"}], 
        RowBox[{"Simplify", "@", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", "+", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"V", "^", "2"}], "-", "W"}], "]"}]}], ")"}], "/", 
           "W"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", "complexPermittivity"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "if", " ", "\[CurlyEpsilon]P", " ", "is", " ", "all", " ", "real"}],
           "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "set", " ", "initial", " ", "guess", " ", "angle", " ", "by", " ", 
            "assuming", " ", "\[Theta]t"}], "==", "\[Theta]i"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"for", " ", "nfast"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"normalIncidence", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "Pi"}], "}"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "0."}], "}"}]}]}], 
              "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",",
             "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "In", " ", "this", " ", "case", " ", "you", " ", "can", " ", 
                 "bound", " ", "the", " ", "root", " ", "of", " ", "FindRoot",
                  " ", "between", " ", 
                 RowBox[{
                  RowBox[{"0", "~", "Pi"}], "/", "2"}], " ", "or", " ", 
                 RowBox[{"Pi", "/", "2"}], " ", "to", " ", "Pi"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"\[Theta]guess", "=", 
                  RowBox[{"Pi", "-", 
                   RowBox[{"Re", "@", 
                    RowBox[{"ArcSin", "[", 
                    RowBox[{"n0", " ", 
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", 
                    RowBox[{"Re", "@", 
                    RowBox[{"(", 
                    RowBox[{"nfast", "/.", 
                    RowBox[{"\[Theta]t", "->", "\[Theta]i"}]}], ")"}]}]}]}], 
                    "]"}]}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"Quiet", "@", 
                 RowBox[{"(", 
                  RowBox[{"sol", "=", 
                   RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nfast"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", "\[Theta]guess", ",", 
                    RowBox[{"Pi", "/", "2"}], ",", "Pi"}], "}"}], ",", 
                    RowBox[{"Method", "\[Rule]", "\"\<Secant\>\""}]}], 
                    "]"}]}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Quiet", "@", 
                RowBox[{"(", 
                 RowBox[{"sol", "=", 
                  RowBox[{"FindRoot", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nfast"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", 
                    RowBox[{"Pi", "-", 
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "\[Theta]small"}], 
                    ",", 
                    RowBox[{"Pi", "-", 
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "\[Theta]small"}]}], 
                    "}"}]}], "]"}]}], ")"}]}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"\[Theta]guess", "=", 
                  RowBox[{"Re", "@", 
                   RowBox[{"ArcSin", "[", 
                    RowBox[{"n0", " ", 
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", 
                    RowBox[{"Re", "@", 
                    RowBox[{"(", 
                    RowBox[{"nfast", "/.", 
                    RowBox[{"\[Theta]t", "->", "\[Theta]i"}]}], ")"}]}]}]}], 
                    "]"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Quiet", "@", 
                RowBox[{"(", 
                 RowBox[{"sol", "=", 
                  RowBox[{"FindRoot", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nfast"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", 
                    RowBox[{
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "\[Theta]small"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "\[Theta]small"}]}], 
                    "}"}]}], "]"}]}], ")"}]}]}], "\[IndentingNewLine]", "]"}],
              ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Theta]tfast", "=", 
           RowBox[{"(", 
            RowBox[{"\[Theta]t", "/.", "sol"}], ")"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"nfast", "=", 
           RowBox[{"(", 
            RowBox[{"nfast", "/.", "sol"}], ")"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"for", " ", "nslow"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"normalIncidence", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "Pi"}], "}"}]}], ",", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "0."}], "}"}]}]}], "]"}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", "\[IndentingNewLine]", 
               RowBox[{"Quiet", "@", 
                RowBox[{"(", 
                 RowBox[{"sol", "=", 
                  RowBox[{"FindRoot", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nslow"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", 
                    RowBox[{"Pi", "-", 
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "\[Theta]small"}], 
                    ",", 
                    RowBox[{"Pi", "-", 
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "\[Theta]small"}]}], 
                    "}"}]}], "]"}]}], ")"}]}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"Quiet", "@", 
                RowBox[{"(", 
                 RowBox[{"sol", "=", 
                  RowBox[{"FindRoot", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nslow"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", 
                    RowBox[{
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "\[Theta]small"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"\[Theta]bounds", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "\[Theta]small"}]}], 
                    "}"}]}], "]"}]}], ")"}]}]}], "\[IndentingNewLine]", "]"}],
              ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Theta]tslow", "=", 
           RowBox[{"(", 
            RowBox[{"\[Theta]t", "/.", "sol"}], ")"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"nslow", "=", 
           RowBox[{"(", 
            RowBox[{"nslow", "/.", "sol"}], ")"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "if", " ", "\[CurlyEpsilon]P", " ", "is", " ", "partly", " ", 
           "complex"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"for", " ", "nfast"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"normalIncidence", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "Pi"}], "}"}]}], ",", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "0."}], "}"}]}]}], "]"}], ";"}], 
            RowBox[{"(*", 
             RowBox[{"this", " ", "is", " ", "not", " ", 
              RowBox[{"general", "!"}], " ", "what", " ", "is", " ", "the", 
              " ", "imaginary", " ", "part", " ", "of", " ", "normal", " ", 
              "incidence", " ", "for", " ", "complex", " ", 
              RowBox[{"n", "?"}]}], "*)"}], "\[IndentingNewLine]", ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "In", " ", "this", " ", "case", " ", "you", " ", "CANNOT", 
                 " ", "bound", " ", "the", " ", "root", " ", "of", " ", 
                 "FindRoot", " ", "because", " ", "\[Theta]", " ", "is", " ", 
                 RowBox[{"complex", "!"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"\[Theta]guess", "=", 
                 RowBox[{"Pi", "-", 
                  RowBox[{"Re", "@", 
                   RowBox[{"ArcSin", "[", 
                    RowBox[{"n0", " ", 
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", 
                    RowBox[{"Re", "@", 
                    RowBox[{"(", 
                    RowBox[{"nfast", "/.", 
                    RowBox[{"\[Theta]t", "->", "\[Theta]i"}]}], ")"}]}]}]}], 
                    "]"}]}], "+", 
                  RowBox[{"0.1", "I"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"Quiet", "@", 
                 RowBox[{"(", 
                  RowBox[{"sol", "=", 
                   RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nfast"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", "\[Theta]guess"}], "}"}]}], 
                    "]"}]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"\[Theta]guess", "=", 
                 RowBox[{
                  RowBox[{"Re", "@", 
                   RowBox[{"ArcSin", "[", 
                    RowBox[{"n0", " ", 
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", 
                    RowBox[{"Re", "@", 
                    RowBox[{"(", 
                    RowBox[{"nfast", "/.", 
                    RowBox[{"\[Theta]t", "->", "\[Theta]i"}]}], ")"}]}]}]}], 
                    "]"}]}], "+", 
                  RowBox[{"0.1", "I"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"Quiet", "@", 
                 RowBox[{"(", 
                  RowBox[{"sol", "=", 
                   RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nfast"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", "\[Theta]guess"}], "}"}]}], 
                    "]"}]}], ")"}]}]}]}], "\[IndentingNewLine]", "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Theta]tfast", "=", 
           RowBox[{"(", 
            RowBox[{"\[Theta]t", "/.", "sol"}], ")"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"nfast", "=", 
           RowBox[{"(", 
            RowBox[{"nfast", "/.", "sol"}], ")"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"for", " ", "nslow"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"normalIncidence", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "Pi"}], "}"}]}], ",", 
               RowBox[{"sol", "=", 
                RowBox[{"{", 
                 RowBox[{"\[Theta]t", "->", "0."}], "}"}]}]}], "]"}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"reflect", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"\[Theta]guess", "=", 
                 RowBox[{"Pi", "-", 
                  RowBox[{"Re", "@", 
                   RowBox[{"ArcSin", "[", 
                    RowBox[{"n0", " ", 
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", 
                    RowBox[{"Re", "@", 
                    RowBox[{"(", 
                    RowBox[{"nslow", "/.", 
                    RowBox[{"\[Theta]t", "->", "\[Theta]i"}]}], ")"}]}]}]}], 
                    "]"}]}], "+", 
                  RowBox[{"0.1", "I"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"Quiet", "@", 
                 RowBox[{"(", 
                  RowBox[{"sol", "=", 
                   RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nslow"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", "\[Theta]guess"}], "}"}]}], 
                    "]"}]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"\[Theta]guess", "=", 
                 RowBox[{
                  RowBox[{"Re", "@", 
                   RowBox[{"ArcSin", "[", 
                    RowBox[{"n0", " ", 
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}], "/", 
                    RowBox[{"Re", "@", 
                    RowBox[{"(", 
                    RowBox[{"nslow", "/.", 
                    RowBox[{"\[Theta]t", "->", "\[Theta]i"}]}], ")"}]}]}]}], 
                    "]"}]}], "+", 
                  RowBox[{"0.1", "I"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"Quiet", "@", 
                 RowBox[{"(", 
                  RowBox[{"sol", "=", 
                   RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nslow"}], 
                    "\[Equal]", " ", 
                    RowBox[{"n0", " ", 
                    RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]t", ",", "\[Theta]guess"}], "}"}]}], 
                    "]"}]}], ")"}]}]}]}], "\[IndentingNewLine]", "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Theta]tslow", "=", 
           RowBox[{"(", 
            RowBox[{"\[Theta]t", "/.", "sol"}], ")"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"nslow", "=", 
           RowBox[{"(", 
            RowBox[{"nslow", "/.", "sol"}], ")"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "@", 
           RowBox[{"Im", "[", "\[Theta]tfast", "]"}]}], "\[LessEqual]", 
          "crit0strong"}], ",", 
         RowBox[{"\[Theta]tfast", "=", 
          RowBox[{"Re", "[", "\[Theta]tfast", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "@", 
           RowBox[{"Im", "[", "\[Theta]tslow", "]"}]}], "\[LessEqual]", 
          "crit0strong"}], ",", 
         RowBox[{"\[Theta]tslow", "=", 
          RowBox[{"Re", "[", "\[Theta]tslow", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "@", 
           RowBox[{"Im", "[", "nfast", "]"}]}], "\[LessEqual]", 
          "crit0strong"}], ",", 
         RowBox[{"nfast", "=", 
          RowBox[{"Re", "[", "nfast", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "@", 
           RowBox[{"Im", "[", "nslow", "]"}]}], "\[LessEqual]", 
          "crit0strong"}], ",", 
         RowBox[{"nslow", "=", 
          RowBox[{"Re", "[", "nslow", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<\[Theta]fast and \[Theta]slow from Snell's law:\\n\>\"", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Theta]tfast", ",", "\[Theta]tslow"}], "}"}], "/", 
             "Pi"}], " ", "180"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<nfast and nslow from Snell's law:\\n\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"nfast", ",", "nslow"}], "}"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Not", "[", "reflect", "]"}], " ", "&&", 
            RowBox[{"(", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"Re", "@", "\[Theta]tfast"}], ">=", 
               RowBox[{"Pi", "/", "2"}]}], "||", 
              RowBox[{
               RowBox[{"Re", "@", "\[Theta]tslow"}], ">=", 
               RowBox[{"Pi", "/", "2"}]}]}], ")"}]}], ",", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\<Error! \[Theta]t is obtuse!\>\"", ",", 
              "\"\<\[Theta]tfast = \>\"", ",", 
              RowBox[{
               RowBox[{"\[Theta]tfast", "/", "Pi"}], " ", "180"}], ",", 
              "\"\<\[Theta]tslow = \>\"", ",", 
              RowBox[{
               RowBox[{"\[Theta]tslow", "/", "Pi"}], " ", "180"}]}], "]"}], 
            ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"reflect", " ", "&&", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Re", "@", "\[Theta]tfast"}], "<=", 
               RowBox[{"Pi", "/", "2"}]}], "||", 
              RowBox[{
               RowBox[{"Re", "@", "\[Theta]tslow"}], "<=", " ", 
               RowBox[{"Pi", "/", "2"}]}]}], ")"}]}], ",", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\<Error! \[Theta]r is acute!\>\"", ",", 
              "\"\<\[Theta]tfast = \>\"", ",", 
              RowBox[{
               RowBox[{"\[Theta]tfast", "/", "Pi"}], " ", "180"}], ",", 
              "\"\<\[Theta]tslow = \>\"", ",", 
              RowBox[{
               RowBox[{"\[Theta]tslow", "/", "Pi"}], " ", "180"}]}], "]"}], 
            ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<|kfast| and |kslow|: \\n\>\"", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"nfast", " ", 
               RowBox[{
                RowBox[{"wOut1", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}],
              ",", 
             RowBox[{"(", 
              RowBox[{"nslow", " ", 
               RowBox[{
                RowBox[{"wOut2", "[", "\[Omega]", "]"}], "/", "c0"}]}], 
              ")"}]}], "}"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"kfast", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"nfast", " ", 
           RowBox[{
            RowBox[{"wOut1", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", "\[Theta]tfast", "]"}], ",", "0", ",", 
           RowBox[{"Cos", "[", "\[Theta]tfast", "]"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kslow", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"nslow", " ", 
           RowBox[{
            RowBox[{"wOut2", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", "\[Theta]tslow", "]"}], ",", "0", ",", 
           RowBox[{"Cos", "[", "\[Theta]tslow", "]"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut1", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k", "]"}], "]"}], "]"}], "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"kfast", ",", "crit0strong"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut2", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k", "]"}], "]"}], "]"}], "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"kslow", ",", "crit0strong"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut1", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k0", "]"}], "]"}], "]"}], "=", 
        RowBox[{"(", 
         RowBox[{"nfast", " ", 
          RowBox[{
           RowBox[{"wOut1", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut2", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k0", "]"}], "]"}], "]"}], "=", 
        RowBox[{"(", 
         RowBox[{"nslow", " ", 
          RowBox[{
           RowBox[{"wOut2", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut1", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "\[Theta]", "]"}], "]"}], "]"}], "=", 
        "\[Theta]tfast"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut2", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "\[Theta]", "]"}], "]"}], "]"}], "=", 
        "\[Theta]tslow"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"\[Theta]tfast", "-", "\[Theta]tslow"}], ",", 
            "crit0strong"}], "]"}], "\[Equal]", "0."}], "  ", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"For", " ", "Isotropic"}], ",", " ", 
           RowBox[{
           "or", "  ", "when", " ", "two", " ", "waves", " ", "are", " ", 
            "identical", " ", "in", " ", "propagting", " ", "direction"}]}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", "\"\<Iso or quasi Iso\>\"", "]"}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Chop", "[", 
                RowBox[{
                 RowBox[{"Im", "@", "\[Theta]tfast"}], ",", "crit0strong"}], 
                "]"}], "!=", "0."}], ",", 
              RowBox[{"complexIsotropic", "=", "True"}]}], "]"}], ";"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"normalIncidence", "||", "complexIsotropic"}], ","}]}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"m", "=", 
           RowBox[{"\[CapitalLambda]", "/.", 
            RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tfast"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"HermitianMatrixQ", "[", "m", "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Hermitian\>\"", "]"}], ";"}], "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
              RowBox[{"Eigensystem", "[", 
               RowBox[{"m", ",", "2", ",", 
                RowBox[{"Method", "\[Rule]", "\"\<Banded\>\""}]}], "]"}]}], 
             ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Not Hermitian\>\"", "]"}], ";"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
             RowBox[{"Eigensystem", "[", 
              RowBox[{"m", ",", "2"}], "]"}]}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"v", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{"v", ",", "crit0strong"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"v", "=", 
           RowBox[{"Normalize", "/@", 
            RowBox[{"(", 
             RowBox[{"v", ".", 
              RowBox[{"C", "\[Transpose]"}]}], ")"}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\<Using standard eigensystem {\[Eta],v} for \[Theta]tfast=\
\[Theta]tslow\\n\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"make", " ", "sure", " ", "the", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1", ",", "0"}], "}"}], " ", "eigenvector", 
            " ", "of", " ", "different", " ", "layers", " ", "are", " ", 
            "always", " ", 
            RowBox[{"aligned", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"vfast", "=", 
             RowBox[{"Chop", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"v", ",", 
                  RowBox[{"{", 
                   RowBox[{"_", ",", "0", ",", "_"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "crit0strong"}], "]"}]}],
             ";", "\[IndentingNewLine]", 
            RowBox[{"vslow", "=", 
             RowBox[{"Chop", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"v", ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "_", ",", "0"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "crit0strong"}], "]"}]}],
             ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<vfast, vslow\\n\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"vfast", ",", " ", "vslow"}], "}"}]}], "]"}], ";"}], 
           "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"vfast", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "crit0strong"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"vslow", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "crit0strong"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<vfast, vslow\\n\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"vfast", ",", " ", "vslow"}], "}"}]}], "]"}], ";"}], 
           "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut1", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut1", "[", "EE", "]"}], "vfast"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut2", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut2", "[", "EE", "]"}], "vslow"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", "\"\<Aniso\\n\>\"", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Chop", "[", 
              RowBox[{
               RowBox[{"Im", "@", "\[Theta]tfast"}], ",", "crit0strong"}], 
              "]"}], "!=", "0."}], ",", 
            RowBox[{"complexIsotropic", "=", "True"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"normalIncidence", "||", "complexIsotropic"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{"\[CapitalLambda]", "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tfast"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"HermitianMatrixQ", "[", "m", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"m", ",", "2", ",", 
                  RowBox[{"Method", "\[Rule]", "\"\<Banded\>\""}]}], "]"}]}], 
               "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"m", ",", "2"}], "]"}]}]}], "\[IndentingNewLine]", 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"v", "=", 
                RowBox[{"Chop", "[", 
                 RowBox[{"v", ",", "crit0strong"}], "]"}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"v", "=", 
              RowBox[{"Normalize", "/@", 
               RowBox[{"(", 
                RowBox[{"v", ".", 
                 RowBox[{"C", "\[Transpose]"}]}], ")"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using standard eigensystem {\[Eta],v} for \
\[Theta]tfast\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"L", ",", "\[CurlyEpsilon]L"}], "}"}], "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tfast"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
              RowBox[{"Eigensystem", "[", 
               RowBox[{"m", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"v", "=", 
                RowBox[{"Chop", "[", 
                 RowBox[{"v", ",", "crit0strong"}], "]"}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using generalized eigensystem {\[Eta],v} for \
\[Theta]tfast\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"vfast", "=", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"\[Eta]", ",", "v"}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", 
                  RowBox[{"1", "/", 
                   SuperscriptBox["nfast", "2"]}]}], "]"}], "<=", 
                "crit0strong"}], "&"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"vfast", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{"vfast", ",", "crit0strong"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut1", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut1", "[", "EE", "]"}], "vfast"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Chop", "[", 
              RowBox[{
               RowBox[{"Im", "@", "\[Theta]tfast"}], ",", "crit0strong"}], 
              "]"}], "!=", "0."}], ",", 
            RowBox[{"complexIsotropic", "=", "True"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"normalIncidence", "||", "complexIsotropic"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{"\[CapitalLambda]", "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tslow"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"HermitianMatrixQ", "[", "m", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{"m", ",", "2", ",", 
                   RowBox[{"Method", "\[Rule]", "\"\<Banded\>\""}]}], "]"}]}],
                 ")"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{"m", ",", "2"}], "]"}]}], ")"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"v", "=", 
                RowBox[{"Chop", "[", 
                 RowBox[{"v", ",", "crit0strong"}], "]"}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"v", "=", 
              RowBox[{"Normalize", "/@", 
               RowBox[{"(", 
                RowBox[{"v", ".", 
                 RowBox[{"C", "\[Transpose]"}]}], ")"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using standard eigensystem {\[Eta],v} for \
\[Theta]tslow\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}]}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"L", ",", "\[CurlyEpsilon]L"}], "}"}], "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tslow"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
              RowBox[{"Eigensystem", "[", 
               RowBox[{"m", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"v", "=", 
                RowBox[{"Chop", "[", 
                 RowBox[{"v", ",", "crit0strong"}], "]"}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using generalized {\[Eta],v} for \[Theta]tslow\\n\>\"", 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"vslow", "=", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"\[Eta]", ",", "v"}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", 
                  RowBox[{"1", "/", 
                   SuperscriptBox["nslow", "2"]}]}], "]"}], "<=", 
                "crit0strong"}], "&"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"vslow", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{"vslow", ",", "crit0strong"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut2", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut2", "[", "EE", "]"}], "vslow"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<vfast, vslow\\n\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"vfast", ",", " ", "vslow"}], "}"}]}], "]"}]}], "]"}], 
       ";"}]}], "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.836987235869816*^9, 3.8369875424530287`*^9}, {
   3.836987732119399*^9, 3.836987739148991*^9}, {3.837002264242731*^9, 
   3.837002267788765*^9}, {3.83789562853448*^9, 3.837895712528709*^9}, {
   3.8380731288320303`*^9, 3.838073142791238*^9}, {3.8380783522485623`*^9, 
   3.838078354755278*^9}, {3.838078915155344*^9, 3.83807894048492*^9}, {
   3.838079088800289*^9, 3.838079095047598*^9}, {3.838079139290643*^9, 
   3.838079142887494*^9}, {3.8380794051199627`*^9, 3.838079438290722*^9}, {
   3.838079590187483*^9, 3.838079601044285*^9}, {3.838079815014067*^9, 
   3.83807986723222*^9}, {3.838079970005868*^9, 3.838079973887388*^9}, {
   3.838080175517726*^9, 3.838080179664004*^9}, {3.838080247715228*^9, 
   3.838080261630459*^9}, {3.838080329095562*^9, 3.838080336274848*^9}, {
   3.838080396888803*^9, 3.838080400750163*^9}, {3.838080512039254*^9, 
   3.838080526841633*^9}, {3.838080670946483*^9, 3.838080746984773*^9}, {
   3.8380809218385277`*^9, 3.83808093187749*^9}, {3.838081847210945*^9, 
   3.838081863953209*^9}, 3.838081968293333*^9, {3.8380820479616594`*^9, 
   3.838082097529948*^9}, 3.838082150338527*^9, {3.838082190287694*^9, 
   3.83808221766566*^9}, {3.83808231976117*^9, 3.838082345107314*^9}, {
   3.838082724712278*^9, 3.838082734970471*^9}, {3.83808288510087*^9, 
   3.83808288726652*^9}, 3.83808293798044*^9, {3.838121488600574*^9, 
   3.8381215010717382`*^9}, {3.8381244643777866`*^9, 3.838124469171367*^9}, {
   3.8381291046978393`*^9, 3.8381291056169605`*^9}, {3.838129137502285*^9, 
   3.838129146170639*^9}, {3.838129281602539*^9, 3.8381292859994884`*^9}, {
   3.838130344111087*^9, 3.8381303497320614`*^9}, {3.8381304179188137`*^9, 
   3.838130477821575*^9}, {3.838130623821934*^9, 3.838130639829201*^9}, {
   3.838130671924817*^9, 3.838130995364807*^9}, {3.838131045907828*^9, 
   3.838131163999233*^9}, {3.838131227510442*^9, 3.838131244559013*^9}, {
   3.838132445040496*^9, 3.838132465164647*^9}, {3.838133347335333*^9, 
   3.838133361121527*^9}, {3.838133439218621*^9, 3.838133463278955*^9}, {
   3.838133820077355*^9, 3.838133823534934*^9}, {3.838133868771288*^9, 
   3.838133878670373*^9}, {3.838141096481681*^9, 3.8381412413286014`*^9}, {
   3.8381413132618103`*^9, 3.8381413915044785`*^9}, {3.838141460095958*^9, 
   3.83814146323137*^9}, {3.838141539173694*^9, 3.838141592335681*^9}, {
   3.838142255639763*^9, 3.838142255855713*^9}, {3.838142433563981*^9, 
   3.838142465068781*^9}, {3.8381425102109537`*^9, 3.8381425318282*^9}, {
   3.8381428217809887`*^9, 3.8381428249874964`*^9}, {3.838142876065695*^9, 
   3.838142906697678*^9}, {3.838143082080664*^9, 3.838143088023468*^9}, 
   3.8381434510103436`*^9, 3.8381434878514824`*^9, {3.838148512480132*^9, 
   3.838148519278156*^9}, 3.838148627819662*^9, {3.838148814628936*^9, 
   3.838148828208548*^9}, {3.838209537623029*^9, 3.838209556069288*^9}, {
   3.8382099283489947`*^9, 3.838209972548228*^9}, {3.8382100461704245`*^9, 
   3.8382100563803043`*^9}, {3.838210136048304*^9, 3.8382101832824793`*^9}, {
   3.838210337957515*^9, 3.8382103663435607`*^9}, {3.8382112095911617`*^9, 
   3.8382112214780807`*^9}, 3.838211441969533*^9, 3.838211711878306*^9, {
   3.8382117530652313`*^9, 3.838211765150365*^9}, {3.8382118478012457`*^9, 
   3.838211852326254*^9}, {3.838246388679229*^9, 3.838246452606124*^9}, {
   3.838246510332605*^9, 3.8382465685212307`*^9}, {3.8382466574074273`*^9, 
   3.838246688846511*^9}, {3.838247162568609*^9, 3.838247173392646*^9}, {
   3.8382472034039063`*^9, 3.838247236311685*^9}, {3.8382473447502623`*^9, 
   3.838247357494445*^9}, 3.838252038066954*^9, {3.838252239395612*^9, 
   3.838252247884816*^9}, {3.838252507034498*^9, 3.838252592084491*^9}, {
   3.8383029610999913`*^9, 3.8383029728999057`*^9}, {3.838305783757766*^9, 
   3.838305820043896*^9}, {3.83830595781818*^9, 3.83830597513659*^9}, {
   3.838306016315999*^9, 3.8383060229322796`*^9}, {3.8383060648933983`*^9, 
   3.83830614410723*^9}, {3.838306488836513*^9, 3.838306489343046*^9}, {
   3.838308535409859*^9, 3.838308535491015*^9}, {3.838308574209706*^9, 
   3.838308634974328*^9}, {3.8383087918684545`*^9, 3.838308812884238*^9}, {
   3.838308930165825*^9, 3.83830896162586*^9}, {3.83830900201204*^9, 
   3.838309009871872*^9}, {3.838309054546984*^9, 3.838309061253982*^9}, {
   3.838309876482908*^9, 3.8383098800153265`*^9}, {3.838310435502099*^9, 
   3.8383104392948236`*^9}, {3.838310496262558*^9, 3.838310509721804*^9}, {
   3.838310685982623*^9, 3.838310719429708*^9}, {3.838310769839418*^9, 
   3.838310771653363*^9}, {3.838310815860279*^9, 3.838310819666709*^9}, {
   3.8383108746424046`*^9, 3.838310885276884*^9}, {3.83831095634803*^9, 
   3.838310983662625*^9}, {3.838311297214005*^9, 3.838311298558351*^9}, 
   3.838311710507812*^9, 3.8383117562937202`*^9, {3.838311788804234*^9, 
   3.838311792180388*^9}, 3.838312112733467*^9, {3.838312184420607*^9, 
   3.838312187513612*^9}, {3.8383122204544*^9, 3.8383122218985043`*^9}, {
   3.838313570597328*^9, 3.838313637864488*^9}, 3.838390913863974*^9, 
   3.838390953421402*^9, {3.838399040639262*^9, 3.8383990974860916`*^9}, {
   3.838399145490924*^9, 3.838399224453648*^9}, {3.8383992553518596`*^9, 
   3.838399347667381*^9}, {3.838399402806449*^9, 3.838399410423678*^9}, {
   3.838506966874176*^9, 3.838506967402253*^9}, {3.838509249274161*^9, 
   3.838509257723307*^9}, {3.838844839708852*^9, 3.838844866003843*^9}, {
   3.838844915076278*^9, 3.838844974604551*^9}, {3.838845035396044*^9, 
   3.838845050061087*^9}, {3.83884508490654*^9, 3.838845088734857*^9}, {
   3.8404820608620057`*^9, 3.840482099698968*^9}, {3.842619577486884*^9, 
   3.8426196026951103`*^9}, {3.842646698158399*^9, 3.842646748648177*^9}, {
   3.84281582006942*^9, 3.842815823209282*^9}, {3.842815922561229*^9, 
   3.842815923826565*^9}, 3.8428159710356*^9, {3.845326983718229*^9, 
   3.8453270305557156`*^9}, {3.845327295223387*^9, 3.84532730725885*^9}, {
   3.8453288774482307`*^9, 3.845328878070001*^9}, 3.847752715122489*^9, 
   3.847752761438386*^9, 3.847753488012537*^9, 3.847753883098298*^9, {
   3.8477884477202883`*^9, 3.8477884667832747`*^9}, {3.847788566877906*^9, 
   3.847788587026359*^9}, {3.8480138054156065`*^9, 3.848013810428177*^9}, {
   3.8544922840921793`*^9, 3.854492853676478*^9}, {3.854492919561217*^9, 
   3.854492929268522*^9}, {3.85449297533694*^9, 3.8544930027021275`*^9}, {
   3.854493553282932*^9, 3.8544936225355873`*^9}, {3.88784356387869*^9, 
   3.887843609092973*^9}, {3.887925353942572*^9, 3.887925380837426*^9}, {
   3.892466837910846*^9, 3.892466864191577*^9}, 3.892761678657649*^9, {
   3.8927617685271015`*^9, 3.892761770552339*^9}, {3.892761863114113*^9, 
   3.8927619679014235`*^9}, {3.892762159730381*^9, 3.892762215988686*^9}, {
   3.892762713451907*^9, 3.892762740280679*^9}, {3.893704359190474*^9, 
   3.89370439251048*^9}, {3.893704761272047*^9, 3.893704841711171*^9}, {
   3.893704877371661*^9, 3.893704888479503*^9}, {3.893708805317971*^9, 
   3.893708833729646*^9}, {3.893708963754801*^9, 3.893708986985428*^9}, {
   3.893709031587142*^9, 3.8937090327641325`*^9}, {3.893709072133047*^9, 
   3.8937091037390738`*^9}, {3.893709413093927*^9, 3.8937094770622625`*^9}, {
   3.893709641027548*^9, 3.893709670585059*^9}, 3.893709818892939*^9, {
   3.8937100057329416`*^9, 3.8937100395597343`*^9}, {3.8937104603401017`*^9, 
   3.893710464134497*^9}, {3.8937141768142443`*^9, 3.893714209869355*^9}, 
   3.893715109779149*^9, {3.893715208807256*^9, 3.8937152421445293`*^9}, {
   3.8937152736381903`*^9, 3.893715342182088*^9}, {3.8937315806551294`*^9, 
   3.893731589820482*^9}, {3.893797383427883*^9, 3.893797388525072*^9}, {
   3.893808682700723*^9, 3.8938086927504077`*^9}, {3.893936830664913*^9, 
   3.893936834715207*^9}, {3.893936999764744*^9, 3.893937034719015*^9}, {
   3.893939609637813*^9, 3.893939701001115*^9}, {3.8939397953095655`*^9, 
   3.893939813978577*^9}, {3.893940078919491*^9, 3.893940086231405*^9}, {
   3.8939426514077497`*^9, 3.893942828677187*^9}, {3.893942860247354*^9, 
   3.893942926527954*^9}, {3.8957136736506925`*^9, 3.895713686263264*^9}, {
   3.895713754684766*^9, 3.895713771168566*^9}, {3.895716937906854*^9, 
   3.895716997590916*^9}, {3.895862175313019*^9, 3.89586219245888*^9}, 
   3.895882067456205*^9, {3.895882325023684*^9, 3.89588234962801*^9}, {
   3.895882383278462*^9, 3.895882391706993*^9}, 3.89588251404266*^9, {
   3.895885292262371*^9, 3.895885295810643*^9}, {3.895885394622199*^9, 
   3.895885407148515*^9}, {3.896665872026624*^9, 3.896665903866987*^9}, {
   3.896665963630591*^9, 3.896665994328994*^9}, 3.897017844684938*^9, {
   3.897018461210894*^9, 3.89701847083834*^9}, {3.897018664066647*^9, 
   3.897018669052011*^9}, 3.897018766148904*^9, {3.8970187976894646`*^9, 
   3.8970188183899193`*^9}, {3.897018879272675*^9, 3.897018881900943*^9}, {
   3.89701903872587*^9, 3.8970190614828515`*^9}, {3.8970195525792694`*^9, 
   3.897019553485156*^9}, {3.897089761661484*^9, 3.8970897762805643`*^9}, 
   3.897089852868108*^9, 3.897089901507635*^9, {3.897094731811201*^9, 
   3.897094733690199*^9}, {3.8970947993880644`*^9, 3.8970948134184866`*^9}, {
   3.8973314098444247`*^9, 3.897331451751294*^9}, {3.897331505068515*^9, 
   3.897331524221115*^9}, {3.897333776417839*^9, 3.897333854112446*^9}, {
   3.897336858254589*^9, 3.897336860227401*^9}, {3.8974377077787275`*^9, 
   3.8974377352584205`*^9}, 3.897437950591372*^9, {3.897438067204224*^9, 
   3.8974380716028976`*^9}, {3.8974381445896163`*^9, 3.897438146035768*^9}, 
   3.897438182876459*^9, 3.897438321676084*^9, {3.8974411680999575`*^9, 
   3.897441168666237*^9}, {3.8978546459786997`*^9, 3.897854652254031*^9}, {
   3.897858667254608*^9, 3.897858670073699*^9}, {3.8978587037310133`*^9, 
   3.8978587063224277`*^9}, {3.8978587966283503`*^9, 3.897858805777769*^9}, {
   3.8978589327947826`*^9, 3.8978589554120193`*^9}, {3.8978590155806923`*^9, 
   3.897859019556755*^9}, {3.897859064303899*^9, 3.897859077180575*^9}, {
   3.897862477527261*^9, 3.897862479960432*^9}, {3.897862583220753*^9, 
   3.897862583448754*^9}, {3.897862759570844*^9, 3.897862818539895*^9}, {
   3.904176795439725*^9, 3.9041768078321686`*^9}, 3.9041768552728605`*^9, {
   3.904176900055218*^9, 3.904176912823416*^9}, {3.904176986917593*^9, 
   3.9041770348091335`*^9}, {3.904177071337497*^9, 3.904177081872788*^9}, 
   3.908199138836351*^9, 3.9082039277046576`*^9, {3.908212077900944*^9, 
   3.908212080465166*^9}, {3.9082124094110537`*^9, 3.908212418773959*^9}, 
   3.90821293334756*^9, {3.908213183926145*^9, 3.908213190585485*^9}, {
   3.9082138202504864`*^9, 3.9082139024796157`*^9}, {3.908214245633775*^9, 
   3.908214263746019*^9}, {3.908214702058063*^9, 3.9082147599828606`*^9}, {
   3.908216058855886*^9, 3.9082160843116474`*^9}, {3.908216732750122*^9, 
   3.908216775575381*^9}, {3.908216928050517*^9, 3.908217031215907*^9}, {
   3.908217086233389*^9, 3.908217146914433*^9}, {3.90821719906575*^9, 
   3.908217313120997*^9}, {3.908217370885936*^9, 3.90821738076596*^9}, {
   3.908926905915153*^9, 3.908926907680392*^9}, {3.908926974797353*^9, 
   3.9089269763898525`*^9}, {3.9089270553013163`*^9, 3.908927075900766*^9}, {
   3.908939608248461*^9, 3.9089396910591197`*^9}, {3.908939731793072*^9, 
   3.908939800967751*^9}, {3.908940109366547*^9, 3.90894011828634*^9}, {
   3.909882452786525*^9, 3.909882462201271*^9}, {3.90988249331334*^9, 
   3.909882494745527*^9}, 3.909882699379029*^9, 3.909932114393126*^9, 
   3.9099324303275757`*^9, {3.909936543169389*^9, 3.9099365449307995`*^9}, {
   3.909936609402054*^9, 3.909936611284379*^9}, {3.909939990178808*^9, 
   3.9099399908857145`*^9}, {3.909940444106714*^9, 3.909940459278652*^9}, {
   3.9099404923894963`*^9, 3.9099405348772087`*^9}, {3.909940798139453*^9, 
   3.909940798760149*^9}, {3.9099422724267454`*^9, 3.9099422729527445`*^9}, {
   3.9099424397362766`*^9, 3.909942457560938*^9}, {3.90994379361656*^9, 
   3.9099438361046667`*^9}, {3.909946460950541*^9, 3.9099464685471725`*^9}, {
   3.9099465809978075`*^9, 3.909946610615527*^9}, {3.9099467011388597`*^9, 
   3.9099467017450995`*^9}, {3.9099490248339224`*^9, 3.909949025295022*^9}, {
   3.909957483623574*^9, 3.90995748535843*^9}, {3.9099575227239666`*^9, 
   3.909957540096383*^9}, {3.909957579709816*^9, 3.909957582822007*^9}, {
   3.909957684638796*^9, 3.909957695312538*^9}, {3.90995793057026*^9, 
   3.909957948273184*^9}, {3.9099583729220047`*^9, 3.909958392463304*^9}, 
   3.9099585087127542`*^9, {3.9099585505805397`*^9, 3.909958676505286*^9}, {
   3.909958754282359*^9, 3.909958760177324*^9}, {3.9099588002800403`*^9, 
   3.9099588018218713`*^9}, {3.909958878807649*^9, 3.909958974683688*^9}, {
   3.9099590214475093`*^9, 3.90995903819449*^9}, {3.9099599839695387`*^9, 
   3.909960002503066*^9}, {3.909960072655497*^9, 3.909960125784034*^9}, {
   3.90996033038019*^9, 3.909960363010599*^9}, {3.909960516147315*^9, 
   3.909960547700559*^9}, {3.909960864543497*^9, 3.9099608657756605`*^9}, {
   3.909962721114502*^9, 3.9099627633249445`*^9}, 3.909968255917284*^9, {
   3.909971239118731*^9, 3.909971245010468*^9}, 3.910561815827318*^9, {
   3.9105621176078925`*^9, 3.91056211783794*^9}, {3.910562158464077*^9, 
   3.91056219186896*^9}, 3.910562261402778*^9, 3.910569071751324*^9, 
   3.910569115177227*^9, {3.9105694561104465`*^9, 3.910569484979787*^9}, {
   3.910569680450482*^9, 3.910569683679026*^9}, {3.910569755660569*^9, 
   3.9105697761895494`*^9}, {3.910569828200206*^9, 3.910569831862813*^9}, {
   3.9105699943743353`*^9, 3.910570041033678*^9}, {3.910570139345061*^9, 
   3.910570147216626*^9}, {3.910570211465758*^9, 3.91057025923252*^9}, 
   3.910570306467693*^9, 3.910570758977023*^9, {3.910570858301751*^9, 
   3.910570873704015*^9}, {3.91090710131397*^9, 3.910907113801091*^9}, {
   3.911860948461785*^9, 3.9118609524689164`*^9}, {3.911860984046138*^9, 
   3.911860984576657*^9}, {3.9118611179249077`*^9, 3.911861143180387*^9}, {
   3.911861174658067*^9, 3.911861228075783*^9}, {3.911861312599168*^9, 
   3.911861326208319*^9}, {3.911861361627497*^9, 3.911861379426529*^9}, {
   3.911861471054164*^9, 3.911861508327914*^9}, {3.9118615431276264`*^9, 
   3.9118615885591173`*^9}, {3.9118620731277246`*^9, 3.911862162237581*^9}, {
   3.9118622406084037`*^9, 3.911862345828798*^9}, {3.9147630162563076`*^9, 
   3.9147630166474876`*^9}, {3.914763096650942*^9, 3.91476310535907*^9}, {
   3.9147633494696198`*^9, 3.9147634895626183`*^9}, {3.914772103415754*^9, 
   3.914772129360473*^9}, {3.914772192278412*^9, 3.914772202190792*^9}, {
   3.914772272865324*^9, 3.9147722758765144`*^9}, {3.9147726471286488`*^9, 
   3.9147726620690804`*^9}, {3.9147726948816967`*^9, 3.914772710652181*^9}, {
   3.9147727901275673`*^9, 3.914772801430626*^9}, {3.9147732843976536`*^9, 
   3.914773309734733*^9}, 3.914773532068407*^9, {3.914773562142214*^9, 
   3.914773633311825*^9}, {3.9147736774475746`*^9, 3.914773720513523*^9}, {
   3.914773902251517*^9, 3.9147739027632*^9}, {3.914774114268293*^9, 
   3.914774146512673*^9}, {3.914774278244335*^9, 3.914774307327929*^9}, {
   3.914774340557852*^9, 3.9147743430647717`*^9}, {3.914774402657967*^9, 
   3.914774408036564*^9}, {3.914774441081169*^9, 3.9147744700854797`*^9}, 
   3.91477461419322*^9, {3.914774706421019*^9, 3.914774783114352*^9}, {
   3.914774828120219*^9, 3.914774863013876*^9}, {3.914774948926148*^9, 
   3.914775136319698*^9}, {3.914775169819118*^9, 3.914775169977497*^9}, {
   3.914775236168152*^9, 3.914775238837433*^9}, {3.91477529029174*^9, 
   3.9147752982025394`*^9}, {3.9147756962232075`*^9, 3.914775699200992*^9}, {
   3.914775818528208*^9, 3.9147758707654953`*^9}, 3.9158847745866566`*^9, {
   3.9158849478204556`*^9, 3.915884986865349*^9}, {3.91588506351425*^9, 
   3.9158850879296045`*^9}, {3.915885483180351*^9, 3.915885488998386*^9}, {
   3.9158856899487524`*^9, 3.91588569572344*^9}, {3.915885737632309*^9, 
   3.91588573821348*^9}, 3.915885952419958*^9, 3.9158862056755505`*^9, {
   3.9158870901879005`*^9, 3.9158870954382763`*^9}, 3.9159218034563828`*^9, {
   3.9159219667289886`*^9, 3.9159219810314903`*^9}, 3.915922057212414*^9, {
   3.9159227783814983`*^9, 3.9159228316863155`*^9}, {3.9159230010878944`*^9, 
   3.9159230925433006`*^9}, {3.9159231289471817`*^9, 3.915923160105385*^9}, {
   3.915923329993452*^9, 3.9159233346577206`*^9}, {3.9159236524423714`*^9, 
   3.9159236583454*^9}, {3.915923712133749*^9, 3.9159237125720615`*^9}, {
   3.915924103742054*^9, 3.915924169662981*^9}, {3.9159242146519337`*^9, 
   3.915924225470812*^9}, {3.9159245476825294`*^9, 3.9159245673857803`*^9}, {
   3.915925646776121*^9, 3.9159258108230534`*^9}, {3.9159258679157963`*^9, 
   3.9159258826614723`*^9}, {3.9159262146751194`*^9, 
   3.9159262518782635`*^9}, {3.9159262828246193`*^9, 3.915926393859064*^9}, {
   3.9159264250606613`*^9, 3.915926442034113*^9}, {3.915926513336035*^9, 
   3.915926539419441*^9}, {3.9159271083750973`*^9, 3.915927119087988*^9}, {
   3.915927272191231*^9, 3.915927274041258*^9}, {3.9159273184138985`*^9, 
   3.915927320266659*^9}, {3.9159273975002975`*^9, 3.9159274051809177`*^9}, {
   3.9159278572183323`*^9, 3.9159278880487995`*^9}, {3.9159303578288994`*^9, 
   3.9159303588811398`*^9}, {3.9159309203509617`*^9, 3.915930946101557*^9}, {
   3.915931542731289*^9, 3.9159315770594425`*^9}},
 CellLabel->
  "In[198]:=",ExpressionUUID->"97649922-01c2-4c2d-bfce-4d5a98b082b0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solver for Fresnel\[CloseCurlyQuote]s law ", "Chapter",
 CellChangeTimes->{{3.8426186505890365`*^9, 3.8426186537946196`*^9}, {
   3.854489278720081*^9, 3.8544893085253057`*^9}, 3.857949554662337*^9, {
   3.892490495462247*^9, 
   3.8924905029753895`*^9}},ExpressionUUID->"5b8a343e-1607-4b4e-83d0-\
2845b6a33fb9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Solve", " ", "the", " ", "electric", " ", "field", " ", "magnitude", " ", 
    "of", " ", "the", " ", 
    RowBox[{"reflective", "/", "transmitive"}], " ", "waves", " ", "by", " ", 
    "boundary", " ", "condition", " ", "method"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "single", " ", "reflection", " ", "on", " ", "one", " ", 
    "surface"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Inputs", ":"}], ";", "\[IndentingNewLine]", 
    RowBox[{"wIn", " ", "-", " ", 
     RowBox[{"a", " ", "list", " ", "of", " ", "incident", " ", "waves"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"wR", " ", "-", " ", 
     RowBox[{"a", " ", "list", " ", "of", " ", "reflective", " ", "waves"}]}],
     ";", " ", "\[IndentingNewLine]", 
    RowBox[{"wT", " ", "-", " ", 
     RowBox[{
     "a", " ", "list", " ", "of", " ", "transmitive", " ", "waves"}]}], ";"}],
    " ", "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "solveFresnel", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"solveFresnel", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Generalized", " ", "wIn"}], ",", " ", "wR", ",", " ", 
     RowBox[{
     "wT", " ", "with", " ", "any", " ", "numbers", " ", "of", " ", 
      "waves"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"solveFresnel", "[", 
     RowBox[{"wIn_List", ",", "wR_List", ",", "wT_List", ",", "unknowns_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "getH", ",", "sol", ",", "equ", ",", "EMtop", ",", "EMbot", ",", 
        "HMtop", ",", "HMbot", ",", "B", ",", "M"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"getH", "[", "wav_", "]"}], ":=", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "k", "]"}], "@", "wav"}], ",", 
           RowBox[{
            RowBox[{"Key", "[", "EE", "]"}], "@", "wav"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "\[Omega]", "]"}], "@", "wav"}], " ", 
           "\[Mu]0"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"EMtop", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{"wIn", ",", "wR"}], "}"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"EMbot", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", "wT", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"HMtop", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"getH", "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{"wIn", ",", "wR"}], "}"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"HMbot", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"getH", "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", "wT", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"flagLinearSolve", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"equ", "=", 
           RowBox[{"(*", 
            RowBox[{"Simplify", "@"}], "*)"}], 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"EMtop", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", 
               RowBox[{"EMbot", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "==", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"HMtop", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", 
               RowBox[{"HMbot", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "==", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"EMtop", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"EMbot", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "==", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"HMtop", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"HMbot", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "==", "0"}]}], "}"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"B", ",", "M"}], "}"}], "=", 
           RowBox[{"Normal", "@", 
            RowBox[{"CoefficientArrays", "[", 
             RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"sol", "=", 
           RowBox[{"Thread", "[", 
            RowBox[{"unknowns", "->", 
             RowBox[{"LinearSolve", "[", 
              RowBox[{"M", ",", "B"}], "]"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"equ", "=", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"EMtop", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}], "==", 
              RowBox[{"EMbot", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"HMtop", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}], "==", 
              RowBox[{"HMbot", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}]}]}], 
            "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"equ", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Simplify", "@", 
             RowBox[{"(", 
              RowBox[{"Thread", "/@", "equ"}], ")"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<In solveFresnel, equ\\n\>\"", ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "@", 
                   RowBox[{"(", 
                    RowBox[{"Thread", "/@", "equ"}], ")"}]}], "/.", 
                  RowBox[{"{", 
                   RowBox[{"\[CapitalDelta]\[Delta]", "->", "0"}], "}"}]}], "//",
                  "Simplify"}], "//", "Chop"}], "//", "MatrixForm"}]}], 
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"Quiet", "@", 
           RowBox[{"If", "[", 
            RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"NSolve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}], 
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"Solve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"sol", "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{
             RowBox[{
             "Print", "[", "\"\<sol is {} in solveFresnel! \>\"", "]"}], ";", 
             RowBox[{"sol", "=", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"unknowns", "->", 
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"Length", "@", "unknowns"}]}], "]"}]}], "}"}], 
               "]"}]}]}], ",", 
            RowBox[{"sol", "=", 
             RowBox[{"sol", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Return", "[", "sol", "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"wR", "=", 
        RowBox[{"wR", "/.", "sol"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Only", " ", "updated", " ", "the", " ", "E", " ", "of", " ", 
          "waves", " ", "in", " ", "the", " ", "List", " ", "wR"}], ",", " ", 
         RowBox[{"not", " ", "H"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wT", "=", 
        RowBox[{"wT", "/.", "sol"}]}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.83850781742671*^9, 3.838507864212983*^9}, {
   3.838845153103168*^9, 3.838845195437742*^9}, {3.838858002202878*^9, 
   3.838858014399566*^9}, {3.840485953175858*^9, 3.840486023555131*^9}, {
   3.8426186808137455`*^9, 3.84261869025289*^9}, 3.8426219794010305`*^9, {
   3.842623948183436*^9, 3.842623967097224*^9}, {3.842993552542854*^9, 
   3.842993555073105*^9}, {3.8429999530378103`*^9, 3.842999962577392*^9}, {
   3.84506610892804*^9, 3.8450661362177334`*^9}, {3.848014985284827*^9, 
   3.848014999765652*^9}, {3.854493635830864*^9, 3.854493725365817*^9}, {
   3.858002329673533*^9, 3.858002371654166*^9}, {3.858003683820328*^9, 
   3.858003765629012*^9}, {3.8580038534614477`*^9, 3.858003856508622*^9}, 
   3.858004312270825*^9, {3.858004346416974*^9, 3.858004360999828*^9}, {
   3.858004441520091*^9, 3.858004451045829*^9}, 3.8580046431846123`*^9, 
   3.858004723560726*^9, {3.8580047807373676`*^9, 3.8580048236209173`*^9}, {
   3.858004860472432*^9, 3.858004869197146*^9}, 3.8864742110690355`*^9, {
   3.887847770303116*^9, 3.887847801295599*^9}, {3.8878479279400187`*^9, 
   3.8878479399041767`*^9}, {3.88784798135714*^9, 3.887847986474515*^9}, {
   3.88784806366482*^9, 3.887848068940711*^9}, {3.887848156785215*^9, 
   3.887848170413537*^9}, {3.887848317593241*^9, 3.8878483608101983`*^9}, {
   3.887853267676303*^9, 3.887853274290948*^9}, {3.88785365241877*^9, 
   3.887853673453754*^9}, 3.88785371790602*^9, {3.887856185522129*^9, 
   3.8878562488131657`*^9}, 3.887920294533537*^9, {3.8879208411793237`*^9, 
   3.887920849697976*^9}, {3.887920920966059*^9, 3.887920923295587*^9}, {
   3.88792098864362*^9, 3.887921043387307*^9}, {3.8879219850186644`*^9, 
   3.887921990192198*^9}, {3.887934144561592*^9, 3.887934217420756*^9}, {
   3.888233487043081*^9, 3.888233506927416*^9}, 3.8924879175627503`*^9, {
   3.892488931577727*^9, 3.892489002076596*^9}, {3.892490935790052*^9, 
   3.892490952209859*^9}, {3.8924910122995253`*^9, 3.8924911401046133`*^9}, {
   3.892491259807175*^9, 3.892491327882967*^9}, 3.892492499078909*^9, {
   3.8924925473096747`*^9, 3.892492555671224*^9}, 3.892494008703597*^9, {
   3.8924940765595007`*^9, 3.89249407888083*^9}, 3.892494307340926*^9, {
   3.8924944574517803`*^9, 3.892494484373708*^9}, 3.892494758757465*^9, 
   3.892762814200599*^9, {3.893294128658565*^9, 3.8932941399943333`*^9}, 
   3.893295489475665*^9, {3.893696173268127*^9, 3.893696194816241*^9}, {
   3.893731096504971*^9, 3.893731103702565*^9}, {3.893732275926164*^9, 
   3.893732333132752*^9}, {3.8937323861248407`*^9, 3.893732507519503*^9}, {
   3.8937325696646585`*^9, 3.8937325734687223`*^9}, 3.8937326295129213`*^9, {
   3.89373266808635*^9, 3.893732676171598*^9}, {3.893940035982898*^9, 
   3.893940040931528*^9}, 3.8939435506672935`*^9, {3.893981104813258*^9, 
   3.8939811049780207`*^9}, 3.8958375895160155`*^9, 3.895860726508342*^9, 
   3.895861315636387*^9, {3.895882095483772*^9, 3.895882137468243*^9}, 
   3.895884681288754*^9, 3.895884961279428*^9, 3.896097138340526*^9, {
   3.8960973282195387`*^9, 3.896097329858135*^9}, {3.8960973972925572`*^9, 
   3.896097405433893*^9}, 3.896664941609304*^9, {3.897854788538865*^9, 
   3.8978547901302767`*^9}, {3.8978554145232*^9, 3.897855420597618*^9}, {
   3.8978554539054728`*^9, 3.89785547114412*^9}, {3.897856476133929*^9, 
   3.8978564816979637`*^9}, {3.909932576532989*^9, 3.909932592306359*^9}, {
   3.909934198521466*^9, 3.9099341991309757`*^9}, {3.910569193379498*^9, 
   3.910569193901218*^9}, {3.910569262517954*^9, 3.910569262722758*^9}, {
   3.9105692964555793`*^9, 3.91056929659421*^9}, {3.9105703211093993`*^9, 
   3.910570321805178*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"39d1645c-06da-4289-ab26-9fba6e886f8f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Solve", " ", "the", " ", "electric", " ", "field", " ", "magnitude", " ", 
    "of", " ", "the", " ", 
    RowBox[{"reflective", "/", "transmitive"}], " ", "waves", " ", "by", " ", 
    "boundary", " ", "condition", " ", "method"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "reflection", " ", "and", " ", "transmission", " ", "of", " ", 
    "nonlinear", " ", "waves", " ", "across", " ", "arbitrary", " ", "number",
     " ", "of", " ", "slabs"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Inputs", ":"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wAir", " ", "-", " ", 
      RowBox[{
      "a", " ", "list", " ", "of", " ", "waves", " ", "from", " ", "Air", " ",
        "or", " ", "into", " ", "Air"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wF", " ", "-", " ", 
      RowBox[{"a", " ", "list", " ", "of", " ", "Forward", " ", "waves"}]}], 
     ";", " ", "\[IndentingNewLine]", 
     RowBox[{"wB", " ", "-", " ", 
      RowBox[{"a", " ", "list", " ", "of", " ", "Backward", " ", "waves"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"wSub", " ", "-", " ", 
      RowBox[{
      "a", " ", "lits", " ", "of", "  ", "waves", " ", "into", " ", 
       "Substrate", " ", 
       RowBox[{"(", 
        RowBox[{"can", " ", "be", " ", "Air"}], ")"}]}]}], ";", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"nM", " ", "-", " ", 
      RowBox[{"the", " ", "number", " ", "of", " ", "media", " ", 
       RowBox[{"(", "layers", ")"}], " ", "is", " ", "obtained", " ", "from", 
       " ", "the", " ", "length", " ", "of", " ", "wF"}]}], ";", "  ", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Outpus", ":"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{
     "the", " ", "solved", " ", "electric", " ", "field", " ", "vectors", " ",
       "for", " ", "wAir"}]}], ",", " ", "wF", ",", " ", "wB", ",", " ", 
    RowBox[{"and", " ", "wSub"}], ",", " ", 
    RowBox[{
     RowBox[{
     "all", " ", "stored", " ", "in", " ", "the", " ", "corresponding", " ", 
      "objects", " ", "of", " ", "the", " ", "lists"}], " ", ";"}]}], " ", 
   "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "solveFresnelN", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"solveFresnelN", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"solveFresnelN", "[", 
     RowBox[{
     "wAir_", ",", "wMed_", ",", "wSub_", ",", "thickness_", ",", 
      "unknowns_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"sol", "=", 
         RowBox[{"{", "}"}]}], ",", "i", ",", 
        RowBox[{"equ", "=", 
         RowBox[{"{", "}"}]}], ",", "equE", ",", "equH", ",", "nM", ",", 
        "equTop", ",", "equBot", ",", "getH", ",", 
        RowBox[{"nloop", "=", "0"}], ",", "B", ",", "M"}], 
       RowBox[{"(*", 
        RowBox[{",", 
         RowBox[{"debug", "=", "True"}]}], "*)"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nM", "=", 
        RowBox[{"Length", "[", "wMed", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"getH", "[", "wav_", "]"}], ":=", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "k", "]"}], "@", "wav"}], ",", 
           RowBox[{
            RowBox[{"Key", "[", "EE", "]"}], "@", "wav"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "\[Omega]", "]"}], "@", "wav"}], " ", 
           "\[Mu]0"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"contruct", " ", "the", " ", "boundary", " ", "conditions"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"the", " ", "top", " ", "surface"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"equTop", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", "wAir"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{"Key", "[", "EE", "]"}], "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{"getH", "/@", "wAir"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{"getH", "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], "}"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"equ", ",", "equTop"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"the", " ", "multilayers"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "<", "nM"}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"equE", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{"I", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}]}], 
                   ")"}], "&"}], "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{
                 RowBox[{"Key", "[", "EE", "]"}], "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"equH", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{"I", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"getH", "@", "#"}], ")"}]}], ")"}], "&"}], "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{"getH", "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"equ", ",", 
            RowBox[{"{", 
             RowBox[{"equE", ",", "equH"}], "}"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"the", " ", "bottom", " ", "surface"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"equBot", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{"I", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "nM", "]"}], "]"}]}], ")"}]}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}]}], 
                  ")"}], "&"}], "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "nM", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "==", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", "wSub"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{"I", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "nM", "]"}], "]"}]}], ")"}]}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{"getH", "@", "#"}], ")"}]}], ")"}], "&"}], "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "nM", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "==", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{"getH", "/@", "wSub"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], "}"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"equ", ",", "equBot"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"equ", "=", 
        RowBox[{"(*", 
         RowBox[{"Chop", "@"}], "*)"}], 
        RowBox[{"(*", 
         RowBox[{"Simplify", "@"}], "*)"}], 
        RowBox[{"Flatten", "[", "equ", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"equ", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"(", 
          RowBox[{"Thread", "/@", "equ"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<k of wMed\\n\>\"", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "k", "]"}], "&"}], "/@", 
            RowBox[{"wMed", "[", 
             RowBox[{"[", "nM", "]"}], "]"}]}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Here!!! equ\\n\>\"", ",", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "@", 
                RowBox[{"(", 
                 RowBox[{"Thread", "/@", "equ"}], ")"}]}], "/.", 
               RowBox[{"{", 
                RowBox[{"\[CapitalDelta]\[Delta]", "->", "0"}], "}"}]}], "//",
               "Simplify"}], "//", "Chop"}], "//", "MatrixForm"}]}], "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"flagLinearSolve", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"B", ",", "M"}], "}"}], "=", 
           RowBox[{"Normal", "@", 
            RowBox[{"CoefficientArrays", "[", 
             RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"sol", "=", 
           RowBox[{"Thread", "[", 
            RowBox[{"unknowns", "->", 
             RowBox[{"LinearSolve", "[", 
              RowBox[{"M", ",", "B"}], "]"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Quiet", "@", 
           RowBox[{"If", "[", 
            RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"NSolve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"Solve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"sol", "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{
             RowBox[{
             "Print", "[", "\"\<sol is {} in solveFresnelN!\>\"", "]"}], ";", 
             RowBox[{"sol", "=", 
              RowBox[{"Thread", "[", 
               RowBox[{"unknowns", "->", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0.", ",", 
                  RowBox[{"Length", "@", "unknowns"}]}], "]"}]}], "]"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"sol", "=", 
             RowBox[{"sol", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<sol\\n\>\"", ",", 
           RowBox[{
            RowBox[{"sol", "//", "Simplify"}], "//", "MatrixForm"}]}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"wAir", "=", 
        RowBox[{"wAir", "/.", "sol"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wSub", "=", 
        RowBox[{"wSub", "/.", "sol"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wMed", "=", 
        RowBox[{"wMed", "/.", "sol"}]}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.847732906800084*^9, 3.847732982270514*^9}, {
   3.8477505131278243`*^9, 3.847750513642277*^9}, 3.8477505802587724`*^9, {
   3.847750611559699*^9, 3.8477506120901637`*^9}, {3.847799152572941*^9, 
   3.847799430473942*^9}, {3.847799514922954*^9, 3.8477997171506815`*^9}, {
   3.847799840071401*^9, 3.847799867399284*^9}, {3.847799911226136*^9, 
   3.847799942291192*^9}, {3.8477999891864815`*^9, 3.847800024705925*^9}, {
   3.847800098418672*^9, 3.847800121747598*^9}, {3.8478001803190837`*^9, 
   3.847800180928764*^9}, {3.8478002389958196`*^9, 3.847800537042777*^9}, {
   3.847800606055557*^9, 3.847800619061784*^9}, {3.847800970346955*^9, 
   3.8478009787252398`*^9}, {3.847801103602794*^9, 3.847801110211218*^9}, {
   3.847801201745866*^9, 3.847801215178229*^9}, 3.84780133363433*^9, 
   3.847801372551295*^9, {3.847801402952591*^9, 3.847801409629897*^9}, 
   3.847801458187795*^9, {3.8478014918406143`*^9, 3.847801501094359*^9}, 
   3.847801536614454*^9, {3.84780158238515*^9, 3.847801629913949*^9}, {
   3.8478016879726715`*^9, 3.8478016973268485`*^9}, {3.8478017336525817`*^9, 
   3.8478017614054203`*^9}, {3.847801792857695*^9, 3.847801798853509*^9}, 
   3.8478018300308833`*^9, {3.847801949865209*^9, 3.8478020159001637`*^9}, {
   3.847805876136056*^9, 3.847805965577001*^9}, {3.847806027550273*^9, 
   3.847806105793802*^9}, {3.8478923656199584`*^9, 3.847892416248486*^9}, {
   3.847892553404544*^9, 3.8478925801157827`*^9}, {3.847892613132194*^9, 
   3.847892722476017*^9}, {3.847892790291929*^9, 3.847892804627013*^9}, {
   3.8478928774532566`*^9, 3.8478928781981683`*^9}, 3.847902642622751*^9, 
   3.8479027028740454`*^9, {3.847902796695471*^9, 3.8479027976808662`*^9}, 
   3.847903037089308*^9, {3.847903115681072*^9, 3.847903287980965*^9}, {
   3.847903373520195*^9, 3.847903383002947*^9}, {3.8479035162257566`*^9, 
   3.8479035249599795`*^9}, {3.847903705913613*^9, 3.847903706702098*^9}, {
   3.847903745747798*^9, 3.8479038316008244`*^9}, {3.847903888445075*^9, 
   3.847903891177968*^9}, 3.847903929192057*^9, 3.8480150074016266`*^9, 
   3.848015244737689*^9, {3.848015279710021*^9, 3.8480152801980867`*^9}, {
   3.8480153859251966`*^9, 3.848015402429034*^9}, {3.8544937321329618`*^9, 
   3.854493929696664*^9}, {3.858002430627852*^9, 3.8580024342110577`*^9}, {
   3.858002475579677*^9, 3.8580025553810315`*^9}, {3.8580025955878983`*^9, 
   3.858002754068923*^9}, {3.858002788476906*^9, 3.858002803691786*^9}, {
   3.858002949361581*^9, 3.858003086163771*^9}, {3.886386158491206*^9, 
   3.8863862157434826`*^9}, {3.886386303960623*^9, 3.886386313094493*^9}, {
   3.886386345915058*^9, 3.886386347270795*^9}, 3.886387926638754*^9, 
   3.886473705736665*^9, 3.886473737003451*^9, 3.8864737678802414`*^9, 
   3.886474134703715*^9, 3.887843544436668*^9, {3.8878523874024396`*^9, 
   3.887852388577885*^9}, {3.887852439490297*^9, 3.887852449257297*^9}, {
   3.887852558163184*^9, 3.887852595488691*^9}, {3.887852639241043*^9, 
   3.8878526532089667`*^9}, {3.8878527161302147`*^9, 
   3.8878527559358673`*^9}, {3.8878531710019255`*^9, 
   3.8878531715999317`*^9}, {3.887853201734925*^9, 3.887853208581858*^9}, 
   3.88785336109925*^9, {3.8878536767927914`*^9, 3.887853706520911*^9}, {
   3.887853740988018*^9, 3.887853770480675*^9}, {3.887853806464505*^9, 
   3.887853894574877*^9}, {3.887853935662038*^9, 3.8878539495380564`*^9}, {
   3.887853998723707*^9, 3.887854002458025*^9}, {3.887854076772145*^9, 
   3.887854085064471*^9}, {3.887854134735679*^9, 3.887854164961273*^9}, {
   3.887854208420014*^9, 3.887854214693897*^9}, {3.887854285179729*^9, 
   3.8878543495461025`*^9}, {3.887854392730285*^9, 3.8878543967579875`*^9}, {
   3.887854468007444*^9, 3.887854475477479*^9}, {3.887854608634014*^9, 
   3.8878546449636197`*^9}, {3.88785467923873*^9, 3.887854679421152*^9}, {
   3.88785471297116*^9, 3.88785471315252*^9}, {3.887854758946162*^9, 
   3.887854772134369*^9}, {3.8878548045602465`*^9, 3.8878548298428917`*^9}, {
   3.887854938363633*^9, 3.887854942664668*^9}, {3.8878551141422167`*^9, 
   3.887855115347071*^9}, {3.887855178736246*^9, 3.8878551947465787`*^9}, {
   3.887855234989222*^9, 3.887855303673656*^9}, {3.887855609673528*^9, 
   3.887855614851804*^9}, {3.887855705745729*^9, 3.887855732814309*^9}, {
   3.88785597251871*^9, 3.887856061475362*^9}, {3.8878563637574015`*^9, 
   3.887856379082927*^9}, {3.887856479998761*^9, 3.8878564925469666`*^9}, {
   3.88785660938179*^9, 3.887856659548732*^9}, {3.887856768219657*^9, 
   3.887856777692586*^9}, {3.887856813719973*^9, 3.887856845414982*^9}, {
   3.887856877798045*^9, 3.887856883321121*^9}, {3.887856968200095*^9, 
   3.887856978383237*^9}, 3.887857017578266*^9, {3.8878570805838423`*^9, 
   3.8878571587452345`*^9}, {3.8878572230446124`*^9, 
   3.8878572538330297`*^9}, {3.8878572915226016`*^9, 3.88785731133545*^9}, {
   3.887857359243762*^9, 3.8878573597281375`*^9}, {3.887919954610072*^9, 
   3.8879199580642843`*^9}, {3.8879200003907413`*^9, 3.887920031792619*^9}, 
   3.887931253229566*^9, 3.887931359541418*^9, {3.887933474907672*^9, 
   3.8879334778516855`*^9}, {3.887933590607071*^9, 3.887933612521811*^9}, {
   3.887933660287312*^9, 3.887933662817077*^9}, {3.887933837234798*^9, 
   3.887933863970456*^9}, {3.887933941216029*^9, 3.8879339941227474`*^9}, {
   3.887934609772808*^9, 3.8879346143160152`*^9}, {3.887934653825678*^9, 
   3.887934668352765*^9}, {3.8882336032543955`*^9, 3.888233609892932*^9}, 
   3.892494384414444*^9, {3.892494748800523*^9, 3.8924947497653832`*^9}, {
   3.8924953802929125`*^9, 3.892495423261282*^9}, {3.892495453815242*^9, 
   3.892495497600283*^9}, {3.892495591278836*^9, 3.892495598306783*^9}, {
   3.892495788263833*^9, 3.892495838276489*^9}, {3.892495991216982*^9, 
   3.892496092572358*^9}, 3.89249630358827*^9, {3.89249634669681*^9, 
   3.8924963492694397`*^9}, {3.892496400642308*^9, 3.892496407315282*^9}, 
   3.892496597328345*^9, {3.892497082232457*^9, 3.892497088961246*^9}, 
   3.892497306937595*^9, 3.8924984485355225`*^9, {3.892498491007666*^9, 
   3.892498530602607*^9}, 3.892498653209288*^9, {3.8924990082639728`*^9, 
   3.892499034375566*^9}, 3.892499245898033*^9, 3.892499928157049*^9, {
   3.8925002357733827`*^9, 3.892500241563636*^9}, 3.8925007090640965`*^9, 
   3.892500876108046*^9, {3.892762346245595*^9, 3.892762363090499*^9}, 
   3.892762457303896*^9, {3.8927624892111645`*^9, 3.892762502660687*^9}, 
   3.893295484969878*^9, 3.89369611615662*^9, {3.8936962328040547`*^9, 
   3.8936962455439014`*^9}, {3.8936964181426935`*^9, 3.893696418512635*^9}, {
   3.893698661852474*^9, 3.8936986623993464`*^9}, 3.89369875295938*^9, {
   3.893698783458149*^9, 3.893698787112262*^9}, 3.8936989977397537`*^9, 
   3.893699124014065*^9, {3.893699185741294*^9, 3.8936991864913*^9}, {
   3.8937002069401875`*^9, 3.893700233738045*^9}, 3.89370167244588*^9, 
   3.893943570274518*^9, {3.8958607385355053`*^9, 3.895860738973004*^9}, 
   3.895861310347907*^9, {3.895863455312131*^9, 3.895863457982354*^9}, {
   3.895882159268922*^9, 3.895882160186198*^9}, {3.8958845762335873`*^9, 
   3.895884599580189*^9}, {3.895884638826479*^9, 3.8958846697586527`*^9}, {
   3.895884747250819*^9, 3.895884764467696*^9}, 3.89588498677387*^9, {
   3.896054206094593*^9, 3.896054258671324*^9}, {3.896054299032913*^9, 
   3.896054305542528*^9}, {3.896054353111327*^9, 3.896054486826587*^9}, {
   3.896055303007364*^9, 3.896055303651204*^9}, {3.896055459245226*^9, 
   3.896055461212379*^9}, {3.896055705344165*^9, 3.896055705471612*^9}, {
   3.896056771856551*^9, 3.8960567725428977`*^9}, {3.8960571474670935`*^9, 
   3.896057148095489*^9}, {3.8961084706977067`*^9, 3.896108484651124*^9}, {
   3.896108528450506*^9, 3.896108568256239*^9}, {3.8961094154391327`*^9, 
   3.896109472251428*^9}, {3.896109547622604*^9, 3.896109553868688*^9}, {
   3.896134258367401*^9, 3.896134258775107*^9}, {3.896134295598743*^9, 
   3.8961343849228597`*^9}, {3.8961344808189087`*^9, 3.896134495980072*^9}, {
   3.896134544584853*^9, 3.896134548027275*^9}, {3.896134587198448*^9, 
   3.8961346140412188`*^9}, {3.896135228118886*^9, 3.8961352722049055`*^9}, {
   3.896135335866455*^9, 3.8961353717250633`*^9}, {3.8961354060910735`*^9, 
   3.896135458723266*^9}, {3.896135539028784*^9, 3.8961355485406556`*^9}, {
   3.896135583804103*^9, 3.896135680950555*^9}, {3.896135760151292*^9, 
   3.896135763347273*^9}, {3.896136014018389*^9, 3.8961360226792345`*^9}, {
   3.8961360535541267`*^9, 3.896136067900677*^9}, {3.8961361401037717`*^9, 
   3.896136163014147*^9}, {3.896136228954855*^9, 3.896136257444093*^9}, {
   3.896136352297743*^9, 3.896136368415354*^9}, {3.8961364256825843`*^9, 
   3.896136426644823*^9}, {3.896137656855519*^9, 3.8961376751787724`*^9}, {
   3.896664950327098*^9, 3.89666495510038*^9}, {3.897848482117449*^9, 
   3.897848485378989*^9}, {3.897854802741653*^9, 3.8978548030569835`*^9}, {
   3.897855490590728*^9, 3.897855506527709*^9}, {3.897856462080842*^9, 
   3.897856470757413*^9}, {3.9098814390221524`*^9, 3.909881442323074*^9}, 
   3.909882802114745*^9, {3.909931125967936*^9, 3.909931126428997*^9}, {
   3.909934204505965*^9, 3.9099342051326*^9}, {3.909934861012515*^9, 
   3.909934861429454*^9}, {3.909934954830824*^9, 3.909934955287376*^9}, {
   3.909936628825538*^9, 3.9099366301180367`*^9}, {3.90993667302899*^9, 
   3.9099366751104045`*^9}, {3.909938637854875*^9, 3.9099386516197505`*^9}, {
   3.909938839840039*^9, 3.909938840342992*^9}, 3.9099390845346165`*^9, {
   3.909939630329803*^9, 3.909939633731355*^9}, {3.90994084282002*^9, 
   3.909940852165858*^9}, {3.914773072160761*^9, 3.914773099185044*^9}, {
   3.9147731328739357`*^9, 3.914773134817425*^9}, {3.914773218864311*^9, 
   3.914773219042197*^9}, {3.914775420202579*^9, 3.9147754362409153`*^9}, {
   3.9147757712444057`*^9, 3.914775771774765*^9}, {3.914775886368173*^9, 
   3.9147758919096966`*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"7ebd4447-fc3c-4eb0-9e76-dd514f64b86e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solver for inhomogeneous waves", "Chapter",
 CellChangeTimes->{{3.8426194097614*^9, 3.842619421050746*^9}, {
  3.854488964366927*^9, 3.8544889882006183`*^9}, {3.854489281630262*^9, 
  3.8544892864348083`*^9}, {3.854489319153143*^9, 3.854489334357749*^9}, {
  3.892490498727158*^9, 
  3.892490500542656*^9}},ExpressionUUID->"9a9bd620-7b4a-46b2-9824-\
74024f07f572"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "computePNL", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"self", "-", "explanatory"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"computePNL", "[", 
    RowBox[{"dL_List", ",", "E1_List", ",", "E2_List", ",", 
     RowBox[{"factor_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", "factor", ")"}], 
    RowBox[{"dL", ".", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"[", "3", "]"}], "]"}], " ", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}]}], "}"}], "&"}], "@@", 
       RowBox[{"{", 
        RowBox[{"E1", ",", "E2"}], "}"}]}], ")"}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.840629925790708*^9, 3.840629981446116*^9}, {
   3.840630087106097*^9, 3.8406301121116295`*^9}, {3.842623976399015*^9, 
   3.842623977233087*^9}, {3.854492249928162*^9, 3.854492257947187*^9}, 
   3.895837579834124*^9},
 CellLabel->"In[88]:=",ExpressionUUID->"8ad8b392-0009-4cba-81ca-2369903c7c44"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "solveInhom", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"solveInhom", ",", "HoldAll"}], "]"}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "for", " ", "single", " ", "interface", " ", "or", " ", "slab", " ", 
    "case"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"solveInhom", "[", 
    RowBox[{
    "mat_", ",", "wT1\[Omega]_", ",", "wT2\[Omega]_", ",", "wT12\[Omega]Inh_",
      ",", "wT22\[Omega]Inh_", ",", "wTmix2\[Omega]Inh_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "w", ",", "phases", ",", "eT1\[Omega]", ",", "eT2\[Omega]", ",", 
       "PNLT1", ",", "PNLT2", ",", "PNLmix", ",", "eT12\[Omega]Inh", ",", 
       "eT22\[Omega]Inh", ",", "eTmix2\[Omega]Inh", ",", "lhs", ",", "rhs", 
       ",", "equ", ",", "sol", ",", "unknowns", ",", "M", ",", "B"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"unknowns", "=", 
       RowBox[{"{", 
        RowBox[{
        "C11", ",", "C21", ",", "C31", ",", "C12", ",", "C22", ",", "C32", 
         ",", "C13", ",", "C23", ",", "C33"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], "==", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "No", " ", "need", " ", "to", " ", "solve", " ", "if", " ", "the", 
          " ", "layer", " ", "is", " ", "linear", " ", "material"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0.", ",", "0."}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0.", ",", "0."}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0.", ",", "0."}], "}"}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], "==", "1"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Define", " ", "real", " ", "space", " ", "vector", " ", "r", " ", 
           "and", " ", "phases", " ", "which", " ", "contain", " ", "ko"}], 
          ",", " ", "keo", ",", " ", 
          RowBox[{
           RowBox[{"and", " ", "ko"}], "+", "keo"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"w", "=", 
          RowBox[{"wT1\[Omega]", "[", "\[Omega]", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"phases", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "/@"}], "*)"}], 
          RowBox[{"<|", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"T1\[Omega]", "->", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT1\[Omega]", "[", "\[Omega]", "]"}], " ", "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT1\[Omega]", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"T2\[Omega]", "->", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT2\[Omega]", "[", "\[Omega]", "]"}], " ", "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT2\[Omega]", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"T1", "\[Rule]", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT12\[Omega]Inh", "[", "\[Omega]", "]"}], "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT12\[Omega]Inh", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"T2", "\[Rule]", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT22\[Omega]Inh", "[", "\[Omega]", "]"}], " ", 
                  "t"}], "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT22\[Omega]Inh", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"mix", "\[Rule]", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wTmix2\[Omega]Inh", "[", "\[Omega]", "]"}], "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wTmix2\[Omega]Inh", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "Compute", " ", "PNL", " ", "from", " ", "\[Omega]", " ", 
            "waves"}], ";", " ", 
           RowBox[{
           "e", " ", "is", " ", "propagating", " ", "electric", " ", 
            "field"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"eT1\[Omega]", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"wT1\[Omega]", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "T1\[Omega]", "]"}]}], 
           RowBox[{"(*", 
            RowBox[{"wT1\[Omega]", "[", "phase", "]"}], "*)"}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"eT2\[Omega]", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"wT2\[Omega]", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "T2\[Omega]", "]"}]}], 
           RowBox[{"(*", 
            RowBox[{"wT2\[Omega]", "[", "phase", "]"}], "*)"}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<dL:\\n\>\"", ",", 
             RowBox[{
              RowBox[{"mat", "[", "dL", "]"}], "//", "MatrixForm"}]}], 
            "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"PNLT1", "=", 
          RowBox[{"computePNL", "[", 
           RowBox[{
            RowBox[{"mat", "[", "dL", "]"}], ",", "eT1\[Omega]", ",", 
            "eT1\[Omega]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"PNLT2", "=", 
          RowBox[{"computePNL", "[", 
           RowBox[{
            RowBox[{"mat", "[", "dL", "]"}], ",", "eT2\[Omega]", ",", 
            "eT2\[Omega]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"PNLmix", "=", 
          RowBox[{"computePNL", "[", 
           RowBox[{
            RowBox[{"mat", "[", "dL", "]"}], ",", "eT1\[Omega]", ",", 
            "eT2\[Omega]", ",", "2"}], "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{"need", " ", "the", " ", "*", "2", " ", "here"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "Establish", " ", "equations", " ", "for", " ", "solving", " ", 
            "inhomogeneous", " ", "waves"}], ";", " ", 
           RowBox[{
           "e", " ", "is", " ", "propagating", " ", "electric", " ", 
            "field"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Replace", " ", "the", " ", "phasor", " ", "to", " ", "preset", " ",
            "ones", " ", "for", " ", "better", " ", "match"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"PNLT1", "=", 
          RowBox[{"PNLT1", "/.", 
           RowBox[{
            RowBox[{"a_.", "*", 
             RowBox[{"E", "^", "b_"}]}], ":>", 
            RowBox[{"a", " ", 
             RowBox[{"phases", "[", "T1", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PNLT2", "=", 
          RowBox[{"PNLT2", "/.", 
           RowBox[{
            RowBox[{"a_.", "*", 
             RowBox[{"E", "^", "b_"}]}], ":>", 
            RowBox[{"a", " ", 
             RowBox[{"phases", "[", "T2", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PNLmix", "=", 
          RowBox[{"PNLmix", "/.", 
           RowBox[{
            RowBox[{"a_.", "*", 
             RowBox[{"E", "^", "b_"}]}], ":>", 
            RowBox[{"a", " ", 
             RowBox[{"phases", "[", "mix", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<PNL:\\n\>\"", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"PNLT1", ",", "PNLT2", ",", "PNLmix"}], "}"}], "//", 
               "Chop"}], "//", "Simplify"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
            "eTmix2\[Omega]Inh"}], "}"}], "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], 
             RowBox[{"phases", "[", "T1", "]"}]}], 
            RowBox[{"(*", 
             RowBox[{"wT12\[Omega]Inh", "[", "phase", "]"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], 
             RowBox[{"phases", "[", "T2", "]"}]}], 
            RowBox[{"(*", 
             RowBox[{"wT22\[Omega]Inh", "[", "phase", "]"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], 
             RowBox[{"phases", "[", "mix", "]"}]}]}], 
           RowBox[{"(*", 
            RowBox[{"wTmix2\[Omega]Inh", "[", "phase", "]"}], "*)"}], "}"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<eT12\[Omega]Inh,eT22\[Omega]Inh,eTmix2\[Omega]Inh:\\n\>\"", 
             ",", 
             RowBox[{"{", 
              RowBox[{
              "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
               "eTmix2\[Omega]Inh"}], "}"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lhs", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{
           RowBox[{
            RowBox[{"Curl", "[", 
             RowBox[{
              RowBox[{"Curl", "[", 
               RowBox[{"#", ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{
            "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
             "eTmix2\[Omega]Inh"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rhs", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"2", "w"}], ")"}], "2"], "\[Mu]0", " ", 
               "\[CurlyEpsilon]0", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}], ".",
                   "#1"}], "+", "#2"}], ")"}]}], ")"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
                "eTmix2\[Omega]Inh"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"PNLT1", ",", "PNLT2", ",", "PNLmix"}], "}"}]}], 
             "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<lhs:\\n\>\"", ",", 
             RowBox[{"lhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<rhs:\\n\>\"", ",", 
             RowBox[{"rhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"equ", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"lhs", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T1", "]"}]}], "]"}], "==", 
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"rhs", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T1", "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"lhs", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T2", "]"}]}], "]"}], "==", 
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"rhs", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T2", "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"lhs", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "mix", "]"}]}], "]"}], "==", 
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"rhs", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "mix", "]"}]}], "]"}]}]}], 
           "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<equations for solving Cij:\\n\>\"", ",", 
             RowBox[{"Simplify", "@", 
              RowBox[{"(", 
               RowBox[{"Thread", "/@", "equ"}], ")"}]}]}], "]"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Check", " ", "in", " ", "PNL", " ", "need", " ", "to", " ", "be", 
           " ", "taken", " ", "out"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"flagLinearSolve", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"B", ",", "M"}], "}"}], "=", 
             RowBox[{"Normal", "@", 
              RowBox[{"CoefficientArrays", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"sol", "=", 
             RowBox[{"Thread", "[", 
              RowBox[{"unknowns", "->", 
               RowBox[{"LinearSolve", "[", 
                RowBox[{"M", ",", "B"}], "]"}]}], "]"}]}], ";"}], 
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Quiet", "@", 
             RowBox[{"If", "[", 
              RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"NSolve", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "@", 
                   RowBox[{"(", 
                    RowBox[{"Thread", "/@", "equ"}], ")"}]}], ",", 
                  "unknowns"}], 
                 RowBox[{"(*", 
                  RowBox[{",", 
                   RowBox[{"Method", "->", "Reduce"}]}], "*)"}], "]"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"Solve", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "@", 
                   RowBox[{"(", 
                    RowBox[{"Thread", "/@", "equ"}], ")"}]}], ",", 
                  "unknowns"}], 
                 RowBox[{"(*", 
                  RowBox[{",", 
                   RowBox[{"Method", "->", "Reduce"}]}], "*)"}], "]"}]}]}], 
              "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<C_ij: \\n\>\"", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"ArrayReshape", "[", 
                   RowBox[{"unknowns", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "3"}], "}"}]}], "]"}], "/.", "sol"}], 
                 ")"}], "//", "Simplify"}], "//", "Transpose"}], "//", 
              "MatrixForm"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", "sol"}], "==", "0"}], ",", 
           RowBox[{
            RowBox[{
            "Print", "[", 
             "\"\<Solution is empty for inhomogeneous 2\[Omega] wave\>\"", 
             "]"}], ";", 
            RowBox[{"sol", "=", 
             RowBox[{"Thread", "[", 
              RowBox[{"unknowns", "->", 
               RowBox[{"ConstantArray", "[", 
                RowBox[{"0.", ",", "9"}], "]"}]}], "]"}]}], ";"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], "/.", 
           RowBox[{"sol", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], "/.", 
           RowBox[{"sol", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], "/.", 
           RowBox[{"sol", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"PNLT1", ",", "PNLT2", ",", "PNLmix"}], "}"}], "]"}], ";"}], 
     "*)"}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"for", " ", "general", " ", "case"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"solveInhom", "[", 
   RowBox[{"mat_", ",", "wHom_", ",", "wInhom_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "w", ",", "phases", ",", "wF1", ",", "wF2", ",", "wB1", ",", "wB2", ",", 
      "\[IndentingNewLine]", "wInhF1F1", ",", "wInhF2F2", ",", "wInhF1F2", 
      ",", "wInhB1B1", ",", "wInhB2B2", ",", "wInhB1B2", ",", "wInhF1B2", ",",
       "wInhF2B1", ",", "wInhF1B1", ",", "wInhF2B2", ",", 
      "\[IndentingNewLine]", "PNLF1F1", ",", "PNLF2F2", ",", "PNLF1F2", ",", 
      "PNLB1B1", ",", "PNLB2B2", ",", "PNLB1B2", ",", "PNLF1B2", ",", 
      "PNLF2B1", ",", "PNLF1B1", ",", "PNLF2B2", ",", "\[IndentingNewLine]", 
      "eF1", ",", "eF2", ",", "eB1", ",", "eB2", ",", "\[IndentingNewLine]", 
      "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", ",", 
      "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B2", ",", "eInhF2B1", ",", 
      "eInhF1B1", ",", "eInhF2B2", ",", "\[IndentingNewLine]", "lhs", ",", 
      "rhs", ",", "equ", ",", "sol", ",", "unknowns", ",", "M", ",", "B"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"unknowns", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "C11", ",", "C21", ",", "C31", ",", "C12", ",", "C22", ",", "C32", 
          ",", "C13", ",", "C23", ",", "C33", ",", "C14", ",", "C24", ",", 
          "C34", ",", "C15", ",", "C25", ",", "C35", ",", "C16", ",", "C26", 
          ",", "C36", ",", "C17", ",", "C27", ",", "C37", ",", "C18", ",", 
          "C28", ",", "C38", ",", "C19", ",", "C29", ",", "C39", ",", "C110", 
          ",", "C210", ",", "C310"}], "}"}], ",", "3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"mat", "[", "pg", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "==", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "No", " ", "need", " ", "to", " ", "solve", " ", "if", " ", "the", 
         " ", "layer", " ", "is", " ", "linear", " ", "material"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sol", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Flatten", "@", "unknowns"}], ")"}], "->", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0.", ",", "30"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wInhom", "=", 
         RowBox[{"wInhom", "/.", "sol"}]}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"mat", "[", "pg", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "==", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"wF1", ",", "wF2", ",", "wB1", ",", "wB2"}], "}"}], "=", 
         "wHom"}], ";", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"wF1", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "wInhF1F1", ",", "wInhF2F2", ",", "wInhF1F2", ",", "wInhB1B1", ",", 
           "wInhB2B2", ",", "wInhB1B2", ",", "wInhF1B1", ",", "wInhF2B2", ",",
            "wInhF1B2", ",", "wInhF2B1"}], "}"}], "=", "wInhom"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"phases", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "/@"}], "*)"}], 
         RowBox[{"<|", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"homF1", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wF1", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wF1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"homF2", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wF2", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wF2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"homB1", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wB1", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wB1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"homB2", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wB2", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wB2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1F1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1F1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1F1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF2F2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF2F2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF2F2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1F2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1F2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1F2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomB1B1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhB1B1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhB1B1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomB2B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhB2B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhB2B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomB1B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhB1B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhB1B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1B1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1B1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1B1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF2B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF2B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF2B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF2B1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF2B1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF2B1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}]}], "\[IndentingNewLine]", "|>"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Compute", " ", "PNL", " ", "from", " ", "\[Omega]", " ", "waves"}],
           ";", " ", 
          RowBox[{
          "e", " ", "is", " ", "propagating", " ", "electric", " ", 
           "field"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"eF1", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wF1", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homF1", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eF2", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wF2", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homF2", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eB1", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wB1", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homB1", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eB2", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wB2", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homB2", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<dL:\\n\>\"", ",", 
            RowBox[{
             RowBox[{"mat", "[", "dL", "]"}], "//", "MatrixForm"}]}], "]"}]}],
          "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1F1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eF1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF2F2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF2", ",", "eF2"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1F2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eF2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLB1B1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eB1", ",", "eB1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLB2B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eB2", ",", "eB2"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLB1B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eB1", ",", "eB2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1B1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eB1", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF2B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF2", ",", "eB2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eB2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF2B1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF2", ",", "eB1", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Replace", " ", "the", " ", "phasor", " ", "to", " ", "preset", " ", 
          "ones", " ", "for", " ", "better", " ", "match"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1F1", "=", 
         RowBox[{"PNLF1F1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1F1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF2F2", "=", 
         RowBox[{"PNLF2F2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF2F2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1F2", "=", 
         RowBox[{"PNLF1F2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1F2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLB1B1", "=", 
         RowBox[{"PNLB1B1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomB1B1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLB2B2", "=", 
         RowBox[{"PNLB2B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomB2B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLB1B2", "=", 
         RowBox[{"PNLB1B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomB1B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1B1", "=", 
         RowBox[{"PNLF1B1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1B1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF2B2", "=", 
         RowBox[{"PNLF2B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF2B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1B2", "=", 
         RowBox[{"PNLF1B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF2B1", "=", 
         RowBox[{"PNLF2B1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF2B1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<PNLs:\\n\>\"", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "PNLF1F1", ",", "PNLF2F2", ",", "PNLF1F2", ",", "PNLB1B1", 
                 ",", "PNLB2B2", ",", "PNLB1B2", ",", "PNLF1B1", ",", 
                 "PNLF2B2", ",", "PNLF1B2", ",", "PNLF2B1"}], "}"}], "//", 
               "Simplify"}], "//", "Chop"}], "//", "MatrixForm"}]}], "]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", ",", 
           "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", "eInhF2B2", ",",
            "eInhF1B2", ",", "eInhF2B1"}], "}"}], "=", " ", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"wInhF1F1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1F1", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF2F2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF2F2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF1F2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1F2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhB1B1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomB1B1", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhB2B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomB2B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhB1B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomB1B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF1B1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1B1", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF2B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF2B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF1B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF2B1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF2B1", "]"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<eInhF1F1,eInhF2F2,eInhF1F2,eInhB1B1,eInhB2B2,eInhB1B2,\
eInhF1B1,eInhF2B2,eInhF1B2,eInhF2B1:\\n\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", 
               ",", "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", 
               "eInhF2B2", ",", "eInhF1B2", ",", "eInhF2B1"}], "}"}], "//", 
             "Simplify"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"lhs", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Curl", "[", 
            RowBox[{
             RowBox[{"Curl", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{
           "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", ",",
             "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", "eInhF2B2", 
            ",", "eInhF1B2", ",", "eInhF2B1"}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rhs", "=", " ", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"2", "w"}], ")"}], "2"], "\[Mu]0", " ", 
              "\[CurlyEpsilon]0", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}], ".", 
                 "#1"}], "+", "#2"}], ")"}]}], ")"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", 
               ",", "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", 
               "eInhF2B2", ",", "eInhF1B2", ",", "eInhF2B1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "PNLF1F1", ",", "PNLF2F2", ",", "PNLF1F2", ",", "PNLB1B1", ",", 
               "PNLB2B2", ",", "PNLB1B2", ",", "PNLF1B1", ",", "PNLF2B2", ",",
                "PNLF1B2", ",", "PNLF2B1"}], "}"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<lhs:\\n\>\"", ",", 
            RowBox[{"lhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<rhs:\\n\>\"", ",", 
            RowBox[{"rhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"equ", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F1", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2F2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2F2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "4", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "4", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B1", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "5", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB2B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "5", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB2B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "6", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "6", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "7", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "7", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B1", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "8", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "8", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "9", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "9", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "10", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "10", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B1", "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<equations for solving Cij:\\n\>\"", ",", 
            RowBox[{
             RowBox[{"equout", "=", "equ"}], ";", 
             RowBox[{"MatrixForm", "@", 
              RowBox[{"(*", 
               RowBox[{"Chop", "@"}], "*)"}], 
              RowBox[{"Simplify", "@", 
               RowBox[{"(", "equ", 
                RowBox[{"(*", 
                 RowBox[{"/.", 
                  RowBox[{"{", 
                   RowBox[{"\[CapitalDelta]\[Delta]", "->", "0"}], "}"}]}], 
                 "*)"}], ")"}]}]}]}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Check", " ", "in", " ", "PNL", " ", "need", " ", "to", " ", "be", 
          " ", "taken", " ", "out"}], "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"flagBackward", "&&", "flagStandingWave", "&&", 
           RowBox[{"(", 
            RowBox[{"!", "flagJK"}], ")"}], "&&", 
           RowBox[{"(", 
            RowBox[{"!", "flagHH"}], ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Quiet", "@", 
           RowBox[{"If", "[", 
            RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sol", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"NSolve", "[", 
                   RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                 RowBox[{"Range", "[", "10", "]"}]}], "]"}]}], ";"}], 
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sol", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Solve", "[", 
                   RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                 RowBox[{"Range", "[", "10", "]"}]}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"flagBackward", "&&", 
             RowBox[{"(", 
              RowBox[{"!", "flagStandingWave"}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{"!", "flagJK"}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{"!", "flagHH"}], ")"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Quiet", "@", 
              RowBox[{"If", "[", 
               RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"sol", "=", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"NSolve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "6", "]"}]}], "]"}]}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"sol", "=", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "6", "]"}]}], "]"}]}], ";"}]}], 
               "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"sol", ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"unknowns", "[", 
                    RowBox[{"[", 
                    RowBox[{"7", ";;", "10"}], "]"}], "]"}], "]"}], "->", 
                  RowBox[{"ConstantArray", "[", 
                   RowBox[{"0", ",", "12"}], "]"}]}], "]"}]}], "]"}]}], ";"}],
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"!", 
                RowBox[{"(", "flagBackward", ")"}]}], "||", "flagHH", "||", 
               "flagJK"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Quiet", "@", 
                RowBox[{"If", "[", 
                 RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"sol", "=", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"NSolve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "3", "]"}]}], "]"}]}], ";"}], 
                  "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"sol", "=", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "3", "]"}]}], "]"}]}], ";"}]}], 
                 "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"sol", ",", 
                  RowBox[{"Thread", "[", 
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", 
                    RowBox[{"4", ";;", "10"}], "]"}], "]"}], "]"}], "->", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", "21"}], "]"}]}], "]"}]}], "]"}]}], 
               ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
            "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<C_ij: \\n\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"unknowns", "/.", "sol"}], ")"}], "//", "Simplify"}], 
              "//", "Chop"}], "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", "sol"}], "==", "0"}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Solution 1 is empty for inhomogeneous 2\[Omega] wave! \
Aborted!\>\"", "]"}], ";", 
           RowBox[{"sol", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Flatten", "@", "unknowns"}], ")"}], "->", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", "30"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"wInhom", "=", 
         RowBox[{"wInhom", "/.", 
          RowBox[{"Flatten", "@", "sol"}]}]}], ";"}]}], "\[IndentingNewLine]",
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.840623579002926*^9, 3.840623587010494*^9}, {
   3.840623623267619*^9, 3.840623645018514*^9}, {3.840623817791394*^9, 
   3.840623846783709*^9}, {3.840623880981275*^9, 3.84062389715619*^9}, {
   3.840624865661085*^9, 3.840624867038286*^9}, {3.840625010793703*^9, 
   3.840625246281911*^9}, {3.840629404714234*^9, 3.840629520786701*^9}, {
   3.8406295509198484`*^9, 3.840629772975324*^9}, {3.8406299895120187`*^9, 
   3.840630035650098*^9}, {3.8406300829257355`*^9, 3.84063008298436*^9}, {
   3.840630123101096*^9, 3.840630341239024*^9}, {3.840630558285247*^9, 
   3.840630944754758*^9}, {3.8406309758344946`*^9, 3.8406309901760464`*^9}, {
   3.84063103910388*^9, 3.84063108285779*^9}, {3.8406311171895285`*^9, 
   3.840631123166865*^9}, {3.840635900064605*^9, 3.8406359870604935`*^9}, 
   3.840636032774841*^9, {3.8406363211852765`*^9, 3.840636321717939*^9}, {
   3.840636392829429*^9, 3.840636406289543*^9}, {3.8406364719559956`*^9, 
   3.840636579352659*^9}, {3.8406366158089447`*^9, 3.840636616380762*^9}, {
   3.840636688134283*^9, 3.8406367186638017`*^9}, 3.840636772994176*^9, {
   3.840636815000583*^9, 3.840636832225251*^9}, {3.840637053509509*^9, 
   3.8406371240439873`*^9}, {3.840637512059969*^9, 3.840637515905404*^9}, {
   3.8406376723105*^9, 3.8406376738032365`*^9}, {3.840637712772744*^9, 
   3.8406377237826056`*^9}, {3.8406377892534246`*^9, 3.84063779021286*^9}, {
   3.8406380125604615`*^9, 3.8406380190431523`*^9}, {3.840638052541001*^9, 
   3.8406380765587177`*^9}, {3.840638308743913*^9, 3.840638309575248*^9}, {
   3.8426206446876316`*^9, 3.8426206483856936`*^9}, {3.842620694344616*^9, 
   3.842620712319669*^9}, {3.842622130488792*^9, 3.8426221521021976`*^9}, {
   3.842622683266835*^9, 3.842622730887514*^9}, {3.842646788319702*^9, 
   3.842646826551877*^9}, {3.842993631787766*^9, 3.842993643191101*^9}, {
   3.845323060352371*^9, 3.845323060888594*^9}, {3.845323119687947*^9, 
   3.845323120381471*^9}, {3.845336046803018*^9, 3.845336071746668*^9}, 
   3.8465817062700405`*^9, {3.885596979795186*^9, 3.8855974255668297`*^9}, {
   3.8855979954271817`*^9, 3.8855980373454494`*^9}, {3.885598163395832*^9, 
   3.885598166786007*^9}, {3.885598364359808*^9, 3.885598364869651*^9}, {
   3.885598399983607*^9, 3.885598402834041*^9}, {3.885598449395629*^9, 
   3.885598452485874*^9}, {3.8855985645085087`*^9, 3.885598566285672*^9}, {
   3.885598720427962*^9, 3.885598723563246*^9}, {3.886352204724801*^9, 
   3.8863522054018526`*^9}, {3.886474925146279*^9, 3.886474930778122*^9}, 
   3.887843113141415*^9, 3.887853307070464*^9, {3.88785367984237*^9, 
   3.887853696580268*^9}, {3.8879344316459846`*^9, 3.887934443147238*^9}, {
   3.892501587510828*^9, 3.892501595473713*^9}, 3.892762835434821*^9, {
   3.893294766125059*^9, 3.89329477024156*^9}, 3.893295480843336*^9, {
   3.893696332633769*^9, 3.893696343114337*^9}, {3.896045256344219*^9, 
   3.896045287556246*^9}, 3.89604534780994*^9, {3.896045705950953*^9, 
   3.896045812565845*^9}, {3.896045924700124*^9, 3.896045926029362*^9}, {
   3.8960573074697*^9, 3.8960573239008055`*^9}, {3.896057480483635*^9, 
   3.896057480648693*^9}, {3.896057582819283*^9, 3.896057585343664*^9}, {
   3.896059701541781*^9, 3.89605970158378*^9}, {3.8960600579390745`*^9, 
   3.896060188470999*^9}, {3.896060430960664*^9, 3.89606044534034*^9}, {
   3.896060479265324*^9, 3.896060508183317*^9}, {3.8960605458776765`*^9, 
   3.896060554730861*^9}, {3.896060878108182*^9, 3.896060890419245*^9}, {
   3.89606318059384*^9, 3.896063203082839*^9}, {3.8961031753768125`*^9, 
   3.896103176608018*^9}, {3.896104083739131*^9, 3.8961040858493285`*^9}, {
   3.896105637320348*^9, 3.89610563943448*^9}, {3.896105675233082*^9, 
   3.896105728137563*^9}, {3.896106064552899*^9, 3.896106103881841*^9}, {
   3.896106173519*^9, 3.896106209158726*^9}, {3.896106358241875*^9, 
   3.896106358690874*^9}, {3.896106657166809*^9, 3.8961066591920576`*^9}, {
   3.8961067121448665`*^9, 3.8961067297957907`*^9}, {3.8961070912826962`*^9, 
   3.89610712052413*^9}, 3.896107196408525*^9, 3.8961074968361*^9, 
   3.896107534878972*^9, {3.8961376984677453`*^9, 3.896137715446099*^9}, {
   3.8963098428703485`*^9, 3.896309852536307*^9}, {3.8963098899274044`*^9, 
   3.8963099747815747`*^9}, {3.89631005494066*^9, 3.8963101586177745`*^9}, {
   3.8963102055901594`*^9, 3.896310218691245*^9}, {3.896310570557405*^9, 
   3.896310601922491*^9}, 3.8963106535169153`*^9, {3.896312429432557*^9, 
   3.896312455088674*^9}, {3.896664739442689*^9, 3.8966647776984525`*^9}, {
   3.896664823484248*^9, 3.896664879860423*^9}, {3.896664968936884*^9, 
   3.896664989212431*^9}, {3.896665110024803*^9, 3.89666511428778*^9}, {
   3.8970135249667068`*^9, 3.8970135288505697`*^9}, {3.89701357693036*^9, 
   3.897013579104664*^9}, {3.897013623358416*^9, 3.897013627948146*^9}, {
   3.897013706992421*^9, 3.897013707592675*^9}, {3.8970138047266903`*^9, 
   3.8970138156465435`*^9}, {3.89701386479228*^9, 3.897013966395974*^9}, {
   3.897014405995186*^9, 3.897014423823183*^9}, {3.89701681572192*^9, 
   3.8970168253184*^9}, {3.89709001914995*^9, 3.8970900195762353`*^9}, {
   3.897090209658141*^9, 3.897090210208144*^9}, {3.89709100419808*^9, 
   3.897091011396214*^9}, {3.897091104783769*^9, 3.897091127765359*^9}, {
   3.897091168993173*^9, 3.897091188711895*^9}, {3.89709134580236*^9, 
   3.8970913702485476`*^9}, {3.897091459616628*^9, 3.897091529627958*^9}, {
   3.8970915636985254`*^9, 3.8970915641654015`*^9}, 3.8970916302344913`*^9, {
   3.897091683533803*^9, 3.8970917301718645`*^9}, {3.8970921215759497`*^9, 
   3.897092121746952*^9}, {3.8970921787081003`*^9, 3.897092324456949*^9}, {
   3.897092418121436*^9, 3.897092424665983*^9}, {3.897092501278545*^9, 
   3.897092505989493*^9}, {3.897092541319958*^9, 3.897092573098068*^9}, {
   3.897092676585085*^9, 3.8970926834729624`*^9}, 3.8970928320549746`*^9, 
   3.89709310085798*^9, {3.8970931788572226`*^9, 3.897093190275114*^9}, {
   3.897093801274205*^9, 3.897093822342343*^9}, 3.89709415782382*^9, {
   3.897094476772786*^9, 3.8970944996371393`*^9}, {3.897094596025419*^9, 
   3.897094599097691*^9}, {3.8970949506630783`*^9, 3.897095088842125*^9}, {
   3.897095466872977*^9, 3.897095524245458*^9}, {3.897095558134813*^9, 
   3.897096061062954*^9}, {3.897096145369032*^9, 3.89709617964712*^9}, {
   3.897096250430691*^9, 3.897096499931136*^9}, {3.897096645909113*^9, 
   3.897096740571319*^9}, {3.897097892816201*^9, 3.897097895560094*^9}, {
   3.89717916004576*^9, 3.897179175539115*^9}, {3.897179217830192*^9, 
   3.897179241961638*^9}, {3.897441217089265*^9, 3.897441293304685*^9}, {
   3.897848319469956*^9, 3.897848347068701*^9}, {3.8978547048130136`*^9, 
   3.897854712978715*^9}, {3.897857841682536*^9, 3.8978578421187043`*^9}, {
   3.8978579087934976`*^9, 3.897857914978042*^9}, {3.897858000544955*^9, 
   3.89785803406016*^9}, {3.89785806765737*^9, 3.8978580705824966`*^9}, {
   3.897858161492572*^9, 3.897858193928844*^9}, {3.897858246434809*^9, 
   3.897858250048804*^9}, {3.909931344822798*^9, 3.909931345263793*^9}, {
   3.909933229026314*^9, 3.909933242943949*^9}, {3.909933310411382*^9, 
   3.9099333424282284`*^9}, {3.909933503654135*^9, 3.9099335147732*^9}, {
   3.909934184401853*^9, 3.909934194316131*^9}, {3.909934360887773*^9, 
   3.90993436108817*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"e7e53672-7a55-40ac-b67a-b6ba1f919ac7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Combined core functions ", "Title",
 CellChangeTimes->{{3.854489059592823*^9, 3.8544890626996765`*^9}, {
  3.8971741696131024`*^9, 
  3.897174170659542*^9}},ExpressionUUID->"aa85a36c-2768-4639-8d0e-\
decaa9e87b85"],

Cell[CellGroupData[{

Cell["Single interface ", "Chapter",
 CellChangeTimes->{{3.838373980263477*^9, 3.838373982795429*^9}, {
  3.838476972345773*^9, 3.838476976108146*^9}, {3.841738032684884*^9, 
  3.841738035641788*^9}, {3.842615597653872*^9, 3.84261560047073*^9}, {
  3.842615633718744*^9, 3.842615645550023*^9}, {3.842621178753799*^9, 
  3.842621182747777*^9}, {3.847727644541135*^9, 3.847727645049964*^9}, {
  3.892490134838199*^9, 3.892490140022032*^9}, {3.892490286919978*^9, 
  3.892490288900804*^9}, {3.893979764635038*^9, 
  3.893979766815338*^9}},ExpressionUUID->"8eefb35c-18b2-43e7-8ef4-\
d903250f5053"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "single", " ", "reflection", " ", "linear", " ", "wave"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Inputs", ":"}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{"m1", " ", "-", " ", 
     RowBox[{
     "the", " ", "first", " ", "material", " ", "where", " ", "incident", " ",
       "wave", " ", "comes", " ", "from"}]}], ";", " ", 
    RowBox[{
    "may", " ", "or", " ", "may", " ", "not", " ", "to", " ", "be", " ", 
     "Air"}], ";", " ", "\[IndentingNewLine]", 
    RowBox[{"m2", " ", "-", " ", 
     RowBox[{"the", " ", "second", " ", "material"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Outputs", ":"}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{"wR1", " ", "-", " ", 
     RowBox[{"the", " ", "reflective", " ", "wave", " ", "1"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"wR2", " ", "-", " ", 
     RowBox[{"the", " ", "reflective", " ", "wave", " ", "2"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"wT1", " ", "-", " ", 
     RowBox[{"the", " ", "transmitive", " ", "wave", " ", "1"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"wT2", " ", "-", " ", 
     RowBox[{"the", " ", "transmitive", " ", "wave", " ", "2"}]}], ";"}], 
   "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "f1L", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"f1L", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"f1L", "[", 
     RowBox[{"m1_", ",", "m2_", ",", "wInc_", ",", 
      RowBox[{"solFresnel_", ":", "True"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"w", ",", "wR1", ",", "wR2", ",", "wT2", ",", "wT1"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ValueQ", "[", "m1", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "m2", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Unvalued arguments detected when calling the function! Abort!\
\>\"", "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w", "=", 
        RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"reflection", " ", "at", " ", "top"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"wR1", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kR1", ",", "k0R1", ",", "\[Theta]R1", ",", "ER1"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wR2", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kR2", ",", "k0R2", ",", "\[Theta]R2", ",", "ER2"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wT1", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kT1", ",", "k0T1", ",", "\[Theta]T1", ",", "ET1"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wT2", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kT2", ",", "k0T2", ",", "\[Theta]T2", ",", "ET2"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{"m2", ",", "wInc", ",", "wT1", ",", "wT2"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{"m1", ",", "wInc", ",", "wR1", ",", "wR2", ",", "True"}], 
        "]"}], ";", 
       RowBox[{"(*", "backward", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"solFresnel", ",", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", "wInc", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"wT1", ",", "wT2"}], "}"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.837007835257337*^9, 3.837007836185034*^9}, {
   3.837007900064698*^9, 3.8370079110545683`*^9}, {3.837008220266658*^9, 
   3.837008255248239*^9}, {3.837008729113855*^9, 3.8370087404028473`*^9}, {
   3.8378089546527143`*^9, 3.837808980415783*^9}, {3.837812186704202*^9, 
   3.837812207026122*^9}, 3.837812321511337*^9, 3.837820855981249*^9, {
   3.838458291877117*^9, 3.8384583082470627`*^9}, {3.838458352961977*^9, 
   3.838458370738013*^9}, {3.8384617738278604`*^9, 3.838461877193755*^9}, 
   3.83846283076084*^9, {3.838499718362018*^9, 3.8384997234469013`*^9}, {
   3.8384997562381625`*^9, 3.838499781269209*^9}, {3.838507019261238*^9, 
   3.838507031386097*^9}, {3.838508702771237*^9, 3.838508710751197*^9}, {
   3.838510207968486*^9, 3.8385102208443346`*^9}, {3.838510563673222*^9, 
   3.8385105651754746`*^9}, 3.838510802522017*^9, {3.838510896949087*^9, 
   3.838510897257112*^9}, {3.838845229824094*^9, 3.838845236903424*^9}, {
   3.838845464553708*^9, 3.8388454675168366`*^9}, {3.8388459940812*^9, 
   3.838845998246813*^9}, {3.840481777360851*^9, 3.840481780239395*^9}, {
   3.842007672641299*^9, 3.8420076888165*^9}, 3.842007889492358*^9, {
   3.842008405306833*^9, 3.842008413178594*^9}, {3.842615913751818*^9, 
   3.842615915862751*^9}, 3.84262383974561*^9, {3.842624026594701*^9, 
   3.84262416293404*^9}, 3.845063252364394*^9, {3.8450633009544063`*^9, 
   3.845063304129873*^9}, {3.8450635282220755`*^9, 3.84506353457038*^9}, {
   3.8544932412464056`*^9, 3.8544932775112505`*^9}, 3.854493318056226*^9, {
   3.854494254470763*^9, 3.854494262418565*^9}, {3.854494551724806*^9, 
   3.854494666881652*^9}, {3.85449484368396*^9, 3.854494865241693*^9}, {
   3.854494908850517*^9, 3.854494939794403*^9}, {3.854670104165124*^9, 
   3.8546701061203117`*^9}, {3.854670144814198*^9, 3.854670160724357*^9}, {
   3.854670193804848*^9, 3.854670267088559*^9}, {3.854670568827015*^9, 
   3.854670572139991*^9}, {3.858003535202718*^9, 3.858003536180534*^9}, {
   3.893733170730446*^9, 3.893733211359901*^9}, {3.893979322721956*^9, 
   3.893979324550219*^9}, {3.893983882794207*^9, 3.893983883012956*^9}, 
   3.895837597304171*^9, {3.896141286976272*^9, 3.896141292336352*^9}, {
   3.896743813357356*^9, 3.89674383188496*^9}, {3.897331389367408*^9, 
   3.897331394839135*^9}, {3.897332622418585*^9, 3.897332639703532*^9}, {
   3.897332877731528*^9, 3.897332877891784*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"4041f397-63fa-4a4c-b9ff-708b0870e6b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "single", " ", "reflection", " ", "nonlinear", " ", "wave"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Inputs", ":"}], " ", ";", "\[IndentingNewLine]", 
     RowBox[{"m1", " ", "-", " ", 
      RowBox[{
      "the", " ", "first", " ", "material", " ", "where", " ", "incident", 
       " ", "wave", " ", "comes", " ", "from"}]}], ";", " ", 
     RowBox[{
     "may", " ", "or", " ", "may", " ", "not", " ", "to", " ", "be", " ", 
      "Air"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"m2", " ", "-", " ", 
      RowBox[{"the", " ", "second", " ", "material"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Outputs", ":"}], " ", ";", "\[IndentingNewLine]", 
     RowBox[{"wR1\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "1", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wR2\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "2", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT1\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "1", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT2\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "2", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wR12\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "1", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wR22\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "2", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT12\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "1", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT22\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "2", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT12\[Omega]Inhom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "1", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"inhomogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT22\[Omega]Inhom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "2", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"inhomogeneous", " ", "part"}], ";"}]}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "f1NL", "]"}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"not", " ", "called"}], ";", " ", 
     RowBox[{"just", " ", "for", " ", "backup"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"f1NL", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"f1NL", "[", 
     RowBox[{"m1_", ",", "m2_", ",", "wInc_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "w", ",", "wR1\[Omega]", ",", "wR2\[Omega]", ",", "wT1\[Omega]", ",", 
        "wT2\[Omega]", ",", "wR12\[Omega]Hom", ",", "wR22\[Omega]Hom", ",", 
        "wT12\[Omega]Hom", ",", "wT22\[Omega]Hom", ",", "wT12\[Omega]Inh", 
        ",", "wT22\[Omega]Inh", ",", "wTmix2\[Omega]Inh", ",", "sol", ",", 
        "equ", ",", "unknowns", ",", "sollinear", ",", "\[Theta]tmp"}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ValueQ", "[", "m1", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "m2", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Unvalued arguments detected when calling the function! Abort!\
\>\"", "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w", "=", 
        RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Obtain", " ", "the", " ", "two", " ", "transmitted", " ", "\[Omega]",
          " ", "waves", " ", "by", " ", "f1L"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"sollinear", "=", 
        RowBox[{"f1L", "[", 
         RowBox[{"m1", ",", "m2", ",", "wInc", ",", "True"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"wR1\[Omega]", ",", "wR2\[Omega]"}], "}"}], "=", 
        RowBox[{"sollinear", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"wT1\[Omega]", ",", "wT2\[Omega]"}], "}"}], "=", 
        RowBox[{"sollinear", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT1\[Omega]: \\n\>\"", ",", 
            RowBox[{"wT1\[Omega]", " ", "//", "MatrixForm"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT2\[Omega]: \\n\>\"", ",", 
            RowBox[{"wT2\[Omega]", "//", "MatrixForm"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Obtain", " ", "the", " ", "two", " ", "transmitted", " ", "and", " ",
          "two", " ", "reflective", " ", "2", "\[Omega]", " ", "waves", " ", 
         "by", " ", "solveSnell"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wT12\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kT12\[Omega]", ",", "k0T12\[Omega]", ",",
            "\[Theta]T12\[Omega]", ",", "ET12\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wT22\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kT22\[Omega]", ",", "k0T22\[Omega]", ",",
            "\[Theta]T22\[Omega]", ",", "ET22\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wR12\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kR12\[Omega]", ",", "k0R12\[Omega]", ",",
            "\[Theta]R12\[Omega]", ",", "ER12\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wR22\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kR22\[Omega]", ",", "k0R22\[Omega]", ",",
            "\[Theta]R22\[Omega]", ",", "ER22\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{
        "m2", ",", "wInc", ",", "wT12\[Omega]Hom", ",", "wT22\[Omega]Hom"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{
        "m1", ",", "wInc", ",", "wR12\[Omega]Hom", ",", "wR22\[Omega]Hom", 
         ",", "True"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Setup", " ", "the", " ", "three", " ", "inhomogeneous", " ", "2", 
          "\[Omega]", " ", "waves", " ", "whose", " ", "magnitude", " ", "to",
           " ", "be", " ", "determined", " ", "by", " ", "Cij"}], ",", " ", 
         RowBox[{
         "which", " ", "is", " ", "solved", " ", "within", " ", 
          "solveInhom"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wT12\[Omega]Inh", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", 
           RowBox[{"2", 
            RowBox[{"wT1\[Omega]", "[", "k", "]"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"wT1\[Omega]", "[", "k0", "]"}]}], ",", 
           RowBox[{"wT1\[Omega]", "[", "\[Theta]", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"C11", ",", "C21", ",", "C31"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wT22\[Omega]Inh", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", 
           RowBox[{"2", 
            RowBox[{"wT2\[Omega]", "[", "k", "]"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"wT2\[Omega]", "[", "k0", "]"}]}], ",", 
           RowBox[{"wT2\[Omega]", "[", "\[Theta]", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"C12", ",", "C22", ",", "C32"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Theta]tmp", "=", 
        RowBox[{"VectorAngle", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"wT1\[Omega]", "[", "k", "]"}], "+", 
             RowBox[{"wT2\[Omega]", "[", "k", "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"wT1\[Omega]", "[", "k0", "]"}], "+", 
             RowBox[{"wT2\[Omega]", "[", "k0", "]"}]}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wTmix2\[Omega]Inh", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", 
           RowBox[{
            RowBox[{"wT1\[Omega]", "[", "k", "]"}], "+", 
            RowBox[{"wT2\[Omega]", "[", "k", "]"}]}], ",", 
           RowBox[{
            RowBox[{"wT1\[Omega]", "[", "k0", "]"}], "+", 
            RowBox[{"wT2\[Omega]", "[", "k0", "]"}]}], ",", "\[Theta]tmp", 
           ",", 
           RowBox[{"{", 
            RowBox[{"C13", ",", "C23", ",", "C33"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"solveInhom", "[", 
        RowBox[{
        "m2", ",", "wT1\[Omega]", ",", "wT2\[Omega]", ",", "wT12\[Omega]Inh", 
         ",", "wT22\[Omega]Inh", ",", "wTmix2\[Omega]Inh"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT12\[Omega]Inh: \\n\>\"", ",", 
            RowBox[{"wT12\[Omega]Inh", " ", "//", "MatrixForm"}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT22\[Omega]Inh: \\n\>\"", ",", 
            RowBox[{"wT22\[Omega]Inh", "//", "MatrixForm"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wTmix2\[Omega]Inh: \\n\>\"", ",", 
            RowBox[{"wTmix2\[Omega]Inh", "//", "MatrixForm"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"unknowns", "=", 
        RowBox[{
         RowBox[{"Key", "[", "EE", "]"}], "/@", 
         RowBox[{"{", 
          RowBox[{
          "wR12\[Omega]Hom", ",", "wR22\[Omega]Hom", ",", "wT12\[Omega]Hom", 
           ",", "wT22\[Omega]Hom"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"unknowns", "=", 
        RowBox[{"DeleteDuplicates", "@", 
         RowBox[{"Cases", "[", 
          RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"solveFresnel", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"wR12\[Omega]Hom", ",", "wR22\[Omega]Hom"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
          "wT12\[Omega]Hom", ",", "wT22\[Omega]Hom", ",", "wT12\[Omega]Inh", 
           ",", "wT22\[Omega]Inh", ",", "wTmix2\[Omega]Inh"}], "}"}], ",", 
         "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Return", " ", "solved", " ", "2", "\[Omega]", " ", "wavs"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"sollinear", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wR12\[Omega]Hom", ",", "wR22\[Omega]Hom"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wT12\[Omega]Hom", ",", "wT22\[Omega]Hom"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "wT12\[Omega]Inh", ",", "wT22\[Omega]Inh", ",", 
             "wTmix2\[Omega]Inh"}], "}"}]}], "}"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8370111756236167`*^9, 3.837011240355401*^9}, {
   3.837011296460211*^9, 3.8370113351944275`*^9}, {3.837011495204887*^9, 
   3.837011654538464*^9}, {3.8370116885640182`*^9, 3.837011891087703*^9}, {
   3.837011940986863*^9, 3.8370120312089*^9}, {3.8370120889075336`*^9, 
   3.837012143381824*^9}, {3.837012179336422*^9, 3.837012340729877*^9}, {
   3.837012414591083*^9, 3.8370126750724516`*^9}, {3.837012712766687*^9, 
   3.837012733609973*^9}, {3.837099380955689*^9, 3.837099487093577*^9}, {
   3.837101858134891*^9, 3.8371019730195155`*^9}, {3.837102023566333*^9, 
   3.8371020411046286`*^9}, {3.837102397698592*^9, 3.837102429674038*^9}, {
   3.837102722862915*^9, 3.837102790385129*^9}, {3.837102856555544*^9, 
   3.837102861407392*^9}, {3.837102900200631*^9, 3.837102918167171*^9}, {
   3.8371029713739185`*^9, 3.8371031136077557`*^9}, {3.837103155782197*^9, 
   3.837103262875979*^9}, {3.83710355182659*^9, 3.837103592838813*^9}, {
   3.837103649599439*^9, 3.837103651919156*^9}, {3.837103693588463*^9, 
   3.8371037302330513`*^9}, {3.8371038194773235`*^9, 
   3.8371038463051915`*^9}, {3.837103913947649*^9, 3.837103988451483*^9}, {
   3.837104098568857*^9, 3.83710417281194*^9}, {3.837104214666757*^9, 
   3.83710428005929*^9}, {3.837104312047778*^9, 3.8371044451064653`*^9}, {
   3.837104488999666*^9, 3.837104490236919*^9}, {3.837104616469263*^9, 
   3.8371049655595884`*^9}, {3.8371050126805043`*^9, 3.837105207252264*^9}, {
   3.8371053815405407`*^9, 3.83710546034364*^9}, {3.8371055312309303`*^9, 
   3.8371055877623496`*^9}, {3.8371056199174995`*^9, 3.837105672754595*^9}, {
   3.837105704691869*^9, 3.8371057344543576`*^9}, {3.837105765472595*^9, 
   3.8371057824183116`*^9}, {3.837105848087447*^9, 3.837106015332658*^9}, {
   3.837106066981455*^9, 3.8371060863951836`*^9}, {3.83710611901339*^9, 
   3.837106246791561*^9}, {3.837106342818833*^9, 3.837106344472864*^9}, {
   3.8371064569926376`*^9, 3.837106467682411*^9}, {3.837106624862486*^9, 
   3.8371066641223435`*^9}, {3.8371066966201487`*^9, 3.837107061150045*^9}, {
   3.8371070941926746`*^9, 3.837107105503098*^9}, {3.8378075653953495`*^9, 
   3.8378075677186584`*^9}, {3.8378078126123*^9, 3.837807820553243*^9}, 
   3.837807859186365*^9, {3.8378082453011103`*^9, 3.837808249180597*^9}, 
   3.837808320919258*^9, {3.837808473597873*^9, 3.8378084880879707`*^9}, {
   3.8378085315170937`*^9, 3.83780853830401*^9}, {3.837808649740037*^9, 
   3.837808720939992*^9}, {3.8378087673639793`*^9, 3.837808823589474*^9}, {
   3.8378088584157453`*^9, 3.837808861047696*^9}, {3.837809086980686*^9, 
   3.837809127045157*^9}, {3.837809172989259*^9, 3.8378092013412533`*^9}, {
   3.837811390895616*^9, 3.837811391539997*^9}, {3.837812337439164*^9, 
   3.837812338968379*^9}, {3.837816570070005*^9, 3.837816627766813*^9}, {
   3.837816718551524*^9, 3.8378167403533955`*^9}, {3.837816923812159*^9, 
   3.837816926261518*^9}, {3.83781718039843*^9, 3.8378172125501976`*^9}, {
   3.837817284609895*^9, 3.837817294689865*^9}, {3.8378177837341375`*^9, 
   3.837817791887147*^9}, {3.83781869350188*^9, 3.837818703000696*^9}, {
   3.837818750984881*^9, 3.83781896777247*^9}, {3.837818998010575*^9, 
   3.837819054061706*^9}, {3.837819313258298*^9, 3.8378193260203843`*^9}, {
   3.83781939733741*^9, 3.837819410063931*^9}, {3.837819444784275*^9, 
   3.837819474894968*^9}, {3.837819521087454*^9, 3.8378195259654417`*^9}, {
   3.837819583511054*^9, 3.8378196399663568`*^9}, {3.837819699198884*^9, 
   3.837819703687841*^9}, {3.837819804845279*^9, 3.837819818510758*^9}, {
   3.8378198911814833`*^9, 3.837819913398425*^9}, {3.837819972051214*^9, 
   3.837819976808687*^9}, {3.8378201519393916`*^9, 3.837820173733742*^9}, {
   3.837820584029259*^9, 3.837820620012338*^9}, {3.8378207754772406`*^9, 
   3.83782077827962*^9}, {3.837820959157303*^9, 3.837820962723849*^9}, {
   3.837821031132693*^9, 3.837821032924157*^9}, {3.8378213907887325`*^9, 
   3.837821433038985*^9}, {3.837821467872021*^9, 3.837821468096036*^9}, {
   3.83782151056887*^9, 3.8378215195702724`*^9}, {3.837891521471547*^9, 
   3.837891522502573*^9}, {3.837891564653766*^9, 3.837891579267441*^9}, {
   3.8378916269288197`*^9, 3.8378916760745974`*^9}, {3.837891721545851*^9, 
   3.837891792553276*^9}, {3.8378918941178207`*^9, 3.837891894727024*^9}, {
   3.8378919639407578`*^9, 3.837891991381095*^9}, {3.837892180684344*^9, 
   3.837892267279922*^9}, {3.837892562986729*^9, 3.837892721454584*^9}, {
   3.837892769480585*^9, 3.837892787952507*^9}, {3.837892825536506*^9, 
   3.837892843767308*^9}, {3.837892885032786*^9, 3.837892895187256*^9}, {
   3.837892925617798*^9, 3.837892948994802*^9}, {3.8378929886518507`*^9, 
   3.837892991815841*^9}, 3.837893044828313*^9, 3.837893102280461*^9, {
   3.8378932362747145`*^9, 3.837893286579934*^9}, {3.837893365743765*^9, 
   3.837893365997512*^9}, {3.837893474253011*^9, 3.8378935686002865`*^9}, {
   3.837894595504875*^9, 3.83789459678084*^9}, 3.837895486667413*^9, {
   3.837895539352363*^9, 3.837895540644899*^9}, {3.837895749834854*^9, 
   3.837895769740769*^9}, {3.837896043935747*^9, 3.8378960991035023`*^9}, {
   3.837896788114651*^9, 3.837896792807534*^9}, {3.837896874592019*^9, 
   3.837896901143776*^9}, 3.8378969348115144`*^9, {3.837897007142313*^9, 
   3.837897009793805*^9}, {3.837897183596117*^9, 3.837897187838358*^9}, 
   3.8378972189834604`*^9, {3.8379004113468323`*^9, 3.837900411893323*^9}, {
   3.838073681009451*^9, 3.838073703796737*^9}, {3.838074070778845*^9, 
   3.8380740815728188`*^9}, 3.8380782394601*^9, 3.838078318186078*^9, {
   3.8381290324458537`*^9, 3.8381290345089207`*^9}, {3.838129078255472*^9, 
   3.838129082162485*^9}, {3.838131685294286*^9, 3.838131725832502*^9}, {
   3.838131831421408*^9, 3.8381319037306843`*^9}, {3.8381430475230775`*^9, 
   3.838143072108023*^9}, {3.838143154777791*^9, 3.83814316426833*^9}, {
   3.838148468987299*^9, 3.838148482112819*^9}, {3.838249885784795*^9, 
   3.838249896877596*^9}, 3.8383339281117315`*^9, {3.838462967298703*^9, 
   3.83846297300643*^9}, {3.838463005208688*^9, 3.838463011395463*^9}, {
   3.838499807667496*^9, 3.8384998548621063`*^9}, {3.8385070720372515`*^9, 
   3.83850709810446*^9}, {3.838845568844281*^9, 3.838845633697424*^9}, {
   3.8388460444094367`*^9, 3.838846044687703*^9}, {3.840476112825001*^9, 
   3.840476121668322*^9}, 3.842007763936949*^9, {3.842007823738381*^9, 
   3.8420078245085573`*^9}, {3.842008315673393*^9, 3.842008336993089*^9}, 
   3.842623853731288*^9, {3.842624167682172*^9, 3.8426241963920803`*^9}, 
   3.842624775230256*^9, 3.842624815723886*^9, 3.842624863626248*^9, {
   3.854493246816428*^9, 3.854493281427164*^9}, 3.854493324225232*^9, {
   3.854494950510412*^9, 3.854494950910301*^9}, {3.854495064666847*^9, 
   3.85449509944733*^9}, {3.8544951447216287`*^9, 3.8544952313261747`*^9}, {
   3.854670272908299*^9, 3.8546702730620203`*^9}, {3.854670558649524*^9, 
   3.854670562102129*^9}, {3.858003512743346*^9, 3.8580035434394217`*^9}, {
   3.858003988577636*^9, 3.858003988727935*^9}, {3.8580041461401525`*^9, 
   3.858004147148191*^9}, {3.858004483779107*^9, 3.858004483919904*^9}, {
   3.85800454413041*^9, 3.8580045551287966`*^9}, {3.858004588091951*^9, 
   3.85800459340919*^9}, {3.858004835003615*^9, 3.858004852950553*^9}, {
   3.8937970526759*^9, 3.893797061304734*^9}, {3.893979332015268*^9, 
   3.893979340463987*^9}, 3.8958375982255993`*^9, {3.8960664019526277`*^9, 
   3.89606642628349*^9}, {3.896068727039133*^9, 3.896068727264359*^9}, {
   3.8961413066517663`*^9, 3.896141359347205*^9}, {3.8961414003255324`*^9, 
   3.8961414050964823`*^9}, {3.8967429959493976`*^9, 3.896743033719715*^9}, {
   3.8967438507797947`*^9, 3.89674385696212*^9}, {3.897332656378974*^9, 
   3.89733271323409*^9}, {3.897332747092564*^9, 3.897332805771158*^9}, {
   3.8973328394347935`*^9, 3.8973328859896517`*^9}, {3.8978564164560933`*^9, 
   3.897856444014556*^9}, 3.897856497731436*^9},
 CellLabel->"In[97]:=",ExpressionUUID->"8049ebf4-e382-440c-9e43-393236a21c0e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Multilayers", "Chapter",
 CellChangeTimes->{{3.847730854397906*^9, 3.847730861429409*^9}, {
   3.8863630254080973`*^9, 3.8863630441335745`*^9}, {3.887848533815809*^9, 
   3.887848534448592*^9}, {3.892490150071565*^9, 3.892490150830311*^9}, {
   3.8924902745339947`*^9, 3.8924902812385025`*^9}, 
   3.893979773698118*^9},ExpressionUUID->"da61b590-48e7-40ee-a0f3-\
2608c5196b8b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "For", " ", "solving", " ", "linear", " ", "waves", " ", "of", " ", "any",
      " ", "number", " ", "of", " ", "layers"}], ";", " ", 
    RowBox[{
    "the", " ", "number", " ", "of", " ", "layer", " ", "is", " ", "the", " ",
      "length", " ", "of", " ", "the", " ", "list", " ", "mAll"}], ";", " ", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Inputs", ":"}], " ", ";", " ", "\[IndentingNewLine]", 
    RowBox[{"m0", " ", "-", " ", 
     RowBox[{
     "material", " ", "for", " ", "the", " ", "incident", " ", "wave"}]}], 
    ";", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mAll", " ", "-", " ", 
      RowBox[{
      "a", " ", "list", " ", "of", " ", "N", " ", "materials", " ", "where", 
       " ", "N", " ", "can", " ", "be", " ", "any", " ", "integer"}]}], " ", ">=",
      "2"}], ";", " ", "\[IndentingNewLine]", 
    RowBox[{"mSub", " ", "-", " ", 
     RowBox[{"material", " ", "at", " ", "the", " ", "bottom"}]}], ";", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"wInc", " ", "=", " ", 
     RowBox[{"the", " ", "incident", " ", "wave"}]}], ";", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"phaseChange", " ", "-", " ", 
     RowBox[{"a", " ", "list", " ", "of", " ", "thickness", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "h1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "h2"}], "}"}], ",", "...", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "hN"}], "}"}]}], "}"}], " ", "for", " ", 
      "the", " ", "layers"}]}], " ", ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"Outputs", ":"}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"wR1", ",", "wR2"}], "}"}], " ", "-", " ", 
     RowBox[{"the", " ", "two", " ", "reflective", " ", "waves"}]}], ";", " ",
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"wT1", ",", "wT2"}], "}"}], " ", "-", " ", 
     RowBox[{"the", " ", "two", " ", "transmitive", " ", "waves"}]}], ";", 
    " ", "\[IndentingNewLine]", 
    RowBox[{"wB", " ", "-", " ", 
     RowBox[{
     "a", " ", "list", " ", "of", " ", "all", " ", "Backward", " ", "waves", 
      " ", "with", " ", "\[Omega]", " ", "frequency", " ", "inside", " ", 
      "the", " ", "layers"}]}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{"wF", " ", "-", " ", 
     RowBox[{
     "a", " ", "list", " ", "of", " ", "all", " ", "Forward", " ", "waves", 
      " ", "with", " ", "\[Omega]", " ", "frequency", " ", "inside", " ", 
      "the", " ", "layers"}]}], " ", ";"}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "f4L", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"f4L", ",", "HoldAll"}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"f4L", "[", 
      RowBox[{"mAll_", ",", "wInc_", ",", 
       RowBox[{"iterative_", ":", "False"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m0", ",", "mSub", ",", "nM", ",", "w", ",", 
         RowBox[{"wF1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"wF2", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"wB1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"wB2", "=", 
          RowBox[{"{", "}"}]}], ",", "wR1", ",", "wR2", ",", "wT1", ",", 
         "wT2", ",", 
         RowBox[{"kF1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"kF2", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"EF1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"EF2", "=", 
          RowBox[{"{", "}"}]}], ",", "unknowns", ",", "sol", ",", "equ", ",", 
         "meds", ",", "wavs", ",", "i", ",", "wF", ",", "wB", ",", 
         "thickness", ",", "wMed", ",", "wF1tmp", ",", "wF2tmp", ",", 
         "wB1tmp", ",", "wB2tmp", ",", "wRs", ",", "wRp", ",", "wTs", ",", 
         "wTp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ValueQ", "[", "mAll", "]"}], "&&", 
             RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Unvalued arguments detected when calling the function! \
Abort!\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"m0", "=", 
         RowBox[{"mAll", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"mSub", "=", 
         RowBox[{"mAll", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"nM", "=", 
         RowBox[{
          RowBox[{"Length", "[", "mAll", "]"}], "-", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Setup", " ", "wave", " ", "names"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", "nM"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"wF1", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kF1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0F1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]F1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EF1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"wF2", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kF2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0F2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]F2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EF2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}], ";", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"wB1", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kB1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0B1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]B1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EB1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"wB2", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kB2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0B2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]B2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EB2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wR1", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kR1", ",", "k0R1", ",", "\[Theta]R1", ",", "ER1"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wR2", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kR2", ",", "k0R2", ",", "\[Theta]R2", ",", "ER2"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wT1", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kT1", ",", "k0T1", ",", "\[Theta]T1", ",", "ET1"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wT2", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kT2", ",", "k0T2", ",", "\[Theta]T2", ",", "ET2"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "wave", " ", "angles", " ", "by", " ", 
          RowBox[{"Snell", "'"}], "s", " ", "law", " ", "for", " ", "each", 
          " ", "layer"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", "nM"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"solveSnell", "[", 
            RowBox[{
             RowBox[{"mAll", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "wInc", ",", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"solveSnell", "[", 
            RowBox[{
             RowBox[{"mAll", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"wB1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "True"}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"solveSnell", "[", 
         RowBox[{"mSub", ",", "wInc", ",", "wT1", ",", "wT2"}], "]"}], ";", 
        RowBox[{"(*", "transmission", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"solveSnell", "[", 
         RowBox[{"m0", ",", "wInc", ",", "wR1", ",", "wR2", ",", "True"}], 
         "]"}], ";", 
        RowBox[{"(*", "reflection", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Store", " ", "Forward", " ", "and", " ", "Backward", " ", "waves", 
          " ", "in", " ", "lists"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"wF", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wB", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wMed", "=", 
         RowBox[{"Flatten", "/@", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wF", ",", "wB"}], "}"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"thickness", "=", 
         RowBox[{
          RowBox[{"Key", "[", "h", "]"}], "/@", 
          RowBox[{"mAll", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"iterative", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Solve", " ", "layer", " ", "by", " ", "layer"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"unknowns", "=", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2", ",", 
               RowBox[{"wF1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"wF2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Cases", "[", 
              RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "\"\<\\n TOP \\n\>\"", "]"}], ";"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"solveFresnel", "[", 
            RowBox[{
             RowBox[{"{", "wInc", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"wF1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"wF2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "unknowns"}], 
            "]"}], ";", 
           RowBox[{"(*", "top", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"wF1tmp", "=", 
            RowBox[{"wF1", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wF1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"wF2tmp", "=", 
            RowBox[{"wF2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wF2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"wB1tmp", "=", 
            RowBox[{"wB1", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wB1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"wB2tmp", "=", 
            RowBox[{"wB2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wB2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"flagHH", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "=", "wF1tmp"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"wF2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "=", "wF2tmp"}], ";"}]}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "=", "wB1tmp"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"wB2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "=", "wB2tmp"}], ";"}], 
               "*)"}], "\[IndentingNewLine]", "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"wF1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"wF2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
            "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "<", "nM"}], ",", 
             RowBox[{"i", "++"}], ",", 
             RowBox[{"(*", "middle", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"unknowns", "=", 
               RowBox[{
                RowBox[{"Key", "[", "EE", "]"}], "/@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"unknowns", "=", 
               RowBox[{"DeleteDuplicates", "@", 
                RowBox[{"Cases", "[", 
                 RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<\\n Middle \\n\>\"", ",", " ", "i"}], "]"}], 
                ";"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"solveFresnel", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"wF1tmp", ",", "wF2tmp"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}], ",", 
                "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"wF1tmp", "=", 
               RowBox[{"wF1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF1", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wF1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"wF2tmp", "=", 
               RowBox[{"wF2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF2", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wF2", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"wB1tmp", "=", 
               RowBox[{"wB1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB1", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wB1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"wB2tmp", "=", 
               RowBox[{"wB2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB2", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wB2", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"flagHH", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF1tmp"}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF2tmp"}], 
                 ";"}]}], "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB1tmp"}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB2tmp"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
                RowBox[{"Key", "[", "EE", "]"}], "/@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              ";"}], "*)"}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", "nM", "]"}], "]"}], ",", 
               RowBox[{"wB2", "[", 
                RowBox[{"[", "nM", "]"}], "]"}], ",", "wT1", ",", "wT2"}], 
              "}"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Cases", "[", 
              RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "\"\<\\n Bottom \\n\>\"", "]"}], ";"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"solveFresnel", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wF1tmp", ",", "wF2tmp"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", "nM", "]"}], "]"}], ",", 
               RowBox[{"wB2", "[", 
                RowBox[{"[", "nM", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "unknowns"}], "]"}], 
           ";", 
           RowBox[{"(*", "bottom", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"wF", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"wB", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Solve", " ", "all", " ", "waves", " ", "at", " ", "once"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"unknowns", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", 
               RowBox[{"{", 
                RowBox[{"wR1", ",", "wR2"}], "}"}]}], ",", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", 
               RowBox[{"Flatten", "@", 
                RowBox[{"{", 
                 RowBox[{"wF", ",", "wB"}], "}"}]}]}], ",", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", 
               RowBox[{"{", 
                RowBox[{"wT1", ",", "wT2"}], "}"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Cases", "[", 
              RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"solveFresnelN", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wInc", ",", "wR1", ",", "wR2"}], "}"}], ",", "wMed", 
             ",", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "thickness", ",", 
             "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"wF", "=", 
            RowBox[{"wMed", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"wB", "=", 
            RowBox[{"wMed", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"3", ";;", "4"}]}], "]"}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "distinguish", " ", "s", " ", "and", " ", "p", " ", "from", " ", 
           "R1", " ", "and", " ", "R2"}], ",", 
          RowBox[{"T1", " ", "and", " ", "T2"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "no", " ", "need", " ", "to", " ", "distinguish", " ", "them", " ", 
          "for", " ", "B", " ", "and", " ", "F", " ", "waves", " ", "cause", 
          " ", "they", " ", 
          RowBox[{"don", "'"}], "t", " ", "have", " ", "to", " ", "be", " ", 
          "s", " ", "and", " ", "p"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"wRs", "=", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wRp", "=", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wTs", "=", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wTp", "=", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wRp", ",", "wRs"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"wTp", ",", "wTs"}], "}"}], ",", "wB", ",", "wF"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.845065372946638*^9, 3.845065395735292*^9}, {
   3.8450654420809374`*^9, 3.84506548639207*^9}, {3.845065575871989*^9, 
   3.8450655777683773`*^9}, {3.845065668078888*^9, 3.845065668986044*^9}, {
   3.84528902695876*^9, 3.845289080792723*^9}, {3.84533066584037*^9, 
   3.8453306663938627`*^9}, {3.845330729642209*^9, 3.84533075571504*^9}, {
   3.8453307892288136`*^9, 3.8453309636956015`*^9}, {3.845331006111681*^9, 
   3.845331177375829*^9}, {3.8453312160356655`*^9, 3.845331312315958*^9}, {
   3.8453320058967624`*^9, 3.8453320093694115`*^9}, {3.845332053238388*^9, 
   3.845332054072174*^9}, {3.845333001931792*^9, 3.84533301659598*^9}, 
   3.845333585376279*^9, 3.845333620466457*^9, {3.847730868040073*^9, 
   3.847730881088668*^9}, {3.847731017024195*^9, 3.847731163115001*^9}, {
   3.847731222547076*^9, 3.847731624673505*^9}, {3.847731661156201*^9, 
   3.847731664652468*^9}, {3.84773174084519*^9, 3.847731802825177*^9}, {
   3.847731851912235*^9, 3.8477318741770163`*^9}, {3.84773192500156*^9, 
   3.847731982329276*^9}, {3.847732040672961*^9, 3.847732131931394*^9}, {
   3.847732165337628*^9, 3.847732167040219*^9}, {3.847732200617171*^9, 
   3.847732508137148*^9}, {3.84773275651525*^9, 3.847732842039984*^9}, {
   3.847733274692076*^9, 3.847733329631008*^9}, {3.847733956866521*^9, 
   3.847734060696605*^9}, 3.8477343416100745`*^9, {3.847734617214596*^9, 
   3.847734622449126*^9}, {3.847734672315295*^9, 3.847734674769531*^9}, {
   3.847734725019654*^9, 3.847734769594583*^9}, {3.847734864340582*^9, 
   3.847734968387145*^9}, {3.847735020866357*^9, 3.847735026368363*^9}, {
   3.847735081774675*^9, 3.8477351197096243`*^9}, {3.8477355255098906`*^9, 
   3.847735615893921*^9}, {3.84773569904531*^9, 3.847735824693991*^9}, {
   3.84773585520744*^9, 3.847735898333299*^9}, {3.8477485136169987`*^9, 
   3.8477486337632475`*^9}, {3.8477487691594863`*^9, 3.847748797175335*^9}, {
   3.8477488952221003`*^9, 3.847748936315177*^9}, {3.847748977066264*^9, 
   3.847749009585788*^9}, {3.847749041925033*^9, 3.8477490546922555`*^9}, {
   3.847749093457613*^9, 3.847749106401278*^9}, {3.847749157463747*^9, 
   3.847749193936259*^9}, {3.8477492245290747`*^9, 3.847749294659584*^9}, {
   3.847749327877115*^9, 3.8477494121651325`*^9}, {3.8477494484506516`*^9, 
   3.847749449905938*^9}, {3.847749492609083*^9, 3.847749581867114*^9}, {
   3.847749827413371*^9, 3.847749837622647*^9}, {3.847749910571083*^9, 
   3.8477499124003315`*^9}, {3.847750039455857*^9, 3.847750043767111*^9}, {
   3.8477506417837086`*^9, 3.847750675743762*^9}, {3.847751799923839*^9, 
   3.847751852831386*^9}, {3.847751931977984*^9, 3.847751970498906*^9}, {
   3.847752028872591*^9, 3.847752163573664*^9}, {3.847752199429863*^9, 
   3.847752217454336*^9}, {3.8477526513111506`*^9, 3.8477526543404493`*^9}, {
   3.8477527390483017`*^9, 3.847752745148618*^9}, {3.8477527957562203`*^9, 
   3.8477528842597747`*^9}, {3.8477529227727385`*^9, 3.847752937683753*^9}, {
   3.847753366422142*^9, 3.84775337745205*^9}, {3.8477534408632793`*^9, 
   3.847753459118499*^9}, {3.847754158107231*^9, 3.847754219046988*^9}, {
   3.847787031677307*^9, 3.847787104739391*^9}, {3.847787143128831*^9, 
   3.84778723200004*^9}, {3.8477874853557625`*^9, 3.8477876188582034`*^9}, {
   3.847787690919975*^9, 3.847787757843085*^9}, {3.847787887454326*^9, 
   3.847787979993074*^9}, {3.8477880371545877`*^9, 3.8477880374513702`*^9}, {
   3.847788311714882*^9, 3.847788343291303*^9}, {3.8477886403185396`*^9, 
   3.847788720931843*^9}, {3.8477887631930356`*^9, 3.847788880268156*^9}, {
   3.847800639028091*^9, 3.8478006460461*^9}, {3.847800697010212*^9, 
   3.847800784939353*^9}, {3.847800859787483*^9, 3.8478008811391087`*^9}, {
   3.8478010189732904`*^9, 3.847801034635039*^9}, 3.847801225138802*^9, {
   3.847801887043112*^9, 3.847801929132553*^9}, {3.847802105417805*^9, 
   3.847802127113562*^9}, {3.847892765275541*^9, 3.847892777661953*^9}, {
   3.847902894832335*^9, 3.847902905888077*^9}, {3.847904111160709*^9, 
   3.8479041190457783`*^9}, 3.847904248077074*^9, {3.847905709238676*^9, 
   3.847905711382891*^9}, {3.847905829942378*^9, 3.847905833998011*^9}, {
   3.854503399699957*^9, 3.854503407429813*^9}, {3.8545045046041965`*^9, 
   3.8545045064246025`*^9}, {3.854668673096052*^9, 3.854668777883206*^9}, {
   3.854670434900192*^9, 3.854670470365327*^9}, {3.854670511098651*^9, 
   3.8546705238515778`*^9}, 3.8546712980421257`*^9, {3.858003165209395*^9, 
   3.858003236122137*^9}, {3.858003416636072*^9, 3.858003419056288*^9}, {
   3.886386814058967*^9, 3.886386857015539*^9}, {3.886456440983572*^9, 
   3.886456488707715*^9}, {3.886456521874305*^9, 3.886456529236988*^9}, {
   3.8864566814300137`*^9, 3.886456687024975*^9}, {3.88645693600428*^9, 
   3.886457005604251*^9}, {3.88645705193421*^9, 3.8864570527445984`*^9}, {
   3.886474090637862*^9, 3.886474099832364*^9}, {3.886474657276188*^9, 
   3.886474659282563*^9}, {3.89276378495142*^9, 3.8927637871302967`*^9}, 
   3.892764563808448*^9, 3.893979422595126*^9, {3.8939795259814253`*^9, 
   3.893979535261064*^9}, {3.893979834050516*^9, 3.893979836481594*^9}, {
   3.893981363482517*^9, 3.893981368972729*^9}, 3.8939820198378744`*^9, {
   3.893982061355859*^9, 3.893982161645256*^9}, 3.895837605735575*^9, {
   3.896055546772706*^9, 3.896055573255626*^9}, {3.896055612632722*^9, 
   3.896055642517644*^9}, {3.89605579850284*^9, 3.896055803675684*^9}, {
   3.896055890536403*^9, 3.896055897555989*^9}, {3.896069802392536*^9, 
   3.896069810945363*^9}, {3.896069931927858*^9, 3.896069935028936*^9}, 
   3.8960699654982157`*^9, {3.896070017614315*^9, 3.8960700367588205`*^9}, {
   3.8960700862874193`*^9, 3.896070086662429*^9}, {3.8960701840589647`*^9, 
   3.896070309777924*^9}, {3.896070345087338*^9, 3.89607043123509*^9}, 
   3.8960705185830574`*^9, {3.896070559972241*^9, 3.896070585188568*^9}, {
   3.8960706494503345`*^9, 3.896070663179276*^9}, {3.896070728581453*^9, 
   3.896070767006935*^9}, {3.896070916618703*^9, 3.896070919415579*^9}, {
   3.896071009794321*^9, 3.8960710655964613`*^9}, {3.896071124406394*^9, 
   3.8960712358975525`*^9}, {3.896093966712827*^9, 3.896093968253095*^9}, {
   3.8960940044026318`*^9, 3.896094081775652*^9}, {3.8960950613276*^9, 
   3.8960950618276*^9}, {3.896095935044676*^9, 3.896095965764129*^9}, {
   3.896140258930219*^9, 3.896140303719612*^9}, {3.896140338896342*^9, 
   3.896140339710318*^9}, {3.896140398908975*^9, 3.896140406067551*^9}, {
   3.8961407130220966`*^9, 3.8961408383868723`*^9}, {3.896140880234333*^9, 
   3.896140888173776*^9}, {3.896140934043968*^9, 3.896140935578937*^9}, {
   3.8961409835463867`*^9, 3.896141008758345*^9}, {3.896141560293703*^9, 
   3.896141563253687*^9}, {3.896742481787018*^9, 3.896742569479904*^9}, {
   3.896742717737087*^9, 3.896742725128307*^9}, {3.896742772491808*^9, 
   3.896742789120053*^9}, {3.896742819453012*^9, 3.8967429107071443`*^9}, {
   3.896743488789355*^9, 3.896743489401479*^9}, {3.8967435587881174`*^9, 
   3.896743561178507*^9}, {3.896743700294944*^9, 3.8967437173518734`*^9}, {
   3.896743761387968*^9, 3.896743786569131*^9}, {3.896743930500347*^9, 
   3.896743930858862*^9}, {3.896744042100503*^9, 3.896744060670375*^9}, {
   3.896744447458796*^9, 3.8967444528977084`*^9}, {3.896744482899743*^9, 
   3.896744537901908*^9}, {3.896744585896675*^9, 3.896744630050929*^9}, {
   3.897018303983884*^9, 3.897018307645895*^9}, {3.897018633323949*^9, 
   3.897018635887433*^9}, 3.8970191015486975`*^9, {3.897103434328393*^9, 
   3.897103472908398*^9}, {3.8971041191058393`*^9, 3.897104138161485*^9}, {
   3.897104249267996*^9, 3.89710426283926*^9}, 3.897104525165263*^9, {
   3.8971045841978254`*^9, 3.897104592402886*^9}, {3.897104953268769*^9, 
   3.89710495535107*^9}, {3.897105076067884*^9, 3.8971051467037754`*^9}, {
   3.897105206331421*^9, 3.8971052492471404`*^9}, {3.897105421792366*^9, 
   3.89710543933972*^9}, {3.897332911326271*^9, 3.897332998780019*^9}, {
   3.8974413723390083`*^9, 3.8974413728714886`*^9}, {3.897855530733348*^9, 
   3.897855663264547*^9}, {3.897855830984475*^9, 3.89785600183053*^9}, {
   3.8978560378264284`*^9, 3.8978560461467338`*^9}, {3.897856754984207*^9, 
   3.897856761800511*^9}, {3.897856898415259*^9, 3.897856900970717*^9}, {
   3.897857044372319*^9, 3.897857051822409*^9}, {3.897857692708531*^9, 
   3.897857697140899*^9}, {3.908215895619771*^9, 3.90821590363826*^9}, {
   3.909932447847071*^9, 3.9099324823653355`*^9}, {3.9099337905387306`*^9, 
   3.909933835766456*^9}, {3.909933919477193*^9, 3.909933925960307*^9}, {
   3.909933959412447*^9, 3.909933970590021*^9}, {3.909934268671164*^9, 
   3.909934295184053*^9}, {3.909940606198429*^9, 3.909940609580837*^9}, {
   3.909940659252143*^9, 3.909940670806994*^9}, 3.909940940057573*^9, {
   3.909957847588928*^9, 3.909957875689587*^9}, {3.909960267291089*^9, 
   3.909960277536834*^9}, 3.9099604429473886`*^9, {3.9099605692120914`*^9, 
   3.909960578508085*^9}, {3.909960614657433*^9, 3.9099606149447308`*^9}, {
   3.9105706007600183`*^9, 3.910570608771783*^9}, 3.910570684756237*^9},
 CellLabel->
  "In[100]:=",ExpressionUUID->"5fa0cc44-7388-47c7-b179-75ce38116667"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "f4NL", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"f4NL", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f4NL", "[", 
    RowBox[{"mAll_", ",", "wInc_", ",", 
     RowBox[{"iterative_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"m0", ",", "mSub", ",", "nM", ",", "w", ",", 
       RowBox[{"kF1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"kF2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"EF1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"EF2", "=", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"wF1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1F1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2F2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1F2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB1B1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB2B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB1B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2B1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1B1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", "wInh", ",", "wRs", ",", "wRp", ",", "wTs",
        ",", "wTp", ",", "\[IndentingNewLine]", "wFHomo", ",", "wBHomo", ",", 
       "wFInh", ",", "wBInh", ",", "wSInh", ",", "wR1", ",", "wR2", ",", 
       "wT1", ",", "wT2", ",", "unknowns", ",", "sol", ",", "equ", ",", 
       "meds", ",", "wavs", ",", "i", ",", "wMed", ",", "wF1tmp", ",", 
       "wF2tmp", ",", "wB1tmp", ",", "wB2tmp", ",", "\[IndentingNewLine]", 
       "sollinear", ",", "wFtmp", ",", "wBtmp", ",", "wF1F1Inhtmp", ",", 
       "wF2F2Inhtmp", ",", "wF1F2Inhtmp", ",", "wB1B1Inhtmp", ",", 
       "wB2B2Inhtmp", ",", "wB1B2Inhtmp", ",", "wF1B1Inhtmp", ",", 
       "wF1B2Inhtmp", ",", "wF2B1Inhtmp", ",", "wF2B2Inhtmp", ",", 
       "thickness", ",", "\[Theta]tmp"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"(", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"ValueQ", "[", "m0", "]"}], "&&"}], "*)"}], 
          RowBox[{
           RowBox[{"ValueQ", "[", "mAll", "]"}], 
           RowBox[{"(*", 
            RowBox[{"&&", 
             RowBox[{"ValueQ", "[", "mSub", "]"}]}], "*)"}], "&&", 
           RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Unvalued arguments detected when calling the function! \
Abort!\>\"", "]"}], ";", 
         RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"solve", " ", "the", " ", "linear", " ", "problem"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"sollinear", "=", 
       RowBox[{"f4L", "[", 
        RowBox[{"mAll", ",", "wInc", ",", "iterative"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Store", " ", "the", " ", "w", " ", "waves", " ", "in", " ", "tmp"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"wBtmp", "=", 
       RowBox[{"sollinear", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wFtmp", "=", 
       RowBox[{"sollinear", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m0", "=", 
       RowBox[{"mAll", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mSub", "=", 
       RowBox[{"mAll", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nM", "=", 
       RowBox[{
        RowBox[{"Length", "[", "mAll", "]"}], "-", "2"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Setup", " ", "wave", " ", "names"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "nM"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kF1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0F1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]F1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EF1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kF2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0F2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]F2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EF2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB1", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kB1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0B1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]B1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EB1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB2", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kB2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0B2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]B2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EB2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wR1", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kR1", ",", "k0R1", ",", "\[Theta]R1", ",",
           "ER1"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wR2", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kR2", ",", "k0R2", ",", "\[Theta]R2", ",",
           "ER2"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wT1", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kT1", ",", "k0T1", ",", "\[Theta]T1", ",",
           "ET1"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wT2", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kT2", ",", "k0T2", ",", "\[Theta]T2", ",",
           "ET2"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Solve", " ", "wave", " ", "angles", " ", "by", " ", 
        RowBox[{"Snell", "'"}], "s", " ", "law", " ", "for", " ", "each", " ",
         "layer"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", "nM"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"solveSnell", "[", 
          RowBox[{
           RowBox[{"mAll", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "wInc", ",", 
           RowBox[{"wF1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"wF2", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"solveSnell", "[", 
          RowBox[{
           RowBox[{"mAll", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
           RowBox[{"wF1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"wB1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"wB2", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", "True"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"solveSnell", "[", 
       RowBox[{"mSub", ",", "wInc", ",", "wT1", ",", "wT2"}], "]"}], ";", 
      RowBox[{"(*", "transmission", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"solveSnell", "[", 
       RowBox[{"m0", ",", "wInc", ",", "wR1", ",", "wR2", ",", "True"}], 
       "]"}], ";", 
      RowBox[{"(*", "reflection", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
          RowBox[{"Key", "[", "EE", "]"}], "/@", "wB1"}], "]"}], ";"}], 
       "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Setup", " ", "inhomo", " ", "wave", " ", "names"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "nM"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wF1F1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wFtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C11", ",", "C21", ",", "C31"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF2F2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wFtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C12", ",", "C22", ",", "C32"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"\[Theta]tmp", "=", 
          RowBox[{"VectorAngle", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
              ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
               "+", 
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
              ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wF1F2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C13", ",", "C23", ",", "C33"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"wB1B1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wBtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C14", ",", "C24", ",", "C34"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wB2B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wBtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C15", ",", "C25", ",", "C35"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"\[Theta]tmp", "=", 
          RowBox[{"VectorAngle", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
              ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
               "+", 
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
              ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wB1B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C16", ",", "C26", ",", "C36"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0."}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0."}], ",", "\[IndentingNewLine]", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF1B1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C17", ",", "C27", ",", "C37"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0."}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0."}], ",", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF2B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C18", ",", "C28", ",", "C38"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0."}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0."}], ",", "\[IndentingNewLine]", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF1B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C19", ",", "C29", ",", "C39"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0."}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0."}], ",", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF2B1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C110", ",", "C210", ",", "C310"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "consider", " ", "both", " ", "backward", " ", "and", " ", 
           "standing", " ", "waves"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"solveInhom", "[", 
          RowBox[{
           RowBox[{"mAll", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wFtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"wFtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"wBtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"wBtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp", ",", 
             "wB1B1Inhtmp", ",", "wB2B2Inhtmp", ",", "wB1B2Inhtmp", ",", 
             "wF1B1Inhtmp", ",", "wF2B2Inhtmp", ",", "wF1B2Inhtmp", ",", 
             "wF2B1Inhtmp"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1B1Inh", ",", "wF1B1Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2B2Inh", ",", "wF2B2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1B2Inh", ",", "wF1B2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2B1Inh", ",", "wF2B1Inhtmp"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB1B1Inh", ",", "wB1B1Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB2B2Inh", ",", "wB2B2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB1B2Inh", ",", "wB1B2Inhtmp"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1F1Inh", ",", "wF1F1Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2F2Inh", ",", "wF2F2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1F2Inh", ",", "wF1F2Inhtmp"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"wFHomo", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wBHomo", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wFInh", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wF1F1Inh", ",", "wF2F2Inh", ",", "wF1F2Inh"}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wBInh", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wB1B1Inh", ",", "wB2B2Inh", ",", "wB1B2Inh"}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wSInh", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{
         "wF1B1Inh", ",", "wF2B2Inh", ",", "wF1B2Inh", ",", "wF2B1Inh"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"flagBackward", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{"flagStandingWave", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wMed", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{
                "wFHomo", ",", "wBHomo", ",", "wFInh", ",", "wBInh", ",", 
                 "wSInh"}], "}"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"wInh", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"wFInh", ",", "wBInh", ",", "wSInh"}], "}"}], 
               "]"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wMed", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"wFHomo", ",", "wBHomo", ",", "wFInh", ",", "wBInh"}],
                 "}"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"wInh", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"wFInh", ",", "wBInh"}], "}"}], "]"}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wMed", "=", 
          RowBox[{"Flatten", "/@", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"wFHomo", ",", "wBHomo", ",", "wFInh"}], "}"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wInh", "=", "wFInh"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"thickness", "=", 
       RowBox[{
        RowBox[{"Key", "[", "h", "]"}], "/@", 
        RowBox[{"mAll", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"!", "flagHH"}], ")"}], "&&", "flagJK"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "layer", " ", "by", " ", "layer"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"unknowns", "=", 
          RowBox[{
           RowBox[{"Key", "[", "EE", "]"}], "/@", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2", ",", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wF1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "unknowns"}], 
          "]"}], ";", 
         RowBox[{"(*", "top", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"add", " ", "phase", " ", "shift"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"wF1tmp", "=", 
          RowBox[{"wF1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wF2tmp", "=", 
          RowBox[{"wF2", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wB1tmp", "=", 
          RowBox[{"wB1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wB2tmp", "=", 
          RowBox[{"wB2", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], 
           "}"}], "=", 
          RowBox[{"wFInh", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wF1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wF1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wF2", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wF2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wB1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wB2", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wB2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1F1Inhtmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF2F2Inhtmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1F2Inhtmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wF1tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wF2tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wB1tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wB2tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wFInh", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], 
           "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "<", "nM"}], ",", 
           RowBox[{"i", "++"}], ",", 
           RowBox[{"(*", "middle", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"unknowns", "=", 
             RowBox[{
              RowBox[{"Key", "[", "EE", "]"}], "/@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wB1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wB2", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wF1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wF2", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"unknowns", "=", 
             RowBox[{"DeleteDuplicates", "@", 
              RowBox[{"Cases", "[", 
               RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"solveFresnel", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "wF1tmp", ",", "wF2tmp", ",", "wF1F1Inhtmp", ",", 
                "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wB1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wB2", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wF1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wF2", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}], ",", 
              "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"wF1tmp", "=", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wF2tmp", "=", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wB1tmp", "=", 
             RowBox[{"wB1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wB2tmp", "=", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}],
               "}"}], "=", 
             RowBox[{"wFInh", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wF1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wF2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wB2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1F1Inhtmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"wFInh", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF2F2Inhtmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"wFInh", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", "k", "]"}], ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1F2Inhtmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"wFInh", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "[", "k", "]"}], ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF1tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF2tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB1tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB2tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", 
             RowBox[{"{", 
              RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}],
               "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{
           RowBox[{"Key", "[", "EE", "]"}], "/@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", "wT1", ",", "wT2"}], 
            "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "wF1tmp", ",", "wF2tmp", ",", "wF1F1Inhtmp", ",", "wF2F2Inhtmp", 
             ",", "wF1F2Inhtmp"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "nM", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "unknowns"}], "]"}], ";", 
         RowBox[{"(*", "bottom", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"wFHomo", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wBHomo", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wInh", "=", "wFInh"}], ";"}]}], 
       RowBox[{"(*", 
        RowBox[{"just", " ", "for", " ", "output"}], "*)"}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"!", "flagJK"}], ")"}], "&&", "flagHH"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "all", " ", "waves", " ", "at", " ", "once"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wMed", "=", 
          RowBox[{"Flatten", "/@", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"wFHomo", ",", "wBHomo", ",", "wFInh"}], "}"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wInh", "=", "wFInh"}], ";", "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{"wFHomo", ",", "wBHomo"}], "}"}]}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnelN", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", "wMed", ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "thickness", ",", 
           "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"wFHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wBHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"3", ";;", "4"}]}], "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"!", "flagJK"}], ")"}], "&&", 
         RowBox[{"(", 
          RowBox[{"!", "flagHH"}], ")"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "all", " ", "waves", " ", "at", " ", "once"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"unknowns", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{"wFHomo", ",", "wBHomo"}], "}"}]}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnelN", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", "wMed", ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "thickness", ",", 
           "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"wFHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wBHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"3", ";;", "4"}]}], "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "distinguish", " ", "s", " ", "and", " ", "p", " ", "from", " ", "R1",
          " ", "and", " ", "R2"}], ",", 
        RowBox[{"T1", " ", "and", " ", "T2"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "no", " ", "need", " ", "to", " ", "distinguish", " ", "them", " ", 
        "for", " ", "B", " ", "and", " ", "F", " ", "waves", " ", "cause", 
        " ", "they", " ", 
        RowBox[{"don", "'"}], "t", " ", "have", " ", "to", " ", "be", " ", 
        "s", " ", "and", " ", "p"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"wRs", "=", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
           "|>"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wRp", "=", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
           "|>"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wTs", "=", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
           "|>"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wTp", "=", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], "|>"}
           ]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"sollinear", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wRs", ",", "wRp"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"wTs", ",", "wTp"}], "}"}], ",", "wBHomo", ",", "wFHomo", 
          ",", "wInh"}], "}"}]}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.847904021337448*^9, 3.847904079863578*^9}, {
   3.8479041340489798`*^9, 3.84790421107556*^9}, {3.84790426207543*^9, 
   3.847904418644097*^9}, {3.8479044494529495`*^9, 3.847904549801116*^9}, {
   3.8479046076243896`*^9, 3.847904754159469*^9}, {3.84790480811007*^9, 
   3.847904888729932*^9}, {3.847905003974305*^9, 3.8479050377665234`*^9}, {
   3.847905074189916*^9, 3.8479052217836285`*^9}, {3.847905462463135*^9, 
   3.8479054737539673`*^9}, {3.847905503989827*^9, 3.847905518265919*^9}, {
   3.847905745467016*^9, 3.8479057720299916`*^9}, {3.847905809728097*^9, 
   3.847905811641218*^9}, {3.847905856381949*^9, 3.84790592493198*^9}, {
   3.847905955468961*^9, 3.8479061110302687`*^9}, {3.847906278944174*^9, 
   3.8479063205585904`*^9}, {3.847926219666322*^9, 3.847926231860385*^9}, 
   3.847927536037767*^9, {3.8545034138271947`*^9, 3.854503426129067*^9}, {
   3.8545045368777275`*^9, 3.854504555604375*^9}, {3.854668427462703*^9, 
   3.854668665380283*^9}, {3.854668739984418*^9, 3.8546687476133366`*^9}, {
   3.8546687834943867`*^9, 3.854668784344531*^9}, {3.854670481240612*^9, 
   3.854670485394778*^9}, {3.854670527241098*^9, 3.8546705361153264`*^9}, 
   3.854671302807073*^9, {3.858003313307441*^9, 3.8580033321862173`*^9}, {
   3.886386868097505*^9, 3.886386888652254*^9}, {3.886457646152478*^9, 
   3.886457712882909*^9}, {3.886458066783598*^9, 3.886458067278647*^9}, {
   3.886458208182783*^9, 3.886458210980225*^9}, {3.886458404692974*^9, 
   3.886458404927358*^9}, {3.8864591408821077`*^9, 3.88645914612155*^9}, {
   3.886474006681934*^9, 3.886474063132013*^9}, {3.887929935262846*^9, 
   3.887929953133015*^9}, {3.887930001806389*^9, 3.887930050204391*^9}, {
   3.887931336937467*^9, 3.887931339028023*^9}, {3.892464712809418*^9, 
   3.892464832115213*^9}, {3.8925010810223055`*^9, 3.8925011113602667`*^9}, {
   3.8925011448185987`*^9, 3.892501162223808*^9}, {3.8925012140053043`*^9, 
   3.892501363509116*^9}, {3.8927637736446347`*^9, 3.8927637762734118`*^9}, 
   3.892764574740513*^9, {3.892765028010311*^9, 3.89276503799009*^9}, 
   3.893979452009078*^9, {3.8939794883516207`*^9, 3.893979496395278*^9}, {
   3.893979862822823*^9, 3.8939798637835937`*^9}, {3.893981301241152*^9, 
   3.89398130695002*^9}, 3.893982242065725*^9, {3.893982285607934*^9, 
   3.893982288079113*^9}, {3.893984380858761*^9, 3.893984381026754*^9}, {
   3.896046497890092*^9, 3.896046514936823*^9}, {3.896046548319895*^9, 
   3.896046549387146*^9}, {3.8960466403885727`*^9, 3.8960466442719765`*^9}, 
   3.896046683088634*^9, {3.896046880737674*^9, 3.896046980743018*^9}, {
   3.896047039099717*^9, 3.896047044991223*^9}, {3.896047075204921*^9, 
   3.896047110244303*^9}, {3.8960471965375767`*^9, 3.8960472595066137`*^9}, {
   3.8960473045866127`*^9, 3.896047686950677*^9}, {3.8960547286844635`*^9, 
   3.896054738947447*^9}, {3.896054791182669*^9, 3.896054791581339*^9}, {
   3.896054927103295*^9, 3.8960549615113134`*^9}, {3.896055113763972*^9, 
   3.89605511543947*^9}, {3.896057185802869*^9, 3.896057232605719*^9}, {
   3.896057678252939*^9, 3.8960577276536427`*^9}, {3.896057763654771*^9, 
   3.8960577989637566`*^9}, {3.8960578362673817`*^9, 3.896057917332243*^9}, {
   3.896057972772883*^9, 3.896058034804333*^9}, {3.896058066147369*^9, 
   3.89605837615547*^9}, {3.89605860334104*^9, 3.896058617520966*^9}, {
   3.8960586589894*^9, 3.89605868460765*^9}, 3.896058730960905*^9, {
   3.896059213826862*^9, 3.89605922077227*^9}, 3.896059637389407*^9, {
   3.896059671550347*^9, 3.896059701602782*^9}, {3.896060907215351*^9, 
   3.8960610005317383`*^9}, {3.896061125958097*^9, 3.896061327879107*^9}, {
   3.8960613660002337`*^9, 3.896061393405516*^9}, {3.896061473325368*^9, 
   3.896061514645944*^9}, {3.896061642098785*^9, 3.896061642260931*^9}, {
   3.896065411491273*^9, 3.896065416189744*^9}, {3.896095402956744*^9, 
   3.89609540476138*^9}, 3.896095492932169*^9, {3.896095575014002*^9, 
   3.896095622595947*^9}, {3.896095713428477*^9, 3.896095722556875*^9}, {
   3.8960957823361588`*^9, 3.896095791273837*^9}, {3.896095823366307*^9, 
   3.8960958265718937`*^9}, 3.896096042069668*^9, {3.896096077099732*^9, 
   3.896096078420653*^9}, {3.896096112092048*^9, 3.896096115791517*^9}, 
   3.896097014188428*^9, {3.896107319784792*^9, 3.896107341386264*^9}, {
   3.8961074500863457`*^9, 3.8961074564175005`*^9}, {3.896141481470374*^9, 
   3.896141542021829*^9}, {3.896141579571952*^9, 3.896141677371272*^9}, {
   3.896141716294585*^9, 3.896141718260524*^9}, {3.896142305518067*^9, 
   3.8961424408203344`*^9}, {3.896664559489291*^9, 3.8966645632468567`*^9}, {
   3.896665136155724*^9, 3.896665136308444*^9}, {3.896666239973944*^9, 
   3.8966662403123074`*^9}, {3.896666466379958*^9, 3.896666482806226*^9}, {
   3.896666556465587*^9, 3.8966666476100364`*^9}, {3.896667100909322*^9, 
   3.896667128549681*^9}, {3.896667176848914*^9, 3.896667199692246*^9}, {
   3.896668579909505*^9, 3.896668611313341*^9}, {3.896668645082497*^9, 
   3.8966686800832515`*^9}, {3.896668717044568*^9, 3.896668738554902*^9}, {
   3.8967429205210567`*^9, 3.896742979300463*^9}, 3.896743793823578*^9, 
   3.896745133372715*^9, {3.8971033647458663`*^9, 3.897103418162595*^9}, {
   3.89710348082746*^9, 3.897103486139161*^9}, {3.8971038743115582`*^9, 
   3.8971039103376493`*^9}, {3.8971040200012555`*^9, 3.897104105932486*^9}, 
   3.8971044047974806`*^9, {3.897104450409124*^9, 3.897104451906612*^9}, 
   3.8971044913709*^9, {3.897104602916844*^9, 3.897104608518504*^9}, {
   3.8971046806482773`*^9, 3.897104703819511*^9}, 3.897105094217064*^9, {
   3.897105524102663*^9, 3.8971056982761354`*^9}, {3.897105743053919*^9, 
   3.897105779661152*^9}, {3.897105815493618*^9, 3.8971058817552595`*^9}, {
   3.8971064532253036`*^9, 3.8971064556918507`*^9}, {3.8971066455554886`*^9, 
   3.897106661516603*^9}, {3.897106798045481*^9, 3.897106812900463*^9}, {
   3.8971070947785945`*^9, 3.897107105993081*^9}, {3.897107248452628*^9, 
   3.897107257830072*^9}, {3.897107330233627*^9, 3.897107338360348*^9}, {
   3.897174524741563*^9, 3.897174525506693*^9}, {3.897174577287145*^9, 
   3.8971745800331087`*^9}, {3.897332993415981*^9, 3.8973330194233265`*^9}, {
   3.897333107839645*^9, 3.897333108580336*^9}, {3.897333140008773*^9, 
   3.897333144021518*^9}, {3.897333193040944*^9, 3.8973332000141172`*^9}, {
   3.897333234546409*^9, 3.897333547650926*^9}, {3.897333614251264*^9, 
   3.897333663610487*^9}, 3.897334148902088*^9, {3.897337472170548*^9, 
   3.897337477521264*^9}, {3.8974413903222923`*^9, 3.8974413945473213`*^9}, {
   3.897855675990243*^9, 3.8978557667276726`*^9}, {3.89785579848901*^9, 
   3.8978558040135727`*^9}, {3.8978560640409837`*^9, 
   3.8978561973318067`*^9}, {3.897856238266096*^9, 3.8978562572234273`*^9}, {
   3.897856298048241*^9, 3.897856298296916*^9}, {3.897856330018164*^9, 
   3.897856399572016*^9}, {3.8978570591570005`*^9, 3.897857093863719*^9}, {
   3.897857225251289*^9, 3.897857229611124*^9}, 3.8978572639289722`*^9, {
   3.897857295453887*^9, 3.897857304578474*^9}, {3.897857630366929*^9, 
   3.897857645945857*^9}, {3.8978577580691805`*^9, 3.897857758217182*^9}, {
   3.9067438849720974`*^9, 3.906744043311474*^9}, {3.9072791713075895`*^9, 
   3.9072791815009136`*^9}, {3.908214587550011*^9, 3.908214599324413*^9}, {
   3.9082162206462116`*^9, 3.90821625307145*^9}, {3.909021531275768*^9, 
   3.909021532121995*^9}, {3.909021620772813*^9, 3.909021624569562*^9}, {
   3.909930845977021*^9, 3.90993088778278*^9}, 3.909931096745556*^9, {
   3.90993309236623*^9, 3.909933092626604*^9}, {3.909933200980162*^9, 
   3.909933208501154*^9}, {3.9099335943876605`*^9, 3.909933626005091*^9}, {
   3.909933706536824*^9, 3.909933736230438*^9}, {3.909933769917374*^9, 
   3.90993377040808*^9}, {3.909934248209645*^9, 3.909934250992466*^9}, 
   3.909934304761796*^9, {3.90993827970883*^9, 3.909938280872992*^9}, {
   3.909938525014612*^9, 3.909938533611378*^9}, {3.909939752760061*^9, 
   3.909939768245776*^9}, {3.9099406902913294`*^9, 3.909940702342287*^9}, {
   3.9099408864181824`*^9, 3.9099409122015734`*^9}, {3.909957884508604*^9, 
   3.90995790445188*^9}, {3.909960286715638*^9, 3.9099602963992333`*^9}, {
   3.9099605885251474`*^9, 3.909960598669457*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"b3fd9750-a54b-4182-8c39-820f6425e529"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Other preset functions for GUI", "Title",
 CellChangeTimes->{{3.8933481280005827`*^9, 3.8933481316914787`*^9}, {
  3.893352763895884*^9, 
  3.893352765059311*^9}},ExpressionUUID->"9042ff58-e452-4ecb-88e6-\
13f19a0537e6"],

Cell[CellGroupData[{

Cell["for preprocessing (inputs, conversion, etc) ", "Chapter",
 CellChangeTimes->{{3.8933788114223638`*^9, 
  3.893378825966983*^9}},ExpressionUUID->"1ec80b5a-86c5-422b-a529-\
432dbf698fdd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"generatingdfun1", ",", "generatingdfun2", ",", "indexfun1"}], 
    "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"generatingdfun1", " ", "is", " ", "for", " ", "read"}], "-", 
     RowBox[{
     "in", " ", "the", " ", "independent", " ", "d", " ", "components", " ", 
      "and", " ", "for", " ", "displaying", " ", "inn", " ", "the", " ", 
      "control", " ", "panel"}]}], ";", " ", 
    RowBox[{
    "use", " ", "generatingfun1", " ", "to", " ", "create", " ", "dlist", " ",
      "for", " ", "displaying"}], ";"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generatingdfun1", "[", "matindex_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"indiceslist", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "6"}], "}"}]}], "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "==", "0"}], ",", 
          "\[IndentingNewLine]", "\"\<0\>\"", ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "==", 
              RowBox[{
               RowBox[{"IntegerDigits", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "\[And]", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "==", 
              RowBox[{
               RowBox[{"IntegerDigits", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"InputField", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"FieldSize", "->", "6"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Dynamic", "[", 
             RowBox[{
              RowBox[{"Sign", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"allmaterials", "[", 
                   RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "*", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"IntegerDigits", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"IntegerDigits", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], 
           "\[IndentingNewLine]", "]"}]}], "]"}], "&"}], ",", "indiceslist", 
       ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"indexfun1", "[", "tempindex_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"generatingdfun2", "[", 
      RowBox[{"tempindex", ",", "#"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "6"}], "}"}]}], "]"}], ",", "1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generatingdfun2", "[", 
    RowBox[{"matindex_", ",", "indices_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "\[NotEqual]", 
       RowBox[{
        RowBox[{"IntegerDigits", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"allmaterials", "[", 
              RowBox[{"[", "matindex", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"indices", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "\[Or]", 
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "\[NotEqual]", 
       RowBox[{
        RowBox[{"IntegerDigits", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"allmaterials", "[", 
              RowBox[{"[", "matindex", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"indices", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allmaterials", "[", 
           RowBox[{"[", "matindex", "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"indices", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"indices", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "==", "0"}], ",", 
         "0", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Sign", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"allmaterials", "[", 
                RowBox[{"[", "matindex", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"indices", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "*", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"allmaterials", "[", 
              RowBox[{"[", "matindex", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"IntegerDigits", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"indices", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"IntegerDigits", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"allmaterials", "[", 
                   RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"indices", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"indices", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}]}], "]"}]}], 
      ";"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.89333099562446*^9, 3.893331012471932*^9}, {
   3.893331150997285*^9, 3.893331156175301*^9}, {3.893331445423029*^9, 
   3.893331585637816*^9}, {3.8933340883388443`*^9, 3.8933341113448844`*^9}, {
   3.893334182807713*^9, 3.893334192546695*^9}, {3.893334591586525*^9, 
   3.893334662443522*^9}, {3.89333469326283*^9, 3.893334719985879*^9}, {
   3.8933347788541*^9, 3.8933349364958873`*^9}, {3.893335012514936*^9, 
   3.893335041225618*^9}, 3.893335304151098*^9, {3.8933354700059404`*^9, 
   3.8933354715704684`*^9}, {3.893336070595887*^9, 3.8933360982696676`*^9}, 
   3.89333619575262*^9, {3.89333623445137*^9, 3.89333624252839*^9}, {
   3.8937223121381936`*^9, 3.893722317212073*^9}, 3.8953649205340967`*^9, 
   3.895859953699232*^9, 3.895860020631808*^9, {3.895865177085079*^9, 
   3.895865254822201*^9}, {3.8958653749579344`*^9, 3.895865397604021*^9}, {
   3.895865427721498*^9, 3.895865458619327*^9}, {3.89586549707895*^9, 
   3.895865589625959*^9}, 3.8960378929527073`*^9},
 CellLabel->
  "In[106]:=",ExpressionUUID->"94e87d36-2b94-458c-9d74-6870a346fef5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "clearFigs", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"clearFigs", "[", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"heterostructureschematic", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fig12d", "=", "placeHolderFigs"}], ";", "\[IndentingNewLine]", 
     RowBox[{"fig13d", "=", "placeHolderFigs"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ellipticityfig", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"plot2geometry2d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"plot2geometry3d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"polarizationplot2d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"polarizationplot3d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"figfresnel", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"figmakerfringespar", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"figmakerfringesperp", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"figRs", ",", "figRp", ",", "figTs", ",", "figTp"}], "}"}], 
      "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"placeHolderFigs", ",", "4"}], "]"}]}]}], 
    "\[IndentingNewLine]", ")"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.895881144875887*^9, 3.895881147036347*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"ad125409-1df9-479b-8433-6fee9c508f3e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "ruihklfun", "]"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "function", " ", "needs", " ", "to", " ", "be", " ", 
    "replaced", " ", "by", " ", 
    RowBox[{"hklConvert", "!"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"ruihklfun", ",", "HoldAll"}], "]"}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ruihklfun", "[", "matindex_", "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "clatticex", ",", "clatticey", ",", "clatticez", ",", "aZTohkl11", ",",
         "aZTohkl21", ",", "aZTohkl31", ",", "aZTohkl12", ",", "aZTohkl22", 
        ",", "aZTohkl32", ",", "aZTohkl13", ",", "aZTohkl23", ",", 
        "aZTohkl33", ",", "Valattice", ",", "Vblattice", ",", "Vclattice", 
        ",", "latticeSolve", ",", "b1", ",", "b2", ",", "b3", ",", "Z1", ",", 
        "Z2", ",", "Z3", ",", "VInput1", ",", "VInput2", ",", "VInput3", ",", 
        "aZTohkl", ",", "CryOrienSolve", ",", "a", ",", "b1lab", ",", "b2lab",
         ",", "b3lab", ",", "Valatticelab", ",", "Vblatticelab", ",", 
        "Vclatticelab", ",", "PlanehSolve", ",", "PlanekSolve", ",", 
        "PlanelSolve", ",", "VerticalhSolve", ",", "VerticalkSolve", ",", 
        "VerticallSolve", ",", "o1", ",", "o2", ",", "o3", ",", 
        "\[IndentingNewLine]", "Orientation", ",", "PointGroup", ",", 
        "\[IndentingNewLine]", "ori", ",", "alattice", ",", "blattice", ",", 
        "clattice", ",", "alphalattice", ",", "betalattice", ",", 
        "gamalattice", ",", 
        RowBox[{"DebugFlag", "=", "False"}], ",", "Verticalh", ",", 
        "Verticalk", ",", "Verticall", ",", "Planeh", ",", "Planek", ",", 
        "Planel", ",", "rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Orientation", "=", 
        RowBox[{
         RowBox[{"allmaterials", "[", 
          RowBox[{"[", "matindex", "]"}], "]"}], "[", "orientation", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"PointGroup", "=", 
        RowBox[{
         RowBox[{"allmaterials", "[", 
          RowBox[{"[", "matindex", "]"}], "]"}], "[", "pg", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "alattice", ",", "blattice", ",", "clattice", ",", "alphalattice", 
          ",", "betalattice", ",", "gamalattice"}], "}"}], "=", 
        RowBox[{
         RowBox[{"allmaterials", "[", 
          RowBox[{"[", "matindex", "]"}], "]"}], "[", "latcon", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ori", "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Planeh", ",", "Planek", ",", "Planel"}], "}"}], "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Verticalh", ",", "Verticalk", ",", "Verticall"}], "}"}], 
        "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Valattice", "=", 
        RowBox[{"alattice", "*", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]}], ";", " ", 
       RowBox[{"Vblattice", "=", 
        RowBox[{"blattice", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"gamalattice", "*", 
             RowBox[{"Pi", "/", "180"}]}], "]"}], ",", 
           RowBox[{"Sin", "[", 
            RowBox[{"gamalattice", "*", 
             RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0"}], "}"}]}]}], ";", 
       " ", 
       RowBox[{"Vclattice", "=", 
        RowBox[{"clattice", "*", 
         RowBox[{"{", 
          RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"latticeSolve", " ", "=", " ", 
        RowBox[{"Quiet", "[", 
         RowBox[{"NSolve", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"clatticez", ">", "0"}], "&&", " ", 
             RowBox[{
              RowBox[{"VectorAngle", "[", 
               RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "\[Equal]", 
              " ", 
              RowBox[{"betalattice", "*", 
               RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", 
             RowBox[{
              RowBox[{"VectorAngle", "[", 
               RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "\[Equal]", 
              " ", 
              RowBox[{"alphalattice", "*", 
               RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"clatticex", "^", "2"}], "+", 
               RowBox[{"clatticey", "^", "2"}], "+", 
               RowBox[{"clatticez", "^", "2"}]}], "\[Equal]", "1"}]}], "}"}], 
           " ", ",", 
           RowBox[{"{", 
            RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], "}"}], 
           ",", "Reals"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"clatticex", "=", " ", 
        RowBox[{"clatticex", "/.", 
         RowBox[{"latticeSolve", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"clatticey", "=", " ", 
        RowBox[{"clatticey", "/.", 
         RowBox[{"latticeSolve", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"clatticez", "=", " ", 
        RowBox[{"clatticez", "/.", 
         RowBox[{"latticeSolve", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b1", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"Valattice", ".", 
           RowBox[{"Cross", "[", 
            RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b2", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{"Vclattice", ",", "Valattice"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"Valattice", ".", 
           RowBox[{"Cross", "[", 
            RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b3", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{"Valattice", ",", "Vblattice"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"Valattice", ".", 
           RowBox[{"Cross", "[", 
            RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<clatticex = \>\"", ",", "clatticex", ",", 
           "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
           "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", "b2", 
           ",", "\"\< , b3 = \>\"", ",", "b3"}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<1\>\""}], "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(1\), \(_\)]\)\>\""}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m\>\""}], "||", 
          " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<2/m\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", 
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", " ", 
           RowBox[{"Z1", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<mm2\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<222\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<mmm\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
           RowBox[{"Z3", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<3\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<32\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<3m\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)m\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]2\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]m\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]\>\""}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
           RowBox[{"Z2", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<4\>\""}], 
          " ", "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4mm\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<422\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)2m\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/m\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/mmm\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
           RowBox[{"Z3", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<6\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6mm\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<622\>\""}], "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/m\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/mmm\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]/mm\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]/m\>\""}]}], "  ", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
           RowBox[{"Z2", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", 
           "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<23\>\""}], " ", "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]\[Infinity]m\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]\[Infinity]\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3\>\""}], "||", 
          " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<432\>\""}], "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3m\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
           RowBox[{"Z2", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<clatticex = \>\"", ",", "clatticex", ",", 
             "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
             "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", 
             RowBox[{"b2", "\"\< , b3 = \>\""}], ",", "b3"}], "]"}], ";"}], 
          "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ori", "==", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"VInput3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Planeh", "*", "b1"}], "+", 
             RowBox[{"Planek", "*", "b2"}], "+", 
             RowBox[{"Planel", "*", "b3"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"VInput2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Verticalh", "*", "Valattice"}], "+", 
             RowBox[{"Verticalk", "*", "Vblattice"}], "+", 
             RowBox[{"Verticall", "*", "Vclattice"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"VInput1", " ", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"VInput2", ",", "VInput3"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<Z1 = \>\"", ",", "Z1", ",", "\"\< , Z2 = \>\"", ",", "Z2",
                 ",", "\"\< , Z3 = \>\"", ",", "Z3"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<VInput1 = \>\"", ",", "VInput1", ",", 
                "\"\< , VInput2 = \>\"", ",", "VInput2", ",", 
                "\"\< , VInput3 = \>\"", ",", "VInput3"}], "]"}], ";"}], 
             "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"aZTohkl", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], 
              "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"CryOrienSolve", " ", "=", " ", 
           RowBox[{"Quiet", "[", 
            RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"aZTohkl", ".", 
                 RowBox[{"{", 
                  RowBox[{"Z1", ",", "Z2", ",", "Z3"}], "}"}]}], "\[Equal]", 
                " ", 
                RowBox[{"{", 
                 RowBox[{"VInput1", ",", "VInput2", ",", "VInput3"}], "}"}]}],
                "}"}], " ", ",", 
              RowBox[{"{", 
               RowBox[{
               "aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13", ",", 
                "aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23", ",", 
                "aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], "}"}]}], 
             "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", " ", "[", 
           RowBox[{"DebugFlag", ",", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<latticeSolve = \>\"", ",", "latticeSolve"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<CryOrienSolve = \>\"", ",", "CryOrienSolve"}], 
               " ", "]"}], ";"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"aZTohkl11", "=", " ", 
           RowBox[{"aZTohkl11", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl12", "=", " ", 
           RowBox[{"aZTohkl12", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl13", "=", " ", 
           RowBox[{"aZTohkl13", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"aZTohkl21", "=", " ", 
           RowBox[{"aZTohkl21", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "4"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl22", "=", " ", 
           RowBox[{"aZTohkl22", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "5"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl23", "=", " ", 
           RowBox[{"aZTohkl23", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"aZTohkl31", "=", " ", 
           RowBox[{"aZTohkl31", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "7"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl32", "=", " ", 
           RowBox[{"aZTohkl32", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "8"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl33", "=", " ", 
           RowBox[{"aZTohkl33", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "9"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"o1", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Chop", "[", 
             RowBox[{"aZTohkl", ".", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]}], 
          ";", " ", 
          RowBox[{"o2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Chop", "[", 
             RowBox[{"aZTohkl", ".", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "]"}]}], 
          ";", " ", 
          RowBox[{"o3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Chop", "[", 
             RowBox[{"aZTohkl", ".", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"DebugFlag", ",", 
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\<Cry1 = \>\"", ",", "rCry1", ",", "\"\< , Cry2 = \>\"", ",", 
              "rCry2", ",", "\"\< , Cry3 = \>\"", ",", "rCry3"}], "]"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"{", 
            RowBox[{"o1", ",", "o2", ",", "o3"}], "}"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "=", "o1"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "=", "o2"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "=", "o3"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"allmaterials", "[", 
             RowBox[{"[", "matindex", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab1", ".", "o1"}], ",", 
               RowBox[{"Lab1", ".", "o2"}], ",", 
               RowBox[{"Lab1", ".", "o3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab2", ".", "o1"}], ",", 
               RowBox[{"Lab2", ".", "o2"}], ",", 
               RowBox[{"Lab2", ".", "o3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab3", ".", "o1"}], ",", 
               RowBox[{"Lab3", ".", "o2"}], ",", 
               RowBox[{"Lab3", ".", "o3"}]}], "}"}]}], "}"}]}], ";"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"EndofIfHKL", ",", 
           RowBox[{"UseDireciton", "=", "Miller"}]}], "*)"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"a", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab1", ".", "rCry1"}], ",", 
               RowBox[{"Lab1", ".", "rCry2"}], ",", 
               RowBox[{"Lab1", ".", "rCry3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab2", ".", "rCry1"}], ",", 
               RowBox[{"Lab2", ".", "rCry2"}], ",", 
               RowBox[{"Lab2", ".", "rCry3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab3", ".", "rCry1"}], ",", 
               RowBox[{"Lab3", ".", "rCry2"}], ",", 
               RowBox[{"Lab3", ".", "rCry3"}]}], "}"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"allmaterials", "[", 
             RowBox[{"[", "matindex", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", "a"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"b1lab", "=", 
           RowBox[{"a", ".", "b1"}]}], ";", " ", 
          RowBox[{"b2lab", "=", 
           RowBox[{"a", ".", "b2"}]}], ";", " ", 
          RowBox[{"b3lab", "=", 
           RowBox[{"a", ".", "b3"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Valatticelab", "=", 
           RowBox[{"a", ".", "Valattice"}]}], ";", " ", 
          RowBox[{"Vblatticelab", "=", 
           RowBox[{"a", ".", "Vblattice"}]}], ";", " ", 
          RowBox[{"Vclatticelab", "=", 
           RowBox[{"a", ".", "Vclattice"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"b1lab", ",", "b2lab", ",", "b3lab"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{
             "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                 RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                 RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                 RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                 RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                "\[Equal]", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], "]"}], 
            ";"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"CryOrienSolve", " ", "=", " ", 
           RowBox[{"Quiet", "[", 
            RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                  RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                  RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                  RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                  RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                 "\[Equal]", " ", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], " ", 
              ",", 
              RowBox[{"{", 
               RowBox[{
               "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve", ",", 
                "VerticalhSolve", ",", "VerticalkSolve", ",", 
                "VerticallSolve"}], "}"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{
             "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"MatrixForm", "@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                  RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                  RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                  RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                  RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                 "\[Equal]", " ", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}]}], " ", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", "CryOrienSolve", "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"PlanehSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"PlanehSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PlanekSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"PlanekSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PlanelSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"PlanelSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "3"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"VerticalhSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"VerticalhSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
          RowBox[{"VerticalkSolve", "=", 
           RowBox[{"Chop", "[", " ", 
            RowBox[{"VerticalkSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "5"}], "]"}], "]"}]}], "]"}]}], ";", 
          RowBox[{"VerticallSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"VerticallSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "6"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"o1", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Rationalize", "[", 
              RowBox[{
               RowBox[{"Normalize", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                  "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve"}], 
                  "}"}], ",", 
                 RowBox[{"Composition", "[", 
                  RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"o2", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Rationalize", "[", 
              RowBox[{
               RowBox[{"Normalize", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                  "VerticalhSolve", ",", "VerticalkSolve", ",", 
                   "VerticallSolve"}], "}"}], ",", 
                 RowBox[{"Composition", "[", 
                  RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"{", 
            RowBox[{"o1", ",", "o2"}], "}"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "=", "o1"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "=", "o2"}], ";"}]}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Print", "[", 
          RowBox[{"o1", ",", "o2"}], "]"}], "*)"}], 
        RowBox[{"(*", " ", 
         RowBox[{"EndofIfHKL", ",", 
          RowBox[{"UseDireciton", "=", "CrystalPhysics"}]}], "*)"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  RowBox[{"(*", " ", "EndofIfHKL", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.893332232910041*^9, 3.8933322524001656`*^9}, 
   3.893333034370672*^9, {3.893333196848257*^9, 3.893333243415746*^9}, {
   3.893333284386979*^9, 3.893333317909128*^9}, {3.893333360735362*^9, 
   3.893333365269149*^9}, {3.8933334194537163`*^9, 3.8933334755436754`*^9}, {
   3.8933335847817636`*^9, 3.893333650382358*^9}, {3.893333757699297*^9, 
   3.89333376952591*^9}, {3.893333805107281*^9, 3.893333939377002*^9}, {
   3.893337082052505*^9, 3.893337093875702*^9}, {3.893337298655434*^9, 
   3.893337328987407*^9}, 3.8933394815611258`*^9, {3.894408622147283*^9, 
   3.894408701618851*^9}, {3.894408748767632*^9, 3.894408751864159*^9}, {
   3.894408832435862*^9, 3.894408990407784*^9}, {3.894636519616379*^9, 
   3.894636540357487*^9}, {3.894638669509083*^9, 3.894638741933413*^9}, {
   3.895837978693138*^9, 3.895837983526423*^9}, {3.8959316241612687`*^9, 
   3.895931626148081*^9}, {3.895931678482754*^9, 3.8959317071432285`*^9}, {
   3.895931770238307*^9, 3.8959318569088087`*^9}, {3.895932113465183*^9, 
   3.895932114985832*^9}, 3.895932271715277*^9, {3.8970115872608976`*^9, 
   3.897011589142701*^9}, {3.897172961727069*^9, 3.897172961997063*^9}, {
   3.909063901068599*^9, 3.909063939443655*^9}, {3.909064191229429*^9, 
   3.909064196987498*^9}, {3.9090644737569737`*^9, 3.9090644775117474`*^9}, {
   3.9090670938689833`*^9, 3.909067109302928*^9}},
 CellLabel->
  "In[112]:=",ExpressionUUID->"d9ded69a-2a0e-4e42-9380-ffecf28be5f8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "hklConvert", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"hklConvert", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hklConvert", "[", "mat_", "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "clatticex", ",", "clatticey", ",", "clatticez", ",", "aZTohkl11", ",", 
       "aZTohkl21", ",", "aZTohkl31", ",", "aZTohkl12", ",", "aZTohkl22", ",",
        "aZTohkl32", ",", "aZTohkl13", ",", "aZTohkl23", ",", "aZTohkl33", 
       ",", "Valattice", ",", "Vblattice", ",", "Vclattice", ",", 
       "latticeSolve", ",", "b1", ",", "b2", ",", "b3", ",", "Z1", ",", "Z2", 
       ",", "Z3", ",", "VInput1", ",", "VInput2", ",", "VInput3", ",", 
       "aZTohkl", ",", "CryOrienSolve", ",", "a", ",", "b1lab", ",", "b2lab", 
       ",", "b3lab", ",", "Valatticelab", ",", "Vblatticelab", ",", 
       "Vclatticelab", ",", "PlanehSolve", ",", "PlanekSolve", ",", 
       "PlanelSolve", ",", "VerticalhSolve", ",", "VerticalkSolve", ",", 
       "VerticallSolve", ",", "o1", ",", "o2", ",", "o3", ",", 
       "\[IndentingNewLine]", "Orientation", ",", "PointGroup", ",", 
       "\[IndentingNewLine]", "ori", ",", "alattice", ",", "blattice", ",", 
       "clattice", ",", "alphalattice", ",", "betalattice", ",", 
       "gamalattice", ",", 
       RowBox[{"DebugFlag", "=", "False"}], ",", "Verticalh", ",", 
       "Verticalk", ",", "Verticall", ",", "Planeh", ",", "Planek", ",", 
       "Planel", ",", "rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Orientation", "=", 
       RowBox[{"mat", "[", "orientation", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PointGroup", "=", 
       RowBox[{"mat", "[", "pg", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "alattice", ",", "blattice", ",", "clattice", ",", "alphalattice", 
         ",", "betalattice", ",", "gamalattice"}], "}"}], "=", 
       RowBox[{"mat", "[", "latcon", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ori", "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Planeh", ",", "Planek", ",", "Planel"}], "}"}], "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Verticalh", ",", "Verticalk", ",", "Verticall"}], "}"}], "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Valattice", "=", 
       RowBox[{"alattice", "*", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]}], ";", " ", 
      RowBox[{"Vblattice", "=", 
       RowBox[{"blattice", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"gamalattice", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}], ",", 
          RowBox[{"Sin", "[", 
           RowBox[{"gamalattice", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0"}], "}"}]}]}], ";", 
      " ", 
      RowBox[{"Vclattice", "=", 
       RowBox[{"clattice", "*", 
        RowBox[{"{", 
         RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], "}"}]}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"latticeSolve", " ", "=", " ", 
       RowBox[{"Quiet", "[", 
        RowBox[{"NSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"clatticez", ">", "0"}], "&&", " ", 
            RowBox[{
             RowBox[{"VectorAngle", "[", 
              RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "\[Equal]", " ", 
             RowBox[{"betalattice", "*", 
              RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", 
            RowBox[{
             RowBox[{"VectorAngle", "[", 
              RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "\[Equal]", " ", 
             RowBox[{"alphalattice", "*", 
              RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"clatticex", "^", "2"}], "+", 
              RowBox[{"clatticey", "^", "2"}], "+", 
              RowBox[{"clatticez", "^", "2"}]}], "\[Equal]", "1"}]}], "}"}], 
          " ", ",", 
          RowBox[{"{", 
           RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], "}"}], 
          ",", "Reals"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"clatticex", "=", " ", 
       RowBox[{"clatticex", "/.", 
        RowBox[{"latticeSolve", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"clatticey", "=", " ", 
       RowBox[{"clatticey", "/.", 
        RowBox[{"latticeSolve", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"clatticez", "=", " ", 
       RowBox[{"clatticez", "/.", 
        RowBox[{"latticeSolve", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b1", " ", "=", " ", 
       RowBox[{
        RowBox[{"Cross", "[", 
         RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"Valattice", ".", 
          RowBox[{"Cross", "[", 
           RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b2", " ", "=", " ", 
       RowBox[{
        RowBox[{"Cross", "[", 
         RowBox[{"Vclattice", ",", "Valattice"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"Valattice", ".", 
          RowBox[{"Cross", "[", 
           RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b3", " ", "=", " ", 
       RowBox[{
        RowBox[{"Cross", "[", 
         RowBox[{"Valattice", ",", "Vblattice"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"Valattice", ".", 
          RowBox[{"Cross", "[", 
           RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<clatticex = \>\"", ",", "clatticex", ",", 
          "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
          "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", "b2", ",", 
          "\"\< , b3 = \>\"", ",", "b3"}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<1\>\""}], "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(1\), \(_\)]\)\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<2/m\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", 
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", " ", 
          RowBox[{"Z1", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<mm2\>\""}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<222\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<mmm\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
          RowBox[{"Z3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<3\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<32\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<3m\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)m\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]2\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]m\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
          RowBox[{"Z2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<4\>\""}], 
         " ", "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4mm\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<422\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)2m\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/m\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/mmm\>\""}]}], 
        ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
          RowBox[{"Z3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<6\>\""}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6mm\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<622\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/m\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/mmm\>\""}], " ",
          "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]/mm\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]/m\>\""}]}], "  ", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
          RowBox[{"Z2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", 
          "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<23\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]\[Infinity]m\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]\[Infinity]\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<432\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3m\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
          RowBox[{"Z2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<clatticex = \>\"", ",", "clatticex", ",", 
            "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
            "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", 
            RowBox[{"b2", "\"\< , b3 = \>\""}], ",", "b3"}], "]"}], ";"}], 
         "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ori", "==", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"VInput3", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Planeh", "*", "b1"}], "+", 
            RowBox[{"Planek", "*", "b2"}], "+", 
            RowBox[{"Planel", "*", "b3"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"VInput2", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Verticalh", "*", "Valattice"}], "+", 
            RowBox[{"Verticalk", "*", "Vblattice"}], "+", 
            RowBox[{"Verticall", "*", "Vclattice"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"VInput1", " ", "=", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Cross", "[", 
            RowBox[{"VInput2", ",", "VInput3"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<Z1 = \>\"", ",", "Z1", ",", "\"\< , Z2 = \>\"", ",", "Z2", 
               ",", "\"\< , Z3 = \>\"", ",", "Z3"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<VInput1 = \>\"", ",", "VInput1", ",", 
               "\"\< , VInput2 = \>\"", ",", "VInput2", ",", 
               "\"\< , VInput3 = \>\"", ",", "VInput3"}], "]"}], ";"}], 
            "}"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"aZTohkl", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13"}], "}"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23"}], "}"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], 
             "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"CryOrienSolve", " ", "=", " ", 
          RowBox[{"Quiet", "[", 
           RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"aZTohkl", ".", 
                RowBox[{"{", 
                 RowBox[{"Z1", ",", "Z2", ",", "Z3"}], "}"}]}], "\[Equal]", 
               " ", 
               RowBox[{"{", 
                RowBox[{"VInput1", ",", "VInput2", ",", "VInput3"}], "}"}]}], 
              "}"}], " ", ",", 
             RowBox[{"{", 
              RowBox[{
              "aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13", ",", 
               "aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23", ",", 
               "aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], "}"}]}], 
            "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", " ", "[", 
          RowBox[{"DebugFlag", ",", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<latticeSolve = \>\"", ",", "latticeSolve"}], "]"}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<CryOrienSolve = \>\"", ",", "CryOrienSolve"}], " ",
               "]"}], ";"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"aZTohkl11", "=", " ", 
          RowBox[{"aZTohkl11", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl12", "=", " ", 
          RowBox[{"aZTohkl12", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl13", "=", " ", 
          RowBox[{"aZTohkl13", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"aZTohkl21", "=", " ", 
          RowBox[{"aZTohkl21", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "4"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl22", "=", " ", 
          RowBox[{"aZTohkl22", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl23", "=", " ", 
          RowBox[{"aZTohkl23", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"aZTohkl31", "=", " ", 
          RowBox[{"aZTohkl31", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "7"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl32", "=", " ", 
          RowBox[{"aZTohkl32", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "8"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl33", "=", " ", 
          RowBox[{"aZTohkl33", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "9"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"o1", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Chop", "[", 
            RowBox[{"aZTohkl", ".", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]}], ";",
          " ", 
         RowBox[{"o2", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Chop", "[", 
            RowBox[{"aZTohkl", ".", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "]"}]}], ";",
          " ", 
         RowBox[{"o3", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Chop", "[", 
            RowBox[{"aZTohkl", ".", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"DebugFlag", ",", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<Cry1 = \>\"", ",", "rCry1", ",", "\"\< , Cry2 = \>\"", ",", 
             "rCry2", ",", "\"\< , Cry3 = \>\"", ",", "rCry3"}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"{", 
           RowBox[{"o1", ",", "o2", ",", "o3"}], "}"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"ori", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Planeh", ",", "Planek", ",", "Planel"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Verticalh", ",", "Verticalk", ",", "Verticall"}], 
               "}"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"o1", ",", "o2", ",", "o3"}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab1", ".", "o1"}], ",", 
              RowBox[{"Lab1", ".", "o2"}], ",", 
              RowBox[{"Lab1", ".", "o3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab2", ".", "o1"}], ",", 
              RowBox[{"Lab2", ".", "o2"}], ",", 
              RowBox[{"Lab2", ".", "o3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab3", ".", "o1"}], ",", 
              RowBox[{"Lab3", ".", "o2"}], ",", 
              RowBox[{"Lab3", ".", "o3"}]}], "}"}]}], "}"}]}], ";"}], 
        RowBox[{"(*", 
         RowBox[{
         "this", " ", "is", " ", "equivalent", " ", "to", " ", "transpose", 
          " ", "of", " ", 
          RowBox[{"{", 
           RowBox[{"o1", ",", "o2", ",", "o3"}], "}"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"EndofIfHKL", ",", 
          RowBox[{"UseDireciton", "=", "Miller"}]}], "*)"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"a", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab1", ".", "rCry1"}], ",", 
              RowBox[{"Lab1", ".", "rCry2"}], ",", 
              RowBox[{"Lab1", ".", "rCry3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab2", ".", "rCry1"}], ",", 
              RowBox[{"Lab2", ".", "rCry2"}], ",", 
              RowBox[{"Lab2", ".", "rCry3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab3", ".", "rCry1"}], ",", 
              RowBox[{"Lab3", ".", "rCry2"}], ",", 
              RowBox[{"Lab3", ".", "rCry3"}]}], "}"}]}], "}"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "this", " ", "is", " ", "equivalent", " ", "to", " ", "transpose", 
           " ", "of", " ", 
           RowBox[{"{", 
            RowBox[{"rCry1", ",", "rCry2", ",", "rCry3"}], "}"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", "a"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b1lab", "=", 
          RowBox[{"a", ".", "b1"}]}], ";", " ", 
         RowBox[{"b2lab", "=", 
          RowBox[{"a", ".", "b2"}]}], ";", " ", 
         RowBox[{"b3lab", "=", 
          RowBox[{"a", ".", "b3"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Valatticelab", "=", 
          RowBox[{"a", ".", "Valattice"}]}], ";", " ", 
         RowBox[{"Vblatticelab", "=", 
          RowBox[{"a", ".", "Vblattice"}]}], ";", " ", 
         RowBox[{"Vclatticelab", "=", 
          RowBox[{"a", ".", "Vclattice"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"b1lab", ",", "b2lab", ",", "b3lab"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{
            "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], "\[Equal]",
                " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"CryOrienSolve", " ", "=", " ", 
          RowBox[{"Quiet", "[", 
           RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                 RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                 RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                 RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                 RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                "\[Equal]", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], " ", 
             ",", 
             RowBox[{"{", 
              RowBox[{
              "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve", ",", 
               "VerticalhSolve", ",", "VerticalkSolve", ",", 
               "VerticallSolve"}], "}"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{
            "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"MatrixForm", "@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                 RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                 RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                 RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                 RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                "\[Equal]", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}]}], " ", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", "CryOrienSolve", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"PlanehSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"PlanehSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PlanekSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"PlanekSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PlanelSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"PlanelSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"VerticalhSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"VerticalhSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
         RowBox[{"VerticalkSolve", "=", 
          RowBox[{"Chop", "[", " ", 
           RowBox[{"VerticalkSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "5"}], "]"}], "]"}]}], "]"}]}], ";", 
         RowBox[{"VerticallSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"VerticallSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"o1", "=", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Rationalize", "[", 
             RowBox[{
              RowBox[{"Normalize", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve"}], 
                 "}"}], ",", 
                RowBox[{"Composition", "[", 
                 RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"o2", "=", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Rationalize", "[", 
             RowBox[{
              RowBox[{"Normalize", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "VerticalhSolve", ",", "VerticalkSolve", ",", 
                  "VerticallSolve"}], "}"}], ",", 
                RowBox[{"Composition", "[", 
                 RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"{", 
           RowBox[{"o1", ",", "o2"}], "}"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"ori", ",", 
            RowBox[{"{", 
             RowBox[{"o1", ",", "o2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"rCry1", ",", "rCry2", ",", "rCry3"}], "}"}]}], "}"}]}], 
         ";"}]}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Print", "[", 
         RowBox[{"o1", ",", "o2"}], "]"}], "*)"}], 
       RowBox[{"(*", " ", 
        RowBox[{"EndofIfHKL", ",", 
         RowBox[{"UseDireciton", "=", "CrystalPhysics"}]}], "*)"}], "]"}]}]}],
     "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.897011633135688*^9, 3.897011846179479*^9}, {
  3.89701187962759*^9, 3.897011882605379*^9}, {3.9090670192152567`*^9, 
  3.9090670603491893`*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"10446bcd-584a-48a4-8540-2d9a165131e4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["for Fresnel and Maker fringes", "Chapter",
 CellChangeTimes->{{3.893382529142957*^9, 
  3.893382535029363*^9}},ExpressionUUID->"7bda4879-c1f5-4657-b1f0-\
1d230c3921d8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"Fresnel", ",", "MF", ",", "MFandFresnel"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Fresnel", "[", 
    RowBox[{"mats_", ",", "thetatemp_", ",", 
     RowBox[{"assumption_", ":", "0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "wIncLocal", ",", "wavLLocal", ",", "wavNLLocal", ",", "tmpw1Local", 
       ",", "tmpw2Local", ",", "rmpw1Local", ",", "rmpw2Local", ",", "rEtemp",
        ",", "tEtemp", ",", "m1", ",", "m2", ",", "m3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wIncLocal", "=", 
       RowBox[{"setwInc", "[", 
        RowBox[{"\[Omega]0", ",", 
         RowBox[{"N", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"thetatemp", "/", "180"}], " ", "Pi"}], ")"}]}], ",", 
         "\[CapitalDelta]\[Delta]", ",", "\[CurlyPhi]", ",", "n0"}], "]"}]}], 
      ";", 
      RowBox[{"extWave", "@", "wIncLocal"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"assumption", "==", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wavLLocal", "=", 
          RowBox[{"f4L", "[", 
           RowBox[{"mats", ",", "wIncLocal"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"assumption", "==", "1"}], "||", 
           RowBox[{"assumption", "==", "2"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wavLLocal", "=", 
            RowBox[{"f4L", "[", 
             RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], 
           ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rmpw1Local", ",", "rmpw2Local"}], "}"}], "=", 
       RowBox[{"wavLLocal", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmpw1Local", ",", "tmpw2Local"}], "}"}], "=", 
       RowBox[{"wavLLocal", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "is", " ", "for", " ", 
         "reflected"}], ",", " ", 
        RowBox[{
         RowBox[{"[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "is", " ", "for", " ", 
         "transmitted"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"extWave", "@", "rmpw1Local"}], ";", 
      RowBox[{"extWave", "@", "rmpw2Local"}], ";", 
      RowBox[{"extWave", "@", "tmpw1Local"}], ";", 
      RowBox[{"extWave", "@", "tmpw2Local"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"rEtemp", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"rmpw1Local", "[", "A", "]"}], "+", 
          RowBox[{"rmpw2Local", "[", "A", "]"}]}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tEtemp", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"tmpw1Local", "[", "A", "]"}], "+", 
          RowBox[{"tmpw2Local", "[", "A", "]"}]}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"thetatemp", ",", 
        RowBox[{
         RowBox[{"rEtemp", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"rEtemp", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"rEtemp", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"rEtemp", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"tEtemp", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"tEtemp", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"tEtemp", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"tEtemp", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MF", "[", 
    RowBox[{"mats_", ",", "thetatemp_", ",", 
     RowBox[{"assumption_", ":", "0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "wIncLocal", ",", "wavLLocal", ",", "wavNLLocal", ",", "tmpw1Local", 
       ",", "tmpw2Local", ",", "tEboLocal", ",", "tEruiLocal", ",", "m1", ",",
        "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wIncLocal", "=", 
       RowBox[{"setwInc", "[", 
        RowBox[{"\[Omega]0", ",", 
         RowBox[{"N", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"thetatemp", "/", "180"}], " ", "Pi"}], ")"}]}], ",", 
         "\[CapitalDelta]\[Delta]", ",", "\[CurlyPhi]", ",", "n0"}], "]"}]}], 
      ";", 
      RowBox[{"extWave", "@", "wIncLocal"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"assumption", "==", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"flagJK", "=", "False"}], ";", 
         RowBox[{"flagHH", "=", "False"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
          RowBox[{"f4NL", "[", 
           RowBox[{"mats", ",", "wIncLocal"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"assumption", "==", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"flagBackward", "=", "False"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"flagStandingWave", "=", "False"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"flagJK", "=", "True"}], ";", 
            RowBox[{"flagHH", "=", "False"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
             RowBox[{"f4NL", "[", 
              RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], ";"}],
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"assumption", "==", "2"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"flagBackward", "=", "False"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"flagStandingWave", "=", "False"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"flagJK", "=", "False"}], ";", 
               RowBox[{"flagHH", "=", "True"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
                RowBox[{"f4NL", "[", 
                 RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], 
               ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmpw1Local", ",", "tmpw2Local"}], "}"}], "=", 
       RowBox[{"wavNLLocal", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "is", " ", "for", " ", 
         "reflected"}], ",", " ", 
        RowBox[{
         RowBox[{"[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "is", " ", "for", " ", 
         "transmitted"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"extWave", "@", "tmpw1Local"}], ";", 
      RowBox[{"extWave", "@", "tmpw2Local"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"tEboLocal", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"tmpw2Local", "[", "A", "]"}], "+", 
          RowBox[{"tmpw1Local", "[", "A", "]"}]}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tEruiLocal", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", 
            RowBox[{"Sin", "[", "\[Psi]", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"Sin", "[", "\[Psi]", "]"}]}], ",", 
            RowBox[{"Cos", "[", "\[Psi]", "]"}]}], "}"}]}], "}"}], ".", " ", 
        "tEboLocal"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"thetatemp", ",", 
        RowBox[{
         RowBox[{"tEruiLocal", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"tEruiLocal", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"tEruiLocal", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"tEruiLocal", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.893347161949204*^9, 3.893347185724688*^9}, {
   3.893358307691169*^9, 3.893358317636998*^9}, 3.893378202753617*^9, {
   3.893378668612151*^9, 3.89337868049402*^9}, {3.895371202000575*^9, 
   3.895371396552465*^9}, {3.895371458703281*^9, 3.895371468619602*^9}, {
   3.8958607445034423`*^9, 3.895860746226354*^9}, {3.895861311559941*^9, 
   3.8958613123844333`*^9}, {3.89586791930539*^9, 3.895867965399525*^9}, {
   3.895868006059975*^9, 3.895868039898413*^9}, {3.896065100554068*^9, 
   3.896065106044956*^9}, {3.896065624223459*^9, 3.896065659494779*^9}, {
   3.896065708784387*^9, 3.896065711214146*^9}, {3.896068944386587*^9, 
   3.896068952543131*^9}, {3.896098115659069*^9, 3.896098129550228*^9}, {
   3.896660074698949*^9, 3.896660129247477*^9}, {3.896750804703697*^9, 
   3.896750857409245*^9}, {3.896750888680524*^9, 3.896750926793042*^9}, 
   3.896751861922112*^9, {3.897173980044154*^9, 3.8971740510181*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"2230f45f-45b4-4d76-8d79-23f7995e3866"]
}, Open  ]],

Cell[CellGroupData[{

Cell["for plotting ", "Chapter",
 CellChangeTimes->{{3.8933787971006308`*^9, 3.893378798881888*^9}, 
   3.8971741381874638`*^9},ExpressionUUID->"feeeed14-16c8-4403-a121-\
6d703a0e1425"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"options", " ", "for", " ", "wave", " ", "vector", " ", "plots"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"options2d", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ViewProjection", "\[Rule]", "\"\<Orthographic\>\""}], ",", 
       RowBox[{"ViewPoint", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity", ",", "0"}], "}"}]}], ",", 
       RowBox[{"ViewVertical", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "0", ",", " ", 
          RowBox[{"-", "1"}]}], "}"}]}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", "Automatic"}], 
         "}"}]}], ",", 
       RowBox[{"ImageSize", "->", "300"}], ",", 
       RowBox[{"BoxRatios", "->", 
        RowBox[{"{", 
         RowBox[{"1", ",", ".1", ",", "1"}], "}"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"for", " ", "polarplot"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"options2", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"PolarAxesOrigin", "\[Rule]", "Automatic"}], 
        RowBox[{"(*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Pi", "/", "2"}], ",", "1.0"}], " ", "}"}], "*)"}], ",", 
        RowBox[{"PolarGridLines", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"PolarAxes", "\[Rule]", "True"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"PlotLegends", "\[Rule]", 
           RowBox[{"\"\<Iy x\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"Round", "@", 
              RowBox[{"(", 
               RowBox[{"1", "/", "Imax"}], ")"}]}], "]"}]}]}], ","}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"PolarTicks", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{"i", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "0", ",", 
                 RowBox[{"2", " ", "Pi"}], ",", 
                 RowBox[{"Pi", "/", "6"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"-", "1"}]}], "]"}], ",", "None"}], "}"}]}], ",", 
        RowBox[{"TicksStyle", "->", "White"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{
                  RowBox[{"Pi", "/", "6"}], " ", "i"}], "]"}], ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"i", "\[NotEqual]", "3"}], ",", 
                  RowBox[{
                   RowBox[{"ToString", "[", 
                    RowBox[{"30", " ", "i"}], "]"}], "<>", 
                   "\"\<\[Degree]\>\""}], ",", 
                  RowBox[{"Style", "[", 
                   RowBox[{
                   "\"\<90\[Degree](\!\(\*SubscriptBox[\(y\), \
\(lab\)]\))\>\"", ",", "14"}], "]"}]}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", 
            "None"}], "}"}], ","}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Frame", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"True", ",", "False"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"True", ",", "True"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"FrameTicksStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Directive", "[", 
              RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}], ",", 
             "None"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"None", ",", "None"}], "}"}]}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"FrameStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Thick", ",", "Thick"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Directive", "[", "White", "]"}], ",", 
             RowBox[{"Directive", "[", "White", "]"}]}], "}"}]}], "}"}]}], 
        ",", 
        RowBox[{"ImageSize", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"350", ",", "350"}], "}"}]}]}], "}"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"options2", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"PolarAxesOrigin", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Pi", "/", "2"}], ",", "1.0"}], " ", "}"}]}], ",", 
       RowBox[{"PolarGridLines", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"PolarAxes", "\[Rule]", "True"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", "1.1"}], ",", "\[IndentingNewLine]", 
       RowBox[{"PolarTicks", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"N", "[", 
               RowBox[{
                RowBox[{"Pi", "/", "4"}], "+", 
                RowBox[{
                 RowBox[{"Pi", "/", "2"}], " ", "i"}]}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"i", "\[NotEqual]", "4"}], ",", 
                  RowBox[{
                   RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"90", "*", "i"}], "+", "45"}], "]"}], "<>", 
                   "\"\<\[Degree]\>\""}], ",", "\"\<\>\""}], "]"}], ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
                ",", "16"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "3"}], "}"}]}], "]"}], ",", "None"}],
          "}"}]}], ",", 
       RowBox[{"Frame", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"True", ",", "False"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"True", ",", "True"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"FrameTicksStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "20"}], "]"}], ",", "None"}],
            "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"None", ",", "None"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"FrameStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Thick", ",", "Thick"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", "White", "]"}], ",", 
            RowBox[{"Directive", "[", "White", "]"}]}], "}"}]}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"350", ",", "350"}], "}"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"samplecolors", "=", 
     RowBox[{"{", 
      RowBox[{
      "Black", ",", "LightBlue", ",", "LightRed", ",", "LightYellow", ",", 
       "LightGreen", ",", "LightOrange", ",", "LightPurple", ",", "LightBlue",
        ",", "LightRed", ",", "LightYellow", ",", "LightGreen", ",", 
       "LightOrange", ",", "LightPurple", ",", "LightBlue", ",", "LightRed", 
       ",", "LightYellow"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"schematicfun", "[", "pos_", "]"}], ":=", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"samplecolors", "[", 
         RowBox[{"[", 
          RowBox[{"pos", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"EdgeForm", "[", 
         RowBox[{"Directive", "[", "Black", "]"}], "]"}], ",", 
        RowBox[{"Rectangle", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "-", "1"}]}], "}"}]}], "]"}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"Text", "[", 
         RowBox[{
          RowBox[{"Style", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "name", "]"}], "]"}], "]"}], 
                "\[NotEqual]", "\"\<Enter Name Here\>\""}], "\[And]", 
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "name", "]"}], "]"}], "]"}], 
                "\[NotEqual]", "\"\<\>\""}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"allmaterials", "[", 
                 RowBox[{"[", 
                  RowBox[{"pos", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"Key", "[", "name", "]"}], "]"}], "]"}], "<>", 
               "\"\<  \>\"", "<>", "\"\<(\>\"", "<>", 
               RowBox[{"StringDelete", "[", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"allmaterials", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"\"\<{\>\"", ",", "\"\<}\>\""}], "}"}]}], "]"}], 
               "<>", "\"\<)\>\"", "<>", "\"\<,  \>\"", "<>", 
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"\"\<Layer \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "]"}], ",", "15", 
            ",", "Black", ",", "Bold"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"4.5", ",", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Text", "[", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "1"}], "]"}], ",", "15", 
            ",", "Black", ",", "Bold"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "==", "1"}], "\[Or]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "==", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"\"\<thickness = \>\"", "<>", "\"\<\[Infinity]\>\""}], 
              ",", "15", ",", "Black", ",", "Bold"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"8", ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"\"\<thickness = \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "h", "]"}], "]"}], "]"}], "]"}], "<>", 
               "\"\< \[Mu]m\>\""}], ",", "15", ",", "Black", ",", "Bold"}], 
             "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"8", ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
           "]"}]}], "]"}]}], "\[IndentingNewLine]", "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"options3", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Orange", ",", 
          RowBox[{"Darker", "[", "Green", "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"Axes", "->", "False"}], ",", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<\!\(\*SubscriptBox[\(E\), \(s\)]\)\>\"", " ", ",", "22", 
              ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Black"}], "]"}], ",", "None"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<\!\(\*SubscriptBox[\(E\), \(p\)]\)\>\"", " ", ",", "22", 
              ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Black"}], "]"}], ",", "None"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"FrameStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Thick", ",", "Thick"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Thick", ",", "Thick"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"FrameTicksStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}], ",", 
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}], ",", 
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}]}], "}"}]}], 
         "}"}]}], ",", 
       RowBox[{"FrameTicks", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Automatic", ",", "Automatic"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Automatic", ",", "Automatic"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Ellipticity\>\"", ",", "Black", ",", 
          RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
          "22"}], "]"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"300", ",", "300"}], "}"}]}], ",", 
       RowBox[{"AxesStyle", "\[Rule]", 
        RowBox[{"Directive", "[", "LightGray", "]"}]}], ",", 
       RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"Method", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<AxesInFront\>\"", "->", "False"}], "}"}]}], ",", 
       RowBox[{"PlotLegends", "->", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"SwatchLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Black", ",", "Orange", ",", 
              RowBox[{"Darker", "[", "Green", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<Incident \!\(\*SuperscriptBox[\(E\), \(i, \
\[Omega]\)]\)\>\"", ",", 
              "\"\<Reflected \!\(\*SuperscriptBox[\(E\), \(R, 2  \
\[Omega]\)]\)\>\"", ",", 
              "\"\<Transmitted \!\(\*SuperscriptBox[\(E\), \(T, 2  \
\[Omega]\)]\)\>\""}], "}"}]}], 
           RowBox[{"(*", 
            RowBox[{",", 
             RowBox[{"LegendFunction", "->", "\"\<Panel\>\""}]}], "*)"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.7", ",", "0.85"}], "}"}]}], "]"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"placeHolderFigs", "=", 
     RowBox[{"Framed", "[", 
      RowBox[{"Style", "[", 
       RowBox[{
       "\"\<Press 'Update' to Generate Figure\>\"", ",", "Bold", ",", "18", 
        ",", 
        RowBox[{"FontFamily", "->", "\"\<Times New Roman\>\""}]}], "]"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"placeHolderEqus", "=", 
     RowBox[{"Framed", "[", 
      RowBox[{"Style", "[", 
       RowBox[{
       "\"\<Press 'Update' to Generate Expression\>\"", ",", "Bold", ",", 
        "18", ",", 
        RowBox[{"FontFamily", "->", "\"\<Times New Roman\>\""}]}], "]"}], 
      "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8933486120835743`*^9, 3.893348618300838*^9}, {
   3.8933502591111736`*^9, 3.893350265924114*^9}, {3.893354645846586*^9, 
   3.893354664557826*^9}, {3.89335578664895*^9, 3.8933558057270465`*^9}, {
   3.893400611360826*^9, 3.89340065309416*^9}, {3.8934006982178073`*^9, 
   3.893400706624937*^9}, {3.893400737025715*^9, 3.893400740216435*^9}, {
   3.894407816016934*^9, 3.8944078629148526`*^9}, {3.894407900733224*^9, 
   3.894407947392223*^9}, {3.8944081285469713`*^9, 3.894408192637411*^9}, {
   3.894408385623866*^9, 3.894408402414906*^9}, 3.894589376903339*^9, {
   3.894589484180315*^9, 3.8945895039885483`*^9}, 3.894589545157735*^9, {
   3.894589613385866*^9, 3.894589636045218*^9}, {3.894589707762707*^9, 
   3.894589710422588*^9}, {3.8945898266462283`*^9, 3.894589860480201*^9}, {
   3.894592640197791*^9, 3.8945926438127384`*^9}, {3.8945937719847016`*^9, 
   3.894593805543951*^9}, {3.895414005022328*^9, 3.895414067154997*^9}, {
   3.895414170536589*^9, 3.895414210626453*^9}, {3.895414264465515*^9, 
   3.895414265688684*^9}, {3.895414497926609*^9, 3.895414517843151*^9}, {
   3.895414557487856*^9, 3.895414571342379*^9}, {3.895414607967214*^9, 
   3.8954146594744177`*^9}, 3.895414724304675*^9, {3.895414835853051*^9, 
   3.8954148435508623`*^9}, {3.89541489782485*^9, 3.8954149626481934`*^9}, {
   3.89541522391429*^9, 3.895415225234209*^9}, {3.895416734850176*^9, 
   3.895416736104639*^9}, {3.895419613538356*^9, 3.895419646964218*^9}, {
   3.8957583024916935`*^9, 3.895758358800396*^9}, {3.895759702560421*^9, 
   3.8957597170784593`*^9}, 3.895759844080161*^9, {3.895759884922897*^9, 
   3.895759886102124*^9}, {3.895839755525236*^9, 3.895839787117711*^9}, 
   3.895922968991507*^9, {3.895923215817199*^9, 3.8959232174450145`*^9}, 
   3.896038427232528*^9, {3.896209147442976*^9, 3.896209169159908*^9}, {
   3.896209207084421*^9, 3.896209221569282*^9}, {3.896209310246527*^9, 
   3.896209311243024*^9}, {3.896209976596665*^9, 3.896209978152924*^9}, {
   3.896227698559813*^9, 3.896227722456881*^9}, {3.89622790949845*^9, 
   3.896227909558445*^9}, {3.8962280471417704`*^9, 3.8962280686627984`*^9}, 
   3.896230721829651*^9},
 CellLabel->
  "In[120]:=",ExpressionUUID->"8826940e-c654-46fe-990e-f7d58f72b8c5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fzvecplots2d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fzvecplots2d", "[", "mat_", "]"}], ":=", 
  RowBox[{"Show", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Orange", ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Cyan", ",", 
       RowBox[{"Opacity", "[", "0.1", "]"}], ",", 
       RowBox[{"EdgeForm", "[", "]"}], ",", 
       RowBox[{"HalfPlane", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
          RowBox[{"[", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "]"}]}], "}"}], 
     "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Black", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "Dashed", ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"-", "1"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], "]"}]}], 
      "}"}], "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Black", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", 
            RowBox[{"Lab1", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", 
              RowBox[{"Lab2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
          "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", 
            RowBox[{"Lab3", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.7", "*", 
           RowBox[{"Lab1", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"(*", 
        RowBox[{"Text", "[", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{"Row", "[", 
             RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}],
              "]"}], ",", "26", ",", 
            RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",",
             "Bold"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0.6", "*", 
            RowBox[{"Lab2", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}], "*)"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", 
           RowBox[{"Lab3", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"\"\<\[TensorProduct]\>\"", ",", "25", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", 
           RowBox[{"Lab2", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "0.1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Blue", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{"0.5", "*", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{"0.5", "*", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{"0.5", "*", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", "Blue", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{"0.7", "*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(Z\), \(2\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{"0.6", "*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1.5"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(Z\), \(3\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", "Blue", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{"0.6", "*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
    RowBox[{"ImageSize", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"300", ",", "300"}], "}"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.893351012815014*^9, 3.893351033551047*^9}, {
   3.8933510684306636`*^9, 3.893351112653323*^9}, {3.893351196443209*^9, 
   3.8933512003050814`*^9}, 3.893352788454318*^9, {3.895680868732071*^9, 
   3.895680878021631*^9}, {3.895680963368698*^9, 3.895680989808733*^9}, {
   3.895681036820758*^9, 3.895681038719311*^9}, {3.895681117359395*^9, 
   3.895681119129198*^9}, {3.895681153088011*^9, 3.8956811548479576`*^9}, {
   3.8956812319908123`*^9, 3.895681246980226*^9}, {3.895681359365009*^9, 
   3.895681383743298*^9}, {3.895681537911544*^9, 3.8956815408680396`*^9}},
 CellLabel->
  "In[127]:=",ExpressionUUID->"430fb27d-99f8-41d5-8a4a-835e12847cce"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fzvecplots3d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fzvecplots3d", "[", "mat_", "]"}], ":=", 
  RowBox[{"Show", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Orange", ",", 
       RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
       RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
       RowBox[{"HalfSpace", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", 
           RowBox[{"-", "0.01"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Blue", ",", 
       RowBox[{"Arrowheads", "[", "0.07", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "Dashed", ",", 
       RowBox[{"EdgeForm", "[", " ", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<\!\(\*SubscriptBox[StyleBox[\\\"Z\\\",FontSlant->\\\"Italic\\\"\
], \\\"1\\\"]\)\>\"", ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold", ",", "Blue"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "+", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<\!\(\*SubscriptBox[StyleBox[\\\"Z\\\",FontSlant->\\\"Italic\\\"\
], \\\"2\\\"]\)\>\"", ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold", ",", "Blue"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.8", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "+", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<\!\(\*SubscriptBox[StyleBox[\\\"Z\\\",FontSlant->\\\"Italic\\\"\
], \\\"3\\\"]\)\>\"", ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold", ",", "Blue"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.8", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "+", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Black", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", "Lab1"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", "Lab2"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", "Lab3"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.7", "*", "Lab1"}], "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.9"}], ",", 
            RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", "Lab2"}], "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.9"}], ",", 
            RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", "Lab3"}], "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.9"}], ",", 
            RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Cyan", ",", 
       RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
       RowBox[{"EdgeForm", "[", "]"}], ",", 
       RowBox[{"HalfPlane", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.5"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
    RowBox[{"ViewPoint", "->", 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
    RowBox[{"ImageSize", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"300", ",", "300"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.893351012815014*^9, 3.893351033551047*^9}, {
   3.8933510684306636`*^9, 3.893351112653323*^9}, {3.893351196443209*^9, 
   3.8933512003050814`*^9}, 3.893352788454318*^9},
 CellLabel->
  "In[129]:=",ExpressionUUID->"e2b0f133-3c5e-4178-b645-c608c913bf9b"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "fplot2geometry2d", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fplot2geometry2d", "[", "theta_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"rtheta", "=", "0.5"}], ",", "CylinTopBase1", ",", "t1", ",", 
      "\[Eta]"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CylinTopBase1", " ", "=", 
      RowBox[{"0.8", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t1", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Orange", ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Cyan", ",", 
          RowBox[{"Opacity", "[", "0.1", "]"}], ",", 
          RowBox[{"EdgeForm", "[", "]"}], ",", 
          RowBox[{"HalfPlane", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "]"}]}], "}"}],
         "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "Dashed", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{"-", "1"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], 
           "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"0.5", "*", 
               RowBox[{"Lab1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Arrow", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "0.9"}], ",", 
                   RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"0.5", "*", 
                 RowBox[{"Lab2", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "0.9"}], ",", 
                   RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
             "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"0.5", "*", 
               RowBox[{"Lab3", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
               "]"}], ",", "30", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"0.7", "*", 
              RowBox[{"Lab1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"Row", "[", 
                 RowBox[{
                 "{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], 
                 "]"}], ",", "26", ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
                ",", "Bold"}], "]"}], ",", 
              RowBox[{
               RowBox[{"0.6", "*", 
                RowBox[{"Lab2", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "0.9"}], ",", 
                  RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"-", "1"}]}], "}"}]}], "]"}], ","}], "*)"}], 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
               "]"}], ",", "30", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"0.6", "*", 
              RowBox[{"Lab3", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<\[TensorProduct]\>\"", ",", "25", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"0.6", "*", 
              RowBox[{"Lab2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "0.1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"theta", "*", 
                   RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], "]"}], 
          ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<\!\(\*SuperscriptBox[\(k\), \(\[Omega]\)]\)\>\"", ",", "30",
               ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Sin", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
               RowBox[{"Cos", "[", 
                RowBox[{"theta", "*", 
                 RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Dashed", ","}], "*)"}], 
          RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"BSplineCurve", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"rtheta", "*", 
               RowBox[{"Lab3", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], " ", ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"8", "/", "8"}], " ", "Degree"}]}]}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SuperscriptBox[\(\[Theta]\), \(i\)]\)\>\"", 
                "}"}], "]"}], ",", "20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{"rtheta", "*", 
             RowBox[{
              RowBox[{"RotationTransform", "[", 
               RowBox[{"2", "*", 
                RowBox[{"theta", "/", "4"}], " ", "Degree"}], "]"}], "[", 
              RowBox[{"Lab3", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Arrowheads", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.04"}], ",", "0.04"}], "}"}], "]"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Dashed", ","}], "*)"}], 
          RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
          RowBox[{"Arrow", "[", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"CylinTopBase1", " ", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "-", 
              RowBox[{"0.3", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"CylinTopBase1", " ", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{"0.3", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}]}], 
            "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(E\), \(p\)]\)\>\"", "}"}], 
               "]"}], ",", "20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"CylinTopBase1", " ", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "-", 
             RowBox[{"0.3", 
              RowBox[{
               RowBox[{"Cross", "[", 
                RowBox[{"CylinTopBase1", ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<\[TensorProduct]\>\"", ",", "25", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{"CylinTopBase1", " ", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(E\), \(s\)]\)\>\"", "}"}], 
               "]"}], ",", "20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{"CylinTopBase1", " ", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "0.3"}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"300", ",", "300"}], "}"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.893351283131983*^9, 3.8933513830490522`*^9}, {
   3.8933514543917203`*^9, 3.893351458497405*^9}, {3.8933515301246185`*^9, 
   3.893351572957464*^9}, 3.8933527927492*^9, {3.893353838062588*^9, 
   3.893353848153953*^9}, {3.8933541616011205`*^9, 3.8933541641404996`*^9}, {
   3.895861694149053*^9, 3.895861694305304*^9}},
 CellLabel->
  "In[131]:=",ExpressionUUID->"979d47e3-561f-4f83-b76c-7bb5f3fb996d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fplot2geometry3d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fplot2geometry3d", "[", "theta_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Show", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Orange", ",", 
         RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
         RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
         RowBox[{"HalfSpace", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"-", "0.01"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Black", ",", 
         RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
         RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", "Lab1"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", "Lab2"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", "Lab3"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Row", "[", 
              RowBox[{
              "{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], "]"}],
              ",", "30", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
             ",", "Bold"}], "]"}], ",", 
           RowBox[{
            RowBox[{"0.7", "*", "Lab1"}], "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Row", "[", 
              RowBox[{
              "{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], "]"}],
              ",", "26", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
             ",", "Bold"}], "]"}], ",", 
           RowBox[{
            RowBox[{"0.6", "*", "Lab2"}], "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Row", "[", 
              RowBox[{
              "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], "]"}],
              ",", "30", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
             ",", "Bold"}], "]"}], ",", 
           RowBox[{
            RowBox[{"0.6", "*", "Lab3"}], "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Red", ",", 
         RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
         RowBox[{"Arrow", "[", 
          RowBox[{"Tube", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"theta", "*", 
                   RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
            "0.03"}], "]"}], "]"}], ",", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<\!\(\*SuperscriptBox[\(k\), \(\[Omega]\)]\)\>\"", ",", "30", 
             ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Sin", "[", 
               RowBox[{"theta", "*", 
                RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
             RowBox[{"Cos", "[", 
              RowBox[{"theta", "*", 
               RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Cyan", ",", 
         RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
         RowBox[{"EdgeForm", "[", "]"}], ",", 
         RowBox[{"HalfPlane", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}],
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "0.5"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
      RowBox[{"ViewPoint", "->", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"300", ",", "300"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.893351283131983*^9, 3.8933513830490522`*^9}, {
  3.8933514543917203`*^9, 3.893351458497405*^9}, {3.8933515301246185`*^9, 
  3.893351572957464*^9}, {3.8933527927492*^9, 3.8933527980390654`*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"f5aa71d2-e846-4c4f-aa94-bff7bcb05b8d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fpolarizationplot3d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fpolarizationplot3d", "[", 
   RowBox[{
   "theta_", ",", "phi_", ",", "psi_", ",", "RotatePolarizer_", ",", 
    "RotateAnalyzer_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "CylinTopBase1", ",", "CylinTopBase2", ",", "CylinBotBase1", ",", 
      "CylinBotBase2", ",", "rCylin", ",", "t1", ",", "t2", ",", "\[Eta]"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CylinTopBase1", " ", "=", " ", 
      RowBox[{"1.8", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CylinBotBase1", " ", "=", 
      RowBox[{"1.7", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CylinTopBase2", " ", "=", " ", 
      RowBox[{"1.8", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CylinBotBase2", " ", "=", 
      RowBox[{"1.7", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rCylin", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"t1", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", 
            RowBox[{"theta", "*", 
             RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t2", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", "Lab1"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", "Lab2"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", "Lab3"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
               "]"}], ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1.3", "*", "Lab1"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.3"}], ",", 
               RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}]}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], 
               "]"}], ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1.1", "*", "Lab2"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.5"}], ",", 
               RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
               "]"}], ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1.1", "*", "Lab3"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.3"}], ",", 
               RowBox[{"-", "1.3"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Orange", ",", 
          RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
          RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
          RowBox[{"HalfSpace", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"-", "0.01"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"Cylinder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"CylinTopBase1", ",", "CylinBotBase1"}], "}"}], ",", 
          "rCylin"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"Cylinder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"CylinTopBase2", ",", "CylinBotBase2"}], "}"}], ",", 
          "rCylin"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinTopBase1", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinTopBase1", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinBotBase1", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinBotBase1", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinTopBase2", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinTopBase2", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinBotBase2", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinBotBase2", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotatePolarizer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase1", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase1", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t1", "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \[Omega]\)]\)\>\
\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                  "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"CylinTopBase1", " ", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t1", "[", 
                    RowBox[{"CylinTopBase1", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"15", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t1", "[", 
                    RowBox[{"CylinTopBase1", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"30", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t1", "[", 
                    RowBox[{"CylinTopBase1", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"40", " ", "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                  "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                   RowBox[{"0.75", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"20", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{"{", 
            RowBox[{"Black", ",", 
             RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
             RowBox[{"GeometricTransformation", "[", 
              RowBox[{
               RowBox[{"Arrow", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                   RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                  ",", 
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                  "}"}], "]"}], ",", 
               RowBox[{"t1", "/.", 
                RowBox[{"\[Eta]", "->", 
                 RowBox[{"phi", " ", "Degree"}]}]}]}], "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{"Row", "[", 
                  RowBox[{
                  "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \
\[Omega]\)]\)\>\"", "}"}], "]"}], ",", "20", ",", 
                 RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}],
                  ",", "Bold"}], "]"}], ",", 
               RowBox[{
                RowBox[{"t1", "[", 
                 RowBox[{"CylinTopBase1", "+", 
                  RowBox[{"0.05", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                  RowBox[{"Cross", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                 "]"}], "/.", 
                RowBox[{"\[Eta]", "->", " ", 
                 RowBox[{"phi", " ", "Degree"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], 
          "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotateAnalyzer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[DoubleVerticalBar]\)\(\\\ \)\(Analyzer\)\(\\\ \)\), \(2  \[Omega]\)]\)\>\"",
                     "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}], ",",
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"CylinTopBase2", " ", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t2", "[", 
                    RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"15", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t2", "[", 
                    RowBox[{"CylinTopBase2", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"30", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t2", "[", 
                    RowBox[{"CylinTopBase2", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"40", " ", "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                  "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                   RowBox[{"1.1", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"10", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"135", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[Perpendicular]\)\(\\\ \)\(Analyzer\)\), \(2  \[Omega]\)]\)\>\"", "}"}], 
                   "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"135", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{"psi", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[DoubleVerticalBar]\)\(\\\ \)\(Analyzer\)\(\\\ \)\), \(2  \[Omega]\)]\)\>\"",
                     "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{"psi", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], " ", "Degree"}]}]}]}], 
               "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[Perpendicular]\)\(\\\ \)\(Analyzer\)\), \(2  \[Omega]\)]\)\>\"", "}"}], 
                   "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], " ", "Degree"}]}]}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"2.7", "*", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
             "0.05"}], "]"}], "]"}]}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Te", "|", 
            RowBox[{"xt", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
               "\"\<(\!\(\*SuperscriptBox[\(k\), \
\(\[Omega]\)]\)\!\(\*SubscriptBox[\()\), \(in\)]\)\>\"", ",", "30", ",", 
                RowBox[{
                "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"theta", "*", 
                   RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{"-", "1"}]}], "}"}]}], "]"}]}]}], "*)"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"2.7", "*", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], "}"}], 
             ",", "0.05"}], "]"}], "]"}]}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<(\!\(\*SuperscriptBox[\(k\), \
\(\[Omega]\)]\)\!\(\*SubscriptBox[\()\), \(in\)]\)\>\"", ",", "30", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}],
               "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sin", "[", 
                RowBox[{"theta", "*", 
                 RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
               RowBox[{"Cos", "[", 
                RowBox[{"theta", "*", 
                 RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "*)"}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Graphics3D", "[", 
          RowBox[{"{", 
           RowBox[{"Cyan", ",", 
            RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
            RowBox[{"EdgeForm", "[", "]"}], ",", 
            RowBox[{"HalfPlane", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
          "]"}], ","}], "*)"}], 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.5"}], ",", "2.5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1.5"}], ",", "1.5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.5"}], ",", "2.5"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"ViewPoint", "->", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"-", "5"}], ",", "20"}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"300", ",", "300"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.893351613065701*^9, 3.893351733836023*^9}, {
   3.8933517927322655`*^9, 3.893351794208815*^9}, 3.893354192094846*^9, {
   3.893354237125998*^9, 3.89335425178049*^9}, {3.8933575554088554`*^9, 
   3.893357557751992*^9}, {3.895861448048014*^9, 3.8958614517763233`*^9}, {
   3.895861711419704*^9, 3.8958617116853275`*^9}},
 CellLabel->
  "In[135]:=",ExpressionUUID->"b62bbf99-2ade-4958-85bd-fb423878e6a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fpolarizationplot2d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fpolarizationplot2d", "[", 
   RowBox[{
   "theta_", ",", "phi_", ",", "psi_", ",", "RotatePolarizer_", ",", 
    "RotateAnalyzer_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"AnalyzerBase", ",", "t1", ",", 
      RowBox[{"rtheta", "=", "0.5"}], ",", "\[Eta]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"t1", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"AnalyzerBase", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"2.5", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", 
               RowBox[{"Lab1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", 
               RowBox[{"Lab2", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Arrow", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2.5"}], ",", 
                   RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"1", "*", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2.5"}], ",", 
                   RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], "}"}], 
             "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<p\>\"", ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1", "*", 
              RowBox[{"Lab1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1.5"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<s\>\"", ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1", "*", 
              RowBox[{"Lab2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], "]"}]}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{"Row", "[", 
                RowBox[{
                "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
                "]"}], ",", "22", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
               ",", "Bold"}], "]"}], ",", 
             RowBox[{
              RowBox[{"1.1", "*", 
               RowBox[{"Lab3", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "2.3"}], ",", 
                 RowBox[{"-", "1.3"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "*)"}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotatePolarizer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"-", "1"}]}], "}"}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"45", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \[Omega]\)]\)\>\
\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"Lab1", "[", 
                   RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"rtheta", "*", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                  "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{"rtheta", "*", 
                 RowBox[{
                  RowBox[{"RotationTransform", "[", 
                   RowBox[{"2", "*", 
                    RowBox[{"45", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                  RowBox[{"Lab1", "[", 
                   RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "2"}], ",", "0"}], "}"}]}], "]"}]}], "}"}], 
            "]"}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "0.5"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0.5", ",", "0"}], "}"}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"-", "1"}]}], "}"}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"phi", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \[Omega]\)]\)\>\
\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"Lab1", "[", 
                   RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"phi", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"rtheta", "*", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", 
                    RowBox[{"phi", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", 
                    RowBox[{"phi", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}]}], 
             RowBox[{"(*", 
              RowBox[{",", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"Row", "[", 
                    RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                   "20", ",", 
                   RowBox[{
                   "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                   "Bold"}], "]"}], ",", 
                 RowBox[{"rtheta", "*", 
                  RowBox[{
                   RowBox[{"RotationTransform", "[", 
                    RowBox[{"2", "*", 
                    RowBox[{"phi", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2"}], ",", "0"}], "}"}]}], "]"}]}], "*)"}], 
             "}"}], "]"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotateAnalyzer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"45", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \[Omega]\)]\)(\
\[Psi])\>\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"rtheta", "*", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[Psi]=\[CurlyPhi]\>\"", "}"}], "]"}], 
                  ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{"AnalyzerBase", "+", 
                 RowBox[{"rtheta", "*", 
                  RowBox[{
                   RowBox[{"RotationTransform", "[", 
                    RowBox[{"2", "*", 
                    RowBox[{"45", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "2"}], ",", "0"}], "}"}]}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"45", "+", "90"}], ")"}], " ", "Degree"}]}]}]}], 
                "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                 "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \
\[Omega]\)]\)(\[Psi]+\!\(\*FractionBox[\(\[Pi]\), \(2\)]\))\>\"", ",", "20", 
                  ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"45", "+", "90"}], ")"}], "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"psi", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                 "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \
\[Omega]\)]\)(\[Psi])\>\"", ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"psi", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], " ", "Degree"}]}]}]}], 
                "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \[Omega]\)]\)(\
\[Psi]+\!\(\*FractionBox[\(\[Pi]\), \(2\)]\))\>\"", "}"}], "]"}], ",", "20", 
                  ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1.5"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"rtheta", "*", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}]}], 
             RowBox[{"(*", 
              RowBox[{",", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ToString", "[", "psi", "]"}], ",", 
                    "\"\<SuperscriptBox[\\\\,o]\>\""}], "}"}], "]"}], ",", 
                   "16", ",", 
                   RowBox[{
                   "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                   "Bold"}], "]"}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"rtheta", "*", 
                   RowBox[{
                    RowBox[{"RotationTransform", "[", 
                    RowBox[{"2", "*", 
                    RowBox[{"psi", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1.5"}], ",", 
                   RowBox[{"-", "1"}]}], "}"}], ",", 
                 RowBox[{"Background", "\[Rule]", "None"}]}], "]"}]}], "*)"}],
              "}"}], "]"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{"{", 
           RowBox[{"Orange", ",", 
            RowBox[{"Opacity", "[", "0.2", "]"}], ",", 
            RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
            RowBox[{"HalfPlane", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1.7"}], ",", 
                  RowBox[{"-", "1.7"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"4.5", ",", 
                  RowBox[{"-", "1.5"}]}], "}"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}], ","}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"AspectRatio", "->", "1"}], ","}], "*)"}], 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1.7"}], ",", "4.8"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1.7"}], ",", "1.7"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", 
        RowBox[{"Style", "[", 
         RowBox[{
         "\"\<Polarization Relation\>\"", ",", "\"\<Times New Roman\>\"", ",",
           "20", ",", "Bold", ",", "Black"}], "]"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.893354130499105*^9, 3.893354151994541*^9}, 
   3.893354207904428*^9, {3.893354266779559*^9, 3.8933542842991447`*^9}, {
   3.893354329107746*^9, 3.893354340998518*^9}, {3.8933575346458993`*^9, 
   3.8933575374267936`*^9}, {3.8958614525705757`*^9, 3.895861458193517*^9}, {
   3.895861735759055*^9, 3.895861735962182*^9}, 3.896920990213098*^9, {
   3.896921047963173*^9, 3.8969210537727823`*^9}, {3.896921101472447*^9, 
   3.89692111137949*^9}, {3.896921147286323*^9, 3.896921158954214*^9}, {
   3.896921193849321*^9, 3.89692121707345*^9}, {3.8971795813693604`*^9, 
   3.897179582731943*^9}, {3.8971798159718094`*^9, 3.897179823244879*^9}, {
   3.8971798912684536`*^9, 3.897179917386658*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"66808810-386d-4202-ba22-b2d66e02143c"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Headers in control panel", "Chapter"]], "Chapter",
 CellChangeTimes->{{3.893378748039623*^9, 
  3.893378754589144*^9}},ExpressionUUID->"0abe504e-5574-4ace-ab71-\
ae25b7bbd0e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   StyleBox["header1", "Input"], 
   StyleBox["=", "Input"], 
   RowBox[{
    StyleBox["Row", "Input"], 
    StyleBox["[", "Input"], 
    RowBox[{
     StyleBox["{", "Input"], 
     RowBox[{
      StyleBox[
       RowBox[{"Style", "[", 
        RowBox[{"\"\<   \>\"", ",", "30"}], "]"}], "Input"], 
      StyleBox[",", "Input"], 
      RowBox[{
       StyleBox["Column", "Input"], 
       StyleBox["[", "Input"], 
       RowBox[{
        RowBox[{
         StyleBox["{", "Input"], 
         RowBox[{
          StyleBox[
           RowBox[{"If", "[", 
            RowBox[{"LogoExists", ",", "Logo", ",", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<\[Sharp] SHAARP.ml\>\"", ",", "Bold", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Castellar\>\""}], ",", 
               "70"}], "]"}]}], "]"}], "Input"], ",", "\"\<\>\"", ",", 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<S\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<econd \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<H\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<armonic \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<A\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<nalysis of\>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<A\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<nisotropic \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<R\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<otational \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<P\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<olarimetry\>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\< \>\"", ",", "20"}], "]"}], "Input"]}], 
         StyleBox["}", "Input"]}], 
        StyleBox[",", "Input"], 
        StyleBox[
         RowBox[{"Alignment", "->", "Center"}], "Input"]}], 
       StyleBox["]", "Input"]}], 
      StyleBox[",", "Input"], 
      StyleBox[
       RowBox[{"Style", "[", 
        RowBox[{"\"\<   \>\"", ",", "60"}], "]"}], "Input"], 
      StyleBox[",", "Input"], 
      StyleBox[" ", "Input"], 
      RowBox[{
       StyleBox["Column", "Input"], 
       StyleBox["[", "Input"], 
       RowBox[{
        RowBox[{
         StyleBox["{", "Input"], 
         StyleBox["\[IndentingNewLine]", "Input"], 
         RowBox[{
          RowBox[{
           StyleBox["Style", "Input"], "[", 
           RowBox[{"\"\<Version 1.00\>\"", 
            StyleBox[",", "Input"], 
            StyleBox[" ", "Input"], 
            StyleBox[
             RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], "Input"], 
            StyleBox[",", "Input"], 
            StyleBox["25", "Input"]}], 
           StyleBox["]", "Input"]}], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<\>\"", ",", "8"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<Copyright (C) 2023\>\"", ",", " ", 
             RowBox[{"FontFamily", "->", "\"\<Arial\>\""}], ",", "16"}], 
            "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<\>\"", ",", "8"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<          Bo Wang, Rui Zu, Lincoln Weber, Akash Saha,\\n     \
      Long-Qing Chen, and Venkatraman Gopalan\>\"", ",", " ", 
             RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
             "16"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<\>\"", ",", "15"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Tutorial video:\>\"", ",", 
               RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
               "18"}], "]"}], ",", 
             RowBox[{"Hyperlink", "[", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"\"\< Youtube\>\"", ",", " ", 
                 RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",",
                  "14"}], "]"}], ",", 
               "\"\<https://www.youtube.com/watch?v=YiKRm6i7kNs\>\""}], 
              "]"}]}], "}"}], "]"}], ",", 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
               "\"\<This program comes with ABSOLUTELY NO WARRANTY; for \
details, \>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "18"}], "]"}], ",", 
              RowBox[{"Hyperlink", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<click here\>\"", ",", " ", 
                  RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], 
                  ",", "14"}], "]"}], ",", 
                "\"\<https://www.gnu.org/licenses/gpl-3.0.en.html\>\""}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<.\>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "14"}], "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<This is free software, and you are welcome to redistribute \
it\>\"", ",", " ", 
             RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
             "14"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<under certain conditions; \>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "14"}], "]"}], ",", 
              RowBox[{"Hyperlink", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<click here\>\"", ",", " ", 
                  RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], 
                  ",", "14"}], "]"}], ",", 
                "\"\<https://www.gnu.org/licenses/gpl-3.0.en.html\>\""}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\< for details.\>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "14"}], "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<    \>\"", ",", "20"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<Please properly acknowledge this software.\>\"", ",", "18", 
              ",", "Bold", ",", "Red", ",", 
              RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}]}], 
             "]"}], "}"}], "]"}], ",", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<\>\"", ",", "20"}], "]"}]}], 
         StyleBox["}", "Input"]}], 
        StyleBox[",", "Input"], 
        StyleBox["\[IndentingNewLine]", "Input"], 
        StyleBox[
         RowBox[{"Alignment", "->", "Center"}], "Input"]}], 
       StyleBox["]", "Input"]}]}], 
     StyleBox["}", "Input"]}], 
    StyleBox["]", "Input"]}]}], 
  StyleBox[";", "Input"]}]], "Input",
 CellChangeTimes->{{3.893378762852874*^9, 3.893378767735992*^9}, 
   3.893386144048743*^9, 3.893400663979915*^9, {3.89439942871823*^9, 
   3.8943994303839164`*^9}, {3.894399460720805*^9, 3.8943994617601166`*^9}, {
   3.894399667595615*^9, 3.894399669253433*^9}, 3.894620115259054*^9, {
   3.895413122039782*^9, 3.895413122229064*^9}, {3.895678233359328*^9, 
   3.895678233786956*^9}, {3.895924442845032*^9, 3.895924444015365*^9}, {
   3.8959254726917763`*^9, 3.8959254803629413`*^9}, {3.895932770681795*^9, 
   3.895932797303816*^9}, {3.895937762239341*^9, 3.895937762415495*^9}, {
   3.897265388520641*^9, 3.897265391024664*^9}, {3.897608305304435*^9, 
   3.897608327037682*^9}, {3.897608359030423*^9, 3.897608401168117*^9}, {
   3.89760843309146*^9, 3.897608458285229*^9}, {3.897608500263793*^9, 
   3.89760850096371*^9}},
 CellLabel->
  "In[139]:=",ExpressionUUID->"b2c6d5f6-b19f-4328-a932-26312a25d4dd"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tooltip Explain", "Chapter",
 CellChangeTimes->{{3.895753423866798*^9, 
  3.895753428771045*^9}},ExpressionUUID->"a540b90a-bd51-4e5a-95e3-\
63d41e29e66c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ZSysExplain", "[", "pg_", "]"}], ":=", " ", 
   RowBox[{"Which", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"pg", "==", "\"\<1\>\""}], "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(1\), \(_\)]\)\>\""}]}], 
     ",", "\"\<\!\(\*SubscriptBox[\(Z\), \(3\)]\) is chosen parallel to \
\!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\). \!\(\*SubscriptBox[\(Z\), \(2\)]\) is normal to the \!\(\*StyleBox[\\\"ac\
\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\) plane(010). The \
\!\(\*SubscriptBox[\(Z\), \(1\)]\) lies in (010) plane and is perpendicular \
to \!\(\*SubscriptBox[\(Z\), \(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\).\
\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<2\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<m\>\""}], "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<2/m\>\""}]}], " ", ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(2\)]\) is chosen parallel to \
\!\(\*StyleBox[\\\"b\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\)[010]. \!\(\*SubscriptBox[\(Z\), \(3\)]\) is parallel along \!\(\*StyleBox[\
\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\). \
\!\(\*SubscriptBox[\(Z\), \(1\)]\) is perpendicular to \!\(\*SubscriptBox[\(Z\
\), \(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\).\>\"", ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<mm2\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<222\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<mmm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<23\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<m3\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<432\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<m3m\>\""}]}], ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are parallel to \
\!\(\*StyleBox[\\\"a\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\), \!\(\*StyleBox[\\\"b\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\
\\\"]\) and \!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\
\"Italic\\\"]\).\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<4\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<4mm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<422\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)2m\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<4/m\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<4/mmm\>\""}]}], ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are parallel to \
\!\(\*StyleBox[\\\"a\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\), \!\(\*StyleBox[\\\"b\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\
\\\"]\) and \!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\
\"Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\)(Four-fold axis).\
\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<6\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<6mm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<622\>\""}], "  ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<6/m\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\""}], 
      "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<6/mmm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<3\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<32\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<3m\>\""}], "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)\>\""}], 
      "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)m\>\""}]}], 
     ",", "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\) and \
\!\(\*SubscriptBox[\(Z\), \(3\)]\) are parallel to \
\!\(\*StyleBox[\\\"a\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\)[100]\!\(\*StyleBox[\\\" \
\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\)and \
\!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\)\!\(\*StyleBox[\\\",\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\
\"]\)respectively. \!\(\*SubscriptBox[\(Z\), \(2\)]\) is perpendicular to \
\!\(\*SubscriptBox[\(Z\), \(1\)]\) and \!\(\*SubscriptBox[\(Z\), \
\(3\)]\).\>\"", ",", "\[IndentingNewLine]", "True", ",", 
     "\[IndentingNewLine]", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are arbitrary\>\""}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ZExplain", "[", "pg_", "]"}], ":=", 
   RowBox[{"StringJoin", "[", 
    RowBox[{
    "\"\<Point group : \>\"", ",", "pg", ",", 
     "\"\<\\nThe crystal physics basis vectors must be orthogonal and \
right-handed.\\n\>\"", ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are given in the lab \
coordinate basis \!\(\*SubscriptBox[\(L\), \(1\)]\), \
\!\(\*SubscriptBox[\(L\), \(2\)]\), and \!\(\*SubscriptBox[\(L\), \
\(3\)]\).\\n\>\"", ",", 
     RowBox[{"ZSysExplain", "[", "pg", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PropagationExplain", "=", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<Waves propagation in the system. Red is fundamental light \
(\!\(\*SuperscriptBox[\(\[Lambda]\), \(\[Omega]\)]\)),orange is bound waves \
(inhomogeneous waves at 2\[Omega]), blue is the SHG light \
(\!\(\*SuperscriptBox[\(\[Lambda]\), \(2  \[Omega]\)]\), homogeneous waves at \
2\[Omega]). In this plot, both ordinary and extraordinary wavevctors are \
shown in each layer. The wavevectors are displaced for better \
visability.\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EllipticityExplain", "=", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<The ellipticity plot shows the ellipticity of incident light at \
\[Omega] frequency, corresponding reflected and transmitted light at \
2\[Omega] frequency.\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hklExplain", " ", "=", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<(hkl) refers to Miller indices of planes.\\nIn trigonal and \
hexagonal system, four-indices notation are commonly aplied. (hkl) -> (h k \
-(h+k) l)\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MTIExplain", " ", "=", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<According to MTI notation,\\nX-cut \!\(\*SubscriptBox[\(LiNbO\), \
\(3\)]\) refers to surface plane (110)=(11-20).\\nY-cut (100)=(10-10)\\nZ-cut \
(001)=(0001)\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolarPlotExplain", " ", "=", " ", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<Polar plots as a function of azimuthal angle \[CurlyPhi], \[Psi], \
where \[CurlyPhi], \[Psi] describe incident polarization (\[Omega]) and \
output polarization (2\[Omega]) directions.\\nIn the program, \[Psi] can \
either be set equal to \[CurlyPhi] (Rotate Analyzer tab) or a fixed \
value(Fixed Analyzer tab).\\nTwo polar plots with orthogonal output \
polarizations (\!\(\*SuperscriptBox[\(I\), \(2  \[Omega]\)]\)(\[CurlyPhi],\
\[Psi]) and \!\(\*SuperscriptBox[\(I\), \(2  \
\[Omega]\)]\)(\[CurlyPhi],\[Psi]+\!\(\*FractionBox[\(\[Pi]\), \(2\)]\))) are \
given to reveal the full anisotropy.\>\"", ",", "\"\<Times New Roman\>\"", 
     ",", "20"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GeometryExplain", " ", "=", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<Orange plane: Surface plane; Blue plane: Plane of incidence; \
\!\(\*SuperscriptBox[\(k\), \(\[Omega]\)]\): Incident wave vector; \
\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \(2\)]\) and \!\
\(\*SubscriptBox[\(Z\), \(3\)]\): Crystal physcis coordinates; \
\!\(\*SubscriptBox[\(L\), \(1\)]\), \!\(\*SubscriptBox[\(L\), \(2\)]\) and \!\
\(\*SubscriptBox[\(L\), \(3\)]\): Lab coordinates;\>\"", ",", 
     "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Plot2RealnExplain", " ", "=", " ", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<1 and 2 refer to two Eigen refractive indices. One is ordinary \
(remains the same value as a function of incident angle) and the other is \
extraordinary (varies as a function of incident angle).\>\"", ",", 
     "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PresetExplain", " ", "=", 
   RowBox[{"Style", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<Presets currently set:   \>\"", "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval1", "]"}], ",", "\"\<1   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval2", "]"}], ",", "\"\<2   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval3", "]"}], ",", "\"\<3   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval4", "]"}], ",", "\"\<4   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ValueQ", "[", "presetval1", "]"}], "\[Or]", 
         RowBox[{"ValueQ", "[", "presetval2", "]"}], "\[Or]", 
         RowBox[{"ValueQ", "[", "presetval3", "]"}], "\[Or]", 
         RowBox[{"ValueQ", "[", "presetval4", "]"}]}], ",", "\"\<\>\"", ",", 
        "\"\<None.\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
      "\"\<\\nUpdate and press any of the preset buttons to save a material's \
\\ninformation to that preset. \\nPress the button again and update to apply \
those values.\\nHide and show this message to refresh.\>\""}], 
     "\[IndentingNewLine]", ",", "\"\<Times New Roman\>\"", ",", "12"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\"\<setup done\>\"", ";"}]}], "Input",
 CellChangeTimes->{{3.895753455927518*^9, 3.895753460362939*^9}, 
   3.895753724764985*^9, 3.895753805346786*^9, 3.895753947698242*^9, {
   3.895754020338092*^9, 3.8957541571157627`*^9}, {3.895754263548226*^9, 
   3.895754293951646*^9}, {3.895754405060065*^9, 3.895754422062916*^9}, {
   3.895754466282419*^9, 3.89575460541528*^9}, {3.8957546362160387`*^9, 
   3.895754739305148*^9}, {3.895754940688539*^9, 3.895754943614787*^9}, {
   3.895757709731511*^9, 3.8957578858615713`*^9}, {3.895757948427687*^9, 
   3.8957579756775875`*^9}, {3.895758007950823*^9, 3.895758129076806*^9}, {
   3.895758176453224*^9, 3.895758181152631*^9}, {3.895838739342277*^9, 
   3.895838774117*^9}, {3.895838825604836*^9, 3.8958388266829586`*^9}, {
   3.897179604898064*^9, 3.897179682597183*^9}, {3.8973364959124804`*^9, 
   3.8973365157230015`*^9}, {3.8973365535400686`*^9, 3.897336574422712*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"eb90e4c9-dab8-4c3b-9305-4612cbb54fac"]
}, Closed]]
}, Open  ]]
},
WindowSize->{718.5, 735.75},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
DockedCells->{},
TaggingRules-><|"TryRealOnly" -> False|>,
Magnification:>0.9 Inherited,
FrontEndVersion->"14.0 for Microsoft Windows (64-bit) (December 12, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"40d7173d-3bfa-425c-8bd7-c438af42d0d7"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 10042, 196, 608, "Input",ExpressionUUID->"ed974761-9dcc-4ef1-9668-ef13d8042673"],
Cell[CellGroupData[{
Cell[10625, 220, 497, 7, 88, "Title",ExpressionUUID->"88d8a200-e326-437a-a2b1-0a7877842aa5"],
Cell[11125, 229, 8132, 174, 591, "Input",ExpressionUUID->"51b750df-eb29-443b-bf24-7fd7f2ec808e"],
Cell[19260, 405, 557, 9, 43, "Input",ExpressionUUID->"c90f9cda-7762-43b7-9062-eed522c003c5"]
}, Closed]],
Cell[CellGroupData[{
Cell[19854, 419, 209, 4, 65, "Title",ExpressionUUID->"2da296c2-29d5-4aef-b5be-57b13251ffe6"],
Cell[CellGroupData[{
Cell[20088, 427, 164, 3, 62, "Chapter",ExpressionUUID->"9aede281-19c4-4f37-b5d7-bf6c4ce47068"],
Cell[20255, 432, 5242, 137, 231, "Input",ExpressionUUID->"14f2bc0a-ec4e-4c7b-9794-7aa3b3a234d3"],
Cell[25500, 571, 11885, 263, 676, "Input",ExpressionUUID->"05d4e82c-14bc-4894-b398-d36d23b22167"],
Cell[37388, 836, 3005, 75, 231, "Input",ExpressionUUID->"24039ff0-d77e-4d2b-8ea7-48805393bf98"],
Cell[40396, 913, 4750, 104, 214, "Input",ExpressionUUID->"03473d21-890c-40c2-aa2c-6155a0c7e300"],
Cell[45149, 1019, 7916, 204, 574, "Input",ExpressionUUID->"f1fff8d2-bdfa-4a84-abc8-6acb06a5406e"]
}, Closed]],
Cell[CellGroupData[{
Cell[53102, 1228, 161, 3, 52, "Chapter",ExpressionUUID->"f675d733-5e58-4b94-9785-948947b52d1d"],
Cell[53266, 1233, 7864, 172, 446, "Input",ExpressionUUID->"6901761b-5a2a-4c42-9da7-8a0b80534fbd"],
Cell[61133, 1407, 6174, 150, 480, "Input",ExpressionUUID->"adb0f516-59df-4b0f-a7ad-3612735eacfa"],
Cell[67310, 1559, 6253, 152, 500, "Input",ExpressionUUID->"423403c9-ffce-4ced-b379-9ac057f69afe"],
Cell[73566, 1713, 8056, 180, 480, "Input",ExpressionUUID->"3eb09a4c-65d5-4c80-a5a5-6df6f7eacfd7"],
Cell[81625, 1895, 16088, 408, 818, "Input",ExpressionUUID->"ffe736ff-305b-4fe9-b58a-df11515970fb"],
Cell[97716, 2305, 13757, 359, 765, "Input",ExpressionUUID->"eda09f38-171f-486c-861e-2ef0036d1ecf"],
Cell[111476, 2666, 9399, 237, 563, "Input",ExpressionUUID->"282025b0-d1ba-4d84-aa03-7c5c8beff868"],
Cell[120878, 2905, 9398, 238, 563, "Input",ExpressionUUID->"a2056cca-1ec8-4bef-8b38-d6985ff4b1e4"],
Cell[130279, 3145, 9491, 231, 634, "Input",ExpressionUUID->"9981114f-ed8d-496c-a589-3cac37e71ab9"],
Cell[139773, 3378, 9405, 233, 631, "Input",ExpressionUUID->"a377865e-d91b-4b72-bcbc-7ba18c1e943b"],
Cell[149181, 3613, 6567, 157, 463, "Input",ExpressionUUID->"aa7e4467-99fe-495d-8e26-34dab5319814"],
Cell[155751, 3772, 8151, 193, 531, "Input",ExpressionUUID->"c6b72c7a-8011-4118-b60d-4c51f1e44794"],
Cell[163905, 3967, 19474, 484, 898, "Input",ExpressionUUID->"346979b3-54f5-4a44-b833-82392ea2670b"],
Cell[183382, 4453, 6615, 159, 480, "Input",ExpressionUUID->"d3f1f024-15ad-4152-8c84-cca002cb4693"],
Cell[190000, 4614, 7960, 200, 610, "Input",ExpressionUUID->"e656aca1-870f-40c0-9b93-4b128951c607"],
Cell[197963, 4816, 8143, 203, 610, "Input",ExpressionUUID->"66978982-1041-49f3-aa3e-da692dc3a573"],
Cell[206109, 5021, 8222, 197, 668, "Input",ExpressionUUID->"35dcb8f3-79e8-43ac-af55-cb7fe16d27e0"],
Cell[214334, 5220, 6768, 161, 566, "Input",ExpressionUUID->"f020739b-0177-430b-bd1b-e2d44d46dc07"],
Cell[221105, 5383, 8645, 188, 483, "Input",ExpressionUUID->"189a9a34-e96d-4c88-b4fb-962a05f5a3ae"]
}, Open  ]],
Cell[CellGroupData[{
Cell[229787, 5576, 256, 4, 62, "Chapter",ExpressionUUID->"6c361ee8-c60a-4774-93ea-8e8a4864c6a7"],
Cell[230046, 5582, 2702, 53, 59, "Input",ExpressionUUID->"b6ae3fa6-73c0-476f-92c5-395265f1e96b"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[232797, 5641, 215, 4, 65, "Title",ExpressionUUID->"1a7c80c2-7a75-461d-b5f3-4f54257b8e10"],
Cell[CellGroupData[{
Cell[233037, 5649, 434, 6, 62, "Chapter",ExpressionUUID->"ba179bfb-303a-47b6-8653-fccc4defc35a"],
Cell[233474, 5657, 75580, 1623, 4388, "Input",ExpressionUUID->"97649922-01c2-4c2d-bfce-4d5a98b082b0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[309091, 7285, 318, 5, 62, "Chapter",ExpressionUUID->"5b8a343e-1607-4b4e-83d0-2845b6a33fb9"],
Cell[309412, 7292, 13186, 292, 882, "Input",ExpressionUUID->"39d1645c-06da-4289-ab26-9fba6e886f8f"],
Cell[322601, 7586, 26165, 537, 1001, "Input",ExpressionUUID->"7ebd4447-fc3c-4eb0-9e76-dd514f64b86e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[348803, 8128, 370, 6, 62, "Chapter",ExpressionUUID->"9a9bd620-7b4a-46b2-9824-74024f07f572"],
Cell[349176, 8136, 2705, 73, 128, "Input",ExpressionUUID->"8ad8b392-0009-4cba-81ca-2369903c7c44"],
Cell[351884, 8211, 67243, 1544, 4130, "Input",ExpressionUUID->"e7e53672-7a55-40ac-b67a-b6ba1f919ac7"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[419176, 9761, 220, 4, 88, "Title",ExpressionUUID->"aa85a36c-2768-4639-8d0e-decaa9e87b85"],
Cell[CellGroupData[{
Cell[419421, 9769, 593, 9, 62, "Chapter",ExpressionUUID->"8eefb35c-18b2-43e7-8ef4-d903250f5053"],
Cell[420017, 9780, 7056, 149, 522, "Input",ExpressionUUID->"4041f397-63fa-4a4c-b9ff-708b0870e6b7"],
Cell[427076, 9931, 21409, 418, 1156, "Input",ExpressionUUID->"8049ebf4-e382-440c-9e43-393236a21c0e"]
}, Closed]],
Cell[CellGroupData[{
Cell[448522, 10354, 383, 6, 52, "Chapter",ExpressionUUID->"da61b590-48e7-40ee-a0f3-2608c5196b8b"],
Cell[448908, 10362, 45635, 990, 2166, "Input",ExpressionUUID->"5fa0cc44-7388-47c7-b179-75ce38116667"],
Cell[494546, 11354, 75503, 1796, 3279, "Input",ExpressionUUID->"b3fd9750-a54b-4182-8c39-820f6425e529"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[570098, 13156, 226, 4, 64, "Title",ExpressionUUID->"9042ff58-e452-4ecb-88e6-13f19a0537e6"],
Cell[CellGroupData[{
Cell[570349, 13164, 191, 3, 62, "Chapter",ExpressionUUID->"1ec80b5a-86c5-422b-a529-432dbf698fdd"],
Cell[570543, 13169, 13499, 331, 659, "Input",ExpressionUUID->"94e87d36-2b94-458c-9d74-6870a346fef5"],
Cell[584045, 13502, 1648, 37, 265, "Input",ExpressionUUID->"ad125409-1df9-479b-8433-6fee9c508f3e"],
Cell[585696, 13541, 40104, 936, 2845, "Input",ExpressionUUID->"d9ded69a-2a0e-4e42-9380-ffecf28be5f8"],
Cell[625803, 14479, 36569, 872, 2845, "Input",ExpressionUUID->"10446bcd-584a-48a4-8540-2d9a165131e4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[662409, 15356, 174, 3, 52, "Chapter",ExpressionUUID->"7bda4879-c1f5-4657-b1f0-1d230c3921d8"],
Cell[662586, 15361, 10777, 257, 813, "Input",ExpressionUUID->"2230f45f-45b4-4d76-8d79-23f7995e3866"]
}, Open  ]],
Cell[CellGroupData[{
Cell[673400, 15623, 185, 3, 62, "Chapter",ExpressionUUID->"feeeed14-16c8-4403-a121-6d703a0e1425"],
Cell[673588, 15628, 21464, 523, 684, "Input",ExpressionUUID->"8826940e-c654-46fe-990e-f7d58f72b8c5"],
Cell[695055, 16153, 16999, 456, 469, "Input",ExpressionUUID->"430fb27d-99f8-41d5-8a4a-835e12847cce"],
Cell[712057, 16611, 10868, 289, 452, "Input",ExpressionUUID->"e2b0f133-3c5e-4178-b645-c608c913bf9b"],
Cell[722928, 16902, 26058, 649, 828, "Input",ExpressionUUID->"979d47e3-561f-4f83-b76c-7bb5f3fb996d"],
Cell[748989, 17553, 8482, 222, 333, "Input",ExpressionUUID->"f5aa71d2-e846-4c4f-aa94-bff7bcb05b8d"],
Cell[757474, 17777, 64013, 1486, 2109, "Input",ExpressionUUID->"b62bbf99-2ade-4958-85bd-fb423878e6a3"],
Cell[821490, 19265, 50517, 1170, 1584, "Input",ExpressionUUID->"66808810-386d-4202-ba22-b2d66e02143c"]
}, Closed]],
Cell[CellGroupData[{
Cell[872044, 20440, 200, 3, 52, "Chapter",ExpressionUUID->"0abe504e-5574-4ace-ab71-ae25b7bbd0e7"],
Cell[872247, 20445, 11285, 261, 453, "Input",ExpressionUUID->"b2c6d5f6-b19f-4328-a932-26312a25d4dd"]
}, Closed]],
Cell[CellGroupData[{
Cell[883569, 20711, 160, 3, 52, "Chapter",ExpressionUUID->"a540b90a-bd51-4e5a-95e3-63d41e29e66c"],
Cell[883732, 20716, 12051, 228, 1233, "Input",ExpressionUUID->"eb90e4c9-dab8-4c3b-9305-4612cbb54fac"]
}, Closed]]
}, Open  ]]
}
]
*)

