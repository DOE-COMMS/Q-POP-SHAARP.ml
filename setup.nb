(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    886991,      20724]
NotebookOptionsPosition[    879373,      20605]
NotebookOutlinePosition[    879863,      20624]
CellTagsIndexPosition[    879820,      20621]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Protect", " ", "the", " ", "keys", " ", "for", " ", "all", " ", 
    "associations"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Unprotect", "[", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "latcon", ",", "\[Omega]", 
      ",", "k", ",", "k0", ",", "\[Theta]", ",", "EE", ",", "H", ",", "neff", 
      ",", "n\[Omega]", ",", "n2\[Omega]", ",", "\[CurlyEpsilon]\[Omega]C", 
      ",", "\[CurlyEpsilon]2\[Omega]C", ",", "\[CurlyEpsilon]\[Omega]L", ",", 
      "\[CurlyEpsilon]\[Omega]2L", ",", "\[CurlyEpsilon]\[Omega]P", ",", 
      "\[CurlyEpsilon]\[Omega]2P", ",", "QP\[Omega]", ",", "QP2\[Omega]", ",",
       "QC", ",", "t", ",", "x", ",", "y", ",", "z", ",", "phase", ",", 
      "intensity", ",", "dL", ",", "dC", ",", "h", ",", "S"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Protect", "[", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "latcon", ",", "\[Omega]", 
      ",", "k", ",", "k0", ",", "\[Theta]", ",", "EE", ",", "H", ",", "neff", 
      ",", "n\[Omega]", ",", "n2\[Omega]", ",", "\[CurlyEpsilon]\[Omega]C", 
      ",", "\[CurlyEpsilon]2\[Omega]C", ",", "\[CurlyEpsilon]\[Omega]L", ",", 
      "\[CurlyEpsilon]\[Omega]2L", ",", "\[CurlyEpsilon]\[Omega]P", ",", 
      "\[CurlyEpsilon]\[Omega]2P", ",", "QP\[Omega]", ",", "QP2\[Omega]", ",",
       "QC", ",", "t", ",", "x", ",", "y", ",", "z", ",", "phase", ",", 
      "intensity", ",", "dL", ",", "dC", ",", "h", ",", "S"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Meaning", " ", "of", " ", 
       RowBox[{"symbols", ":"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]", " ", "-", " ", 
       RowBox[{"wave", " ", "frequency"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"k", " ", "-", " ", 
       RowBox[{"wave", " ", "vector"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"k0", " ", "-", " ", 
       RowBox[{"wave", " ", "vector", " ", "amplitude"}]}], ";", " ", 
      RowBox[{"may", " ", "be", " ", "complex", " ", "scalar"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", " ", "-", " ", 
       RowBox[{"wave", " ", "angle"}]}], ";", " ", 
      RowBox[{"may", " ", "be", " ", "complex", " ", "scalar"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"H", " ", "-", " ", 
       RowBox[{"magnetic", " ", "field", " ", "of", " ", "waves"}]}], ";", 
      "\[IndentingNewLine]", "n\[Omega]"}], ",", 
     RowBox[{
      RowBox[{"n2\[Omega]", " ", "-", " ", 
       RowBox[{
       "refractive", " ", "indices", " ", "of", " ", "\[Omega]", " ", "and", 
        " ", "2", "\[Omega]", " ", "waves", " ", "in", " ", "Principal", " ", 
        "coordinates", " ", "of", " ", "a", " ", "material"}]}], ";", " ", 
      RowBox[{
       RowBox[{"so", " ", "they", " ", "are", " ", "3"}], "-", "tuples"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"neff", " ", "-", " ", 
       RowBox[{
       "effective", " ", "refractive", " ", "index", " ", "of", " ", "the", 
        " ", "wave", " ", "in", " ", "the", " ", "mater"}]}], ";", " ", 
      RowBox[{
      "it", " ", "is", " ", "an", " ", "attribute", " ", "of", " ", "the", 
       " ", "wave"}]}], ",", " ", 
     RowBox[{
      RowBox[{"not", " ", "the", " ", 
       RowBox[{"mater", "!"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"c", " ", "-", " ", 
       RowBox[{
       "effective", " ", "refractive", " ", "index", " ", "of", " ", "a", " ",
         "wave"}]}], ";", " ", 
      RowBox[{"it", " ", "is", " ", "scalar"}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"EE", " ", "-", " ", 
       RowBox[{"the", " ", "electric", " ", "field", " ", "vector"}]}], ";", 
      "\[IndentingNewLine]", "\[CurlyEpsilon]\[Omega]C"}], ",", 
     RowBox[{
      RowBox[{"\[CurlyEpsilon]2\[Omega]C", " ", "-", " ", 
       RowBox[{
       "the", " ", "relative", " ", "dielectric", " ", "tensors", " ", 
        "expressed", " ", "in", " ", "the", " ", "Crystal", " ", "physics", 
        " ", "coordinate", " ", "system"}]}], ";", " ", "\[IndentingNewLine]",
       "\[CurlyEpsilon]\[Omega]P"}], ",", 
     RowBox[{
      RowBox[{"\[CurlyEpsilon]2\[Omega]P", " ", "-", " ", 
       RowBox[{
       "the", " ", "relative", " ", "dielectric", " ", "tensors", " ", 
        "expressed", " ", "in", " ", "the", " ", "Principal", " ", 
        "coordinate", " ", "system"}]}], ";", " ", 
      RowBox[{
      "they", " ", "are", " ", "the", " ", "same", " ", "as", " ", "Crystal", 
       " ", "physics", " ", "coordinate", " ", "except", " ", "for", " ", 
       RowBox[{"monoclinic", "/", "triclinic"}], " ", "crystal", " ", 
       "systems"}], ";", "\[IndentingNewLine]", "\[CurlyEpsilon]\[Omega]L"}], 
     ",", 
     RowBox[{
      RowBox[{"\[CurlyEpsilon]\[Omega]2L", " ", "-", " ", 
       RowBox[{
       "the", " ", "relative", " ", "dielectric", " ", "tensors", " ", 
        "expressed", " ", "in", " ", "the", " ", "Lab", " ", "coordinate", 
        " ", "system"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"QP", " ", "-", " ", 
       RowBox[{
       "the", " ", "rotation", " ", "matrix", " ", "from", " ", "Principal", 
        " ", "to", " ", "Lab"}]}], ";", " ", 
      RowBox[{"for", " ", "eigenvalue", " ", "problem", " ", "of", " ", 
       RowBox[{"Snell", "'"}], "s", " ", "law", " ", "only"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"QC", " ", "-", " ", 
       RowBox[{
       "the", " ", "rotation", " ", "matrix", " ", "from", " ", "Crystal", 
        " ", "physics", " ", "to", " ", "Lab"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"A", " ", "-", " ", 
       RowBox[{
       "the", " ", "electric", " ", "field", " ", "vector", " ", "of", " ", 
        "a", " ", "wave", " ", "expressed", " ", "in", " ", "a", " ", "the", 
        " ", "analyzer", " ", "plane", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"z", "//", 
           RowBox[{"k", " ", "vector"}]}], ",", " ", 
          RowBox[{"y", "//", 
           RowBox[{"y", " ", "of", " ", "Lab"}]}], ",", " ", 
          RowBox[{
          "x", " ", "in", " ", "the", " ", "plane", " ", "of", " ", 
           "incidence"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "x"}], ",",
      "y", ",", 
     RowBox[{
      RowBox[{"z", " ", "-", " ", 
       RowBox[{
       "for", " ", "denoting", " ", "the", " ", "lab", " ", "coordinate", " ",
         "system", " ", "directions"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"phase", " ", "-", " ", 
       RowBox[{"phase", " ", "term", " ", "of", " ", "the", " ", "wave"}]}], 
      ";", " ", "\[IndentingNewLine]", 
      RowBox[{"dL", " ", "-", " ", 
       RowBox[{
       "SHG", " ", "tensor", " ", "d", " ", "expressed", " ", "in", " ", 
        "the", " ", "Lab", " ", "coordiante", " ", "system"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"dC", " ", "-", " ", 
       RowBox[{
       "SHG", " ", "tensor", " ", "d", " ", "expressed", " ", "in", " ", 
        "the", " ", "Crystal", " ", "physics", " ", "coordinate", " ", 
        "system"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"h", " ", "-", " ", 
       RowBox[{"thickness", " ", "of", " ", "a", " ", "layer"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"S", " ", "-", " ", 
       RowBox[{"Poynting", " ", "vector"}]}], ";"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"For", " ", "details", " ", "of", " ", "the", " ", "theory"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"please", " ", "refer", " ", 
       RowBox[{"to", ":", " ", "https", ":"}]}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{"arxiv", ".", "org"}], "/", "abs"}], "/", "2307.01368"}]}]}], 
    " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.8356509661036606`*^9, 3.835650972264577*^9}, {
   3.836899627764406*^9, 3.8368996812769423`*^9}, 3.8369104479078836`*^9, {
   3.8369264363939457`*^9, 3.8369264480375795`*^9}, {3.8369264854751463`*^9, 
   3.8369265012038774`*^9}, {3.836926551233517*^9, 3.8369265552462273`*^9}, {
   3.836930097356699*^9, 3.8369301002950864`*^9}, {3.8378083270891457`*^9, 
   3.837808341193586*^9}, {3.8378101691240525`*^9, 3.8378101811422915`*^9}, {
   3.8378949639554405`*^9, 3.837894997571883*^9}, {3.8544893542856627`*^9, 
   3.8544893696652365`*^9}, {3.8544906269849896`*^9, 
   3.8544907297335153`*^9}, {3.8544915241707525`*^9, 3.85449183857032*^9}, {
   3.8863631331198545`*^9, 3.8863631524818416`*^9}, {3.886364070564902*^9, 
   3.886364074945816*^9}, {3.8864497322939043`*^9, 3.8864497352770205`*^9}, 
   3.8878505870971856`*^9, 3.887853250132854*^9, {3.88852297680593*^9, 
   3.888522979622653*^9}, {3.8890074909873543`*^9, 3.8890074948019404`*^9}, {
   3.8890137184531155`*^9, 3.8890137257649117`*^9}, 3.8890137692659626`*^9, {
   3.889014376267557*^9, 3.889014388706135*^9}, {3.889016555379466*^9, 
   3.8890165630903597`*^9}, {3.8933352279945097`*^9, 3.89333525191485*^9}, {
   3.89335182604932*^9, 3.8933518327347283`*^9}, {3.893352855940297*^9, 
   3.89335285631689*^9}, {3.8946722534426975`*^9, 3.89467225982658*^9}, 
   3.895837464665057*^9, {3.895838206947111*^9, 3.89583820761733*^9}, {
   3.895861657636712*^9, 3.895861660410586*^9}, {3.895861789447469*^9, 
   3.8958618338382597`*^9}, {3.895861866473256*^9, 3.895861872762532*^9}, {
   3.8958620149730306`*^9, 3.8958621341288276`*^9}, {3.89744081899312*^9, 
   3.8974409025597095`*^9}, {3.8974409518747225`*^9, 
   3.8974410747403545`*^9}, {3.897441508388521*^9, 3.8974415213363647`*^9}, {
   3.8974415774065833`*^9, 3.8974416332604694`*^9}, {3.89760816659741*^9, 
   3.897608189552846*^9}, {3.89785473503031*^9, 3.8978547383911314`*^9}, {
   3.8978583502257385`*^9, 3.8978583895232153`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"ed974761-9dcc-4ef1-9668-ef13d8042673"],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Constants and control flags", "Title"]], "Title",
 CellChangeTimes->{{3.8368559613446956`*^9, 3.8368559621411257`*^9}, {
  3.8383214278716197`*^9, 3.838321433324609*^9}, {3.8383739872383795`*^9, 
  3.838373987747495*^9}, {3.8426186181304803`*^9, 3.8426186213708715`*^9}, {
  3.854489238595169*^9, 3.854489239418007*^9}, {3.8960569501829157`*^9, 
  3.896056952861331*^9}, {3.897174243059548*^9, 
  3.8971742607882786`*^9}},ExpressionUUID->"88d8a200-e326-437a-a2b1-\
0a7877842aa5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Before", " ", "normalization"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"n0", "=", "1"}], ";", "\[IndentingNewLine]", 
    RowBox[{"c0", "=", 
     RowBox[{"2.998", "*", 
      SuperscriptBox["10", "8"]}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"m", "/", "s"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[CurlyEpsilon]0", "=", 
     RowBox[{"8.854", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "12"}]]}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"C", "/", 
      RowBox[{"(", 
       RowBox[{"m", " ", "V"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[Mu]0", "=", 
     RowBox[{"1.2566", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"N", "/", 
      RowBox[{"A", "^", "2"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[Lambda]0", "=", 
     RowBox[{"0.8", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}]}], ";", " ", 
    RowBox[{"(*", "m", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"dSI", "=", "1"}], 
    RowBox[{"(*", 
     SuperscriptBox["10", 
      RowBox[{"-", "6"}]], "*)"}], ";", "\[IndentingNewLine]", 
    RowBox[{"\[Omega]0", "=", 
     RowBox[{"2", "Pi", " ", 
      RowBox[{"c0", "/", 
       RowBox[{"(", "\[Lambda]0", ")"}]}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"E0", "=", "1"}], 
    RowBox[{"(*", 
     RowBox[{
      SuperscriptBox["10", "6"], " ", 
      RowBox[{"V", "/", "m"}]}], "*)"}], ";"}], "*)"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"After", " ", "normalization"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Lambda]0", "=", "0.8"}], ";"}], 
   RowBox[{"(*", "\[Mu]m", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n0", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"c0", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Omega]0", "=", 
     RowBox[{"N", "@", 
      RowBox[{"(", 
       RowBox[{"2", " ", "Pi", " ", 
        RowBox[{"c0", "/", "\[Lambda]0"}]}], ")"}]}]}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Mu]0", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CurlyEpsilon]0", "=", "1"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Lab1", " ", "=", 
     RowBox[{"{", 
      RowBox[{"1", " ", ",", "0", ",", "0"}], "}"}]}], ";", "    ", 
    RowBox[{"Lab2", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", "    ", 
    RowBox[{"Lab3", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rotationAngle", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"so", " ", "E0"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"10", "^", "12"}], " ", 
      RowBox[{"V", "/", "m"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"dSI", "=", "1"}], ";"}], " ", "*)"}], 
   RowBox[{"(*", 
    RowBox[{"so", " ", "d", " ", "coefficients", " ", 
     RowBox[{"pm", "/", "V"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"eigenStandard", "=", "True"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Change", " ", "how", " ", "the", " ", "eigensystem", " ", "is", " ", 
       "evaluated"}], ";", " ", 
      RowBox[{"True", " ", "for", " ", "standard", " ", "EVP"}], ";", " ", 
      RowBox[{"False", " ", "for", " ", "generalized", " ", "EVP"}], ";", " ", 
      RowBox[{
      "Depending", " ", "on", " ", "whether", " ", "the", " ", "dielectric", 
       " ", "tensor", " ", "has", " ", "imaginary", " ", "part"}]}], ",", " ", 
     RowBox[{"i", ".", "e", "."}], ",", " ", 
     RowBox[{"absorption", ";", " ", 
      RowBox[{"if", " ", "so"}]}], ",", " ", 
     RowBox[{"use", " ", "False"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagBackward", "=", "True"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagHorizPhaseShift", "=", "False"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"debug", "=", "False"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagLinearSolve", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagNSolve", "=", "True"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"noAnalytical", "=", "True"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagStandingWave", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagJK", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"flagHH", "=", "False"}], ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.838130262356327*^9, {3.838399443573641*^9, 3.838399449152543*^9}, {
   3.838844461927244*^9, 3.8388444968996363`*^9}, {3.842013437480895*^9, 
   3.842013460996214*^9}, {3.842013528721349*^9, 3.842013580350273*^9}, {
   3.842014153628293*^9, 3.8420141821752167`*^9}, {3.8420149311463385`*^9, 
   3.842014934466958*^9}, {3.8420150367677603`*^9, 3.8420150379097414`*^9}, {
   3.842015145392124*^9, 3.8420151471650653`*^9}, 3.8420151934681444`*^9, 
   3.8420153150039344`*^9, {3.8420156304576197`*^9, 3.8420156753138638`*^9}, {
   3.842016130052949*^9, 3.8420161323549547`*^9}, {3.842016372048893*^9, 
   3.8420163772103586`*^9}, {3.8426097896716337`*^9, 3.842609792957*^9}, {
   3.842609854543292*^9, 3.8426098693510065`*^9}, {3.8426109638390026`*^9, 
   3.842610987054261*^9}, {3.8426127492754607`*^9, 3.8426127501148853`*^9}, {
   3.842613448167435*^9, 3.8426134661523905`*^9}, {3.842613672424838*^9, 
   3.8426136817515163`*^9}, {3.8426137264830885`*^9, 3.842613727104783*^9}, {
   3.8426150948388963`*^9, 3.842615095744261*^9}, 3.8426152863763256`*^9, {
   3.842615353554594*^9, 3.842615353781355*^9}, {3.842621857670888*^9, 
   3.8426218936561394`*^9}, 3.8426466092684426`*^9, {3.842646643245229*^9, 
   3.8426466465636024`*^9}, {3.842646908750248*^9, 3.8426469494842033`*^9}, {
   3.8426497555529013`*^9, 3.8426497628320775`*^9}, {3.8426497949729395`*^9, 
   3.8426498171737456`*^9}, {3.8426506510958557`*^9, 3.84265065120641*^9}, 
   3.8426550592492504`*^9, {3.8426557991040163`*^9, 3.842655799678192*^9}, {
   3.8428154389579287`*^9, 3.842815443988274*^9}, {3.8441586345111666`*^9, 
   3.844158643444953*^9}, {3.8441587574034977`*^9, 3.844158763785598*^9}, {
   3.845062922835438*^9, 3.8450629247614017`*^9}, {3.8450647546115913`*^9, 
   3.8450647580364733`*^9}, {3.8452888764183474`*^9, 3.845288880023301*^9}, 
   3.8452889139987965`*^9, {3.854489569254717*^9, 3.8544897709426823`*^9}, {
   3.8852152050192747`*^9, 3.8852152421306763`*^9}, {3.885592606654632*^9, 
   3.885592610119428*^9}, {3.8855932781565924`*^9, 3.885593295639739*^9}, {
   3.885593343343672*^9, 3.8855933437631655`*^9}, {3.8856884573808146`*^9, 
   3.885688458057515*^9}, {3.8863626029852486`*^9, 3.886362607165965*^9}, {
   3.887930061360459*^9, 3.887930065892145*^9}, {3.892462386605009*^9, 
   3.8924623871051717`*^9}, {3.8924908863873606`*^9, 
   3.8924908969917927`*^9}, {3.892501957694131*^9, 3.8925019627661834`*^9}, {
   3.892502169323886*^9, 3.892502221865057*^9}, {3.8936961551206703`*^9, 
   3.89369616052936*^9}, {3.8945886493625116`*^9, 3.894588649691876*^9}, {
   3.8945910914458895`*^9, 3.8945910944761295`*^9}, 3.8946720364429455`*^9, {
   3.8958610895449142`*^9, 3.8958610924039154`*^9}, {3.8958811607203293`*^9, 
   3.8958811645635753`*^9}, {3.8960451372528257`*^9, 3.896045172625966*^9}, {
   3.896045204650752*^9, 3.896045206875878*^9}, {3.896056932304902*^9, 
   3.8960569409166665`*^9}, {3.8960963428703184`*^9, 3.896096347301057*^9}, {
   3.8961063273330436`*^9, 3.8961063278993163`*^9}, {3.896655723288972*^9, 
   3.896655723883175*^9}, {3.8971063278488784`*^9, 3.897106331030901*^9}, {
   3.8971729687155313`*^9, 3.897172969096471*^9}, {3.907542861987129*^9, 
   3.9075428707471733`*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"51b750df-eb29-443b-bf24-7fd7f2ec808e"],

Cell[BoxData[{
 RowBox[{"Off", "[", 
  RowBox[{"PolynomialGCD", "::", "lrgexp"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Off", "[", 
  RowBox[{"General", "::", "munfl"}], "]"}]}], "Input",
 CellChangeTimes->{{3.845064855331528*^9, 3.845064862912162*^9}, {
   3.845064899396927*^9, 3.8450649045548077`*^9}, {3.845065138511583*^9, 
   3.845065150046914*^9}, {3.893714713369342*^9, 3.8937147234706182`*^9}, 
   3.895884973595166*^9, {3.897174220343539*^9, 3.8971742204883456`*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"c90f9cda-7762-43b7-9062-eed522c003c5"]
}, Closed]],

Cell[CellGroupData[{

Cell["Setup functions", "Title",
 CellChangeTimes->{{3.8544890148642817`*^9, 3.854489031571971*^9}, {
  3.897174164867919*^9, 
  3.8971741758568954`*^9}},ExpressionUUID->"2da296c2-29d5-4aef-b5be-\
57b13251ffe6"],

Cell[CellGroupData[{

Cell["Auxiliary functions", "Chapter",
 CellChangeTimes->{{3.8450629875483713`*^9, 
  3.845062996557543*^9}},ExpressionUUID->"9aede281-19c4-4f37-b5d7-\
bf6c4ce47068"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"m2t3", ",", "t2m3"}], "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "matrix", " ", "notation", " ", "to", " ", "tensor", " ", "for", " ", 
     "tensor", " ", "of", " ", "rank", " ", "3"}], ",", " ", "m2t3"}], "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "tensor", " ", "to", " ", "matrix", " ", "notation", " ", "for", " ", 
     "tensor", " ", "of", " ", "rank", " ", "3"}], ",", " ", "t2m3"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"m2t3", "[", 
    RowBox[{"A_", ",", 
     RowBox[{"factor_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ip", ",", "i", ",", "j", ",", "k"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ip", "=", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{
          RowBox[{"ToString", "[", "11", "]"}], "\[Rule]", "1"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "22", "]"}], "\[Rule]", "2"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "33", "]"}], "\[Rule]", "3"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ToString", "[", "23", "]"}], "\[Rule]", "4"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "32", "]"}], "\[Rule]", "4"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "13", "]"}], "\[Rule]", "5"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "31", "]"}], "\[Rule]", "5"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "21", "]"}], "\[Rule]", "6"}], ",", 
         RowBox[{
          RowBox[{"ToString", "[", "12", "]"}], "\[Rule]", "6"}]}], "|>"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", 
            RowBox[{"ip", "[", 
             RowBox[{
              RowBox[{"ToString", "[", "j", "]"}], "<>", 
              RowBox[{"ToString", "[", "k", "]"}]}], "]"}]}], "]"}], "]"}], 
         " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"4", "\[LessEqual]", " ", 
            RowBox[{"ip", "[", 
             RowBox[{
              RowBox[{"ToString", "[", "j", "]"}], "<>", 
              RowBox[{"ToString", "[", "k", "]"}]}], "]"}], "\[LessEqual]", 
            " ", "6"}], ",", 
           RowBox[{"1", "/", "factor"}], ",", "1"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "3"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"t2m3", "[", 
    RowBox[{"A_", ",", 
     RowBox[{"factor_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ip", ",", "i", ",", "j"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ip", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", 
            RowBox[{"ip", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"ip", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "2"}], "]"}], "]"}]}], "]"}], "]"}], "*", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"4", "\[LessEqual]", "j", "\[LessEqual]", "6"}], ",", 
           "factor", ",", "1"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "6"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7532873907410135`*^9, 3.753287509306856*^9}, {
   3.753287554398059*^9, 3.7532875990455365`*^9}, {3.771592684584158*^9, 
   3.771592715715247*^9}, {3.7716812789161215`*^9, 3.7716812860376453`*^9}, {
   3.797612433547504*^9, 3.7976124695458364`*^9}, 3.797613106559743*^9, {
   3.7976132159257965`*^9, 3.797613227820726*^9}, {3.7976132845506926`*^9, 
   3.797613286489273*^9}, 3.8020114504612246`*^9, {3.802116661188183*^9, 
   3.8021166898806286`*^9}, {3.802963315382929*^9, 3.8029633429393225`*^9}, {
   3.805550849260888*^9, 3.8055508606744156`*^9}, {3.805551368566444*^9, 
   3.805551377306875*^9}, {3.8119555159082994`*^9, 3.811955523092436*^9}, {
   3.837894153692382*^9, 3.837894161379652*^9}, {3.8388445032185087`*^9, 
   3.838844514366094*^9}, {3.8544900129831953`*^9, 3.854490078993662*^9}, 
   3.8958375686833496`*^9},
 CellLabel->"In[24]:=",ExpressionUUID->"14f2bc0a-ec4e-4c7b-9794-7aa3b3a234d3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"setWave", ",", "extWave", ",", "setMater", ",", "extMater"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"setWave", ":", " ", 
     RowBox[{"create", " ", "a", " ", "wave", " ", "object", " ", 
      RowBox[{"(", "Association", ")"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"extWave", ":", " ", 
     RowBox[{
     "extend", " ", "a", " ", "created", " ", "wave", " ", "object", " ", 
      "to", " ", "obtain", " ", "the", " ", "other", " ", "attributes"}]}], 
    ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"setMater", ":", " ", 
     RowBox[{"create", " ", "a", " ", "material", " ", "object", " ", 
      RowBox[{"(", "Association", ")"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"extMater", ":", " ", 
     RowBox[{
     "extend", " ", "a", " ", "created", " ", "material", " ", "object", " ", 
      "to", " ", "obtain", " ", "the", " ", "other", " ", 
      RowBox[{"attributes", "."}]}]}]}], " ", "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"extWave", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"extMater", ",", "HoldAll"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setWave", ":=", 
   RowBox[{
    RowBox[{"AssociationThread", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Omega]", ",", "k", ",", "k0", ",", "\[Theta]", ",", "EE"}], 
       "}"}], "\[Rule]", " ", "#"}], "]"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"extWave", "[", "wav_", "]"}], ":=", 
    RowBox[{"AppendTo", "[", 
     RowBox[{"wav", ",", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"H", "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"wav", "[", "\[Omega]", "]"}], "\[Mu]0"}], ")"}]}], 
           ")"}], 
          RowBox[{"Cross", "[", 
           RowBox[{
            RowBox[{"wav", "[", "k", "]"}], ",", 
            RowBox[{"wav", "[", "EE", "]"}]}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"neff", "\[RuleDelayed]", " ", 
         RowBox[{
          RowBox[{"wav", "[", "k0", "]"}], " ", 
          RowBox[{"c0", "/", 
           RowBox[{"wav", "[", "\[Omega]", "]"}]}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"A", "\[RuleDelayed]", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"RotationMatrix", "[", 
            RowBox[{
             RowBox[{"wav", "[", "\[Theta]", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], 
           "\[Transpose]"}], ".", 
          RowBox[{"wav", "[", "EE", "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"phase", ":>", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"wav", "[", "\[Omega]", "]"}], "t"}], "-", 
             RowBox[{
              RowBox[{"wav", "[", "k", "]"}], ".", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], "]"}]}],
         ",", 
        RowBox[{"(*", 
         RowBox[{"pay", " ", "attention", " ", "to", " ", "Re"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"intensity", ":>", 
         RowBox[{
          RowBox[{"Conjugate", "[", 
           RowBox[{"wav", "[", "EE", "]"}], "]"}], ".", 
          RowBox[{"wav", "[", "EE", "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"S", ":>", 
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{"wav", "[", "EE", "]"}], ",", 
           RowBox[{"wav", "[", "H", "]"}]}], "]"}]}]}], " ", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "To", " ", "define", " ", "the", " ", "direction", " ", "of", " ", 
          "D"}], ",", " ", 
         RowBox[{
         "we", " ", "need", " ", "both", " ", "the", " ", "wave", " ", "and", 
          " ", "the", " ", "materials"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setMater", ":=", 
   RowBox[{
    RowBox[{"AssociationThread", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "name", ",", "orientation", ",", "pg", ",", "latcon", ",", 
        "\[CurlyEpsilon]\[Omega]C", ",", "\[CurlyEpsilon]2\[Omega]C", ",", 
        "dC", ",", "h", ",", "QC"}], "}"}], "\[Rule]", "#"}], "]"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"extMater", "[", "mat_", "]"}], ":=", 
   RowBox[{"AppendTo", "[", 
    RowBox[{"mat", ",", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n\[Omega]", "\[RuleDelayed]", 
        RowBox[{"Sort", "@", 
         RowBox[{"Sqrt", "@", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]C", "]"}], "]"}]}]}]}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"n2\[Omega]", "\[RuleDelayed]", 
        RowBox[{"Sort", "@", 
         RowBox[{"Sqrt", "@", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]C", "]"}], 
           "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"QP\[Omega]", ":>", 
        RowBox[{"QC2QP", "[", 
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], ",", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]C", "]"}], ",", 
          RowBox[{
           RowBox[{"mat", "[", "orientation", "]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"QP2\[Omega]", ":>", 
        RowBox[{"QC2QP", "[", 
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], ",", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]C", "]"}], ",", 
          RowBox[{
           RowBox[{"mat", "[", "orientation", "]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]\[Omega]L", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"mat", "[", "QC", "]"}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]C", "]"}], ".", 
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QC", "]"}]}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]2\[Omega]L", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"mat", "[", "QC", "]"}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]C", "]"}], ".", 
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QC", "]"}]}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]\[Omega]P", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QP\[Omega]", "]"}]}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]L", "]"}], ".", 
          RowBox[{"mat", "[", "QP\[Omega]", "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CurlyEpsilon]2\[Omega]P", ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Transpose", "@", 
           RowBox[{"mat", "[", "QP2\[Omega]", "]"}]}], ".", 
          RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}], ".", 
          RowBox[{"mat", "[", "QP2\[Omega]", "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"dL", ":>", 
        RowBox[{"t2m3", "@", 
         RowBox[{"TensorContract", "[", 
          RowBox[{
           RowBox[{"TensorProduct", "[", 
            RowBox[{
             RowBox[{"mat", "[", "QC", "]"}], ",", 
             RowBox[{"mat", "[", "QC", "]"}], ",", 
             RowBox[{"mat", "[", "QC", "]"}], ",", 
             RowBox[{"m2t3", "[", 
              RowBox[{"mat", "[", "dC", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "7"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"4", ",", "8"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"6", ",", "9"}], "}"}]}], "}"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8378080833299994`*^9, 3.8378081090382257`*^9}, {
   3.8378100807529697`*^9, 3.83781008287507*^9}, {3.8378102013608885`*^9, 
   3.837810203112071*^9}, {3.8378938227994432`*^9, 3.837893967735532*^9}, {
   3.8378940187388024`*^9, 3.8378940381023073`*^9}, {3.8378940874053464`*^9, 
   3.8378941198115206`*^9}, {3.8378941861836896`*^9, 3.83789422136145*^9}, {
   3.837894740902835*^9, 3.837894871506814*^9}, {3.8378951600907564`*^9, 
   3.837895162126977*^9}, {3.837895316094494*^9, 3.8378953360034466`*^9}, 
   3.8378954094702015`*^9, {3.8379009995929213`*^9, 3.837901001420617*^9}, {
   3.838080102004238*^9, 3.838080106238412*^9}, 3.8381213552255044`*^9, 
   3.8381302861963987`*^9, {3.838132384699938*^9, 3.838132394562888*^9}, {
   3.8381418887906027`*^9, 3.838141889536482*^9}, {3.838477733688236*^9, 
   3.838477799858054*^9}, {3.8384789987688837`*^9, 3.8384790048344865`*^9}, {
   3.83847914025099*^9, 3.8384791421790004`*^9}, {3.838479260792677*^9, 
   3.83847926211395*^9}, {3.838480160968072*^9, 3.8384801672139177`*^9}, {
   3.838496074826474*^9, 3.8384960876170664`*^9}, {3.8385080912443027`*^9, 
   3.8385080914603105`*^9}, {3.838844588886248*^9, 3.8388446507205873`*^9}, {
   3.8388446843729486`*^9, 3.838844815887065*^9}, {3.841739598257861*^9, 
   3.8417396277690554`*^9}, {3.8420150738385496`*^9, 3.842015078091406*^9}, 
   3.8426236906736164`*^9, 3.842623724056247*^9, {3.842646674400347*^9, 
   3.842646692049489*^9}, {3.8544902103923464`*^9, 3.8544904476424627`*^9}, {
   3.854490499358527*^9, 3.8544906223045197`*^9}, {3.8544919493563414`*^9, 
   3.854491964217675*^9}, {3.8863845650990343`*^9, 3.8863845658022003`*^9}, {
   3.8879343080422072`*^9, 3.8879343097897563`*^9}, {3.887934930925497*^9, 
   3.887934938996603*^9}, 3.888233460993658*^9, {3.8885228000648346`*^9, 
   3.8885228101335278`*^9}, {3.8885228427186413`*^9, 3.888522851029481*^9}, {
   3.889007505169984*^9, 3.889007505525813*^9}, 3.889013789389907*^9, 
   3.8890144000505834`*^9, {3.889016571281604*^9, 3.8890165716599984`*^9}, {
   3.893335207966735*^9, 3.8933352086832514`*^9}, 3.8946600559508033`*^9, {
   3.895837439056285*^9, 3.895837441221644*^9}, 3.8958374783316526`*^9, 
   3.8958375774125953`*^9, {3.8958404121089134`*^9, 3.895840412633013*^9}, {
   3.8958618863590994`*^9, 3.8958618918789463`*^9}, {3.895861944867728*^9, 
   3.8958619567031326`*^9}, 3.895880086578993*^9, {3.8958815628137293`*^9, 
   3.895881566114777*^9}, {3.896043277531657*^9, 3.896043278133692*^9}, {
   3.89604331494793*^9, 3.8960433248097734`*^9}, {3.896918627988633*^9, 
   3.896918673529722*^9}, 3.8970951650032897`*^9, {3.897331187816922*^9, 
   3.897331188468194*^9}, {3.8973312300536222`*^9, 3.897331249941637*^9}, {
   3.897331478126912*^9, 3.897331485505226*^9}, {3.8974409849249706`*^9, 
   3.8974409852687325`*^9}, {3.89744108963216*^9, 3.8974411001658278`*^9}, {
   3.8974415536957884`*^9, 3.8974415541925545`*^9}, {3.897441640280963*^9, 
   3.897441676606819*^9}, {3.8978545798554735`*^9, 3.897854581952622*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"05d4e82c-14bc-4894-b398-d36d23b22167"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "QC2QP", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"QC2QP", "[", 
   RowBox[{"PointGroup_", ",", "\[CurlyEpsilon]\[Omega]C_", ",", "QC_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Inv", ",", "aCryToPrin"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", " ", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<1\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<m\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<mm2\>\""}], 
        "\[Or]", " ", 
        RowBox[{
         RowBox[{"PointGroup", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Inv", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"aCryToPrin", " ", "=", " ", 
         RowBox[{"Inv", ".", 
          RowBox[{"Eigenvectors", "[", 
           RowBox[{"Re", "[", 
            RowBox[{"MatrixPower", "[", 
             RowBox[{"\[CurlyEpsilon]\[Omega]C", ",", "0.5"}], "]"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", " ", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"SetPrecision", "[", 
            RowBox[{
             RowBox[{"aCryToPrin", ".", "\[CurlyEpsilon]\[Omega]C", ".", 
              RowBox[{"Transpose", "[", "aCryToPrin", "]"}]}], ",", "6"}], 
            "]"}], "==", 
           RowBox[{"SetPrecision", "[", 
            RowBox[{"\[CurlyEpsilon]\[Omega]C", ",", "6"}], "]"}]}], ",", 
          RowBox[{"aCryToPrin", " ", "=", " ", 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"aCryToPrin", " ", "=", " ", 
         RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"aCryToPrin", ".", 
      RowBox[{"Inverse", "[", "QC", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{
  3.895837578146972*^9, {3.8958380904141083`*^9, 3.895838113705183*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"24039ff0-d77e-4d2b-8ea7-48805393bf98"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "setwInc", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Set", " ", "up", " ", "incident", " ", "wave"}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setwInc", "[", 
   RowBox[{
   "\[Omega]_", ",", "\[Theta]inc_", ",", "\[CapitalDelta]\[Delta]_", ",", 
    "\[CurlyPhi]_", ",", "n0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Ainc", ",", "Einc", ",", "m1", ",", "wInc", ",", "ax", ",", "ay", ",", 
      "\[Delta]x", ",", "\[Delta]y", ",", 
      RowBox[{"E0", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "@", "\[Theta]inc"}], "\[Equal]", " ", "Symbol"}], 
       ",", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Error! Incident light angle needs to be specified!\>\"", "]"}], 
        ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Ainc", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ax", " ", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", " ", "\[Delta]x"}], "]"}]}], ",", 
         RowBox[{"ay", " ", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", " ", "\[Delta]y"}], "]"}]}], ",", "0"}], "}"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ax", "\[Rule]", " ", 
          RowBox[{"E0", " ", 
           RowBox[{"Cos", "[", "\[CurlyPhi]", "]"}]}]}], ",", 
         RowBox[{"ay", "\[Rule]", 
          RowBox[{"E0", " ", 
           RowBox[{"Sin", "[", "\[CurlyPhi]", "]"}]}]}], ",", 
         RowBox[{"\[Delta]x", "\[Rule]", "0"}], ",", 
         RowBox[{"\[Delta]y", "\[Rule]", "\[CapitalDelta]\[Delta]"}]}], 
        "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Einc", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"RotationMatrix", "[", 
         RowBox[{
          RowBox[{"-", "\[Theta]inc"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], 
        "\[Transpose]"}], ".", "Ainc"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wInc", "=", 
      RowBox[{"setWave", "[", 
       RowBox[{"{", 
        RowBox[{"\[Omega]", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"n0", " ", 
            RowBox[{"\[Omega]", "/", "c0"}]}], ")"}], 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Sin", "@", "\[Theta]inc"}], ",", "0", ",", 
            RowBox[{"Cos", "@", "\[Theta]inc"}]}], "}"}]}], ",", 
         RowBox[{"(", 
          RowBox[{"n0", " ", 
           RowBox[{"\[Omega]", "/", "c0"}]}], ")"}], ",", "\[Theta]inc", ",", 
         "Einc"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "wInc", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8378080833299994`*^9, 3.8378081090382257`*^9}, {
   3.8378100807529697`*^9, 3.83781008287507*^9}, {3.8378102013608885`*^9, 
   3.837810203112071*^9}, {3.8378938227994432`*^9, 3.837893967735532*^9}, {
   3.8378940187388024`*^9, 3.8378940381023073`*^9}, {3.8378940874053464`*^9, 
   3.8378941198115206`*^9}, {3.8378941861836896`*^9, 3.83789422136145*^9}, {
   3.837894740902835*^9, 3.837894871506814*^9}, {3.8378951600907564`*^9, 
   3.837895162126977*^9}, {3.837895316094494*^9, 3.8378953360034466`*^9}, 
   3.8378954094702015`*^9, {3.8379009995929213`*^9, 3.837901001420617*^9}, {
   3.838080102004238*^9, 3.838080106238412*^9}, 3.8381213552255044`*^9, 
   3.8381302861963987`*^9, {3.838132384699938*^9, 3.838132394562888*^9}, {
   3.8381418887906027`*^9, 3.838141889536482*^9}, {3.838477733688236*^9, 
   3.838477799858054*^9}, {3.8384789987688837`*^9, 3.8384790048344865`*^9}, {
   3.83847914025099*^9, 3.8384791421790004`*^9}, {3.838479260792677*^9, 
   3.83847926211395*^9}, {3.838480160968072*^9, 3.8384801672139177`*^9}, {
   3.838496074826474*^9, 3.8384960876170664`*^9}, {3.8385080912443027`*^9, 
   3.8385080914603105`*^9}, {3.838844588886248*^9, 3.8388446507205873`*^9}, {
   3.8388446843729486`*^9, 3.838844815887065*^9}, {3.841739598257861*^9, 
   3.8417396277690554`*^9}, {3.8420150738385496`*^9, 3.842015078091406*^9}, 
   3.8426236906736164`*^9, {3.842623724056247*^9, 3.8426237589482794`*^9}, {
   3.854491982033924*^9, 3.8544921894275007`*^9}, 3.8958375791622458`*^9, {
   3.8958605176560836`*^9, 3.895860527710758*^9}, {3.895860659244032*^9, 
   3.8958606709591103`*^9}, {3.895861052053163*^9, 3.8958610830830927`*^9}, {
   3.8958612937229834`*^9, 3.895861295541204*^9}, {3.897331347985426*^9, 
   3.8973313516609616`*^9}, {3.897331545223548*^9, 3.897331548340597*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"03473d21-890c-40c2-aa2c-6155a0c7e300"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "dsym", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "dsym", " ", "read", " ", "in", " ", "a", " ", "mater", " ", "object", 
     " ", "and", " ", "modify", " ", "its", " ", 
     RowBox[{"Key", "[", "dC", "]"}], " ", "by", " ", "the", " ", "symmetry", 
     " ", "constraint", " ", "according", " ", "to", " ", 
     RowBox[{"Key", "[", "pg", "]"}]}], ";", " ", 
    RowBox[{
    "it", " ", "is", " ", "useful", " ", "for", " ", "single", " ", "run", 
     " ", "outside", " ", "the", " ", "GUI"}], ";", " ", 
    RowBox[{
    "it", " ", "is", " ", "also", " ", "useful", " ", "when", " ", "define", 
     " ", "materials", " ", "function"}], ";"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"dsym", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dsym", "[", "mat_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "fsym", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"fsym", "[", 
        RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"i", "\[NotEqual]", 
           RowBox[{
            RowBox[{"IntegerDigits", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "pg", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "\[Or]", 
          RowBox[{"j", "\[NotEqual]", 
           RowBox[{
            RowBox[{"IntegerDigits", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "pg", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", "pg", "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "0"}], ",", 
           "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Sign", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "pg", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"mat", "[", "dC", "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"IntegerDigits", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"mat", "[", "pg", "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"IntegerDigits", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"mat", "[", "pg", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ")"}]}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", "dC", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mat", "[", "dC", "]"}], "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"fsym", "@@", "#"}], "&"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "6"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "form", " ", "is", " ", "useful", " ", "when", " ", "define",
      " ", "materials", " ", "function"}], ";", " ", 
    RowBox[{
    "read", " ", "in", " ", "pg", " ", "and", " ", "the", " ", "initial", " ",
      "dC", " ", "and", " ", "return", " ", "the", " ", "symmetrized", " ", 
     "dC"}], ";"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dsym", "[", 
   RowBox[{"pg_", ",", "dC_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "fsym", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"fsym", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"i", "\[NotEqual]", 
          RowBox[{
           RowBox[{"IntegerDigits", "[", 
            RowBox[{"pg", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "\[Or]", 
         RowBox[{"j", "\[NotEqual]", 
          RowBox[{
           RowBox[{"IntegerDigits", "[", 
            RowBox[{"pg", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pg", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "0"}], ",", 
          "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Sign", "[", 
            RowBox[{"pg", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"dC", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"IntegerDigits", "[", 
                 RowBox[{"pg", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"IntegerDigits", "[", 
                RowBox[{"pg", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ")"}]}]}], 
         "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"dC", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"fsym", "@@", "#"}], "&"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "6"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->"In[38]:=",ExpressionUUID->"f1fff8d2-bdfa-4a84-abc8-6acb06a5406e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Setup materials ", "Chapter",
 CellChangeTimes->{{3.840467011689859*^9, 
  3.840467014669623*^9}},ExpressionUUID->"f675d733-5e58-4b94-9785-\
948947b52d1d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Air", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Air", "[", 
   RowBox[{"\[Lambda]_", ":", "1.064"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\[Infinity]\[Infinity]m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Air\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "1"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "1"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8453327664843225`*^9, 3.8453327959219203`*^9}, {
   3.845332834136978*^9, 3.8453328343600006`*^9}, {3.888523009176219*^9, 
   3.8885230124852347`*^9}, {3.8890075706273565`*^9, 3.8890075742101464`*^9}, 
   3.8890080269899735`*^9, {3.889013881265599*^9, 3.889013895660239*^9}, {
   3.889014415049775*^9, 3.889014439414218*^9}, 3.889016342374221*^9, {
   3.889016639641178*^9, 3.8890166590573606`*^9}, {3.8890167025931683`*^9, 
   3.8890167044693413`*^9}, {3.8890167818402667`*^9, 3.889016782381955*^9}, 
   3.89143630012029*^9, {3.89143753400932*^9, 3.8914375411300154`*^9}, {
   3.8914376961554303`*^9, 3.891437710635779*^9}, {3.892563831444539*^9, 
   3.892563832286707*^9}, 3.892564085493104*^9, {3.892817233534154*^9, 
   3.892817282728448*^9}, {3.8928173201338615`*^9, 3.892817324126648*^9}, {
   3.8933535200567417`*^9, 3.8933535206973743`*^9}, 3.894586628549274*^9, {
   3.8945922433283415`*^9, 3.894592250177868*^9}, {3.8946712557012253`*^9, 
   3.8946712661713095`*^9}, {3.8946713003679523`*^9, 
   3.8946714053884635`*^9}, {3.8946714388245497`*^9, 
   3.8946714433795795`*^9}, {3.894671478528617*^9, 3.8946714922094307`*^9}, {
   3.8946715315307274`*^9, 3.8946716495463753`*^9}, {3.8946717118829665`*^9, 
   3.894671715987898*^9}, {3.8946718431045976`*^9, 3.894671939082777*^9}, 
   3.89467200315673*^9, {3.8946721687559366`*^9, 3.894672172328909*^9}, 
   3.8946727551305776`*^9, {3.8946728974995613`*^9, 3.894672900335682*^9}, {
   3.894672931358403*^9, 3.894672944243925*^9}, {3.8946803365593185`*^9, 
   3.8946803371878195`*^9}, 3.8958375203719583`*^9, {3.895863637129712*^9, 
   3.8958636385760007`*^9}, {3.895865767250534*^9, 3.895865797748279*^9}, {
   3.895865836148788*^9, 3.8958658538821754`*^9}, {3.8960433545819473`*^9, 
   3.8960434312390337`*^9}, {3.896043468789647*^9, 3.8960434841908646`*^9}, {
   3.89604389668793*^9, 3.8960438981103663`*^9}, 3.8966650358635826`*^9, {
   3.8966697549047008`*^9, 3.8966697550514245`*^9}, 3.8967503769305286`*^9},
 CellLabel->"In[42]:=",ExpressionUUID->"6901761b-5a2a-4c42-9da7-8a0b80534fbd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "blankMaterL", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"blankMaterL", "[", 
   RowBox[{"\[Lambda]_", ":", "1.0"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<m3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"5", ",", "5", ",", "5", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Blank Linear Material\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "2"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "3"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.896748927484727*^9, 3.896748945693947*^9}, {
   3.896748990940816*^9, 3.8967491043081093`*^9}, 3.8967492279913254`*^9, 
   3.8967503799532976`*^9, {3.896752120120945*^9, 3.896752148848276*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"adb0f516-59df-4b0f-a7ad-3612735eacfa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "blankMaterNL", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"blankMaterNL", "[", 
   RowBox[{"\[Lambda]_", ":", "1.0"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "14", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "14"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"5", ",", "5", ",", "5", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Blank Nonlinear Material\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "2"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "3"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "1"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.896749112362629*^9, 3.896749158267877*^9}, {
   3.8967491992200384`*^9, 3.8967492253044357`*^9}, 3.896750381830434*^9, {
   3.8967520828184705`*^9, 3.8967521150819435`*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"423403c9-ffce-4ced-b379-9ac057f69afe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "LiNbO3", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LiNbO3", "[", 
   RowBox[{"\[Lambda]_", ":", "1.064"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "15", ",", "0", 
            ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.14", ",", "5.14", ",", "13.50", ",", "90", ",", "90", ",", "120"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "name", "=", "\"\<Z-cut \!\(\*SubscriptBox[\(LiNbO\), \(3\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", "2.294778"}]}], ";", 
     RowBox[{"n3\[Omega]", "=", "2.185673"}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", "2.474147"}]}], ";", 
     RowBox[{"n32\[Omega]", "=", "2.338687"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d22", ",", "d15"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{"6.2", ",", "1.0", ",", 
        RowBox[{"-", "0.3"}], ",", "1.2"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8426550803812265`*^9, 3.8426550841901274`*^9}, {
   3.842655145821518*^9, 3.8426551671723833`*^9}, {3.842655531211684*^9, 
   3.842655593243911*^9}, {3.884303876663249*^9, 3.8843039516497717`*^9}, {
   3.8885230445683928`*^9, 3.888523046283479*^9}, 3.8885230774221754`*^9, {
   3.889007788333742*^9, 3.8890077914243307`*^9}, 3.8890139038676386`*^9, {
   3.889013948103441*^9, 3.889013993729333*^9}, {3.8890144902618313`*^9, 
   3.889014495779154*^9}, {3.8890167106749673`*^9, 3.8890167108138123`*^9}, {
   3.8890167670572824`*^9, 3.889016775990918*^9}, {3.891437731054139*^9, 
   3.8914377370654488`*^9}, {3.8925638457328005`*^9, 3.8925638463521814`*^9}, 
   3.892564094274437*^9, 3.8933535528481054`*^9, {3.89338418536973*^9, 
   3.893384208382173*^9}, {3.894317120027052*^9, 3.894317153073374*^9}, {
   3.8943172548628635`*^9, 3.8943172559274697`*^9}, {3.894582341075609*^9, 
   3.8945823489967604`*^9}, {3.894585624726663*^9, 3.894585638250597*^9}, 
   3.894585792894455*^9, {3.894586353347005*^9, 3.894586401784198*^9}, {
   3.894592227618774*^9, 3.8945922356884713`*^9}, {3.894658724670315*^9, 
   3.8946587553550777`*^9}, {3.8946721558854384`*^9, 3.8946722239747534`*^9}, 
   3.8946723424152136`*^9, {3.894672782183144*^9, 3.8946727893567276`*^9}, {
   3.8946728860532475`*^9, 3.8946729230884533`*^9}, {3.8946803217578955`*^9, 
   3.8946803235281544`*^9}, {3.895747764457614*^9, 3.895747778192709*^9}, 
   3.8957478612281203`*^9, 3.895837522047835*^9, {3.8958636178436885`*^9, 
   3.895863624216496*^9}, {3.8958656270668583`*^9, 3.8958657273127375`*^9}, 
   3.895865858604431*^9, {3.895925180093006*^9, 3.89592519341943*^9}, {
   3.8960435460552397`*^9, 3.8960435555582523`*^9}, 3.8966650341525097`*^9, 
   3.896669758706303*^9, 3.8967503840260797`*^9},
 CellLabel->"In[48]:=",ExpressionUUID->"3eb09a4c-65d5-4c80-a5a5-6df6f7eacfd7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "LiNbO3xCut\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LiNbO3xCut\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "538.1"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "15", ",", "0", 
            ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.1378", ",", "5.1378", ",", "13.4987", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<\!\(\*SubscriptBox[\(LiNbO\), \(3\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", "  ", "=", " ", 
      RowBox[{"-", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", 
          RowBox[{"Cos", "[", 
           RowBox[{"Pi", "/", "6"}], "]"}]}], ",", 
         RowBox[{"-", 
          RowBox[{"Sin", "[", 
           RowBox[{"Pi", "/", "6"}], "]"}]}]}], "}"}]}]}], ";", "   ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"Pi", "/", "3"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"Sin", "[", 
          RowBox[{"Pi", "/", "3"}], "]"}]}]}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry1", ",", "Cry2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.02047"}], ")"}]}]}], 
        "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.0666"}], ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "416.08"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.02047"}], 
           ")"}]}]}], "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.0666"}], 
           ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "416.08"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"D", ".", "E", ".", "Zelmon"}], ",", 
       RowBox[{"D", ".", "L", ".", "Small"}], ",", 
       RowBox[{
        RowBox[{"and", " ", 
         RowBox[{"D", ".", "Jundt", ".", "Infrared"}], " ", "corrected", " ", 
         "Sellmeier", " ", "coefficients", " ", "for", " ", "congruently", 
         " ", "grown", " ", "lithium", " ", "niobate", " ", "and", " ", "5", 
         " ", 
         RowBox[{"mol", ".", "%"}], " ", "magnesium", " ", "oxide"}], "-", 
        RowBox[{"doped", " ", "lithium", " ", "niobate"}]}], ",", 
       RowBox[{
        RowBox[{"J", ".", "Opt", ".", "Soc", ".", "Am", ".", "B"}], " ", 
        "14"}], ",", 
       RowBox[{"3319", "-", 
        RowBox[{"3322", " ", 
         RowBox[{"(", "1997", ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d22", ",", "d15"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"5.454", ",", "1", ",", 
         RowBox[{"-", "0.388"}], ",", "1.173"}], "}"}], "*", "3.539"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894582363259985*^9, 3.8945823639389324`*^9}, {
   3.8945825494868917`*^9, 3.8945825949157925`*^9}, {3.8945826932271967`*^9, 
   3.8945827013442326`*^9}, {3.8945827998176785`*^9, 
   3.8945828174161825`*^9}, {3.894582905975268*^9, 3.894582922087063*^9}, {
   3.894582959673998*^9, 3.894583030215909*^9}, {3.89458307637948*^9, 
   3.8945831238168497`*^9}, {3.8945831900265026`*^9, 3.894583191953596*^9}, {
   3.894583236978216*^9, 3.894583242897235*^9}, {3.8945833058739386`*^9, 
   3.8945833158176126`*^9}, 3.8945835149614787`*^9, 3.894586694495343*^9, {
   3.8945922137890396`*^9, 3.894592223149113*^9}, {3.8946574109900208`*^9, 
   3.8946574228282175`*^9}, 3.8946578605757675`*^9, {3.8946587650116143`*^9, 
   3.8946588257631397`*^9}, {3.8946588565338736`*^9, 3.894658863920725*^9}, {
   3.894658951819721*^9, 3.894659197492869*^9}, {3.894659249186803*^9, 
   3.89465925215044*^9}, 3.894660950924752*^9, {3.8946610266385407`*^9, 
   3.8946610390237923`*^9}, {3.894661124131369*^9, 3.894661128085573*^9}, {
   3.8946611652703896`*^9, 3.894661171200652*^9}, {3.894661494710918*^9, 
   3.89466154629911*^9}, 3.89466187951642*^9, {3.8946641340572786`*^9, 
   3.8946641459930897`*^9}, {3.8946728006275043`*^9, 3.8946728735684*^9}, {
   3.894672963616661*^9, 3.8946729664284163`*^9}, {3.8946803157726746`*^9, 
   3.894680318092904*^9}, {3.8957477835406847`*^9, 3.895747784757304*^9}, 
   3.89574785818042*^9, 3.895837522992565*^9, 3.8958375810218153`*^9, {
   3.895863646273452*^9, 3.8958636479956956`*^9}, {3.8958658648948607`*^9, 
   3.8958658728618245`*^9}, {3.8959251649968967`*^9, 
   3.8959251716919203`*^9}, {3.8960435010727763`*^9, 3.8960435118947353`*^9}, 
   3.896665031979083*^9, 3.8966697607897005`*^9, {3.8967503895165854`*^9, 
   3.8967504058753405`*^9}, {3.897176848351478*^9, 3.897176850992095*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"ffe736ff-305b-4fe9-b58a-df11515970fb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "LiNbO3zCut\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LiNbO3zCut\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "119.4"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "15", ",", "0", 
            ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.1378", ",", "5.1378", ",", "13.4987", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "name", "=", "\"\<Z-cut \!\(\*SubscriptBox[\(LiNbO\), \(3\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", 
      RowBox[{"-", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{"Pi", "/", "3"}], "]"}], ",", 
         RowBox[{"Sin", "[", 
          RowBox[{"Pi", "/", "3"}], "]"}], ",", "0"}], "}"}]}]}], ";", "   ", 
     RowBox[{"Cry2", " ", "=", "  ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"Pi", "/", "6"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"Sin", "[", 
          RowBox[{"Pi", "/", "6"}], "]"}]}], ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry1", ",", "Cry2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.01764"}], ")"}]}]}], 
        "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.05914"}], ")"}]}]}], 
        "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "474.60"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.02047"}], ")"}]}]}], 
        "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "0.0666"}], ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["\[Lambda]", "2"], "-", "416.08"}], ")"}]}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.6734", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.01764"}], 
           ")"}]}]}], "+", 
        RowBox[{"1.2290", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.05914"}], 
           ")"}]}]}], "+", 
        RowBox[{"12.614", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "474.60"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{"2.9804", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.02047"}], 
           ")"}]}]}], "+", 
        RowBox[{"0.5981", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.0666"}], 
           ")"}]}]}], "+", 
        RowBox[{"8.9543", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "416.08"}], 
           ")"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"D", ".", "E", ".", "Zelmon"}], ",", 
       RowBox[{"D", ".", "L", ".", "Small"}], ",", 
       RowBox[{
        RowBox[{"and", " ", 
         RowBox[{"D", ".", "Jundt", ".", "Infrared"}], " ", "corrected", " ", 
         "Sellmeier", " ", "coefficients", " ", "for", " ", "congruently", 
         " ", "grown", " ", "lithium", " ", "niobate", " ", "and", " ", "5", 
         " ", 
         RowBox[{"mol", ".", "%"}], " ", "magnesium", " ", "oxide"}], "-", 
        RowBox[{"doped", " ", "lithium", " ", "niobate"}]}], ",", 
       RowBox[{
        RowBox[{"J", ".", "Opt", ".", "Soc", ".", "Am", ".", "B"}], " ", 
        "14"}], ",", 
       RowBox[{"3319", "-", 
        RowBox[{"3322", " ", 
         RowBox[{"(", "1997", ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d22", ",", "d15"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"5.454", ",", "1", ",", 
         RowBox[{"-", "0.388"}], ",", "1.173"}], "}"}], "*", "3.539"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8946801951441727`*^9, 3.89468022089438*^9}, {
   3.8946803075576687`*^9, 3.894680311420179*^9}, {3.894680589271468*^9, 
   3.8946806302543397`*^9}, {3.894680699066939*^9, 3.8946807020272*^9}, {
   3.8957477965671883`*^9, 3.895747812102058*^9}, 3.895747854220705*^9, 
   3.8958375242474585`*^9, 3.895837581595019*^9, {3.89586365507965*^9, 
   3.8958636566837387`*^9}, {3.895865878703206*^9, 3.895865888638618*^9}, {
   3.8959251567937417`*^9, 3.895925160571821*^9}, {3.896043780249897*^9, 
   3.896043780395897*^9}, {3.89604388248248*^9, 3.896043887049894*^9}, 
   3.8966650298055034`*^9, 3.8966697626573386`*^9, {3.896750410248633*^9, 
   3.8967504121413555`*^9}, {3.8971768615747485`*^9, 3.897176864099617*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"eda09f38-171f-486c-861e-2ef0036d1ecf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "KTPxCut", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"KTPxCut", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "370.1"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<mm2\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "24", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "32", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "6.40", ",", "10.62", ",", "12.81", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<X-cut KTP\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], " ", ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.03978"}], ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "31.45571"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04597"}], ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "39.43799"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04763"}], ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "86.12171"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.03978"}], 
         ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "31.45571"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04597"}], 
         ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "39.43799"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04763"}], 
         ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "86.12171"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d32", ",", "d31", ",", "d24", ",", "d15"}], "}"}],
       "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4.178", ",", "1", ",", "0.805", ",", "0.997", ",", "0.365"}],
         "}"}], "*", "1.333"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680245949854*^9, 3.8946802945543084`*^9}, {
   3.8946805892871017`*^9, 3.894680630270318*^9}, {3.894680692238202*^9, 
   3.8946806966447096`*^9}, {3.895747842448019*^9, 3.895747847696395*^9}, 
   3.8958375252368755`*^9, 3.8958375826887636`*^9, {3.8958636626518416`*^9, 
   3.895863665264708*^9}, {3.8958814133989625`*^9, 3.8958814232121153`*^9}, {
   3.8959251443962717`*^9, 3.895925153273678*^9}, {3.8960437839573507`*^9, 
   3.8960437841378284`*^9}, {3.8960438725386257`*^9, 3.896043876911891*^9}, 
   3.8966650274331245`*^9, 3.8966697649804025`*^9, {3.8967504214428015`*^9, 
   3.8967504245376973`*^9}, 3.89701666655156*^9},
 CellLabel->"In[54]:=",ExpressionUUID->"282025b0-d1ba-4d84-aa03-7c5c8beff868"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "KTPyCut", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"KTPyCut", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "571.4"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<mm2\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "24", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "32", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "6.40", ",", "10.62", ",", "12.81", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Y-cut KTP\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], " ", ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", " ", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry2", ",", "Cry3"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.03978"}], ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "31.45571"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04597"}], ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "39.43799"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "0.04763"}], ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Lambda]", "2"], "-", "86.12171"}], ")"}]}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"3.29100", "+", 
       RowBox[{"0.04140", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.03978"}], 
         ")"}]}], "+", 
       RowBox[{"9.35522", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "31.45571"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"3.45018", "+", 
       RowBox[{"0.04341", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04597"}], 
         ")"}]}], "+", 
       RowBox[{"16.98825", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "39.43799"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"4.59423", "+", 
       RowBox[{"0.06206", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "0.04763"}], 
         ")"}]}], "+", 
       RowBox[{"110.80672", "/", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", "86.12171"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d32", ",", "d31", ",", "d24", ",", "d15"}], "}"}],
       "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4.178", ",", "1", ",", "0.805", ",", "0.997", ",", "0.365"}],
         "}"}], "*", "1.333"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{
  3.8946803642279873`*^9, {3.894680589302722*^9, 3.894680630270318*^9}, {
   3.894680686125657*^9, 3.8946806896488433`*^9}, {3.894681123262018*^9, 
   3.8946811251534348`*^9}, {3.8957478677365103`*^9, 3.8957478713467245`*^9}, 
   3.895837526094018*^9, 3.8958375833137455`*^9, {3.8958636697143106`*^9, 
   3.895863671849382*^9}, {3.895881425646021*^9, 3.8958814387321944`*^9}, {
   3.895925134886552*^9, 3.89592514117666*^9}, {3.896043787088994*^9, 
   3.896043787272547*^9}, {3.8960438665208464`*^9, 3.896043870215077*^9}, 
   3.8966650254915357`*^9, 3.8966697677073135`*^9, {3.896750429540289*^9, 
   3.8967504306584387`*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"a2056cca-1ec8-4bef-8b38-d6985ff4b1e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "ZnO001", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ZnO001", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.159"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<6mm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "15", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "3.2342", ",", "3.2342", ",", "5.1772", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<ZnO\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Axo", " ", "=", " ", "1.9289"}], ",", " ", 
         RowBox[{"Bxo", " ", "=", " ", "0.010689"}], ",", " ", 
         RowBox[{"Cxo", " ", "=", "0.00530"}], ",", 
         RowBox[{"Axe", " ", "=", "1.848"}], ",", " ", 
         RowBox[{"Bxe", " ", "=", " ", "0.08447"}], ",", " ", 
         RowBox[{"Cxe", " ", "=", 
          RowBox[{"-", "0.00818"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n1\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox["\[Lambda]", "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox["\[Lambda]", "4"]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"n2\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox["\[Lambda]", "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox["\[Lambda]", "4"]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"n3\[Omega]", "=", 
         RowBox[{"Axe", "+", 
          RowBox[{"Bxe", "/", 
           SuperscriptBox["\[Lambda]", "2"]}], "+", 
          RowBox[{"Cxe", "/", 
           SuperscriptBox["\[Lambda]", "4"]}]}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Axo", " ", "=", " ", "1.917"}], ",", " ", 
         RowBox[{"Bxo", " ", "=", " ", "0.02730"}], ",", " ", 
         RowBox[{"Cxo", " ", "=", "0.002"}], ",", 
         RowBox[{"Axe", " ", "=", " ", "1.917"}], ",", " ", 
         RowBox[{"Bxe", " ", "=", " ", "0.02730"}], ",", 
         RowBox[{"Cxe", " ", "=", "0.002"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n12\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "4"]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n22\[Omega]", "=", 
         RowBox[{"Axo", "+", 
          RowBox[{"Bxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"]}], "+", 
          RowBox[{"Cxo", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "4"]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n32\[Omega]", "=", 
         RowBox[{"Axe", "+", 
          RowBox[{"Bxe", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"]}], "+", 
          RowBox[{"Cxe", "/", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"\[Lambda]", "/", "2"}], ")"}], "4"]}]}]}]}]}], "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d33", ",", "d31", ",", "d15"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "6.654"}], ",", "0.830", ",", "1.079"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8946803778195314`*^9, 3.8946803942274284`*^9}, {
   3.894680589302722*^9, 3.894680630285942*^9}, {3.894680681545948*^9, 
   3.8946806834268436`*^9}, {3.895747875698756*^9, 3.8957478780681195`*^9}, 
   3.895837526797143*^9, 3.8958375840946417`*^9, {3.8958636778523326`*^9, 
   3.8958636795537353`*^9}, {3.89588144505348*^9, 3.8958814525982075`*^9}, {
   3.895925130345343*^9, 3.8959251311480317`*^9}, {3.89604379066364*^9, 
   3.8960437915587797`*^9}, {3.896043857582008*^9, 3.896043864744508*^9}, 
   3.8966650225381355`*^9, 3.8966697693143597`*^9, {3.8967504387954874`*^9, 
   3.896750450754822*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"9981114f-ed8d-496c-a589-3cac37e71ab9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Pt111\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Pt111\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.2"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<m3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "3.944", ",", "3.944", ",", "3.944", ",", "90", ",", "90", ",", "90"}],
        "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Pt\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", 
        RowBox[{"1.7719", "+", 
         RowBox[{"16.193", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", 
        RowBox[{"0.55572", "+", 
         RowBox[{"7.7907", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680414620223*^9, 3.8946804326369905`*^9}, {
   3.894680589318348*^9, 3.894680630301571*^9}, {3.8957478859556828`*^9, 
   3.8957478898776875`*^9}, 3.8958375277208643`*^9, 3.895837584673145*^9, {
   3.895863684257454*^9, 3.89586368535365*^9}, {3.8958814566994743`*^9, 
   3.8958814623702974`*^9}, {3.8959251254641314`*^9, 3.8959251262134085`*^9}, 
   3.8959310235178213`*^9, {3.8960437952484956`*^9, 3.896043795686414*^9}, {
   3.8960438514536886`*^9, 3.896043854924721*^9}, 3.8966650207274733`*^9, 
   3.896669772301193*^9, {3.896750444481723*^9, 3.8967504543681145`*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"a377865e-d91b-4b72-bcbc-7ba18c1e943b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Al2O3$0001\[Lambda]1550", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Al2O3$0001\[Lambda]1550", "[", 
   RowBox[{"\[Lambda]_", ":", "1.55"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "100"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<6/mmm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.7606", ",", "4.7606", ",", "12.994", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "name", "=", 
      "\"\<\!\(\*SubscriptBox[\(Al\), \(2\)]\)\!\(\*SubscriptBox[\(O\), \
\(3\)]\)\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", "1.7462"}]}], ";", 
     RowBox[{"n3\[Omega]", "=", "1.7384"}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", "1.7608"}]}], ";", 
     RowBox[{"n32\[Omega]", "=", "1.7529"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680450820321*^9, 3.8946804572137175`*^9}, {
   3.894680589333973*^9, 3.894680630301571*^9}, {3.895747926508278*^9, 
   3.8957479391713157`*^9}, 3.8958375289240065`*^9, 3.8958375853415174`*^9, 
   3.895863690761427*^9, {3.895881469323343*^9, 3.895881476975786*^9}, {
   3.8959251220759335`*^9, 3.8959251229607763`*^9}, {3.896043798550697*^9, 
   3.8960437989010496`*^9}, {3.896043845367012*^9, 3.896043849060902*^9}, 
   3.8966650188643293`*^9, 3.896669776970318*^9},
 CellLabel->"In[62]:=",ExpressionUUID->"aa7e4467-99fe-495d-8e26-34dab5319814"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Quartz$xCut\[Lambda]1064", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Quartz$xCut\[Lambda]1064", "[", 
   RowBox[{"\[Lambda]_", ":", "1.064"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "300"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<32\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"11", ",", 
            RowBox[{"-", "11"}], ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", 
            RowBox[{"-", "14"}], ",", 
            RowBox[{"-", "11"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.913", ",", "4.913", ",", "5.405", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<X-cut Quartz\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"isotropic", " ", "assumption", " ", "following", " ", "HH"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", "1.53413"}]}]}], " ", ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", "1.54702"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "0.0"}], ";", 
     RowBox[{"d11", "=", "0.3"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8946804693430386`*^9, 3.894680492906515*^9}, {
   3.894680589349596*^9, 3.894680630317193*^9}, {3.8946806669312696`*^9, 
   3.8946806681027846`*^9}, {3.895747949271001*^9, 3.8957479560860534`*^9}, 
   3.8958375319638925`*^9, 3.8958375859506884`*^9, {3.895863699474267*^9, 
   3.895863701486473*^9}, {3.8958814797249193`*^9, 3.895881486883256*^9}, {
   3.8960438014704647`*^9, 3.8960438019255533`*^9}, {3.896043839582748*^9, 
   3.8960438427735834`*^9}, 3.896665015752559*^9, 3.896669778942253*^9, {
   3.896750465184737*^9, 3.896750465609867*^9}, {3.8970986411504874`*^9, 
   3.897098641370947*^9}, {3.8971758141743517`*^9, 3.8971758346830597`*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"c6b72c7a-8011-4118-b60d-4c51f1e44794"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Quartz$zCut\[Lambda]800", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Quartz$zCut\[Lambda]800", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "121.1"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<32\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"11", ",", 
            RowBox[{"-", "11"}], ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", 
            RowBox[{"-", "14"}], ",", 
            RowBox[{"-", "11"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.913", ",", "4.913", ",", "5.405", ",", "90", ",", "90", ",", 
        "120"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Z-cut Quartz\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"co1", " ", "=", " ", "0.663044"}], ",", " ", 
         RowBox[{"co2", " ", "=", " ", "0.060"}], ",", " ", 
         RowBox[{"co3", " ", "=", "0.517852"}], ",", 
         RowBox[{"co4", " ", "=", " ", "0.106"}], ",", " ", 
         RowBox[{"co5", "  ", "=", "0.175912"}], ",", 
         RowBox[{"co6", " ", "=", "0.119"}], ",", 
         RowBox[{"co7", "=", "0.565380"}], " ", ",", 
         RowBox[{"co8", " ", "=", "8.844"}], ",", 
         RowBox[{"co9", "=", "1.675299"}], ",", 
         RowBox[{"co10", " ", "=", "20.742"}], ",", 
         RowBox[{"ce1", " ", "=", " ", "0.665721"}], ",", " ", 
         RowBox[{"ce2", " ", "=", " ", "0.060"}], ",", " ", 
         RowBox[{"ce3", " ", "=", "0.503511"}], ",", 
         RowBox[{"ce4", " ", "=", "0.106"}], ",", " ", 
         RowBox[{"ce5", "  ", "=", "0.214792"}], ",", 
         RowBox[{"ce6", " ", "=", "0.119"}], ",", 
         RowBox[{"ce7", "=", "0.539173"}], " ", ",", 
         RowBox[{"ce8", " ", "=", "8.792"}], ",", 
         RowBox[{"ce9", "=", "1.807613"}], ",", 
         RowBox[{"ce10", " ", "=", "19.70"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n1\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n2\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n3\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"ce1", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce3", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce5", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce7", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce9", "*", 
            RowBox[{
             SuperscriptBox["\[Lambda]", "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Lambda]", "2"], "-", 
               SuperscriptBox["ce10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"n12\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n22\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"co1", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co3", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co5", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co7", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"co9", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["co10", "2"]}], ")"}]}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n32\[Omega]", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "+", 
           RowBox[{"ce1", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce2", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce3", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce4", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce5", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce6", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce7", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce8", "2"]}], ")"}]}]}], "+", 
           RowBox[{"ce9", "*", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Lambda]", "/", "2"}], ")"}], "2"], "-", 
               SuperscriptBox["ce10", "2"]}], ")"}]}]}]}], "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"n1\[Omega]", "=", 
        RowBox[{"n2\[Omega]", "=", "1.538360"}]}], ";", 
       RowBox[{"n3\[Omega]", "=", "1.5473"}], ";", "\[IndentingNewLine]", 
       RowBox[{"n12\[Omega]", "=", 
        RowBox[{"n22\[Omega]", "=", "1.5577"}]}], ";", 
       RowBox[{"n32\[Omega]", "=", "1.5673"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "0.0"}], ";", 
     RowBox[{"d11", "=", "0.3"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.894680511029557*^9, 3.894680539080276*^9}, {
   3.8946805893732667`*^9, 3.894680660929772*^9}, {3.895747962025387*^9, 
   3.895747965481039*^9}, 3.8958375340374117`*^9, 3.8958375869222507`*^9, {
   3.8958637102672477`*^9, 3.8958637124649506`*^9}, {3.895881490175833*^9, 
   3.895881497788248*^9}, {3.8959251067212715`*^9, 3.8959251175640955`*^9}, {
   3.896043804709467*^9, 3.8960438357599387`*^9}, 3.896665011372362*^9, 
   3.896669780801416*^9, {3.8967505419711447`*^9, 3.896750558941663*^9}, {
   3.8969142851392603`*^9, 3.8969142874111633`*^9}, {3.89691489297744*^9, 
   3.896914896097435*^9}, {3.896915237845811*^9, 3.896915240889225*^9}, {
   3.8969171547041173`*^9, 3.8969171567638283`*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"346979b3-54f5-4a44-b833-82392ea2670b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "Au\[Lambda]800", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Au\[Lambda]800", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.0139"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\[Infinity]\[Infinity]m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.07", ",", "4.07", ",", "4.07", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<Au Coating\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"n3\[Omega]", "=", 
        RowBox[{"3.479500", "+", 
         RowBox[{"2.921145", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"n32\[Omega]", "=", 
        RowBox[{"2.251755", "+", 
         RowBox[{"1.596650", "I"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "0.0"}], ";", 
     RowBox[{"d11", "=", "0.3"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8946805554435964`*^9, 3.8946806534978013`*^9}, {
   3.89574797037466*^9, 3.89574797507477*^9}, 3.895837536974988*^9, 
   3.895837587812747*^9, 3.895863718872358*^9, {3.8958815017946424`*^9, 
   3.8958815084015217`*^9}, {3.8960438090377307`*^9, 3.896043827758664*^9}, {
   3.896665003529061*^9, 3.896665004607565*^9}, 3.896669783440449*^9, {
   3.8967505493939753`*^9, 3.8967505503297524`*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"d3f1f024-15ad-4152-8c84-cca002cb4693"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "GaAs111\[Lambda]800", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GaAs111\[Lambda]800", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "14", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "14", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "14"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "5.65", ",", "5.65", ",", "5.65", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<GaAs\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "/", 
          RowBox[{"(", 
           RowBox[{"\[Sqrt]", "2"}], ")"}]}], ")"}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", "  ", 
     RowBox[{"Cry2", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", 
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{"2", "/", "3"}], ")"}]}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", " ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "2"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "6"}], ")"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Sqrt]", "3"}], ")"}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "2"}], ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"3.666", "+", 
       RowBox[{"I", " ", "0.059"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"3.666", "+", 
       RowBox[{"I", " ", "0.059"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"3.666", "+", 
       RowBox[{"I", " ", "0.059"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"4.509", "+", " ", 
       RowBox[{"I", " ", "1.948"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"4.509", "+", " ", 
       RowBox[{"I", " ", "1.948"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"4.509", "+", " ", 
       RowBox[{"I", " ", "1.948"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d14", "=", "270"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"SetPrecision", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"{", 
            RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], 
            "}"}], "2"], ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"SetPrecision", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"{", 
            RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
            "}"}], "2"], ",", "2"}], "]"}], "]"}], ",", "dC", ",", 
       "thickness", ",", "QC"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8959244814176254`*^9, 3.8959245642889643`*^9}, {
   3.8959245943315163`*^9, 3.8959248044584074`*^9}, {3.89592484607351*^9, 
   3.895924955499893*^9}, {3.8959249978470216`*^9, 3.8959250256096964`*^9}, {
   3.8960438138162117`*^9, 3.8960438224466887`*^9}, 3.8966649985782*^9, 
   3.8966697858732777`*^9, {3.8967505689544673`*^9, 3.896750570552704*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"e656aca1-870f-40c0-9b93-4b128951c607"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "BTO", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BTO", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "1"}], ",", "Cry1", ",", "Cry2", ",", "Cry3", 
      ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<4mm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "15", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "15", ",", "0", ",", "0"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"31", ",", "31", ",", "33", ",", "0", ",", "0", ",", "0"}],
            "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "4.0", ",", "4.0", ",", "4.02", ",", "90", ",", "90", ",", "90"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<BaTiO3\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.3787"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n2\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.3787"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.2316"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "6.0757"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n22\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "6.0757"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "5.8234"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"d15", "=", "35"}], ";", 
     RowBox[{"d31", "=", "37"}], ";", 
     RowBox[{"d33", "=", "14"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8970090314236207`*^9, 3.8970090342311306`*^9}, {
  3.8970091093361864`*^9, 3.897009120847371*^9}, {3.89700915266514*^9, 
  3.8970093008005276`*^9}, {3.897009515992498*^9, 3.8970095338292694`*^9}, {
  3.897009579544096*^9, 3.89700961790901*^9}, {3.8970097867024193`*^9, 
  3.897009788916156*^9}, {3.8970100714850783`*^9, 3.8970101002336397`*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"f020739b-0177-430b-bd1b-e2d44d46dc07"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "MoS2", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MoS2", "[", 
   RowBox[{"\[Lambda]_", ":", "0.8"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "name", ",", "orientation", ",", "pg", ",", "a", ",", "b", ",", "c", ",",
       "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", ",", "n1\[Omega]", ",", 
      "n2\[Omega]", ",", "n3\[Omega]", ",", "n12\[Omega]", ",", "n22\[Omega]",
       ",", "n32\[Omega]", ",", "\[IndentingNewLine]", "d11", ",", "d12", ",",
       "d13", ",", "d14", ",", "d15", ",", "d16", ",", "d21", ",", "d22", ",",
       "d23", ",", "d24", ",", "d25", ",", "d26", ",", "d31", ",", "d32", ",",
       "d33", ",", "d34", ",", "d35", ",", "d36", ",", 
      RowBox[{"thickness", "=", "0.00065"}], ",", "Cry1", ",", "Cry2", ",", 
      "Cry3", ",", "dC", ",", "QC"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pg", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
            RowBox[{"-", "22"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "22"}], ",", "22", ",", "0", ",", "0", ",", "0", ",",
             "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], "}"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
        "\[Gamma]"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
       "3.19", ",", "3.19", ",", "6.50", ",", "90", ",", "90", ",", "120"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Cry1", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ";", "   ", 
     RowBox[{"Cry3", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";", " ", 
     RowBox[{"Cry2", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"Cry3", ",", "Cry1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", "\"\<\!\(\*SubscriptBox[\(MoS\), \(2\)]\)\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"orientation", "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cry1", ",", "Cry2", ",", "Cry3"}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab1", ".", "Cry1"}], ",", 
          RowBox[{"Lab1", ".", "Cry2"}], ",", 
          RowBox[{"Lab1", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab2", ".", "Cry1"}], ",", 
          RowBox[{"Lab2", ".", "Cry2"}], ",", 
          RowBox[{"Lab2", ".", "Cry3"}]}], "}"}], ",", "\[IndentingNewLine]", 
        "       ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Lab3", ".", "Cry1"}], ",", 
          RowBox[{"Lab3", ".", "Cry2"}], ",", 
          RowBox[{"Lab3", ".", "Cry3"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n1\[Omega]", "=", 
      RowBox[{"n2\[Omega]", "=", 
       RowBox[{"Sqrt", "@", "10.776"}]}]}], ";", 
     RowBox[{"n3\[Omega]", "=", 
      RowBox[{"Sqrt", "@", "1.9395"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n12\[Omega]", "=", 
      RowBox[{"n22\[Omega]", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"0.2489", "+", 
         RowBox[{"14.57", " ", "I"}]}], "]"}]}]}], ";", 
     RowBox[{"n32\[Omega]", "=", 
      RowBox[{"Sqrt", "[", "1.9395", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16", ",",
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26", 
        ",", "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", 
        "d36"}], "}"}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", "18"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "d22", "}"}], "=", 
      RowBox[{"{", "158.19", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dC", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "d11", ",", "d12", ",", "d13", ",", "d14", ",", "d15", ",", "d16"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d21", ",", "d22", ",", "d23", ",", "d24", ",", "d25", ",", "d26"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "d31", ",", "d32", ",", "d33", ",", "d34", ",", "d35", ",", "d36"}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pg", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "!=", "0"}], ",", 
       RowBox[{"dC", "=", 
        RowBox[{"dsym", "[", 
         RowBox[{
          RowBox[{"pg", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "dC"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", "orientation", ",", "pg", ",", 
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "\[Alpha]", ",", "\[Beta]", ",", 
         "\[Gamma]"}], "}"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n1\[Omega]", ",", "n2\[Omega]", ",", "n3\[Omega]"}], "}"}],
          "2"], "]"}], ",", 
       RowBox[{"DiagonalMatrix", "[", 
        SuperscriptBox[
         RowBox[{"{", 
          RowBox[{"n12\[Omega]", ",", "n22\[Omega]", ",", "n32\[Omega]"}], 
          "}"}], "2"], "]"}], ",", "dC", ",", "thickness", ",", "QC"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8426550803812265`*^9, 3.8426550841901274`*^9}, {
   3.842655145821518*^9, 3.8426551671723833`*^9}, {3.842655531211684*^9, 
   3.842655593243911*^9}, {3.884303876663249*^9, 3.8843039516497717`*^9}, {
   3.8885230445683928`*^9, 3.888523046283479*^9}, 3.8885230774221754`*^9, {
   3.889007788333742*^9, 3.8890077914243307`*^9}, 3.8890139038676386`*^9, {
   3.889013948103441*^9, 3.889013993729333*^9}, {3.8890144902618313`*^9, 
   3.889014495779154*^9}, {3.8890167106749673`*^9, 3.8890167108138123`*^9}, {
   3.8890167670572824`*^9, 3.889016775990918*^9}, {3.891437731054139*^9, 
   3.8914377370654488`*^9}, {3.8925638457328005`*^9, 3.8925638463521814`*^9}, 
   3.892564094274437*^9, 3.8933535528481054`*^9, {3.89338418536973*^9, 
   3.893384208382173*^9}, {3.894317120027052*^9, 3.894317153073374*^9}, {
   3.8943172548628635`*^9, 3.8943172559274697`*^9}, {3.894582341075609*^9, 
   3.8945823489967604`*^9}, {3.894585624726663*^9, 3.894585638250597*^9}, 
   3.894585792894455*^9, {3.894586353347005*^9, 3.894586401784198*^9}, {
   3.894592227618774*^9, 3.8945922356884713`*^9}, {3.894658724670315*^9, 
   3.8946587553550777`*^9}, {3.8946721558854384`*^9, 3.8946722239747534`*^9}, 
   3.8946723424152136`*^9, {3.894672782183144*^9, 3.8946727893567276`*^9}, {
   3.8946728860532475`*^9, 3.8946729230884533`*^9}, {3.8946803217578955`*^9, 
   3.8946803235281544`*^9}, {3.895747764457614*^9, 3.895747778192709*^9}, 
   3.8957478612281203`*^9, 3.895837522047835*^9, {3.8958636178436885`*^9, 
   3.895863624216496*^9}, {3.8958656270668583`*^9, 3.8958657273127375`*^9}, 
   3.895865858604431*^9, {3.895925180093006*^9, 3.89592519341943*^9}, {
   3.8960435460552397`*^9, 3.8960435555582523`*^9}, 3.8966650341525097`*^9, 
   3.896669758706303*^9, 3.8967503840260797`*^9, {3.904176054109989*^9, 
   3.904176077575979*^9}, {3.9041761155012717`*^9, 3.9041761195293274`*^9}, {
   3.9041761635653667`*^9, 3.9041762239964924`*^9}, {3.904176368134694*^9, 
   3.9041764176611757`*^9}, 3.904176550009095*^9, {3.904176660128357*^9, 
   3.9041766702794275`*^9}, {3.9041772355200806`*^9, 3.904177238701792*^9}, {
   3.906757273977559*^9, 3.906757290208516*^9}, {3.906760111834385*^9, 
   3.906760122661182*^9}, {3.906761426258911*^9, 3.9067614296953583`*^9}, {
   3.906761689148563*^9, 3.906761690375826*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"189a9a34-e96d-4c88-b4fb-962a05f5a3ae"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Visualization ", "Chapter",
 CellChangeTimes->{{3.8450629875483713`*^9, 3.845062996557543*^9}, {
  3.8489229031112695`*^9, 3.8489229050578566`*^9}, {3.854489241892913*^9, 
  3.854489247367448*^9}},ExpressionUUID->"6c361ee8-c60a-4774-93ea-\
8e8a4864c6a7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "pltWav", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"plot", " ", "wave", " ", "quickly"}], ";", " ", 
    RowBox[{"use", " ", "with", " ", "Graphics3D"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"pltWav", "[", 
    RowBox[{"wav_", ",", "pos_", ",", "color_", ",", 
     RowBox[{"thickness_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"thscale", "=", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"color", ",", 
       RowBox[{"Arrow", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"pos", ",", "pos"}], "}"}], "+", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"thscale", " ", 
            RowBox[{"Normalize", "@", 
             RowBox[{"Re", "@", 
              RowBox[{"wav", "[", "k", "]"}]}]}]}]}], "}"}]}], "]"}]}], 
      "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.837895929941512*^9, 3.837895938170895*^9}, {
   3.838844520765436*^9, 3.838844550187666*^9}, {3.846525129243972*^9, 
   3.8465251322711096`*^9}, {3.846528873103463*^9, 3.8465288831197968`*^9}, {
   3.8480112672517567`*^9, 3.84801127307761*^9}, {3.848011331445773*^9, 
   3.8480113606378717`*^9}, {3.8480114522219763`*^9, 
   3.8480115151241617`*^9}, {3.8480116492784204`*^9, 3.848011678226552*^9}, {
   3.8480118059495325`*^9, 3.8480118104248266`*^9}, {3.8544898661809025`*^9, 
   3.8544898901089687`*^9}, {3.8544899336816745`*^9, 3.854489934083889*^9}, {
   3.8863653109571223`*^9, 3.886365323124114*^9}, 3.886365491440099*^9, {
   3.886365576316636*^9, 3.8863655893494315`*^9}, 3.8863656201551943`*^9, {
   3.886365699845317*^9, 3.8863657144943123`*^9}, {3.8933376263575144`*^9, 
   3.893337626795015*^9}, {3.8933387683042784`*^9, 3.8933387718749027`*^9}, {
   3.893339097959325*^9, 3.893339100927888*^9}, {3.894592451034591*^9, 
   3.8945924920889387`*^9}, 3.8945925983393974`*^9, {3.89459269075128*^9, 
   3.8945927205004854`*^9}, {3.8945927762091093`*^9, 3.894592808443256*^9}, {
   3.894593213072794*^9, 3.8945932189332457`*^9}, {3.8945933150303526`*^9, 
   3.894593320010736*^9}, {3.8945933504343157`*^9, 3.8945933775790963`*^9}, {
   3.8945934477062163`*^9, 3.8945934485813627`*^9}, {3.894593652464726*^9, 
   3.8945936631493874`*^9}, 3.8945937444962273`*^9, {3.895365541436553*^9, 
   3.895365546760451*^9}, 3.8953666854107876`*^9, {3.895367291353115*^9, 
   3.895367291702284*^9}, {3.8953673945717063`*^9, 3.895367399256281*^9}, {
   3.89586068733958*^9, 3.8958607184006996`*^9}, {3.8958662086849895`*^9, 
   3.895866208765851*^9}},
 CellLabel->"In[76]:=",ExpressionUUID->"b6ae3fa6-73c0-476f-92c5-395265f1e96b"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Basic core functions ", "Title",
 CellChangeTimes->{{3.854489048361622*^9, 3.854489050570813*^9}, {
  3.8971741723745356`*^9, 
  3.897174173019218*^9}},ExpressionUUID->"1a7c80c2-7a75-461d-b5f3-\
4f54257b8e10"],

Cell[CellGroupData[{

Cell["Solver for Snell\[CloseCurlyQuote]s law ", "Chapter",
 CellChangeTimes->{{3.8368559613446956`*^9, 3.8368559621411257`*^9}, {
  3.8383214278716197`*^9, 3.838321433324609*^9}, {3.8383739872383795`*^9, 
  3.838373987747495*^9}, {3.8426186181304803`*^9, 3.8426186401152368`*^9}, {
  3.8544892737836533`*^9, 3.854489300893743*^9}, {3.8924904918959723`*^9, 
  3.8924905051894417`*^9}},ExpressionUUID->"ba179bfb-303a-47b6-8653-\
fccc4defc35a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Solve", " ", "for", " ", "the", " ", "wave", " ", "vector", " ", "and", 
    " ", "electric", " ", "field", " ", "direction", " ", "of", " ", "the", 
    " ", 
    RowBox[{"reflective", "/", "transmitive"}], " ", "waves"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", "solveSnell", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"solveSnell", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Inputs", ":"}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"mat", " ", "-", " ", 
       RowBox[{"the", " ", "material"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wIn", " ", "-", " ", 
       RowBox[{"the", " ", "incident", " ", "wave"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wOut1", " ", "-", " ", 
       RowBox[{"the", " ", "output", " ", 
        RowBox[{"(", 
         RowBox[{"reflective", " ", "or", " ", "transmitive"}], ")"}], " ", 
        "wave", " ", "1"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"wOut2", " ", "-", " ", 
       RowBox[{"the", " ", "output", " ", 
        RowBox[{"(", 
         RowBox[{"reflective", " ", "or", " ", "transmitive"}], ")"}], " ", 
        "wave", " ", "2"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"reflect", " ", "-", " ", 
       RowBox[{"if", " ", "True"}]}]}], ",", " ", 
     RowBox[{
      RowBox[{"compute", " ", "reflective", " ", "wave"}], ";", " ", 
      RowBox[{"if", " ", "False"}]}], ",", " ", 
     RowBox[{
      RowBox[{"compute", " ", "transmitive", " ", "wave"}], ";", " ", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Outputs", ":"}], ";", "\[IndentingNewLine]", 
      RowBox[{"k", " ", "and", " ", "E", " ", "vectors", " ", 
       RowBox[{"(", 
        RowBox[{
        "only", " ", "direction", " ", "with", " ", "normalized", " ", 
         "magnitude"}], ")"}], " ", "for", " ", "wOut1", " ", "and", " ", 
       "wOut2"}]}], ",", " ", 
     RowBox[{
      RowBox[{
      "stored", " ", "in", " ", "the", " ", "objects", " ", "wOut1", " ", 
       "and", " ", 
       RowBox[{"wOut2", "."}]}], " ", ";"}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"solveSnell", "[", 
     RowBox[{"mat_", ",", "wIn_", ",", "wOut1_", ",", "wOut2_", ",", 
      RowBox[{"reflect_", ":", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Theta]t", ",", "n0", ",", "ux", ",", "uy", ",", "uz", ",", "L", ",",
         "R", ",", "V", ",", "W", ",", "\[CapitalLambda]", ",", "C", ",", 
        "\[Theta]i", ",", "m", ",", "QP0", ",", "\[IndentingNewLine]", 
        "nfast", ",", "nslow", ",", "\[Theta]tfast", ",", "\[Theta]tslow", 
        ",", "kfast", ",", "kslow", ",", "sol", ",", "\[Eta]", ",", "v", ",", 
        "pos", ",", "vfast", ",", "vslow", ",", "\[Theta]guess", ",", 
        "\[CurlyEpsilon]P", ",", "\[CurlyEpsilon]L", ",", 
        RowBox[{"resolu", "=", 
         SuperscriptBox["10", 
          RowBox[{"-", "8"}]]}], ",", 
        RowBox[{"crit0", "=", 
         SuperscriptBox["10", 
          RowBox[{"-", "6"}]]}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Find", " ", "incident", " ", "angle", " ", "from", " ", "wIn"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Theta]i", "=", 
        RowBox[{"wIn", "[", "\[Theta]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "Find", " ", "refractive", " ", "index", " ", "of", " ", "wIn"}], 
          ";", " ", 
          RowBox[{
          "this", " ", "is", " ", "the", " ", "refractive", " ", "index", " ",
            "of", " ", "the", " ", "prior", " ", "material"}]}], ",", " ", 
         RowBox[{
          RowBox[{"not", " ", "the", " ", "current", " ", 
           RowBox[{"one", "!"}]}], " ", ";"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"n0", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"c0", " ", "/", 
           RowBox[{"wIn", "[", "\[Omega]", "]"}]}], ")"}], 
         RowBox[{"wIn", "[", "k0", "]"}]}]}], ";", " ", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Determine", " ", "whether", " ", "to", " ", "compute", " ", "the", 
          " ", "\[Omega]", " ", "or", " ", "2", "\[Omega]", " ", "waves"}], 
         ",", " ", 
         RowBox[{"from", " ", "the", " ", "wOut"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"wOut1", "[", "\[Omega]", "]"}], "-", "\[Omega]0"}], 
           "]"}], "\[LessEqual]", " ", 
          SuperscriptBox["10", 
           RowBox[{"-", "3"}]]}], ",", 
         RowBox[{
          RowBox[{"\[CurlyEpsilon]P", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]P", "]"}]}], ";", 
          RowBox[{"\[CurlyEpsilon]L", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]\[Omega]L", "]"}]}], ";", 
          RowBox[{"QP0", "=", 
           RowBox[{"mat", "[", "QP\[Omega]", "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"wOut1", "[", "\[Omega]", "]"}], "-", 
            RowBox[{"2", "\[Omega]0"}]}], "]"}], "\[LessEqual]", " ", 
          SuperscriptBox["10", 
           RowBox[{"-", "3"}]]}], ",", 
         RowBox[{
          RowBox[{"\[CurlyEpsilon]P", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]P", "]"}]}], ";", 
          RowBox[{"\[CurlyEpsilon]L", "=", 
           RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}]}], ";", 
          RowBox[{"QP0", "=", 
           RowBox[{"mat", "[", "QP2\[Omega]", "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Follow", " ", "the", " ", "routine"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ux", "=", 
        RowBox[{"Sin", "[", "\[Theta]t", "]"}]}], ";", "  ", 
       RowBox[{"uy", "=", "0.0"}], ";", "  ", 
       RowBox[{"uz", "=", 
        RowBox[{"Cos", "[", "\[Theta]t", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"L", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"uy", "^", "2"}], "+", 
             RowBox[{"uz", "^", "2"}]}], ",", 
            RowBox[{
             RowBox[{"-", "ux"}], "*", "uy"}], ",", 
            RowBox[{
             RowBox[{"-", "ux"}], "*", "uz"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "ux"}], "*", "uy"}], ",", 
            RowBox[{
             RowBox[{"ux", "^", "2"}], "+", 
             RowBox[{"uz", "^", "2"}]}], ",", 
            RowBox[{
             RowBox[{"-", "uy"}], "*", "uz"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "uz"}], "*", "ux"}], ",", 
            RowBox[{
             RowBox[{"-", "uz"}], "*", "uy"}], ",", 
            RowBox[{
             RowBox[{"ux", "^", "2"}], "+", 
             RowBox[{"uy", "^", "2"}]}]}], "}"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"R", "=", 
        RowBox[{
         RowBox[{"MatrixPower", "[", 
          RowBox[{"\[CurlyEpsilon]P", ",", 
           RowBox[{"1", "/", "2"}]}], "]"}], ".", 
         RowBox[{"Transpose", "@", "QP0"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"Pay", " ", 
         RowBox[{"attention", "!"}], " ", "My", " ", "Q", " ", "is", " ", 
         "the", " ", "transpose", " ", "of", " ", "the", " ", "Q", " ", 
         "defined", " ", "in", " ", 
         RowBox[{"Chang", "'"}], "s", " ", "paper"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"C", "=", 
        RowBox[{"Inverse", "[", "R", "]"}]}], ";", 
       RowBox[{"\[CapitalLambda]", "=", 
        RowBox[{
         RowBox[{"Transpose", "[", "C", "]"}], ".", "L", ".", "C"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"V", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "2"}], ")"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[CapitalLambda]", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
           RowBox[{"\[CapitalLambda]", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", 
           RowBox[{"\[CapitalLambda]", "[", 
            RowBox[{"[", 
             RowBox[{"3", ",", "3"}], "]"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"W", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "1"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "3"}], "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "3"}], "]"}], "]"}], 
          RowBox[{"\[CapitalLambda]", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "2"}], "]"}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<QP0,\[CurlyEpsilon]P,R,C,\[CapitalLambda],V,W\>\"", ",", 
           RowBox[{"Simplify", "@", 
            RowBox[{"{", 
             RowBox[{
             "QP0", ",", "\[CurlyEpsilon]P", ",", "R", ",", "C", ",", 
              "\[CapitalLambda]", ",", "V", ",", "W"}], "}"}]}]}], "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"For", " ", "aniso", " ", "in", " ", "general"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"nfast", "=", 
        RowBox[{"(*", 
         RowBox[{"Chop", "@"}], "*)"}], 
        RowBox[{"Simplify", "@", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", "-", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"V", "^", "2"}], "-", "W"}], "]"}]}], ")"}], "/", 
           "W"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nslow", "=", 
        RowBox[{"(*", 
         RowBox[{"Chop", "@"}], "*)"}], 
        RowBox[{"Simplify", "@", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", "+", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"V", "^", "2"}], "-", "W"}], "]"}]}], ")"}], "/", 
           "W"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Element", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", " ", 
            RowBox[{"Chop", "[", "\[CurlyEpsilon]P", "]"}]}], ",", "Reals"}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"reflect", ",", 
            RowBox[{"\[Theta]guess", "=", 
             RowBox[{"Pi", "-", "\[Theta]i"}]}], ",", 
            RowBox[{"\[Theta]guess", "=", "\[Theta]i"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"reflect", ",", 
            RowBox[{"\[Theta]guess", "=", 
             RowBox[{"Pi", "-", "\[Theta]i", "+", 
              RowBox[{"0.1", "I"}]}]}], ",", 
            RowBox[{"\[Theta]guess", "=", 
             RowBox[{"\[Theta]i", "+", 
              RowBox[{"0.1", "I"}]}]}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Quiet", "@", 
        RowBox[{"(", 
         RowBox[{"sol", "=", 
          RowBox[{"FindRoot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nfast"}], "\[Equal]", 
             " ", 
             RowBox[{"n0", " ", 
              RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Theta]t", ",", "\[Theta]guess"}], "}"}]}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Theta]tfast", "=", 
        RowBox[{"(", 
         RowBox[{"\[Theta]t", "/.", "sol"}], ")"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nfast", "=", 
        RowBox[{"(", 
         RowBox[{"nfast", "/.", "sol"}], ")"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Quiet", "@", 
        RowBox[{"(", 
         RowBox[{"sol", "=", 
          RowBox[{"FindRoot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Sin", "[", "\[Theta]t", "]"}], "nslow"}], "\[Equal]", 
             " ", 
             RowBox[{"n0", " ", 
              RowBox[{"Sin", "[", "\[Theta]i", "]"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Theta]t", ",", "\[Theta]guess"}], "}"}]}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Theta]tslow", "=", 
        RowBox[{"(", 
         RowBox[{"\[Theta]t", "/.", "sol"}], ")"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nslow", "=", 
        RowBox[{"(", 
         RowBox[{"nslow", "/.", "sol"}], ")"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<\[Theta]fast and \[Theta]slow from Snell's law:\\n\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]tfast", ",", "\[Theta]tslow"}], "}"}]}], "]"}]}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<nfast and nslow from Snell's law:\\n\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"nfast", ",", "nslow"}], "}"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "@", 
           RowBox[{"Im", "[", "\[Theta]tfast", "]"}]}], "\[LessEqual]", 
          "resolu"}], ",", 
         RowBox[{"\[Theta]tfast", "=", 
          RowBox[{"Re", "[", "\[Theta]tfast", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "@", 
           RowBox[{"Im", "[", "\[Theta]tslow", "]"}]}], "\[LessEqual]", 
          "resolu"}], ",", 
         RowBox[{"\[Theta]tslow", "=", 
          RowBox[{"Re", "[", "\[Theta]tslow", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Not", "[", "reflect", "]"}], " ", "&&", 
          RowBox[{"(", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Re", "@", "\[Theta]tfast"}], ">=", 
             RowBox[{"Pi", "/", "2"}]}], "||", 
            RowBox[{
             RowBox[{"Re", "@", "\[Theta]tslow"}], ">=", 
             RowBox[{"Pi", "/", "2"}]}]}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<Error! \[Theta]t is obtuse!\>\"", ",", 
            "\"\<\[Theta]tfast = \>\"", ",", "\[Theta]tfast", ",", 
            "\"\<\[Theta]tslow = \>\"", ",", "\[Theta]tslow"}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"reflect", " ", "&&", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Re", "@", "\[Theta]tfast"}], "<=", 
             RowBox[{"Pi", "/", "2"}]}], "||", 
            RowBox[{
             RowBox[{"Re", "@", "\[Theta]tslow"}], "<=", " ", 
             RowBox[{"Pi", "/", "2"}]}]}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<Error! \[Theta]r is acute!\>\"", ",", 
            "\"\<\[Theta]tfast = \>\"", ",", "\[Theta]tfast", ",", 
            "\"\<\[Theta]tslow = \>\"", ",", "\[Theta]tslow"}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<|kfast| and |kslow|: \\n\>\"", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"nfast", " ", 
               RowBox[{
                RowBox[{"wOut1", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}],
              ",", 
             RowBox[{"(", 
              RowBox[{"nslow", " ", 
               RowBox[{
                RowBox[{"wOut2", "[", "\[Omega]", "]"}], "/", "c0"}]}], 
              ")"}]}], "}"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"kfast", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"nfast", " ", 
           RowBox[{
            RowBox[{"wOut1", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", "\[Theta]tfast", "]"}], ",", "0", ",", 
           RowBox[{"Cos", "[", "\[Theta]tfast", "]"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kslow", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"nslow", " ", 
           RowBox[{
            RowBox[{"wOut2", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sin", "[", "\[Theta]tslow", "]"}], ",", "0", ",", 
           RowBox[{"Cos", "[", "\[Theta]tslow", "]"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut1", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k", "]"}], "]"}], "]"}], "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"kfast", ",", "crit0"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut2", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k", "]"}], "]"}], "]"}], "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"kslow", ",", "crit0"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut1", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k0", "]"}], "]"}], "]"}], "=", 
        RowBox[{"(", 
         RowBox[{"nfast", " ", 
          RowBox[{
           RowBox[{"wOut1", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut2", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "k0", "]"}], "]"}], "]"}], "=", 
        RowBox[{"(", 
         RowBox[{"nslow", " ", 
          RowBox[{
           RowBox[{"wOut2", "[", "\[Omega]", "]"}], "/", "c0"}]}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut1", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "\[Theta]", "]"}], "]"}], "]"}], "=", 
        "\[Theta]tfast"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wOut2", "[", 
         RowBox[{"[", 
          RowBox[{"Key", "[", "\[Theta]", "]"}], "]"}], "]"}], "=", 
        "\[Theta]tslow"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"\[Theta]tfast", "-", "\[Theta]tslow"}], ",", "resolu"}], 
           "]"}], "\[Equal]", "0"}], " ", ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"For", " ", "Isotropic"}], ",", " ", 
           RowBox[{
           "or", "  ", "when", " ", "two", " ", "waves", " ", "are", " ", 
            "identical", " ", "in", " ", "propagting", " ", "direction"}]}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", "\"\<Iso or quasi Iso\\n\>\"", "]"}]}], 
           "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"eigenStandard", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{"\[CapitalLambda]", "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tfast"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"HermitianMatrixQ", "[", "m", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"m", ",", "2", ",", 
                  RowBox[{"Method", "\[Rule]", "\"\<Banded\>\""}]}], "]"}]}], 
               "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"m", ",", "2"}], "]"}]}]}], "\[IndentingNewLine]", 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"v", "=", 
              RowBox[{"Normalize", "/@", 
               RowBox[{"(", 
                RowBox[{"v", ".", 
                 RowBox[{"C", "\[Transpose]"}]}], ")"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using standard eigensystem {\[Eta],v} for \
\[Theta]tfast\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"L", ",", "\[CurlyEpsilon]L"}], "}"}], "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tfast"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
              RowBox[{"Eigensystem", "[", 
               RowBox[{"m", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using generalized eigensystem {\[Eta],v} for \
\[Theta]tfast\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"vfast", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "crit0"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"vslow", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "crit0"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<vfast, vslow\\n\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"vfast", ",", " ", "vslow"}], "}"}]}], "]"}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut1", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut1", "[", "EE", "]"}], "vfast"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut2", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut2", "[", "EE", "]"}], "vslow"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", "\"\<Aniso\\n\>\"", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"eigenStandard", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{"\[CapitalLambda]", "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tfast"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"HermitianMatrixQ", "[", "m", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"m", ",", "2", ",", 
                  RowBox[{"Method", "\[Rule]", "\"\<Banded\>\""}]}], "]"}]}], 
               "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"m", ",", "2"}], "]"}]}]}], "\[IndentingNewLine]", 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"v", "=", 
              RowBox[{"Normalize", "/@", 
               RowBox[{"(", 
                RowBox[{"v", ".", 
                 RowBox[{"C", "\[Transpose]"}]}], ")"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using standard eigensystem {\[Eta],v} for \
\[Theta]tfast\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"L", ",", "\[CurlyEpsilon]L"}], "}"}], "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tfast"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
              RowBox[{"Eigensystem", "[", 
               RowBox[{"m", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using generalized eigensystem {\[Eta],v} for \
\[Theta]tfast\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"vfast", "=", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"\[Eta]", ",", "v"}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", 
                  RowBox[{"1", "/", 
                   SuperscriptBox["nfast", "2"]}]}], "]"}], "<=", "resolu"}], 
               "&"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"vfast", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{"vfast", ",", "crit0"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut1", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut1", "[", "EE", "]"}], "vfast"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"eigenStandard", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{"\[CapitalLambda]", "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tslow"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"HermitianMatrixQ", "[", "m", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{"m", ",", "2", ",", 
                   RowBox[{"Method", "\[Rule]", "\"\<Banded\>\""}]}], "]"}]}],
                 ")"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{"m", ",", "2"}], "]"}]}], ")"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"v", "=", 
              RowBox[{"Normalize", "/@", 
               RowBox[{"(", 
                RowBox[{"v", ".", 
                 RowBox[{"C", "\[Transpose]"}]}], ")"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using standard eigensystem {\[Eta],v} for \
\[Theta]tslow\\n\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}]}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"m", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"L", ",", "\[CurlyEpsilon]L"}], "}"}], "/.", 
               RowBox[{"\[Theta]t", "\[Rule]", " ", "\[Theta]tslow"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Eta]", ",", "v"}], "}"}], "=", 
              RowBox[{"Eigensystem", "[", 
               RowBox[{"m", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{"debug", ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Using generalized {\[Eta],v} for \[Theta]tslow\\n\>\"", 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Eta]", ",", "v"}], "}"}]}], "]"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"vslow", "=", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"\[Eta]", ",", "v"}], "}"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "-", 
                  RowBox[{"1", "/", 
                   SuperscriptBox["nslow", "2"]}]}], "]"}], "<=", "resolu"}], 
               "&"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"vslow", "=", 
           RowBox[{"Chop", "[", 
            RowBox[{"vslow", ",", "crit0"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wOut2", "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "EE", "]"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wOut2", "[", "EE", "]"}], "vslow"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"debug", ",", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<vfast, vslow\\n\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"vfast", ",", " ", "vslow"}], "}"}]}], "]"}]}], "]"}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.836987235869816*^9, 3.8369875424530287`*^9}, {
   3.836987732119399*^9, 3.8369877391489916`*^9}, {3.8370022642427316`*^9, 
   3.837002267788765*^9}, {3.83789562853448*^9, 3.8378957125287094`*^9}, {
   3.8380731288320303`*^9, 3.838073142791238*^9}, {3.8380783522485623`*^9, 
   3.8380783547552795`*^9}, {3.838078915155344*^9, 3.8380789404849205`*^9}, {
   3.838079088800289*^9, 3.838079095047598*^9}, {3.8380791392906446`*^9, 
   3.8380791428874936`*^9}, {3.8380794051199636`*^9, 3.838079438290722*^9}, {
   3.838079590187483*^9, 3.838079601044285*^9}, {3.838079815014067*^9, 
   3.8380798672322206`*^9}, {3.838079970005868*^9, 3.838079973887388*^9}, {
   3.838080175517726*^9, 3.8380801796640043`*^9}, {3.838080247715228*^9, 
   3.838080261630459*^9}, {3.838080329095562*^9, 3.838080336274848*^9}, {
   3.838080396888803*^9, 3.838080400750163*^9}, {3.838080512039254*^9, 
   3.838080526841633*^9}, {3.8380806709464827`*^9, 3.838080746984773*^9}, {
   3.8380809218385277`*^9, 3.83808093187749*^9}, {3.838081847210945*^9, 
   3.838081863953209*^9}, 3.838081968293333*^9, {3.8380820479616594`*^9, 
   3.838082097529948*^9}, 3.8380821503385286`*^9, {3.838082190287694*^9, 
   3.83808221766566*^9}, {3.8380823197611704`*^9, 3.838082345107314*^9}, {
   3.838082724712278*^9, 3.838082734970471*^9}, {3.83808288510087*^9, 
   3.8380828872665205`*^9}, 3.83808293798044*^9, {3.8381214886005735`*^9, 
   3.8381215010717382`*^9}, {3.8381244643777866`*^9, 3.838124469171367*^9}, {
   3.8381291046978393`*^9, 3.8381291056169605`*^9}, {3.838129137502285*^9, 
   3.838129146170639*^9}, {3.838129281602539*^9, 3.8381292859994884`*^9}, {
   3.8381303441110864`*^9, 3.8381303497320614`*^9}, {3.8381304179188137`*^9, 
   3.838130477821575*^9}, {3.8381306238219333`*^9, 3.8381306398292017`*^9}, {
   3.838130671924817*^9, 3.838130995364807*^9}, {3.838131045907828*^9, 
   3.838131163999233*^9}, {3.838131227510442*^9, 3.838131244559013*^9}, {
   3.838132445040496*^9, 3.838132465164647*^9}, {3.838133347335333*^9, 
   3.8381333611215267`*^9}, {3.8381334392186213`*^9, 
   3.8381334632789555`*^9}, {3.838133820077355*^9, 3.838133823534934*^9}, {
   3.838133868771288*^9, 3.838133878670373*^9}, {3.838141096481681*^9, 
   3.8381412413286014`*^9}, {3.8381413132618103`*^9, 
   3.8381413915044785`*^9}, {3.8381414600959573`*^9, 3.83814146323137*^9}, {
   3.8381415391736946`*^9, 3.838141592335681*^9}, {3.838142255639763*^9, 
   3.838142255855713*^9}, {3.838142433563981*^9, 3.838142465068781*^9}, {
   3.8381425102109537`*^9, 3.8381425318282003`*^9}, {3.8381428217809887`*^9, 
   3.8381428249874964`*^9}, {3.838142876065695*^9, 3.8381429066976786`*^9}, {
   3.8381430820806646`*^9, 3.838143088023468*^9}, 3.8381434510103436`*^9, 
   3.8381434878514824`*^9, {3.838148512480132*^9, 3.8381485192781568`*^9}, 
   3.838148627819662*^9, {3.838148814628936*^9, 3.8381488282085495`*^9}, {
   3.838209537623029*^9, 3.8382095560692887`*^9}, {3.8382099283489947`*^9, 
   3.8382099725482283`*^9}, {3.8382100461704245`*^9, 
   3.8382100563803043`*^9}, {3.838210136048304*^9, 3.8382101832824793`*^9}, {
   3.838210337957515*^9, 3.8382103663435607`*^9}, {3.8382112095911617`*^9, 
   3.8382112214780807`*^9}, 3.838211441969533*^9, 3.838211711878306*^9, {
   3.8382117530652313`*^9, 3.838211765150365*^9}, {3.8382118478012457`*^9, 
   3.838211852326254*^9}, {3.8382463886792297`*^9, 3.838246452606124*^9}, {
   3.8382465103326054`*^9, 3.8382465685212307`*^9}, {3.8382466574074273`*^9, 
   3.838246688846511*^9}, {3.838247162568609*^9, 3.8382471733926463`*^9}, {
   3.8382472034039063`*^9, 3.8382472363116856`*^9}, {3.8382473447502623`*^9, 
   3.838247357494445*^9}, 3.8382520380669546`*^9, {3.8382522393956127`*^9, 
   3.838252247884816*^9}, {3.838252507034498*^9, 3.8382525920844913`*^9}, {
   3.8383029610999913`*^9, 3.8383029728999057`*^9}, {3.8383057837577662`*^9, 
   3.8383058200438995`*^9}, {3.83830595781818*^9, 3.83830597513659*^9}, {
   3.838306016315999*^9, 3.8383060229322796`*^9}, {3.8383060648933983`*^9, 
   3.83830614410723*^9}, {3.8383064888365126`*^9, 3.8383064893430467`*^9}, {
   3.8383085354098616`*^9, 3.8383085354910154`*^9}, {3.8383085742097063`*^9, 
   3.838308634974328*^9}, {3.8383087918684545`*^9, 3.8383088128842382`*^9}, {
   3.838308930165825*^9, 3.8383089616258616`*^9}, {3.83830900201204*^9, 
   3.838309009871872*^9}, {3.8383090545469837`*^9, 3.838309061253982*^9}, {
   3.8383098764829073`*^9, 3.8383098800153265`*^9}, {3.8383104355020995`*^9, 
   3.8383104392948284`*^9}, {3.838310496262558*^9, 3.8383105097218046`*^9}, {
   3.838310685982623*^9, 3.8383107194297085`*^9}, {3.838310769839418*^9, 
   3.8383107716533623`*^9}, {3.838310815860279*^9, 3.8383108196667094`*^9}, {
   3.8383108746424046`*^9, 3.8383108852768846`*^9}, {3.83831095634803*^9, 
   3.8383109836626253`*^9}, {3.838311297214005*^9, 3.8383112985583506`*^9}, 
   3.838311710507812*^9, 3.8383117562937202`*^9, {3.8383117888042336`*^9, 
   3.838311792180388*^9}, 3.838312112733467*^9, {3.8383121844206076`*^9, 
   3.838312187513612*^9}, {3.8383122204544*^9, 3.8383122218985043`*^9}, {
   3.838313570597328*^9, 3.8383136378644886`*^9}, 3.8383909138639746`*^9, 
   3.838390953421402*^9, {3.838399040639262*^9, 3.8383990974860916`*^9}, {
   3.8383991454909234`*^9, 3.8383992244536486`*^9}, {3.8383992553518596`*^9, 
   3.8383993476673803`*^9}, {3.838399402806449*^9, 3.8383994104236784`*^9}, {
   3.838506966874176*^9, 3.838506967402253*^9}, {3.8385092492741613`*^9, 
   3.8385092577233067`*^9}, {3.8388448397088523`*^9, 
   3.8388448660038433`*^9}, {3.8388449150762806`*^9, 
   3.8388449746045513`*^9}, {3.838845035396044*^9, 3.8388450500610895`*^9}, {
   3.83884508490654*^9, 3.8388450887348585`*^9}, {3.8404820608620057`*^9, 
   3.840482099698968*^9}, {3.842619577486884*^9, 3.8426196026951103`*^9}, {
   3.8426466981584015`*^9, 3.842646748648177*^9}, {3.84281582006942*^9, 
   3.842815823209282*^9}, {3.8428159225612297`*^9, 3.8428159238265657`*^9}, 
   3.8428159710356016`*^9, {3.8453269837182293`*^9, 3.8453270305557156`*^9}, {
   3.845327295223387*^9, 3.84532730725885*^9}, {3.8453288774482307`*^9, 
   3.845328878070001*^9}, 3.847752715122489*^9, 3.847752761438386*^9, 
   3.847753488012537*^9, 3.847753883098298*^9, {3.8477884477202883`*^9, 
   3.8477884667832747`*^9}, {3.847788566877906*^9, 3.8477885870263567`*^9}, {
   3.8480138054156065`*^9, 3.848013810428177*^9}, {3.8544922840921793`*^9, 
   3.854492853676478*^9}, {3.8544929195612173`*^9, 3.8544929292685227`*^9}, {
   3.85449297533694*^9, 3.8544930027021275`*^9}, {3.8544935532829313`*^9, 
   3.8544936225355873`*^9}, {3.88784356387869*^9, 3.887843609092973*^9}, {
   3.887925353942572*^9, 3.8879253808374257`*^9}, {3.8924668379108467`*^9, 
   3.892466864191577*^9}, 3.892761678657649*^9, {3.8927617685271015`*^9, 
   3.8927617705523386`*^9}, {3.892761863114113*^9, 3.8927619679014235`*^9}, {
   3.892762159730381*^9, 3.8927622159886875`*^9}, {3.892762713451907*^9, 
   3.892762740280679*^9}, {3.893704359190474*^9, 3.89370439251048*^9}, {
   3.893704761272047*^9, 3.893704841711171*^9}, {3.893704877371661*^9, 
   3.8937048884795027`*^9}, {3.8937088053179703`*^9, 
   3.8937088337296467`*^9}, {3.893708963754801*^9, 3.893708986985428*^9}, {
   3.893709031587142*^9, 3.8937090327641325`*^9}, {3.893709072133047*^9, 
   3.8937091037390738`*^9}, {3.8937094130939274`*^9, 
   3.8937094770622625`*^9}, {3.893709641027548*^9, 3.8937096705850596`*^9}, 
   3.893709818892939*^9, {3.8937100057329416`*^9, 3.8937100395597343`*^9}, {
   3.8937104603401017`*^9, 3.893710464134497*^9}, {3.8937141768142443`*^9, 
   3.8937142098693547`*^9}, 3.893715109779149*^9, {3.893715208807256*^9, 
   3.8937152421445293`*^9}, {3.8937152736381903`*^9, 3.893715342182088*^9}, {
   3.8937315806551294`*^9, 3.8937315898204813`*^9}, {3.893797383427883*^9, 
   3.893797388525072*^9}, {3.8938086827007236`*^9, 3.8938086927504077`*^9}, {
   3.893936830664913*^9, 3.893936834715207*^9}, {3.8939369997647448`*^9, 
   3.893937034719015*^9}, {3.893939609637813*^9, 3.893939701001115*^9}, {
   3.8939397953095655`*^9, 3.8939398139785767`*^9}, {3.893940078919491*^9, 
   3.893940086231405*^9}, {3.8939426514077497`*^9, 3.893942828677187*^9}, {
   3.8939428602473536`*^9, 3.893942926527954*^9}, {3.8957136736506925`*^9, 
   3.8957136862632656`*^9}, {3.895713754684766*^9, 3.895713771168566*^9}, {
   3.8957169379068546`*^9, 3.895716997590916*^9}, {3.895862175313019*^9, 
   3.8958621924588823`*^9}, 3.8958820674562054`*^9, {3.8958823250236855`*^9, 
   3.8958823496280107`*^9}, {3.8958823832784634`*^9, 3.895882391706993*^9}, 
   3.8958825140426607`*^9, {3.895885292262371*^9, 3.895885295810643*^9}, {
   3.895885394622199*^9, 3.8958854071485157`*^9}, {3.8966658720266256`*^9, 
   3.8966659038669877`*^9}, {3.896665963630591*^9, 3.8966659943289957`*^9}, 
   3.8970178446849375`*^9, {3.897018461210894*^9, 3.89701847083834*^9}, {
   3.8970186640666475`*^9, 3.8970186690520115`*^9}, 3.897018766148904*^9, {
   3.8970187976894646`*^9, 3.8970188183899193`*^9}, {3.8970188792726755`*^9, 
   3.8970188819009423`*^9}, {3.89701903872587*^9, 3.8970190614828515`*^9}, {
   3.8970195525792694`*^9, 3.897019553485156*^9}, {3.897089761661484*^9, 
   3.8970897762805643`*^9}, 3.897089852868108*^9, 3.897089901507635*^9, {
   3.897094731811201*^9, 3.897094733690199*^9}, {3.8970947993880644`*^9, 
   3.8970948134184866`*^9}, {3.8973314098444247`*^9, 3.897331451751294*^9}, {
   3.897331505068515*^9, 3.897331524221115*^9}, {3.897333776417839*^9, 
   3.897333854112446*^9}, {3.897336858254589*^9, 3.8973368602273993`*^9}, {
   3.8974377077787275`*^9, 3.8974377352584205`*^9}, 3.897437950591372*^9, {
   3.8974380672042246`*^9, 3.8974380716028976`*^9}, {3.8974381445896163`*^9, 
   3.8974381460357685`*^9}, 3.897438182876459*^9, 3.8974383216760845`*^9, {
   3.8974411680999575`*^9, 3.897441168666237*^9}, {3.8978546459786997`*^9, 
   3.897854652254031*^9}, {3.897858667254608*^9, 3.897858670073699*^9}, {
   3.8978587037310133`*^9, 3.8978587063224277`*^9}, {3.8978587966283503`*^9, 
   3.897858805777769*^9}, {3.8978589327947874`*^9, 3.8978589554120193`*^9}, {
   3.8978590155806923`*^9, 3.897859019556755*^9}, {3.8978590643039007`*^9, 
   3.897859077180575*^9}, {3.8978624775272617`*^9, 3.897862479960432*^9}, {
   3.8978625832207546`*^9, 3.8978625834487543`*^9}, {3.8978627595708447`*^9, 
   3.897862818539895*^9}, {3.904176795439725*^9, 3.9041768078321686`*^9}, 
   3.9041768552728605`*^9, {3.9041769000552173`*^9, 3.904176912823416*^9}, {
   3.904176986917593*^9, 3.9041770348091335`*^9}, {3.904177071337497*^9, 
   3.9041770818727875`*^9}},
 CellLabel->"In[78]:=",ExpressionUUID->"97649922-01c2-4c2d-bfce-4d5a98b082b0"]
}, Closed]],

Cell[CellGroupData[{

Cell["Solver for Fresnel\[CloseCurlyQuote]s law ", "Chapter",
 CellChangeTimes->{{3.8426186505890365`*^9, 3.8426186537946205`*^9}, {
   3.854489278720081*^9, 3.8544893085253057`*^9}, 3.8579495546623363`*^9, {
   3.892490495462247*^9, 
   3.8924905029753895`*^9}},ExpressionUUID->"5b8a343e-1607-4b4e-83d0-\
2845b6a33fb9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Solve", " ", "the", " ", "electric", " ", "field", " ", "magnitude", " ", 
    "of", " ", "the", " ", 
    RowBox[{"reflective", "/", "transmitive"}], " ", "waves", " ", "by", " ", 
    "boundary", " ", "condition", " ", "method"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "single", " ", "reflection", " ", "on", " ", "one", " ", 
    "surface"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Inputs", ":"}], ";", "\[IndentingNewLine]", 
    RowBox[{"wIn", " ", "-", " ", 
     RowBox[{"a", " ", "list", " ", "of", " ", "incident", " ", "waves"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"wR", " ", "-", " ", 
     RowBox[{"a", " ", "list", " ", "of", " ", "reflective", " ", "waves"}]}],
     ";", " ", "\[IndentingNewLine]", 
    RowBox[{"wT", " ", "-", " ", 
     RowBox[{
     "a", " ", "list", " ", "of", " ", "transmitive", " ", "waves"}]}], ";"}],
    " ", "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "solveFresnel", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"solveFresnel", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Generalized", " ", "wIn"}], ",", " ", "wR", ",", " ", 
     RowBox[{
     "wT", " ", "with", " ", "any", " ", "numbers", " ", "of", " ", 
      "waves"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"solveFresnel", "[", 
     RowBox[{"wIn_List", ",", "wR_List", ",", "wT_List", ",", "unknowns_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "getH", ",", "sol", ",", "equ", ",", "EMtop", ",", "EMbot", ",", 
        "HMtop", ",", "HMbot", ",", "B", ",", "M"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"getH", "[", "wav_", "]"}], ":=", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "k", "]"}], "@", "wav"}], ",", 
           RowBox[{
            RowBox[{"Key", "[", "EE", "]"}], "@", "wav"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "\[Omega]", "]"}], "@", "wav"}], " ", 
           "\[Mu]0"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"EMtop", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{"wIn", ",", "wR"}], "}"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"EMbot", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", "wT", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"HMtop", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"getH", "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{"wIn", ",", "wR"}], "}"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"HMbot", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"getH", "@", "#"}], ")"}], "&"}], "/@", 
          RowBox[{"Flatten", "[", "wT", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"flagLinearSolve", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"equ", "=", 
           RowBox[{"(*", 
            RowBox[{"Simplify", "@"}], "*)"}], 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"EMtop", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", 
               RowBox[{"EMbot", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "==", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"HMtop", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", 
               RowBox[{"HMbot", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "==", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"EMtop", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"EMbot", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "==", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"HMtop", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"HMbot", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "==", "0"}]}], "}"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"B", ",", "M"}], "}"}], "=", 
           RowBox[{"Normal", "@", 
            RowBox[{"CoefficientArrays", "[", 
             RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"sol", "=", 
           RowBox[{"Thread", "[", 
            RowBox[{"unknowns", "->", 
             RowBox[{"LinearSolve", "[", 
              RowBox[{"M", ",", "B"}], "]"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"equ", "=", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"EMtop", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}], "==", 
              RowBox[{"EMbot", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"HMtop", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}], "==", 
              RowBox[{"HMbot", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", "2"}], "]"}], "]"}]}]}], 
            "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"equ", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Simplify", "@", 
             RowBox[{"(", 
              RowBox[{"Thread", "/@", "equ"}], ")"}]}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Quiet", "@", 
           RowBox[{"If", "[", 
            RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"NSolve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}], 
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"Solve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"sol", "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{
             RowBox[{
             "Print", "[", "\"\<sol is {} in solveFresnel! \>\"", "]"}], ";", 
             RowBox[{"sol", "=", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"unknowns", "->", 
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"Length", "@", "unknowns"}]}], "]"}]}], "}"}], 
               "]"}]}]}], ",", 
            RowBox[{"sol", "=", 
             RowBox[{"sol", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Return", "[", "sol", "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"wR", "=", 
        RowBox[{"wR", "/.", "sol"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Only", " ", "updated", " ", "the", " ", "E", " ", "of", " ", 
          "waves", " ", "in", " ", "the", " ", "List", " ", "wR"}], ",", " ", 
         RowBox[{"not", " ", "H"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wT", "=", 
        RowBox[{"wT", "/.", "sol"}]}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.83850781742671*^9, 3.838507864212983*^9}, {
   3.8388451531031713`*^9, 3.838845195437742*^9}, {3.838858002202878*^9, 
   3.8388580143995686`*^9}, {3.8404859531758585`*^9, 3.840486023555131*^9}, {
   3.8426186808137493`*^9, 3.84261869025289*^9}, 3.8426219794010305`*^9, {
   3.842623948183436*^9, 3.842623967097224*^9}, {3.8429935525428534`*^9, 
   3.842993555073105*^9}, {3.8429999530378103`*^9, 3.842999962577392*^9}, {
   3.8450661089280405`*^9, 3.8450661362177334`*^9}, {3.848014985284827*^9, 
   3.848014999765652*^9}, {3.854493635830864*^9, 3.854493725365817*^9}, {
   3.8580023296735334`*^9, 3.858002371654166*^9}, {3.8580036838203287`*^9, 
   3.858003765629012*^9}, {3.8580038534614477`*^9, 3.858003856508622*^9}, 
   3.858004312270825*^9, {3.858004346416974*^9, 3.858004360999828*^9}, {
   3.858004441520091*^9, 3.858004451045829*^9}, 3.8580046431846123`*^9, 
   3.858004723560726*^9, {3.8580047807373676`*^9, 3.8580048236209173`*^9}, {
   3.858004860472432*^9, 3.858004869197146*^9}, 3.8864742110690355`*^9, {
   3.887847770303116*^9, 3.887847801295599*^9}, {3.8878479279400187`*^9, 
   3.8878479399041767`*^9}, {3.8878479813571405`*^9, 3.887847986474515*^9}, {
   3.8878480636648235`*^9, 3.887848068940711*^9}, {3.8878481567852154`*^9, 
   3.887848170413537*^9}, {3.8878483175932426`*^9, 3.8878483608101983`*^9}, {
   3.887853267676303*^9, 3.887853274290948*^9}, {3.88785365241877*^9, 
   3.8878536734537544`*^9}, 3.88785371790602*^9, {3.887856185522129*^9, 
   3.8878562488131657`*^9}, 3.887920294533537*^9, {3.8879208411793203`*^9, 
   3.8879208496979747`*^9}, {3.8879209209660587`*^9, 3.887920923295587*^9}, {
   3.88792098864362*^9, 3.887921043387307*^9}, {3.8879219850186644`*^9, 
   3.8879219901921973`*^9}, {3.887934144561592*^9, 3.8879342174207554`*^9}, {
   3.8882334870430818`*^9, 3.888233506927416*^9}, 3.8924879175627503`*^9, {
   3.8924889315777273`*^9, 3.892489002076596*^9}, {3.892490935790052*^9, 
   3.892490952209859*^9}, {3.8924910122995253`*^9, 3.8924911401046133`*^9}, {
   3.8924912598071747`*^9, 3.892491327882967*^9}, 3.892492499078909*^9, {
   3.8924925473096747`*^9, 3.8924925556712246`*^9}, 3.892494008703597*^9, {
   3.8924940765595007`*^9, 3.89249407888083*^9}, 3.892494307340926*^9, {
   3.8924944574517803`*^9, 3.892494484373708*^9}, 3.8924947587574644`*^9, 
   3.8927628142006016`*^9, {3.8932941286585655`*^9, 3.8932941399943333`*^9}, 
   3.893295489475665*^9, {3.8936961732681274`*^9, 3.8936961948162413`*^9}, {
   3.8937310965049706`*^9, 3.8937311037025647`*^9}, {3.8937322759261637`*^9, 
   3.893732333132752*^9}, {3.8937323861248407`*^9, 3.893732507519503*^9}, {
   3.8937325696646585`*^9, 3.8937325734687223`*^9}, 3.8937326295129213`*^9, {
   3.8937326680863495`*^9, 3.8937326761715975`*^9}, {3.893940035982898*^9, 
   3.893940040931528*^9}, 3.8939435506672935`*^9, {3.893981104813258*^9, 
   3.8939811049780207`*^9}, 3.8958375895160155`*^9, 3.895860726508342*^9, 
   3.895861315636387*^9, {3.8958820954837723`*^9, 3.8958821374682446`*^9}, 
   3.8958846812887545`*^9, 3.8958849612794285`*^9, 3.896097138340526*^9, {
   3.8960973282195387`*^9, 3.896097329858135*^9}, {3.8960973972925572`*^9, 
   3.8960974054338956`*^9}, 3.896664941609304*^9, {3.897854788538865*^9, 
   3.8978547901302767`*^9}, {3.8978554145232*^9, 3.8978554205976195`*^9}, {
   3.8978554539054728`*^9, 3.8978554711441226`*^9}, {3.8978564761339297`*^9, 
   3.8978564816979637`*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"39d1645c-06da-4289-ab26-9fba6e886f8f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Solve", " ", "the", " ", "electric", " ", "field", " ", "magnitude", " ", 
    "of", " ", "the", " ", 
    RowBox[{"reflective", "/", "transmitive"}], " ", "waves", " ", "by", " ", 
    "boundary", " ", "condition", " ", "method"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "reflection", " ", "and", " ", "transmission", " ", "of", " ", 
    "nonlinear", " ", "waves", " ", "across", " ", "arbitrary", " ", "number",
     " ", "of", " ", "slabs"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Inputs", ":"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wAir", " ", "-", " ", 
      RowBox[{
      "a", " ", "list", " ", "of", " ", "waves", " ", "from", " ", "Air", " ",
        "or", " ", "into", " ", "Air"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wF", " ", "-", " ", 
      RowBox[{"a", " ", "list", " ", "of", " ", "Forward", " ", "waves"}]}], 
     ";", " ", "\[IndentingNewLine]", 
     RowBox[{"wB", " ", "-", " ", 
      RowBox[{"a", " ", "list", " ", "of", " ", "Backward", " ", "waves"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"wSub", " ", "-", " ", 
      RowBox[{
      "a", " ", "lits", " ", "of", "  ", "waves", " ", "into", " ", 
       "Substrate", " ", 
       RowBox[{"(", 
        RowBox[{"can", " ", "be", " ", "Air"}], ")"}]}]}], ";", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"nM", " ", "-", " ", 
      RowBox[{"the", " ", "number", " ", "of", " ", "media", " ", 
       RowBox[{"(", "layers", ")"}], " ", "is", " ", "obtained", " ", "from", 
       " ", "the", " ", "length", " ", "of", " ", "wF"}]}], ";", "  ", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Outpus", ":"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{
     "the", " ", "solved", " ", "electric", " ", "field", " ", "vectors", " ",
       "for", " ", "wAir"}]}], ",", " ", "wF", ",", " ", "wB", ",", " ", 
    RowBox[{"and", " ", "wSub"}], ",", " ", 
    RowBox[{
     RowBox[{
     "all", " ", "stored", " ", "in", " ", "the", " ", "corresponding", " ", 
      "objects", " ", "of", " ", "the", " ", "lists"}], " ", ";"}]}], " ", 
   "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "solveFresnelN", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"solveFresnelN", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"solveFresnelN", "[", 
     RowBox[{
     "wAir_", ",", "wMed_", ",", "wSub_", ",", "thickness_", ",", 
      "unknowns_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"sol", "=", 
         RowBox[{"{", "}"}]}], ",", "i", ",", 
        RowBox[{"equ", "=", 
         RowBox[{"{", "}"}]}], ",", "equE", ",", "equH", ",", "nM", ",", 
        "equTop", ",", "equBot", ",", "getH", ",", 
        RowBox[{"nloop", "=", "0"}], ",", "B", ",", "M"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nM", "=", 
        RowBox[{"Length", "[", "wMed", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"getH", "[", "wav_", "]"}], ":=", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "k", "]"}], "@", "wav"}], ",", 
           RowBox[{
            RowBox[{"Key", "[", "EE", "]"}], "@", "wav"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Key", "[", "\[Omega]", "]"}], "@", "wav"}], " ", 
           "\[Mu]0"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"contruct", " ", "the", " ", "boundary", " ", "conditions"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"the", " ", "top", " ", "surface"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"equTop", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", "wAir"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{"Key", "[", "EE", "]"}], "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{"getH", "/@", "wAir"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{"getH", "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], "}"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"equ", ",", "equTop"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"the", " ", "multilayers"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "<", "nM"}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"equE", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{"I", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}]}], 
                   ")"}], "&"}], "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{
                 RowBox[{"Key", "[", "EE", "]"}], "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"equH", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{"I", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"getH", "@", "#"}], ")"}]}], ")"}], "&"}], "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "\[Equal]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Total", "[", 
                RowBox[{"getH", "/@", 
                 RowBox[{"wMed", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"equ", ",", 
            RowBox[{"{", 
             RowBox[{"equE", ",", "equH"}], "}"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"the", " ", "bottom", " ", "surface"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"equBot", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{"I", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "nM", "]"}], "]"}]}], ")"}]}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Key", "[", "EE", "]"}], "@", "#"}], ")"}]}], 
                  ")"}], "&"}], "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "nM", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "==", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", "wSub"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{"I", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", "k", "]"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", "nM", "]"}], "]"}]}], ")"}]}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{"getH", "@", "#"}], ")"}]}], ")"}], "&"}], "/@", 
                RowBox[{"wMed", "[", 
                 RowBox[{"[", "nM", "]"}], "]"}]}], "]"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}], "==", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{"getH", "/@", "wSub"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}], ")"}]}]}], "}"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"equ", ",", "equBot"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"equ", "=", 
        RowBox[{"(*", 
         RowBox[{"Chop", "@"}], "*)"}], 
        RowBox[{"(*", 
         RowBox[{"Simplify", "@"}], "*)"}], 
        RowBox[{"Flatten", "[", "equ", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"equ", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"(", 
          RowBox[{"Thread", "/@", "equ"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<k of wMed\\n\>\"", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "k", "]"}], "&"}], "/@", 
            RowBox[{"wMed", "[", 
             RowBox[{"[", "nM", "]"}], "]"}]}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Here!!! equ\\n\>\"", ",", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "@", 
                RowBox[{"(", 
                 RowBox[{"Thread", "/@", "equ"}], ")"}]}], "/.", 
               RowBox[{"{", 
                RowBox[{"\[CapitalDelta]\[Delta]", "->", "0"}], "}"}]}], "//",
               "Simplify"}], "//", "Chop"}], "//", "MatrixForm"}]}], "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"flagLinearSolve", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"B", ",", "M"}], "}"}], "=", 
           RowBox[{"Normal", "@", 
            RowBox[{"CoefficientArrays", "[", 
             RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"sol", "=", 
           RowBox[{"Thread", "[", 
            RowBox[{"unknowns", "->", 
             RowBox[{"LinearSolve", "[", 
              RowBox[{"M", ",", "B"}], "]"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Quiet", "@", 
           RowBox[{"If", "[", 
            RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"NSolve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"Solve", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "sol"}], "==", "0"}], ",", 
            RowBox[{
             RowBox[{
             "Print", "[", "\"\<sol is {} in solveFresnelN!\>\"", "]"}], ";", 
             RowBox[{"sol", "=", 
              RowBox[{"Thread", "[", 
               RowBox[{"unknowns", "->", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0.", ",", 
                  RowBox[{"Length", "@", "unknowns"}]}], "]"}]}], "]"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"sol", "=", 
             RowBox[{"sol", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<sol\\n\>\"", ",", 
           RowBox[{
            RowBox[{"sol", "//", "Simplify"}], "//", "MatrixForm"}]}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"wAir", "=", 
        RowBox[{"wAir", "/.", "sol"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wSub", "=", 
        RowBox[{"wSub", "/.", "sol"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wMed", "=", 
        RowBox[{"wMed", "/.", "sol"}]}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.847732906800084*^9, 3.8477329822705135`*^9}, {
   3.8477505131278243`*^9, 3.8477505136422763`*^9}, 3.8477505802587724`*^9, {
   3.847750611559699*^9, 3.8477506120901637`*^9}, {3.847799152572941*^9, 
   3.847799430473942*^9}, {3.8477995149229507`*^9, 3.8477997171506815`*^9}, {
   3.8477998400713997`*^9, 3.847799867399284*^9}, {3.847799911226136*^9, 
   3.8477999422911916`*^9}, {3.8477999891864815`*^9, 3.847800024705925*^9}, {
   3.847800098418672*^9, 3.8478001217475977`*^9}, {3.8478001803190837`*^9, 
   3.8478001809287643`*^9}, {3.8478002389958196`*^9, 3.847800537042777*^9}, {
   3.847800606055557*^9, 3.847800619061784*^9}, {3.847800970346955*^9, 
   3.8478009787252398`*^9}, {3.8478011036027946`*^9, 3.847801110211218*^9}, {
   3.847801201745866*^9, 3.847801215178229*^9}, 3.84780133363433*^9, 
   3.8478013725512943`*^9, {3.8478014029525905`*^9, 3.847801409629897*^9}, 
   3.847801458187795*^9, {3.8478014918406143`*^9, 3.847801501094359*^9}, 
   3.8478015366144533`*^9, {3.84780158238515*^9, 3.847801629913949*^9}, {
   3.8478016879726715`*^9, 3.8478016973268485`*^9}, {3.8478017336525817`*^9, 
   3.8478017614054165`*^9}, {3.8478017928576927`*^9, 3.847801798853509*^9}, 
   3.8478018300308833`*^9, {3.8478019498652096`*^9, 3.8478020159001637`*^9}, {
   3.847805876136056*^9, 3.847805965577001*^9}, {3.847806027550273*^9, 
   3.8478061057938027`*^9}, {3.8478923656199584`*^9, 
   3.8478924162484865`*^9}, {3.847892553404544*^9, 3.8478925801157827`*^9}, {
   3.8478926131321945`*^9, 3.847892722476017*^9}, {3.8478927902919283`*^9, 
   3.8478928046270123`*^9}, {3.8478928774532566`*^9, 3.8478928781981683`*^9}, 
   3.8479026426227503`*^9, 3.8479027028740454`*^9, {3.847902796695471*^9, 
   3.8479027976808662`*^9}, 3.847903037089308*^9, {3.847903115681072*^9, 
   3.8479032879809647`*^9}, {3.847903373520195*^9, 3.847903383002947*^9}, {
   3.8479035162257566`*^9, 3.8479035249599795`*^9}, {3.847903705913613*^9, 
   3.847903706702098*^9}, {3.847903745747798*^9, 3.8479038316008244`*^9}, {
   3.847903888445075*^9, 3.8479038911779675`*^9}, 3.8479039291920567`*^9, 
   3.8480150074016266`*^9, 3.848015244737689*^9, {3.848015279710021*^9, 
   3.8480152801980867`*^9}, {3.8480153859251966`*^9, 3.848015402429034*^9}, {
   3.8544937321329613`*^9, 3.854493929696664*^9}, {3.8580024306278524`*^9, 
   3.8580024342110615`*^9}, {3.8580024755796804`*^9, 
   3.8580025553810315`*^9}, {3.8580025955878983`*^9, 3.858002754068923*^9}, {
   3.858002788476906*^9, 3.8580028036917863`*^9}, {3.858002949361581*^9, 
   3.858003086163771*^9}, {3.886386158491206*^9, 3.8863862157434826`*^9}, {
   3.886386303960623*^9, 3.886386313094493*^9}, {3.8863863459150577`*^9, 
   3.886386347270795*^9}, 3.886387926638754*^9, 3.886473705736665*^9, 
   3.886473737003451*^9, 3.8864737678802414`*^9, 3.8864741347037153`*^9, 
   3.887843544436668*^9, {3.8878523874024396`*^9, 3.8878523885778856`*^9}, {
   3.8878524394902973`*^9, 3.8878524492572975`*^9}, {3.887852558163184*^9, 
   3.8878525954886913`*^9}, {3.887852639241043*^9, 3.8878526532089667`*^9}, {
   3.8878527161302147`*^9, 3.8878527559358673`*^9}, {3.8878531710019255`*^9, 
   3.8878531715999317`*^9}, {3.887853201734925*^9, 3.8878532085818577`*^9}, 
   3.88785336109925*^9, {3.8878536767927914`*^9, 3.8878537065209103`*^9}, {
   3.8878537409880176`*^9, 3.8878537704806747`*^9}, {3.887853806464505*^9, 
   3.887853894574877*^9}, {3.887853935662038*^9, 3.8878539495380564`*^9}, {
   3.887853998723707*^9, 3.887854002458025*^9}, {3.8878540767721443`*^9, 
   3.8878540850644712`*^9}, {3.887854134735679*^9, 3.887854164961273*^9}, {
   3.8878542084200134`*^9, 3.8878542146938972`*^9}, {3.8878542851797295`*^9, 
   3.8878543495461025`*^9}, {3.8878543927302856`*^9, 
   3.8878543967579875`*^9}, {3.887854468007444*^9, 3.887854475477479*^9}, {
   3.887854608634014*^9, 3.8878546449636197`*^9}, {3.8878546792387304`*^9, 
   3.887854679421152*^9}, {3.88785471297116*^9, 3.8878547131525197`*^9}, {
   3.887854758946162*^9, 3.887854772134369*^9}, {3.8878548045602465`*^9, 
   3.8878548298428917`*^9}, {3.8878549383636336`*^9, 3.887854942664668*^9}, {
   3.8878551141422167`*^9, 3.8878551153470716`*^9}, {3.887855178736246*^9, 
   3.8878551947465816`*^9}, {3.8878552349892225`*^9, 
   3.8878553036736565`*^9}, {3.8878556096735296`*^9, 
   3.8878556148518047`*^9}, {3.8878557057457294`*^9, 3.887855732814309*^9}, {
   3.88785597251871*^9, 3.887856061475362*^9}, {3.8878563637574015`*^9, 
   3.8878563790829268`*^9}, {3.8878564799987645`*^9, 
   3.8878564925469666`*^9}, {3.88785660938179*^9, 3.887856659548732*^9}, {
   3.8878567682196565`*^9, 3.887856777692586*^9}, {3.887856813719973*^9, 
   3.887856845414982*^9}, {3.8878568777980456`*^9, 3.8878568833211217`*^9}, {
   3.8878569682000947`*^9, 3.887856978383237*^9}, 3.887857017578266*^9, {
   3.8878570805838423`*^9, 3.8878571587452345`*^9}, {3.8878572230446124`*^9, 
   3.8878572538330297`*^9}, {3.8878572915226016`*^9, 3.88785731133545*^9}, {
   3.8878573592437625`*^9, 3.8878573597281375`*^9}, {3.887919954610072*^9, 
   3.8879199580642843`*^9}, {3.8879200003907413`*^9, 3.8879200317926183`*^9}, 
   3.887931253229566*^9, 3.887931359541418*^9, {3.887933474907672*^9, 
   3.8879334778516855`*^9}, {3.887933590607071*^9, 3.8879336125218105`*^9}, {
   3.8879336602873106`*^9, 3.887933662817077*^9}, {3.8879338372347975`*^9, 
   3.887933863970456*^9}, {3.887933941216029*^9, 3.8879339941227474`*^9}, {
   3.887934609772808*^9, 3.8879346143160152`*^9}, {3.887934653825678*^9, 
   3.8879346683527637`*^9}, {3.8882336032543955`*^9, 3.8882336098929315`*^9}, 
   3.8924943844144444`*^9, {3.892494748800523*^9, 3.8924947497653832`*^9}, {
   3.8924953802929125`*^9, 3.892495423261282*^9}, {3.892495453815242*^9, 
   3.892495497600283*^9}, {3.8924955912788363`*^9, 3.892495598306783*^9}, {
   3.892495788263833*^9, 3.8924958382764893`*^9}, {3.892495991216982*^9, 
   3.8924960925723577`*^9}, 3.8924963035882735`*^9, {3.8924963466968102`*^9, 
   3.8924963492694397`*^9}, {3.892496400642308*^9, 3.892496407315282*^9}, 
   3.892496597328345*^9, {3.892497082232457*^9, 3.892497088961246*^9}, 
   3.892497306937595*^9, 3.8924984485355225`*^9, {3.8924984910076685`*^9, 
   3.892498530602607*^9}, 3.8924986532092905`*^9, {3.8924990082639723`*^9, 
   3.892499034375566*^9}, 3.892499245898033*^9, 3.892499928157049*^9, {
   3.8925002357733827`*^9, 3.892500241563636*^9}, 3.8925007090640965`*^9, 
   3.8925008761080465`*^9, {3.892762346245595*^9, 3.892762363090499*^9}, 
   3.892762457303896*^9, {3.8927624892111683`*^9, 3.892762502660687*^9}, 
   3.8932954849698796`*^9, 3.89369611615662*^9, {3.8936962328040547`*^9, 
   3.8936962455439014`*^9}, {3.8936964181426935`*^9, 
   3.8936964185126343`*^9}, {3.8936986618524733`*^9, 3.8936986623993464`*^9}, 
   3.89369875295938*^9, {3.893698783458149*^9, 3.893698787112262*^9}, 
   3.8936989977397537`*^9, 3.8936991240140653`*^9, {3.893699185741294*^9, 
   3.8936991864913*^9}, {3.8937002069401875`*^9, 3.8937002337380457`*^9}, 
   3.89370167244588*^9, 3.893943570274518*^9, {3.8958607385355053`*^9, 
   3.8958607389730043`*^9}, 3.895861310347907*^9, {3.895863455312131*^9, 
   3.895863457982354*^9}, {3.8958821592689223`*^9, 3.895882160186198*^9}, {
   3.8958845762335873`*^9, 3.895884599580189*^9}, {3.895884638826479*^9, 
   3.8958846697586527`*^9}, {3.8958847472508187`*^9, 3.895884764467696*^9}, 
   3.8958849867738705`*^9, {3.896054206094593*^9, 3.8960542586713233`*^9}, {
   3.8960542990329127`*^9, 3.896054305542528*^9}, {3.8960543531113276`*^9, 
   3.8960544868265886`*^9}, {3.8960553030073647`*^9, 
   3.8960553036512055`*^9}, {3.896055459245226*^9, 3.8960554612123795`*^9}, {
   3.896055705344165*^9, 3.896055705471612*^9}, {3.896056771856551*^9, 
   3.8960567725428977`*^9}, {3.8960571474670935`*^9, 
   3.8960571480954895`*^9}, {3.8961084706977067`*^9, 3.896108484651124*^9}, {
   3.896108528450506*^9, 3.896108568256239*^9}, {3.8961094154391336`*^9, 
   3.8961094722514286`*^9}, {3.8961095476226034`*^9, 3.896109553868688*^9}, {
   3.8961342583673987`*^9, 3.896134258775107*^9}, {3.896134295598743*^9, 
   3.8961343849228597`*^9}, {3.8961344808189087`*^9, 3.896134495980072*^9}, {
   3.8961345445848527`*^9, 3.8961345480272727`*^9}, {3.896134587198448*^9, 
   3.8961346140412188`*^9}, {3.896135228118886*^9, 3.8961352722049055`*^9}, {
   3.8961353358664556`*^9, 3.8961353717250633`*^9}, {3.8961354060910735`*^9, 
   3.8961354587232666`*^9}, {3.8961355390287857`*^9, 
   3.8961355485406556`*^9}, {3.896135583804103*^9, 3.896135680950555*^9}, {
   3.896135760151292*^9, 3.896135763347273*^9}, {3.896136014018389*^9, 
   3.8961360226792345`*^9}, {3.8961360535541267`*^9, 
   3.8961360679006767`*^9}, {3.8961361401037717`*^9, 
   3.8961361630141473`*^9}, {3.896136228954855*^9, 3.8961362574440928`*^9}, {
   3.896136352297743*^9, 3.896136368415354*^9}, {3.8961364256825843`*^9, 
   3.896136426644823*^9}, {3.8961376568555183`*^9, 3.8961376751787724`*^9}, {
   3.896664950327098*^9, 3.8966649551003804`*^9}, {3.8978484821174498`*^9, 
   3.897848485378989*^9}, {3.8978548027416525`*^9, 3.8978548030569835`*^9}, {
   3.897855490590728*^9, 3.8978555065277095`*^9}, {3.897856462080842*^9, 
   3.897856470757413*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"7ebd4447-fc3c-4eb0-9e76-dd514f64b86e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solver for inhomogeneous waves", "Chapter",
 CellChangeTimes->{{3.8426194097614*^9, 3.842619421050746*^9}, {
  3.854488964366927*^9, 3.8544889882006183`*^9}, {3.854489281630262*^9, 
  3.8544892864348087`*^9}, {3.854489319153143*^9, 3.854489334357749*^9}, {
  3.8924904987271585`*^9, 
  3.892490500542656*^9}},ExpressionUUID->"9a9bd620-7b4a-46b2-9824-\
74024f07f572"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "computePNL", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"self", "-", "explanatory"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"computePNL", "[", 
    RowBox[{"dL_List", ",", "E1_List", ",", "E2_List", ",", 
     RowBox[{"factor_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", "factor", ")"}], 
    RowBox[{"dL", ".", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"[", "3", "]"}], "]"}], " ", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}]}], "}"}], "&"}], "@@", 
       RowBox[{"{", 
        RowBox[{"E1", ",", "E2"}], "}"}]}], ")"}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8406299257907085`*^9, 3.840629981446116*^9}, {
   3.8406300871060963`*^9, 3.8406301121116295`*^9}, {3.8426239763990154`*^9, 
   3.8426239772330875`*^9}, {3.8544922499281626`*^9, 3.854492257947187*^9}, 
   3.895837579834124*^9},
 CellLabel->"In[87]:=",ExpressionUUID->"8ad8b392-0009-4cba-81ca-2369903c7c44"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "solveInhom", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"solveInhom", ",", "HoldAll"}], "]"}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "for", " ", "single", " ", "interface", " ", "or", " ", "slab", " ", 
    "case"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"solveInhom", "[", 
    RowBox[{
    "mat_", ",", "wT1\[Omega]_", ",", "wT2\[Omega]_", ",", "wT12\[Omega]Inh_",
      ",", "wT22\[Omega]Inh_", ",", "wTmix2\[Omega]Inh_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "w", ",", "phases", ",", "eT1\[Omega]", ",", "eT2\[Omega]", ",", 
       "PNLT1", ",", "PNLT2", ",", "PNLmix", ",", "eT12\[Omega]Inh", ",", 
       "eT22\[Omega]Inh", ",", "eTmix2\[Omega]Inh", ",", "lhs", ",", "rhs", 
       ",", "equ", ",", "sol", ",", "unknowns", ",", "M", ",", "B"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"unknowns", "=", 
       RowBox[{"{", 
        RowBox[{
        "C11", ",", "C21", ",", "C31", ",", "C12", ",", "C22", ",", "C32", 
         ",", "C13", ",", "C23", ",", "C33"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], "==", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "No", " ", "need", " ", "to", " ", "solve", " ", "if", " ", "the", 
          " ", "layer", " ", "is", " ", "linear", " ", "material"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0.", ",", "0."}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0.", ",", "0."}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0.", ",", "0."}], "}"}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"mat", "[", "pg", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], "==", "1"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Define", " ", "real", " ", "space", " ", "vector", " ", "r", " ", 
           "and", " ", "phases", " ", "which", " ", "contain", " ", "ko"}], 
          ",", " ", "keo", ",", " ", 
          RowBox[{
           RowBox[{"and", " ", "ko"}], "+", "keo"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"w", "=", 
          RowBox[{"wT1\[Omega]", "[", "\[Omega]", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"phases", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "/@"}], "*)"}], 
          RowBox[{"<|", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"T1\[Omega]", "->", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT1\[Omega]", "[", "\[Omega]", "]"}], " ", "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT1\[Omega]", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"T2\[Omega]", "->", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT2\[Omega]", "[", "\[Omega]", "]"}], " ", "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT2\[Omega]", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"T1", "\[Rule]", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT12\[Omega]Inh", "[", "\[Omega]", "]"}], "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT12\[Omega]Inh", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"T2", "\[Rule]", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wT22\[Omega]Inh", "[", "\[Omega]", "]"}], " ", 
                  "t"}], "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wT22\[Omega]Inh", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"mix", "\[Rule]", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wTmix2\[Omega]Inh", "[", "\[Omega]", "]"}], "t"}], 
                 "-", 
                 RowBox[{"(*", 
                  RowBox[{"Re", "@"}], "*)"}], 
                 RowBox[{
                  RowBox[{"wTmix2\[Omega]Inh", "[", "k", "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
              "]"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "Compute", " ", "PNL", " ", "from", " ", "\[Omega]", " ", 
            "waves"}], ";", " ", 
           RowBox[{
           "e", " ", "is", " ", "propagating", " ", "electric", " ", 
            "field"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"eT1\[Omega]", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"wT1\[Omega]", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "T1\[Omega]", "]"}]}], 
           RowBox[{"(*", 
            RowBox[{"wT1\[Omega]", "[", "phase", "]"}], "*)"}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"eT2\[Omega]", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"wT2\[Omega]", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "T2\[Omega]", "]"}]}], 
           RowBox[{"(*", 
            RowBox[{"wT2\[Omega]", "[", "phase", "]"}], "*)"}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<dL:\\n\>\"", ",", 
             RowBox[{
              RowBox[{"mat", "[", "dL", "]"}], "//", "MatrixForm"}]}], 
            "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"PNLT1", "=", 
          RowBox[{"computePNL", "[", 
           RowBox[{
            RowBox[{"mat", "[", "dL", "]"}], ",", "eT1\[Omega]", ",", 
            "eT1\[Omega]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"PNLT2", "=", 
          RowBox[{"computePNL", "[", 
           RowBox[{
            RowBox[{"mat", "[", "dL", "]"}], ",", "eT2\[Omega]", ",", 
            "eT2\[Omega]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"PNLmix", "=", 
          RowBox[{"computePNL", "[", 
           RowBox[{
            RowBox[{"mat", "[", "dL", "]"}], ",", "eT1\[Omega]", ",", 
            "eT2\[Omega]", ",", "2"}], "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{"need", " ", "the", " ", "*", "2", " ", "here"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "Establish", " ", "equations", " ", "for", " ", "solving", " ", 
            "inhomogeneous", " ", "waves"}], ";", " ", 
           RowBox[{
           "e", " ", "is", " ", "propagating", " ", "electric", " ", 
            "field"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Replace", " ", "the", " ", "phasor", " ", "to", " ", "preset", " ",
            "ones", " ", "for", " ", "better", " ", "match"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"PNLT1", "=", 
          RowBox[{"PNLT1", "/.", 
           RowBox[{
            RowBox[{"a_.", "*", 
             RowBox[{"E", "^", "b_"}]}], ":>", 
            RowBox[{"a", " ", 
             RowBox[{"phases", "[", "T1", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PNLT2", "=", 
          RowBox[{"PNLT2", "/.", 
           RowBox[{
            RowBox[{"a_.", "*", 
             RowBox[{"E", "^", "b_"}]}], ":>", 
            RowBox[{"a", " ", 
             RowBox[{"phases", "[", "T2", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PNLmix", "=", 
          RowBox[{"PNLmix", "/.", 
           RowBox[{
            RowBox[{"a_.", "*", 
             RowBox[{"E", "^", "b_"}]}], ":>", 
            RowBox[{"a", " ", 
             RowBox[{"phases", "[", "mix", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<PNL:\\n\>\"", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"PNLT1", ",", "PNLT2", ",", "PNLmix"}], "}"}], "//", 
               "Chop"}], "//", "Simplify"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
            "eTmix2\[Omega]Inh"}], "}"}], "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], 
             RowBox[{"phases", "[", "T1", "]"}]}], 
            RowBox[{"(*", 
             RowBox[{"wT12\[Omega]Inh", "[", "phase", "]"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], 
             RowBox[{"phases", "[", "T2", "]"}]}], 
            RowBox[{"(*", 
             RowBox[{"wT22\[Omega]Inh", "[", "phase", "]"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], 
             RowBox[{"phases", "[", "mix", "]"}]}]}], 
           RowBox[{"(*", 
            RowBox[{"wTmix2\[Omega]Inh", "[", "phase", "]"}], "*)"}], "}"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<eT12\[Omega]Inh,eT22\[Omega]Inh,eTmix2\[Omega]Inh:\\n\>\"", 
             ",", 
             RowBox[{"{", 
              RowBox[{
              "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
               "eTmix2\[Omega]Inh"}], "}"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lhs", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{
           RowBox[{
            RowBox[{"Curl", "[", 
             RowBox[{
              RowBox[{"Curl", "[", 
               RowBox[{"#", ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{
            "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
             "eTmix2\[Omega]Inh"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rhs", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"2", "w"}], ")"}], "2"], "\[Mu]0", " ", 
               "\[CurlyEpsilon]0", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}], ".",
                   "#1"}], "+", "#2"}], ")"}]}], ")"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "eT12\[Omega]Inh", ",", "eT22\[Omega]Inh", ",", 
                "eTmix2\[Omega]Inh"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"PNLT1", ",", "PNLT2", ",", "PNLmix"}], "}"}]}], 
             "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<lhs:\\n\>\"", ",", 
             RowBox[{"lhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<rhs:\\n\>\"", ",", 
             RowBox[{"rhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"equ", "=", 
          RowBox[{"(*", 
           RowBox[{"Chop", "@"}], "*)"}], 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"lhs", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T1", "]"}]}], "]"}], "==", 
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"rhs", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T1", "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"lhs", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T2", "]"}]}], "]"}], "==", 
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"rhs", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "T2", "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"lhs", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "mix", "]"}]}], "]"}], "==", 
             RowBox[{"Coefficient", "[", 
              RowBox[{
               RowBox[{"rhs", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", 
               RowBox[{"phases", "[", "mix", "]"}]}], "]"}]}]}], 
           "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<equations for solving Cij:\\n\>\"", ",", 
             RowBox[{"Simplify", "@", 
              RowBox[{"(", 
               RowBox[{"Thread", "/@", "equ"}], ")"}]}]}], "]"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Check", " ", "in", " ", "PNL", " ", "need", " ", "to", " ", "be", 
           " ", "taken", " ", "out"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"flagLinearSolve", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"B", ",", "M"}], "}"}], "=", 
             RowBox[{"Normal", "@", 
              RowBox[{"CoefficientArrays", "[", 
               RowBox[{"equ", ",", "unknowns"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"sol", "=", 
             RowBox[{"Thread", "[", 
              RowBox[{"unknowns", "->", 
               RowBox[{"LinearSolve", "[", 
                RowBox[{"M", ",", "B"}], "]"}]}], "]"}]}], ";"}], 
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Quiet", "@", 
             RowBox[{"If", "[", 
              RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"NSolve", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "@", 
                   RowBox[{"(", 
                    RowBox[{"Thread", "/@", "equ"}], ")"}]}], ",", 
                  "unknowns"}], 
                 RowBox[{"(*", 
                  RowBox[{",", 
                   RowBox[{"Method", "->", "Reduce"}]}], "*)"}], "]"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"Solve", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "@", 
                   RowBox[{"(", 
                    RowBox[{"Thread", "/@", "equ"}], ")"}]}], ",", 
                  "unknowns"}], 
                 RowBox[{"(*", 
                  RowBox[{",", 
                   RowBox[{"Method", "->", "Reduce"}]}], "*)"}], "]"}]}]}], 
              "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<C_ij: \\n\>\"", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"ArrayReshape", "[", 
                   RowBox[{"unknowns", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "3"}], "}"}]}], "]"}], "/.", "sol"}], 
                 ")"}], "//", "Simplify"}], "//", "Transpose"}], "//", 
              "MatrixForm"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", "sol"}], "==", "0"}], ",", 
           RowBox[{
            RowBox[{
            "Print", "[", 
             "\"\<Solution is empty for inhomogeneous 2\[Omega] wave\>\"", 
             "]"}], ";", 
            RowBox[{"sol", "=", 
             RowBox[{"Thread", "[", 
              RowBox[{"unknowns", "->", 
               RowBox[{"ConstantArray", "[", 
                RowBox[{"0.", ",", "9"}], "]"}]}], "]"}]}], ";"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{"wT12\[Omega]Inh", "[", "EE", "]"}], "/.", 
           RowBox[{"sol", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{"wT22\[Omega]Inh", "[", "EE", "]"}], "/.", 
           RowBox[{"sol", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{"wTmix2\[Omega]Inh", "[", "EE", "]"}], "/.", 
           RowBox[{"sol", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"PNLT1", ",", "PNLT2", ",", "PNLmix"}], "}"}], "]"}], ";"}], 
     "*)"}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"for", " ", "general", " ", "case"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"solveInhom", "[", 
   RowBox[{"mat_", ",", "wHom_", ",", "wInhom_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "w", ",", "phases", ",", "wF1", ",", "wF2", ",", "wB1", ",", "wB2", ",", 
      "\[IndentingNewLine]", "wInhF1F1", ",", "wInhF2F2", ",", "wInhF1F2", 
      ",", "wInhB1B1", ",", "wInhB2B2", ",", "wInhB1B2", ",", "wInhF1B2", ",",
       "wInhF2B1", ",", "wInhF1B1", ",", "wInhF2B2", ",", 
      "\[IndentingNewLine]", "PNLF1F1", ",", "PNLF2F2", ",", "PNLF1F2", ",", 
      "PNLB1B1", ",", "PNLB2B2", ",", "PNLB1B2", ",", "PNLF1B2", ",", 
      "PNLF2B1", ",", "PNLF1B1", ",", "PNLF2B2", ",", "\[IndentingNewLine]", 
      "eF1", ",", "eF2", ",", "eB1", ",", "eB2", ",", "\[IndentingNewLine]", 
      "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", ",", 
      "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B2", ",", "eInhF2B1", ",", 
      "eInhF1B1", ",", "eInhF2B2", ",", "\[IndentingNewLine]", "lhs", ",", 
      "rhs", ",", "equ", ",", "sol", ",", "unknowns", ",", "M", ",", "B"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"unknowns", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "C11", ",", "C21", ",", "C31", ",", "C12", ",", "C22", ",", "C32", 
          ",", "C13", ",", "C23", ",", "C33", ",", "C14", ",", "C24", ",", 
          "C34", ",", "C15", ",", "C25", ",", "C35", ",", "C16", ",", "C26", 
          ",", "C36", ",", "C17", ",", "C27", ",", "C37", ",", "C18", ",", 
          "C28", ",", "C38", ",", "C19", ",", "C29", ",", "C39", ",", "C110", 
          ",", "C210", ",", "C310"}], "}"}], ",", "3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"mat", "[", "pg", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "==", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "No", " ", "need", " ", "to", " ", "solve", " ", "if", " ", "the", 
         " ", "layer", " ", "is", " ", "linear", " ", "material"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sol", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Flatten", "@", "unknowns"}], ")"}], "->", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0.", ",", "30"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wInhom", "=", 
         RowBox[{"wInhom", "/.", "sol"}]}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"mat", "[", "pg", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "==", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"wF1", ",", "wF2", ",", "wB1", ",", "wB2"}], "}"}], "=", 
         "wHom"}], ";", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"wF1", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "wInhF1F1", ",", "wInhF2F2", ",", "wInhF1F2", ",", "wInhB1B1", ",", 
           "wInhB2B2", ",", "wInhB1B2", ",", "wInhF1B1", ",", "wInhF2B2", ",",
            "wInhF1B2", ",", "wInhF2B1"}], "}"}], "=", "wInhom"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"phases", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "/@"}], "*)"}], 
         RowBox[{"<|", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"homF1", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wF1", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wF1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"homF2", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wF2", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wF2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"homB1", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wB1", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wB1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"homB2", "->", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"wB2", "[", "\[Omega]", "]"}], ")"}], " ", "t"}], 
                "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wB2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1F1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1F1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1F1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF2F2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF2F2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF2F2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1F2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1F2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1F2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomB1B1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhB1B1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhB1B1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomB2B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhB2B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhB2B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomB1B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhB1B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhB1B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1B1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1B1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1B1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF2B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF2B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF2B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF1B2", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF1B2", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF1B2", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"inhomF2B1", "\[Rule]", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"wInhF2B1", "[", "\[Omega]", "]"}], "t"}], "-", 
                RowBox[{"(*", 
                 RowBox[{"Re", "@"}], "*)"}], 
                RowBox[{
                 RowBox[{"wInhF2B1", "[", "k", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ")"}]}], 
             "]"}]}]}], "\[IndentingNewLine]", "|>"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Compute", " ", "PNL", " ", "from", " ", "\[Omega]", " ", "waves"}],
           ";", " ", 
          RowBox[{
          "e", " ", "is", " ", "propagating", " ", "electric", " ", 
           "field"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"eF1", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wF1", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homF1", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eF2", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wF2", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homF2", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eB1", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wB1", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homB1", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eB2", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"wB2", "[", "EE", "]"}], 
           RowBox[{"phases", "[", "homB2", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<dL:\\n\>\"", ",", 
            RowBox[{
             RowBox[{"mat", "[", "dL", "]"}], "//", "MatrixForm"}]}], "]"}]}],
          "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1F1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eF1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF2F2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF2", ",", "eF2"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1F2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eF2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLB1B1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eB1", ",", "eB1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLB2B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eB2", ",", "eB2"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"PNLB1B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eB1", ",", "eB2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1B1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eB1", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF2B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF2", ",", "eB2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF1B2", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF1", ",", "eB2", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"PNLF2B1", "=", " ", 
         RowBox[{"computePNL", "[", 
          RowBox[{
           RowBox[{"mat", "[", "dL", "]"}], ",", "eF2", ",", "eB1", ",", 
           "2"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Replace", " ", "the", " ", "phasor", " ", "to", " ", "preset", " ", 
          "ones", " ", "for", " ", "better", " ", "match"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1F1", "=", 
         RowBox[{"PNLF1F1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1F1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF2F2", "=", 
         RowBox[{"PNLF2F2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF2F2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1F2", "=", 
         RowBox[{"PNLF1F2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1F2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLB1B1", "=", 
         RowBox[{"PNLB1B1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomB1B1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLB2B2", "=", 
         RowBox[{"PNLB2B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomB2B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLB1B2", "=", 
         RowBox[{"PNLB1B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomB1B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1B1", "=", 
         RowBox[{"PNLF1B1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1B1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF2B2", "=", 
         RowBox[{"PNLF2B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF2B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF1B2", "=", 
         RowBox[{"PNLF1B2", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF1B2", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PNLF2B1", "=", 
         RowBox[{"PNLF2B1", "/.", 
          RowBox[{
           RowBox[{"a_.", "*", 
            RowBox[{"E", "^", "b_"}]}], ":>", 
           RowBox[{"a", " ", 
            RowBox[{"phases", "[", "inhomF2B1", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<PNLs:\\n\>\"", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "PNLF1F1", ",", "PNLF2F2", ",", "PNLF1F2", ",", "PNLB1B1", 
                 ",", "PNLB2B2", ",", "PNLB1B2", ",", "PNLF1B1", ",", 
                 "PNLF2B2", ",", "PNLF1B2", ",", "PNLF2B1"}], "}"}], "//", 
               "Simplify"}], "//", "Chop"}], "//", "MatrixForm"}]}], "]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", ",", 
           "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", "eInhF2B2", ",",
            "eInhF1B2", ",", "eInhF2B1"}], "}"}], "=", " ", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"wInhF1F1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1F1", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF2F2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF2F2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF1F2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1F2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhB1B1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomB1B1", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhB2B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomB2B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhB1B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomB1B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF1B1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1B1", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF2B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF2B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF1B2", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF1B2", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wInhF2B1", "[", "EE", "]"}], 
            RowBox[{"phases", "[", "inhomF2B1", "]"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<eInhF1F1,eInhF2F2,eInhF1F2,eInhB1B1,eInhB2B2,eInhB1B2,\
eInhF1B1,eInhF2B2,eInhF1B2,eInhF2B1:\\n\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", 
               ",", "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", 
               "eInhF2B2", ",", "eInhF1B2", ",", "eInhF2B1"}], "}"}], "//", 
             "Simplify"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"lhs", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Curl", "[", 
            RowBox[{
             RowBox[{"Curl", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{
           "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", ",",
             "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", "eInhF2B2", 
            ",", "eInhF1B2", ",", "eInhF2B1"}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rhs", "=", " ", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"2", "w"}], ")"}], "2"], "\[Mu]0", " ", 
              "\[CurlyEpsilon]0", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"mat", "[", "\[CurlyEpsilon]2\[Omega]L", "]"}], ".", 
                 "#1"}], "+", "#2"}], ")"}]}], ")"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "eInhF1F1", ",", "eInhF2F2", ",", "eInhF1F2", ",", "eInhB1B1", 
               ",", "eInhB2B2", ",", "eInhB1B2", ",", "eInhF1B1", ",", 
               "eInhF2B2", ",", "eInhF1B2", ",", "eInhF2B1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "PNLF1F1", ",", "PNLF2F2", ",", "PNLF1F2", ",", "PNLB1B1", ",", 
               "PNLB2B2", ",", "PNLB1B2", ",", "PNLF1B1", ",", "PNLF2B2", ",",
                "PNLF1B2", ",", "PNLF2B1"}], "}"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<lhs:\\n\>\"", ",", 
            RowBox[{"lhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<rhs:\\n\>\"", ",", 
            RowBox[{"rhs", "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"equ", "=", 
         RowBox[{"(*", 
          RowBox[{"Chop", "@"}], "*)"}], 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F1", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2F2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2F2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1F2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "4", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "4", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B1", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "5", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB2B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "5", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB2B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "6", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "6", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomB1B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "7", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "7", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B1", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "8", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "8", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "9", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B2", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "9", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF1B2", "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"lhs", "[", 
               RowBox[{"[", "10", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B1", "]"}]}], "]"}], "==", 
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"rhs", "[", 
               RowBox[{"[", "10", "]"}], "]"}], ",", 
              RowBox[{"phases", "[", "inhomF2B1", "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<equations for solving Cij:\\n\>\"", ",", 
            RowBox[{
             RowBox[{"equout", "=", "equ"}], ";", 
             RowBox[{"MatrixForm", "@", 
              RowBox[{"(*", 
               RowBox[{"Chop", "@"}], "*)"}], 
              RowBox[{"Simplify", "@", 
               RowBox[{"(", "equ", 
                RowBox[{"(*", 
                 RowBox[{"/.", 
                  RowBox[{"{", 
                   RowBox[{"\[CapitalDelta]\[Delta]", "->", "0"}], "}"}]}], 
                 "*)"}], ")"}]}]}]}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Check", " ", "in", " ", "PNL", " ", "need", " ", "to", " ", "be", 
          " ", "taken", " ", "out"}], "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"flagBackward", "&&", "flagStandingWave", "&&", 
           RowBox[{"(", 
            RowBox[{"!", "flagJK"}], ")"}], "&&", 
           RowBox[{"(", 
            RowBox[{"!", "flagHH"}], ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Quiet", "@", 
           RowBox[{"If", "[", 
            RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sol", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"NSolve", "[", 
                   RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                 RowBox[{"Range", "[", "10", "]"}]}], "]"}]}], ";"}], 
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sol", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Solve", "[", 
                   RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                 RowBox[{"Range", "[", "10", "]"}]}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"flagBackward", "&&", 
             RowBox[{"(", 
              RowBox[{"!", "flagStandingWave"}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{"!", "flagJK"}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{"!", "flagHH"}], ")"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Quiet", "@", 
              RowBox[{"If", "[", 
               RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"sol", "=", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"NSolve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "6", "]"}]}], "]"}]}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"sol", "=", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "6", "]"}]}], "]"}]}], ";"}]}], 
               "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"sol", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"sol", ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"unknowns", "[", 
                    RowBox[{"[", 
                    RowBox[{"7", ";;", "10"}], "]"}], "]"}], "]"}], "->", 
                  RowBox[{"ConstantArray", "[", 
                   RowBox[{"0", ",", "12"}], "]"}]}], "]"}]}], "]"}]}], ";"}],
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"!", 
                RowBox[{"(", "flagBackward", ")"}]}], "||", "flagHH", "||", 
               "flagJK"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Quiet", "@", 
                RowBox[{"If", "[", 
                 RowBox[{"flagNSolve", ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"sol", "=", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"NSolve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "3", "]"}]}], "]"}]}], ";"}], 
                  "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"sol", "=", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"Simplify", "@", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"equ", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}]}], ",", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Range", "[", "3", "]"}]}], "]"}]}], ";"}]}], 
                 "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"sol", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"sol", ",", 
                  RowBox[{"Thread", "[", 
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"unknowns", "[", 
                    RowBox[{"[", 
                    RowBox[{"4", ";;", "10"}], "]"}], "]"}], "]"}], "->", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", "21"}], "]"}]}], "]"}]}], "]"}]}], 
               ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
            "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"debug", ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<C_ij: \\n\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"unknowns", "/.", "sol"}], ")"}], "//", "Simplify"}], 
              "//", "Chop"}], "//", "MatrixForm"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", "sol"}], "==", "0"}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Solution 1 is empty for inhomogeneous 2\[Omega] wave! \
Aborted!\>\"", "]"}], ";", 
           RowBox[{"sol", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Flatten", "@", "unknowns"}], ")"}], "->", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", "30"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"wInhom", "=", 
         RowBox[{"wInhom", "/.", 
          RowBox[{"Flatten", "@", "sol"}]}]}], ";"}]}], "\[IndentingNewLine]",
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.840623579002926*^9, 3.840623587010494*^9}, {
   3.840623623267619*^9, 3.8406236450185137`*^9}, {3.8406238177913923`*^9, 
   3.8406238467837095`*^9}, {3.840623880981275*^9, 3.84062389715619*^9}, {
   3.8406248656610847`*^9, 3.840624867038286*^9}, {3.840625010793703*^9, 
   3.840625246281911*^9}, {3.8406294047142344`*^9, 3.840629520786701*^9}, {
   3.8406295509198484`*^9, 3.840629772975324*^9}, {3.8406299895120187`*^9, 
   3.840630035650098*^9}, {3.8406300829257355`*^9, 3.84063008298436*^9}, {
   3.840630123101096*^9, 3.8406303412390237`*^9}, {3.840630558285247*^9, 
   3.840630944754758*^9}, {3.8406309758344946`*^9, 3.8406309901760464`*^9}, {
   3.8406310391038804`*^9, 3.84063108285779*^9}, {3.8406311171895285`*^9, 
   3.840631123166865*^9}, {3.8406359000646057`*^9, 3.8406359870604935`*^9}, 
   3.840636032774841*^9, {3.8406363211852765`*^9, 3.8406363217179384`*^9}, {
   3.840636392829429*^9, 3.840636406289543*^9}, {3.8406364719559956`*^9, 
   3.840636579352659*^9}, {3.8406366158089447`*^9, 3.840636616380762*^9}, {
   3.840636688134283*^9, 3.8406367186638017`*^9}, 3.8406367729941754`*^9, {
   3.8406368150005827`*^9, 3.840636832225251*^9}, {3.840637053509509*^9, 
   3.8406371240439873`*^9}, {3.840637512059969*^9, 3.840637515905404*^9}, {
   3.8406376723104997`*^9, 3.8406376738032365`*^9}, {3.840637712772744*^9, 
   3.8406377237826056`*^9}, {3.8406377892534246`*^9, 3.84063779021286*^9}, {
   3.8406380125604615`*^9, 3.8406380190431523`*^9}, {3.8406380525410004`*^9, 
   3.8406380765587177`*^9}, {3.8406383087439127`*^9, 3.840638309575248*^9}, {
   3.8426206446876316`*^9, 3.8426206483856936`*^9}, {3.842620694344616*^9, 
   3.842620712319669*^9}, {3.8426221304887953`*^9, 3.8426221521021976`*^9}, {
   3.842622683266835*^9, 3.842622730887514*^9}, {3.842646788319702*^9, 
   3.842646826551877*^9}, {3.842993631787766*^9, 3.842993643191101*^9}, {
   3.8453230603523703`*^9, 3.8453230608885937`*^9}, {3.8453231196879463`*^9, 
   3.845323120381471*^9}, {3.8453360468030176`*^9, 3.845336071746668*^9}, 
   3.8465817062700405`*^9, {3.885596979795186*^9, 3.8855974255668297`*^9}, {
   3.8855979954271817`*^9, 3.8855980373454494`*^9}, {3.885598163395832*^9, 
   3.885598166786007*^9}, {3.8855983643598084`*^9, 3.885598364869651*^9}, {
   3.8855983999836087`*^9, 3.8855984028340416`*^9}, {3.885598449395629*^9, 
   3.885598452485874*^9}, {3.8855985645085087`*^9, 3.8855985662856717`*^9}, {
   3.885598720427962*^9, 3.885598723563246*^9}, {3.886352204724801*^9, 
   3.8863522054018526`*^9}, {3.886474925146279*^9, 3.886474930778122*^9}, 
   3.887843113141415*^9, 3.887853307070464*^9, {3.88785367984237*^9, 
   3.887853696580268*^9}, {3.8879344316459846`*^9, 3.887934443147238*^9}, {
   3.892501587510828*^9, 3.892501595473713*^9}, 3.892762835434821*^9, {
   3.893294766125059*^9, 3.89329477024156*^9}, 3.893295480843336*^9, {
   3.893696332633769*^9, 3.8936963431143365`*^9}, {3.8960452563442216`*^9, 
   3.8960452875562468`*^9}, 3.89604534780994*^9, {3.8960457059509535`*^9, 
   3.896045812565845*^9}, {3.896045924700124*^9, 3.8960459260293627`*^9}, {
   3.8960573074697*^9, 3.8960573239008093`*^9}, {3.896057480483635*^9, 
   3.896057480648693*^9}, {3.8960575828192835`*^9, 3.896057585343664*^9}, {
   3.8960597015417814`*^9, 3.8960597015837812`*^9}, {3.8960600579390745`*^9, 
   3.8960601884709992`*^9}, {3.8960604309606647`*^9, 3.89606044534034*^9}, {
   3.896060479265324*^9, 3.8960605081833167`*^9}, {3.8960605458776765`*^9, 
   3.896060554730861*^9}, {3.896060878108182*^9, 3.8960608904192457`*^9}, {
   3.89606318059384*^9, 3.8960632030828395`*^9}, {3.8961031753768125`*^9, 
   3.8961031766080184`*^9}, {3.896104083739131*^9, 3.8961040858493285`*^9}, {
   3.8961056373203487`*^9, 3.8961056394344826`*^9}, {3.8961056752330837`*^9, 
   3.8961057281375628`*^9}, {3.8961060645528994`*^9, 
   3.8961061038818426`*^9}, {3.896106173519*^9, 3.8961062091587296`*^9}, {
   3.8961063582418756`*^9, 3.896106358690874*^9}, {3.8961066571668096`*^9, 
   3.8961066591920576`*^9}, {3.8961067121448665`*^9, 
   3.8961067297957907`*^9}, {3.8961070912826962`*^9, 3.8961071205241303`*^9}, 
   3.8961071964085255`*^9, 3.8961074968361*^9, 3.896107534878972*^9, {
   3.8961376984677453`*^9, 3.8961377154460983`*^9}, {3.8963098428703485`*^9, 
   3.8963098525363064`*^9}, {3.8963098899274044`*^9, 
   3.8963099747815747`*^9}, {3.89631005494066*^9, 3.8963101586177745`*^9}, {
   3.8963102055901594`*^9, 3.896310218691245*^9}, {3.896310570557405*^9, 
   3.896310601922491*^9}, 3.8963106535169153`*^9, {3.896312429432557*^9, 
   3.8963124550886745`*^9}, {3.896664739442689*^9, 3.8966647776984525`*^9}, {
   3.8966648234842515`*^9, 3.896664879860423*^9}, {3.896664968936884*^9, 
   3.896664989212431*^9}, {3.896665110024803*^9, 3.8966651142877812`*^9}, {
   3.8970135249667068`*^9, 3.8970135288505697`*^9}, {3.89701357693036*^9, 
   3.8970135791046643`*^9}, {3.8970136233584166`*^9, 3.897013627948146*^9}, {
   3.897013706992421*^9, 3.8970137075926743`*^9}, {3.8970138047266903`*^9, 
   3.8970138156465435`*^9}, {3.89701386479228*^9, 3.897013966395974*^9}, {
   3.897014405995186*^9, 3.897014423823183*^9}, {3.89701681572192*^9, 
   3.8970168253184004`*^9}, {3.89709001914995*^9, 3.8970900195762353`*^9}, {
   3.8970902096581416`*^9, 3.897090210208144*^9}, {3.89709100419808*^9, 
   3.8970910113962135`*^9}, {3.897091104783769*^9, 3.897091127765359*^9}, {
   3.897091168993173*^9, 3.897091188711895*^9}, {3.89709134580236*^9, 
   3.8970913702485476`*^9}, {3.8970914596166286`*^9, 
   3.8970915296279573`*^9}, {3.8970915636985254`*^9, 3.8970915641654015`*^9}, 
   3.8970916302344913`*^9, {3.8970916835338035`*^9, 3.8970917301718645`*^9}, {
   3.8970921215759497`*^9, 3.897092121746952*^9}, {3.8970921787081003`*^9, 
   3.897092324456949*^9}, {3.897092418121436*^9, 3.897092424665983*^9}, {
   3.8970925012785454`*^9, 3.8970925059894924`*^9}, {3.8970925413199563`*^9, 
   3.897092573098068*^9}, {3.897092676585085*^9, 3.8970926834729624`*^9}, 
   3.8970928320549746`*^9, 3.8970931008579793`*^9, {3.8970931788572226`*^9, 
   3.897093190275114*^9}, {3.897093801274205*^9, 3.8970938223423424`*^9}, 
   3.89709415782382*^9, {3.897094476772786*^9, 3.8970944996371393`*^9}, {
   3.897094596025419*^9, 3.897094599097691*^9}, {3.8970949506630783`*^9, 
   3.897095088842125*^9}, {3.8970954668729763`*^9, 3.8970955242454586`*^9}, {
   3.8970955581348124`*^9, 3.8970960610629525`*^9}, {3.897096145369032*^9, 
   3.8970961796471205`*^9}, {3.8970962504306903`*^9, 3.897096499931136*^9}, {
   3.897096645909113*^9, 3.8970967405713177`*^9}, {3.897097892816201*^9, 
   3.897097895560094*^9}, {3.89717916004576*^9, 3.897179175539115*^9}, {
   3.897179217830192*^9, 3.897179241961638*^9}, {3.897441217089265*^9, 
   3.897441293304685*^9}, {3.8978483194699564`*^9, 3.8978483470687013`*^9}, {
   3.8978547048130136`*^9, 3.897854712978715*^9}, {3.897857841682536*^9, 
   3.8978578421187043`*^9}, {3.8978579087934976`*^9, 
   3.8978579149780436`*^9}, {3.8978580005449553`*^9, 
   3.8978580340601645`*^9}, {3.89785806765737*^9, 3.8978580705824966`*^9}, {
   3.897858161492572*^9, 3.897858193928844*^9}, {3.8978582464348097`*^9, 
   3.8978582500488043`*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"e7e53672-7a55-40ac-b67a-b6ba1f919ac7"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Combined core functions ", "Title",
 CellChangeTimes->{{3.854489059592823*^9, 3.8544890626996765`*^9}, {
  3.8971741696131024`*^9, 
  3.897174170659542*^9}},ExpressionUUID->"aa85a36c-2768-4639-8d0e-\
decaa9e87b85"],

Cell[CellGroupData[{

Cell["Single interface ", "Chapter",
 CellChangeTimes->{{3.838373980263477*^9, 3.838373982795429*^9}, {
  3.838476972345773*^9, 3.838476976108146*^9}, {3.841738032684884*^9, 
  3.8417380356417885`*^9}, {3.8426155976538725`*^9, 3.84261560047073*^9}, {
  3.8426156337187448`*^9, 3.842615645550023*^9}, {3.8426211787537994`*^9, 
  3.8426211827477765`*^9}, {3.847727644541135*^9, 3.847727645049964*^9}, {
  3.8924901348382006`*^9, 3.892490140022032*^9}, {3.892490286919978*^9, 
  3.8924902889008045`*^9}, {3.8939797646350374`*^9, 
  3.893979766815338*^9}},ExpressionUUID->"8eefb35c-18b2-43e7-8ef4-\
d903250f5053"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "single", " ", "reflection", " ", "linear", " ", "wave"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Inputs", ":"}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{"m1", " ", "-", " ", 
     RowBox[{
     "the", " ", "first", " ", "material", " ", "where", " ", "incident", " ",
       "wave", " ", "comes", " ", "from"}]}], ";", " ", 
    RowBox[{
    "may", " ", "or", " ", "may", " ", "not", " ", "to", " ", "be", " ", 
     "Air"}], ";", " ", "\[IndentingNewLine]", 
    RowBox[{"m2", " ", "-", " ", 
     RowBox[{"the", " ", "second", " ", "material"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Outputs", ":"}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{"wR1", " ", "-", " ", 
     RowBox[{"the", " ", "reflective", " ", "wave", " ", "1"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"wR2", " ", "-", " ", 
     RowBox[{"the", " ", "reflective", " ", "wave", " ", "2"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"wT1", " ", "-", " ", 
     RowBox[{"the", " ", "transmitive", " ", "wave", " ", "1"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"wT2", " ", "-", " ", 
     RowBox[{"the", " ", "transmitive", " ", "wave", " ", "2"}]}], ";"}], 
   "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "f1L", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"f1L", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"f1L", "[", 
     RowBox[{"m1_", ",", "m2_", ",", "wInc_", ",", 
      RowBox[{"solFresnel_", ":", "True"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"w", ",", "wR1", ",", "wR2", ",", "wT2", ",", "wT1"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ValueQ", "[", "m1", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "m2", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Unvalued arguments detected when calling the function! Abort!\
\>\"", "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w", "=", 
        RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"reflection", " ", "at", " ", "top"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"wR1", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kR1", ",", "k0R1", ",", "\[Theta]R1", ",", "ER1"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wR2", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kR2", ",", "k0R2", ",", "\[Theta]R2", ",", "ER2"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wT1", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kT1", ",", "k0T1", ",", "\[Theta]T1", ",", "ET1"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wT2", "=", 
        RowBox[{"setWave", "[", 
         RowBox[{"{", 
          RowBox[{
          "w", ",", "kT2", ",", "k0T2", ",", "\[Theta]T2", ",", "ET2"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{"m2", ",", "wInc", ",", "wT1", ",", "wT2"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{"m1", ",", "wInc", ",", "wR1", ",", "wR2", ",", "True"}], 
        "]"}], ";", 
       RowBox[{"(*", "backward", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"solFresnel", ",", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", "wInc", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"wT1", ",", "wT2"}], "}"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8370078352573366`*^9, 3.837007836185034*^9}, {
   3.837007900064698*^9, 3.8370079110545692`*^9}, {3.837008220266658*^9, 
   3.837008255248239*^9}, {3.837008729113855*^9, 3.8370087404028473`*^9}, {
   3.8378089546527143`*^9, 3.837808980415783*^9}, {3.8378121867042027`*^9, 
   3.837812207026122*^9}, 3.837812321511337*^9, 3.837820855981249*^9, {
   3.838458291877117*^9, 3.8384583082470627`*^9}, {3.838458352961977*^9, 
   3.838458370738013*^9}, {3.8384617738278604`*^9, 3.8384618771937556`*^9}, 
   3.83846283076084*^9, {3.8384997183620167`*^9, 3.8384997234469013`*^9}, {
   3.8384997562381625`*^9, 3.838499781269209*^9}, {3.838507019261238*^9, 
   3.838507031386097*^9}, {3.838508702771237*^9, 3.838508710751197*^9}, {
   3.838510207968486*^9, 3.8385102208443346`*^9}, {3.838510563673222*^9, 
   3.8385105651754746`*^9}, 3.8385108025220165`*^9, {3.8385108969490876`*^9, 
   3.838510897257112*^9}, {3.838845229824094*^9, 3.838845236903424*^9}, {
   3.838845464553708*^9, 3.8388454675168405`*^9}, {3.8388459940812025`*^9, 
   3.8388459982468133`*^9}, {3.8404817773608503`*^9, 3.840481780239395*^9}, {
   3.8420076726412992`*^9, 3.8420076888164997`*^9}, 3.8420078894923573`*^9, {
   3.8420084053068333`*^9, 3.8420084131785965`*^9}, {3.8426159137518187`*^9, 
   3.842615915862751*^9}, 3.84262383974561*^9, {3.842624026594701*^9, 
   3.84262416293404*^9}, 3.845063252364394*^9, {3.8450633009544063`*^9, 
   3.8450633041298733`*^9}, {3.8450635282220755`*^9, 3.84506353457038*^9}, {
   3.8544932412464056`*^9, 3.8544932775112505`*^9}, 3.854493318056226*^9, {
   3.8544942544707623`*^9, 3.854494262418565*^9}, {3.854494551724806*^9, 
   3.854494666881652*^9}, {3.85449484368396*^9, 3.8544948652416925`*^9}, {
   3.8544949088505163`*^9, 3.854494939794403*^9}, {3.854670104165124*^9, 
   3.8546701061203117`*^9}, {3.8546701448141985`*^9, 3.854670160724357*^9}, {
   3.8546701938048515`*^9, 3.854670267088559*^9}, {3.8546705688270144`*^9, 
   3.854670572139991*^9}, {3.858003535202718*^9, 3.858003536180534*^9}, {
   3.893733170730446*^9, 3.893733211359901*^9}, {3.8939793227219553`*^9, 
   3.8939793245502195`*^9}, {3.893983882794207*^9, 3.893983883012956*^9}, 
   3.8958375973041716`*^9, {3.896141286976272*^9, 3.8961412923363514`*^9}, {
   3.896743813357356*^9, 3.89674383188496*^9}, {3.897331389367408*^9, 
   3.897331394839135*^9}, {3.897332622418585*^9, 3.897332639703532*^9}, {
   3.897332877731528*^9, 3.897332877891784*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"4041f397-63fa-4a4c-b9ff-708b0870e6b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "For", " ", "single", " ", "reflection", " ", "nonlinear", " ", "wave"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Inputs", ":"}], " ", ";", "\[IndentingNewLine]", 
     RowBox[{"m1", " ", "-", " ", 
      RowBox[{
      "the", " ", "first", " ", "material", " ", "where", " ", "incident", 
       " ", "wave", " ", "comes", " ", "from"}]}], ";", " ", 
     RowBox[{
     "may", " ", "or", " ", "may", " ", "not", " ", "to", " ", "be", " ", 
      "Air"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"m2", " ", "-", " ", 
      RowBox[{"the", " ", "second", " ", "material"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Outputs", ":"}], " ", ";", "\[IndentingNewLine]", 
     RowBox[{"wR1\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "1", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wR2\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "2", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT1\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "1", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT2\[Omega]", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "2", " ", "at", " ", 
       "\[Omega]", " ", "frequency"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wR12\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "1", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wR22\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "reflective", " ", "wave", " ", "2", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT12\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "1", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT22\[Omega]Hom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "2", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"homogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT12\[Omega]Inhom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "1", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"inhomogeneous", " ", "part"}], ";", "\[IndentingNewLine]", 
     RowBox[{"wT22\[Omega]Inhom", " ", "-", " ", 
      RowBox[{
      "the", " ", "transmitive", " ", "wave", " ", "2", " ", "at", " ", "2", 
       "\[Omega]", " ", "frequency"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"inhomogeneous", " ", "part"}], ";"}]}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "f1NL", "]"}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"not", " ", "called"}], ";", " ", 
     RowBox[{"just", " ", "for", " ", "backup"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"f1NL", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"f1NL", "[", 
     RowBox[{"m1_", ",", "m2_", ",", "wInc_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "w", ",", "wR1\[Omega]", ",", "wR2\[Omega]", ",", "wT1\[Omega]", ",", 
        "wT2\[Omega]", ",", "wR12\[Omega]Hom", ",", "wR22\[Omega]Hom", ",", 
        "wT12\[Omega]Hom", ",", "wT22\[Omega]Hom", ",", "wT12\[Omega]Inh", 
        ",", "wT22\[Omega]Inh", ",", "wTmix2\[Omega]Inh", ",", "sol", ",", 
        "equ", ",", "unknowns", ",", "sollinear", ",", "\[Theta]tmp"}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ValueQ", "[", "m1", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "m2", "]"}], "&&", 
            RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Unvalued arguments detected when calling the function! Abort!\
\>\"", "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w", "=", 
        RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Obtain", " ", "the", " ", "two", " ", "transmitted", " ", "\[Omega]",
          " ", "waves", " ", "by", " ", "f1L"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"sollinear", "=", 
        RowBox[{"f1L", "[", 
         RowBox[{"m1", ",", "m2", ",", "wInc", ",", "True"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"wR1\[Omega]", ",", "wR2\[Omega]"}], "}"}], "=", 
        RowBox[{"sollinear", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"wT1\[Omega]", ",", "wT2\[Omega]"}], "}"}], "=", 
        RowBox[{"sollinear", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT1\[Omega]: \\n\>\"", ",", 
            RowBox[{"wT1\[Omega]", " ", "//", "MatrixForm"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT2\[Omega]: \\n\>\"", ",", 
            RowBox[{"wT2\[Omega]", "//", "MatrixForm"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Obtain", " ", "the", " ", "two", " ", "transmitted", " ", "and", " ",
          "two", " ", "reflective", " ", "2", "\[Omega]", " ", "waves", " ", 
         "by", " ", "solveSnell"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wT12\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kT12\[Omega]", ",", "k0T12\[Omega]", ",",
            "\[Theta]T12\[Omega]", ",", "ET12\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wT22\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kT22\[Omega]", ",", "k0T22\[Omega]", ",",
            "\[Theta]T22\[Omega]", ",", "ET22\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wR12\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kR12\[Omega]", ",", "k0R12\[Omega]", ",",
            "\[Theta]R12\[Omega]", ",", "ER12\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wR22\[Omega]Hom", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", "kR22\[Omega]", ",", "k0R22\[Omega]", ",",
            "\[Theta]R22\[Omega]", ",", "ER22\[Omega]"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{
        "m2", ",", "wInc", ",", "wT12\[Omega]Hom", ",", "wT22\[Omega]Hom"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"solveSnell", "[", 
        RowBox[{
        "m1", ",", "wInc", ",", "wR12\[Omega]Hom", ",", "wR22\[Omega]Hom", 
         ",", "True"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Setup", " ", "the", " ", "three", " ", "inhomogeneous", " ", "2", 
          "\[Omega]", " ", "waves", " ", "whose", " ", "magnitude", " ", "to",
           " ", "be", " ", "determined", " ", "by", " ", "Cij"}], ",", " ", 
         RowBox[{
         "which", " ", "is", " ", "solved", " ", "within", " ", 
          "solveInhom"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wT12\[Omega]Inh", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", 
           RowBox[{"2", 
            RowBox[{"wT1\[Omega]", "[", "k", "]"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"wT1\[Omega]", "[", "k0", "]"}]}], ",", 
           RowBox[{"wT1\[Omega]", "[", "\[Theta]", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"C11", ",", "C21", ",", "C31"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wT22\[Omega]Inh", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", 
           RowBox[{"2", 
            RowBox[{"wT2\[Omega]", "[", "k", "]"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"wT2\[Omega]", "[", "k0", "]"}]}], ",", 
           RowBox[{"wT2\[Omega]", "[", "\[Theta]", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"C12", ",", "C22", ",", "C32"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Theta]tmp", "=", 
        RowBox[{"VectorAngle", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"wT1\[Omega]", "[", "k", "]"}], "+", 
             RowBox[{"wT2\[Omega]", "[", "k", "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"wT1\[Omega]", "[", "k0", "]"}], "+", 
             RowBox[{"wT2\[Omega]", "[", "k0", "]"}]}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wTmix2\[Omega]Inh", "=", 
        RowBox[{"setWave", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"2", "w"}], ",", 
           RowBox[{
            RowBox[{"wT1\[Omega]", "[", "k", "]"}], "+", 
            RowBox[{"wT2\[Omega]", "[", "k", "]"}]}], ",", 
           RowBox[{
            RowBox[{"wT1\[Omega]", "[", "k0", "]"}], "+", 
            RowBox[{"wT2\[Omega]", "[", "k0", "]"}]}], ",", "\[Theta]tmp", 
           ",", 
           RowBox[{"{", 
            RowBox[{"C13", ",", "C23", ",", "C33"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"solveInhom", "[", 
        RowBox[{
        "m2", ",", "wT1\[Omega]", ",", "wT2\[Omega]", ",", "wT12\[Omega]Inh", 
         ",", "wT22\[Omega]Inh", ",", "wTmix2\[Omega]Inh"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"debug", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT12\[Omega]Inh: \\n\>\"", ",", 
            RowBox[{"wT12\[Omega]Inh", " ", "//", "MatrixForm"}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wT22\[Omega]Inh: \\n\>\"", ",", 
            RowBox[{"wT22\[Omega]Inh", "//", "MatrixForm"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<wTmix2\[Omega]Inh: \\n\>\"", ",", 
            RowBox[{"wTmix2\[Omega]Inh", "//", "MatrixForm"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"unknowns", "=", 
        RowBox[{
         RowBox[{"Key", "[", "EE", "]"}], "/@", 
         RowBox[{"{", 
          RowBox[{
          "wR12\[Omega]Hom", ",", "wR22\[Omega]Hom", ",", "wT12\[Omega]Hom", 
           ",", "wT22\[Omega]Hom"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"unknowns", "=", 
        RowBox[{"DeleteDuplicates", "@", 
         RowBox[{"Cases", "[", 
          RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"solveFresnel", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"wR12\[Omega]Hom", ",", "wR22\[Omega]Hom"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
          "wT12\[Omega]Hom", ",", "wT22\[Omega]Hom", ",", "wT12\[Omega]Inh", 
           ",", "wT22\[Omega]Inh", ",", "wTmix2\[Omega]Inh"}], "}"}], ",", 
         "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Return", " ", "solved", " ", "2", "\[Omega]", " ", "wavs"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"sollinear", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wR12\[Omega]Hom", ",", "wR22\[Omega]Hom"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wT12\[Omega]Hom", ",", "wT22\[Omega]Hom"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "wT12\[Omega]Inh", ",", "wT22\[Omega]Inh", ",", 
             "wTmix2\[Omega]Inh"}], "}"}]}], "}"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8370111756236167`*^9, 3.837011240355401*^9}, {
   3.837011296460211*^9, 3.8370113351944275`*^9}, {3.8370114952048874`*^9, 
   3.837011654538464*^9}, {3.8370116885640182`*^9, 3.8370118910877028`*^9}, {
   3.837011940986863*^9, 3.8370120312089*^9}, {3.8370120889075327`*^9, 
   3.8370121433818254`*^9}, {3.837012179336422*^9, 3.837012340729877*^9}, {
   3.8370124145910835`*^9, 3.8370126750724516`*^9}, {3.837012712766687*^9, 
   3.837012733609973*^9}, {3.8370993809556894`*^9, 3.837099487093577*^9}, {
   3.837101858134891*^9, 3.8371019730195155`*^9}, {3.837102023566333*^9, 
   3.8371020411046286`*^9}, {3.837102397698592*^9, 3.8371024296740384`*^9}, {
   3.837102722862915*^9, 3.837102790385129*^9}, {3.837102856555544*^9, 
   3.8371028614073915`*^9}, {3.837102900200631*^9, 3.837102918167171*^9}, {
   3.8371029713739185`*^9, 3.8371031136077557`*^9}, {3.837103155782197*^9, 
   3.8371032628759785`*^9}, {3.83710355182659*^9, 3.8371035928388124`*^9}, {
   3.837103649599439*^9, 3.837103651919156*^9}, {3.8371036935884633`*^9, 
   3.8371037302330513`*^9}, {3.8371038194773235`*^9, 
   3.8371038463051915`*^9}, {3.8371039139476495`*^9, 3.837103988451483*^9}, {
   3.8371040985688567`*^9, 3.83710417281194*^9}, {3.837104214666757*^9, 
   3.83710428005929*^9}, {3.8371043120477767`*^9, 3.8371044451064653`*^9}, {
   3.837104488999666*^9, 3.837104490236919*^9}, {3.837104616469263*^9, 
   3.8371049655595884`*^9}, {3.8371050126805043`*^9, 3.837105207252264*^9}, {
   3.8371053815405407`*^9, 3.8371054603436403`*^9}, {3.8371055312309303`*^9, 
   3.8371055877623496`*^9}, {3.8371056199174995`*^9, 3.837105672754595*^9}, {
   3.837105704691869*^9, 3.8371057344543576`*^9}, {3.8371057654725943`*^9, 
   3.8371057824183116`*^9}, {3.837105848087447*^9, 3.837106015332658*^9}, {
   3.837106066981455*^9, 3.8371060863951836`*^9}, {3.8371061190133905`*^9, 
   3.837106246791561*^9}, {3.837106342818833*^9, 3.837106344472864*^9}, {
   3.8371064569926367`*^9, 3.8371064676824102`*^9}, {3.837106624862486*^9, 
   3.8371066641223435`*^9}, {3.8371066966201487`*^9, 3.837107061150045*^9}, {
   3.8371070941926746`*^9, 3.837107105503098*^9}, {3.8378075653953495`*^9, 
   3.8378075677186584`*^9}, {3.8378078126123*^9, 3.837807820553243*^9}, 
   3.837807859186365*^9, {3.8378082453011103`*^9, 3.837808249180597*^9}, 
   3.837808320919258*^9, {3.8378084735978756`*^9, 3.8378084880879707`*^9}, {
   3.8378085315170937`*^9, 3.8378085383040104`*^9}, {3.837808649740037*^9, 
   3.837808720939992*^9}, {3.8378087673639793`*^9, 3.8378088235894747`*^9}, {
   3.8378088584157453`*^9, 3.837808861047696*^9}, {3.837809086980686*^9, 
   3.8378091270451574`*^9}, {3.837809172989259*^9, 3.8378092013412533`*^9}, {
   3.837811390895616*^9, 3.837811391539997*^9}, {3.837812337439164*^9, 
   3.837812338968379*^9}, {3.8378165700700054`*^9, 3.837816627766813*^9}, {
   3.8378167185515237`*^9, 3.8378167403533955`*^9}, {3.8378169238121614`*^9, 
   3.837816926261518*^9}, {3.83781718039843*^9, 3.8378172125501976`*^9}, {
   3.8378172846098957`*^9, 3.837817294689865*^9}, {3.8378177837341375`*^9, 
   3.8378177918871465`*^9}, {3.8378186935018826`*^9, 3.837818703000696*^9}, {
   3.8378187509848814`*^9, 3.83781896777247*^9}, {3.8378189980105753`*^9, 
   3.837819054061706*^9}, {3.837819313258298*^9, 3.8378193260203843`*^9}, {
   3.83781939733741*^9, 3.8378194100639315`*^9}, {3.837819444784275*^9, 
   3.837819474894968*^9}, {3.837819521087454*^9, 3.8378195259654417`*^9}, {
   3.837819583511054*^9, 3.8378196399663568`*^9}, {3.8378196991988864`*^9, 
   3.8378197036878414`*^9}, {3.8378198048452806`*^9, 3.837819818510758*^9}, {
   3.8378198911814833`*^9, 3.837819913398425*^9}, {3.837819972051214*^9, 
   3.8378199768086886`*^9}, {3.8378201519393916`*^9, 
   3.8378201737337427`*^9}, {3.837820584029259*^9, 3.8378206200123377`*^9}, {
   3.8378207754772406`*^9, 3.83782077827962*^9}, {3.837820959157303*^9, 
   3.8378209627238493`*^9}, {3.8378210311326923`*^9, 3.837821032924157*^9}, {
   3.8378213907887325`*^9, 3.8378214330389853`*^9}, {3.837821467872021*^9, 
   3.837821468096036*^9}, {3.8378215105688705`*^9, 3.8378215195702724`*^9}, {
   3.837891521471547*^9, 3.8378915225025725`*^9}, {3.8378915646537666`*^9, 
   3.837891579267441*^9}, {3.8378916269288197`*^9, 3.8378916760745974`*^9}, {
   3.8378917215458503`*^9, 3.837891792553276*^9}, {3.8378918941178207`*^9, 
   3.837891894727024*^9}, {3.8378919639407578`*^9, 3.837891991381095*^9}, {
   3.8378921806843452`*^9, 3.837892267279922*^9}, {3.837892562986729*^9, 
   3.837892721454584*^9}, {3.837892769480585*^9, 3.837892787952507*^9}, {
   3.837892825536506*^9, 3.837892843767308*^9}, {3.837892885032786*^9, 
   3.837892895187256*^9}, {3.837892925617798*^9, 3.837892948994802*^9}, {
   3.8378929886518507`*^9, 3.8378929918158417`*^9}, 3.837893044828313*^9, 
   3.837893102280461*^9, {3.8378932362747145`*^9, 3.837893286579934*^9}, {
   3.837893365743765*^9, 3.837893365997512*^9}, {3.837893474253011*^9, 
   3.8378935686002865`*^9}, {3.837894595504875*^9, 3.83789459678084*^9}, 
   3.8378954866674123`*^9, {3.837895539352363*^9, 3.8378955406448994`*^9}, {
   3.8378957498348546`*^9, 3.8378957697407694`*^9}, {3.837896043935747*^9, 
   3.8378960991035023`*^9}, {3.8378967881146507`*^9, 
   3.8378967928075333`*^9}, {3.837896874592019*^9, 3.837896901143776*^9}, 
   3.8378969348115144`*^9, {3.837897007142313*^9, 3.837897009793805*^9}, {
   3.837897183596117*^9, 3.837897187838358*^9}, 3.8378972189834604`*^9, {
   3.8379004113468323`*^9, 3.837900411893323*^9}, {3.838073681009451*^9, 
   3.838073703796737*^9}, {3.838074070778845*^9, 3.8380740815728188`*^9}, 
   3.8380782394601*^9, 3.838078318186078*^9, {3.8381290324458537`*^9, 
   3.8381290345089207`*^9}, {3.838129078255472*^9, 3.838129082162485*^9}, {
   3.838131685294286*^9, 3.8381317258325014`*^9}, {3.8381318314214077`*^9, 
   3.8381319037306843`*^9}, {3.8381430475230775`*^9, 3.838143072108023*^9}, {
   3.8381431547777915`*^9, 3.8381431642683306`*^9}, {3.838148468987299*^9, 
   3.8381484821128206`*^9}, {3.8382498857847958`*^9, 3.838249896877596*^9}, 
   3.8383339281117315`*^9, {3.838462967298703*^9, 3.83846297300643*^9}, {
   3.838463005208688*^9, 3.838463011395463*^9}, {3.8384998076674957`*^9, 
   3.8384998548621063`*^9}, {3.8385070720372515`*^9, 
   3.8385070981044593`*^9}, {3.838845568844281*^9, 3.838845633697424*^9}, {
   3.8388460444094367`*^9, 3.838846044687703*^9}, {3.840476112825001*^9, 
   3.840476121668322*^9}, 3.842007763936949*^9, {3.8420078237383814`*^9, 
   3.8420078245085573`*^9}, {3.8420083156733932`*^9, 3.842008336993089*^9}, 
   3.8426238537312884`*^9, {3.842624167682172*^9, 3.8426241963920803`*^9}, 
   3.842624775230256*^9, 3.842624815723886*^9, 3.842624863626248*^9, {
   3.8544932468164277`*^9, 3.854493281427164*^9}, 3.854493324225232*^9, {
   3.8544949505104113`*^9, 3.8544949509103003`*^9}, {3.854495064666847*^9, 
   3.85449509944733*^9}, {3.8544951447216287`*^9, 3.8544952313261747`*^9}, {
   3.8546702729082994`*^9, 3.8546702730620203`*^9}, {3.8546705586495237`*^9, 
   3.854670562102129*^9}, {3.858003512743346*^9, 3.8580035434394217`*^9}, {
   3.858003988577636*^9, 3.858003988727935*^9}, {3.8580041461401525`*^9, 
   3.8580041471481915`*^9}, {3.858004483779107*^9, 3.8580044839199047`*^9}, {
   3.85800454413041*^9, 3.8580045551287966`*^9}, {3.8580045880919504`*^9, 
   3.85800459340919*^9}, {3.858004835003615*^9, 3.858004852950553*^9}, {
   3.8937970526758995`*^9, 3.8937970613047333`*^9}, {3.8939793320152683`*^9, 
   3.8939793404639864`*^9}, 3.8958375982255993`*^9, {3.8960664019526277`*^9, 
   3.89606642628349*^9}, {3.896068727039133*^9, 3.8960687272643595`*^9}, {
   3.8961413066517663`*^9, 3.8961413593472056`*^9}, {3.8961414003255324`*^9, 
   3.8961414050964823`*^9}, {3.8967429959494014`*^9, 3.896743033719715*^9}, {
   3.8967438507797956`*^9, 3.89674385696212*^9}, {3.8973326563789735`*^9, 
   3.89733271323409*^9}, {3.8973327470925627`*^9, 3.8973328057711573`*^9}, {
   3.8973328394347935`*^9, 3.8973328859896517`*^9}, {3.8978564164560933`*^9, 
   3.897856444014556*^9}, 3.897856497731436*^9},
 CellLabel->"In[96]:=",ExpressionUUID->"8049ebf4-e382-440c-9e43-393236a21c0e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Multilayers", "Chapter",
 CellChangeTimes->{{3.847730854397906*^9, 3.847730861429409*^9}, {
   3.8863630254080973`*^9, 3.8863630441335745`*^9}, {3.8878485338158097`*^9, 
   3.887848534448592*^9}, {3.8924901500715656`*^9, 3.892490150830311*^9}, {
   3.8924902745339947`*^9, 3.8924902812385025`*^9}, 
   3.893979773698118*^9},ExpressionUUID->"da61b590-48e7-40ee-a0f3-\
2608c5196b8b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "For", " ", "solving", " ", "linear", " ", "waves", " ", "of", " ", "any",
      " ", "number", " ", "of", " ", "layers"}], ";", " ", 
    RowBox[{
    "the", " ", "number", " ", "of", " ", "layer", " ", "is", " ", "the", " ",
      "length", " ", "of", " ", "the", " ", "list", " ", "mAll"}], ";", " ", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Inputs", ":"}], " ", ";", " ", "\[IndentingNewLine]", 
    RowBox[{"m0", " ", "-", " ", 
     RowBox[{
     "material", " ", "for", " ", "the", " ", "incident", " ", "wave"}]}], 
    ";", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mAll", " ", "-", " ", 
      RowBox[{
      "a", " ", "list", " ", "of", " ", "N", " ", "materials", " ", "where", 
       " ", "N", " ", "can", " ", "be", " ", "any", " ", "integer"}]}], " ", ">=",
      "2"}], ";", " ", "\[IndentingNewLine]", 
    RowBox[{"mSub", " ", "-", " ", 
     RowBox[{"material", " ", "at", " ", "the", " ", "bottom"}]}], ";", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"wInc", " ", "=", " ", 
     RowBox[{"the", " ", "incident", " ", "wave"}]}], ";", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"phaseChange", " ", "-", " ", 
     RowBox[{"a", " ", "list", " ", "of", " ", "thickness", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "h1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "h2"}], "}"}], ",", "...", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "hN"}], "}"}]}], "}"}], " ", "for", " ", 
      "the", " ", "layers"}]}], " ", ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"Outputs", ":"}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"wR1", ",", "wR2"}], "}"}], " ", "-", " ", 
     RowBox[{"the", " ", "two", " ", "reflective", " ", "waves"}]}], ";", " ",
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"wT1", ",", "wT2"}], "}"}], " ", "-", " ", 
     RowBox[{"the", " ", "two", " ", "transmitive", " ", "waves"}]}], ";", 
    " ", "\[IndentingNewLine]", 
    RowBox[{"wB", " ", "-", " ", 
     RowBox[{
     "a", " ", "list", " ", "of", " ", "all", " ", "Backward", " ", "waves", 
      " ", "with", " ", "\[Omega]", " ", "frequency", " ", "inside", " ", 
      "the", " ", "layers"}]}], " ", ";", "\[IndentingNewLine]", 
    RowBox[{"wF", " ", "-", " ", 
     RowBox[{
     "a", " ", "list", " ", "of", " ", "all", " ", "Forward", " ", "waves", 
      " ", "with", " ", "\[Omega]", " ", "frequency", " ", "inside", " ", 
      "the", " ", "layers"}]}], " ", ";"}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "f4L", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"f4L", ",", "HoldAll"}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"f4L", "[", 
      RowBox[{"mAll_", ",", "wInc_", ",", 
       RowBox[{"iterative_", ":", "False"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m0", ",", "mSub", ",", "nM", ",", "w", ",", 
         RowBox[{"wF1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"wF2", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"wB1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"wB2", "=", 
          RowBox[{"{", "}"}]}], ",", "wR1", ",", "wR2", ",", "wT1", ",", 
         "wT2", ",", 
         RowBox[{"kF1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"kF2", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"EF1", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"EF2", "=", 
          RowBox[{"{", "}"}]}], ",", "unknowns", ",", "sol", ",", "equ", ",", 
         "meds", ",", "wavs", ",", "i", ",", "wF", ",", "wB", ",", 
         "thickness", ",", "wMed", ",", "wF1tmp", ",", "wF2tmp", ",", 
         "wB1tmp", ",", "wB2tmp", ",", "wRs", ",", "wRp", ",", "wTs", ",", 
         "wTp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ValueQ", "[", "mAll", "]"}], "&&", 
             RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Unvalued arguments detected when calling the function! \
Abort!\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"m0", "=", 
         RowBox[{"mAll", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"mSub", "=", 
         RowBox[{"mAll", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"nM", "=", 
         RowBox[{
          RowBox[{"Length", "[", "mAll", "]"}], "-", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Setup", " ", "wave", " ", "names"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", "nM"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"wF1", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kF1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0F1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]F1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EF1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"wF2", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kF2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0F2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]F2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EF2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}], ";", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"wB1", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kB1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0B1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]B1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EB1\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"wB2", ",", 
             RowBox[{"setWave", "@", 
              RowBox[{"{", 
               RowBox[{"w", ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<kB2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<k0B2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<\[Theta]B2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"Symbol", "[", 
                  RowBox[{"\"\<EB2\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
               "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wR1", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kR1", ",", "k0R1", ",", "\[Theta]R1", ",", "ER1"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wR2", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kR2", ",", "k0R2", ",", "\[Theta]R2", ",", "ER2"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wT1", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kT1", ",", "k0T1", ",", "\[Theta]T1", ",", "ET1"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wT2", "=", 
         RowBox[{"setWave", "[", 
          RowBox[{"{", 
           RowBox[{
           "w", ",", "kT2", ",", "k0T2", ",", "\[Theta]T2", ",", "ET2"}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "wave", " ", "angles", " ", "by", " ", 
          RowBox[{"Snell", "'"}], "s", " ", "law", " ", "for", " ", "each", 
          " ", "layer"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", "nM"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"solveSnell", "[", 
            RowBox[{
             RowBox[{"mAll", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "wInc", ",", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"solveSnell", "[", 
            RowBox[{
             RowBox[{"mAll", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"wB1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "True"}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"solveSnell", "[", 
         RowBox[{"mSub", ",", "wInc", ",", "wT1", ",", "wT2"}], "]"}], ";", 
        RowBox[{"(*", "transmission", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"solveSnell", "[", 
         RowBox[{"m0", ",", "wInc", ",", "wR1", ",", "wR2", ",", "True"}], 
         "]"}], ";", 
        RowBox[{"(*", "reflection", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Store", " ", "Forward", " ", "and", " ", "Backward", " ", "waves", 
          " ", "in", " ", "lists"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"wF", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wB", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wMed", "=", 
         RowBox[{"Flatten", "/@", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wF", ",", "wB"}], "}"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"thickness", "=", 
         RowBox[{
          RowBox[{"Key", "[", "h", "]"}], "/@", 
          RowBox[{"mAll", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"iterative", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Solve", " ", "layer", " ", "by", " ", "layer"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"unknowns", "=", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2", ",", 
               RowBox[{"wF1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"wF2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Cases", "[", 
              RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"solveFresnel", "[", 
            RowBox[{
             RowBox[{"{", "wInc", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"wF1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"wF2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "unknowns"}], 
            "]"}], ";", 
           RowBox[{"(*", "top", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"wF1tmp", "=", 
            RowBox[{"wF1", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wF1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"wF2tmp", "=", 
            RowBox[{"wF2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wF2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"wB1tmp", "=", 
            RowBox[{"wB1", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wB1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"wB2tmp", "=", 
            RowBox[{"wB2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
            RowBox[{
             RowBox[{
              RowBox[{"wB2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                  RowBox[{"thickness", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"flagHH", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"wF1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "=", "wF1tmp"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wF2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "=", "wF2tmp"}], ";"}]}], 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "=", "wB1tmp"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wB2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "=", "wB2tmp"}], ";"}], 
             "*)"}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
            "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "<", "nM"}], ",", 
             RowBox[{"i", "++"}], ",", 
             RowBox[{"(*", "middle", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"unknowns", "=", 
               RowBox[{
                RowBox[{"Key", "[", "EE", "]"}], "/@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"unknowns", "=", 
               RowBox[{"DeleteDuplicates", "@", 
                RowBox[{"Cases", "[", 
                 RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"solveFresnel", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"wF1tmp", ",", "wF2tmp"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}], ",", 
                "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"wF1tmp", "=", 
               RowBox[{"wF1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF1", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wF1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"wF2tmp", "=", 
               RowBox[{"wF2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wF2", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wF2", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"wB1tmp", "=", 
               RowBox[{"wB1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB1", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wB1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"wB2tmp", "=", 
               RowBox[{"wB2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"wB2", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], 
                " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"wB2", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                   ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                    RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{"flagHH", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF1tmp"}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF2tmp"}], 
                 ";"}]}], "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB1tmp"}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB2tmp"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", "nM", "]"}], "]"}], ",", 
               RowBox[{"wB2", "[", 
                RowBox[{"[", "nM", "]"}], "]"}], ",", "wT1", ",", "wT2"}], 
              "}"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Cases", "[", 
              RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"solveFresnel", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wF1tmp", ",", "wF2tmp"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", "nM", "]"}], "]"}], ",", 
               RowBox[{"wB2", "[", 
                RowBox[{"[", "nM", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "unknowns"}], "]"}], 
           ";", 
           RowBox[{"(*", "bottom", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"wF", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"wB", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Solve", " ", "all", " ", "waves", " ", "at", " ", "once"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"unknowns", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", 
               RowBox[{"{", 
                RowBox[{"wR1", ",", "wR2"}], "}"}]}], ",", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", 
               RowBox[{"Flatten", "@", 
                RowBox[{"{", 
                 RowBox[{"wF", ",", "wB"}], "}"}]}]}], ",", 
              RowBox[{
               RowBox[{"Key", "[", "EE", "]"}], "/@", 
               RowBox[{"{", 
                RowBox[{"wT1", ",", "wT2"}], "}"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"unknowns", "=", 
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Cases", "[", 
              RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"solveFresnelN", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wInc", ",", "wR1", ",", "wR2"}], "}"}], ",", "wMed", 
             ",", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "thickness", ",", 
             "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"wF", "=", 
            RowBox[{"wMed", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"wB", "=", 
            RowBox[{"wMed", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"3", ";;", "4"}]}], "]"}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "distinguish", " ", "s", " ", "and", " ", "p", " ", "from", " ", 
           "R1", " ", "and", " ", "R2"}], ",", 
          RowBox[{"T1", " ", "and", " ", "T2"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "no", " ", "need", " ", "to", " ", "distinguish", " ", "them", " ", 
          "for", " ", "B", " ", "and", " ", "F", " ", "waves", " ", "cause", 
          " ", "they", " ", 
          RowBox[{"don", "'"}], "t", " ", "have", " ", "to", " ", "be", " ", 
          "s", " ", "and", " ", "p"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"wRs", "=", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wRp", "=", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wTs", "=", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wTp", "=", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
            RowBox[{"<|", 
             RowBox[{"__", ",", 
              RowBox[{"EE", "->", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
             "|>"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wRp", ",", "wRs"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"wTp", ",", "wTs"}], "}"}], ",", "wB", ",", "wF"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.845065372946638*^9, 3.8450653957352924`*^9}, {
   3.8450654420809374`*^9, 3.84506548639207*^9}, {3.845065575871989*^9, 
   3.8450655777683773`*^9}, {3.8450656680788884`*^9, 3.845065668986044*^9}, {
   3.8452890269587603`*^9, 3.845289080792723*^9}, {3.84533066584037*^9, 
   3.8453306663938627`*^9}, {3.845330729642209*^9, 3.8453307557150393`*^9}, {
   3.8453307892288136`*^9, 3.8453309636956015`*^9}, {3.845331006111681*^9, 
   3.845331177375829*^9}, {3.8453312160356655`*^9, 3.8453313123159566`*^9}, {
   3.8453320058967624`*^9, 3.8453320093694115`*^9}, {3.845332053238388*^9, 
   3.845332054072174*^9}, {3.8453330019317913`*^9, 3.8453330165959797`*^9}, 
   3.845333585376279*^9, 3.845333620466457*^9, {3.847730868040073*^9, 
   3.847730881088668*^9}, {3.8477310170241933`*^9, 3.847731163115001*^9}, {
   3.8477312225470743`*^9, 3.847731624673505*^9}, {3.8477316611562004`*^9, 
   3.8477316646524663`*^9}, {3.84773174084519*^9, 3.8477318028251762`*^9}, {
   3.8477318519122334`*^9, 3.8477318741770124`*^9}, {3.84773192500156*^9, 
   3.847731982329276*^9}, {3.847732040672961*^9, 3.8477321319313927`*^9}, {
   3.847732165337628*^9, 3.847732167040219*^9}, {3.8477322006171703`*^9, 
   3.847732508137148*^9}, {3.8477327565152493`*^9, 3.8477328420399823`*^9}, {
   3.847733274692076*^9, 3.847733329631008*^9}, {3.847733956866521*^9, 
   3.8477340606966043`*^9}, 3.8477343416100707`*^9, {3.847734617214596*^9, 
   3.847734622449126*^9}, {3.8477346723152933`*^9, 3.847734674769531*^9}, {
   3.847734725019654*^9, 3.8477347695945826`*^9}, {3.847734864340582*^9, 
   3.8477349683871446`*^9}, {3.847735020866357*^9, 3.8477350263683624`*^9}, {
   3.8477350817746744`*^9, 3.8477351197096243`*^9}, {3.8477355255098906`*^9, 
   3.847735615893921*^9}, {3.84773569904531*^9, 3.8477358246939907`*^9}, {
   3.84773585520744*^9, 3.8477358983332987`*^9}, {3.8477485136169987`*^9, 
   3.8477486337632513`*^9}, {3.8477487691594863`*^9, 3.847748797175335*^9}, {
   3.8477488952221003`*^9, 3.847748936315177*^9}, {3.847748977066264*^9, 
   3.8477490095857882`*^9}, {3.8477490419250326`*^9, 
   3.8477490546922555`*^9}, {3.847749093457613*^9, 3.847749106401278*^9}, {
   3.8477491574637475`*^9, 3.8477491939362593`*^9}, {3.8477492245290747`*^9, 
   3.847749294659584*^9}, {3.8477493278771143`*^9, 3.8477494121651325`*^9}, {
   3.8477494484506516`*^9, 3.847749449905938*^9}, {3.847749492609083*^9, 
   3.847749581867114*^9}, {3.847749827413371*^9, 3.8477498376226463`*^9}, {
   3.847749910571083*^9, 3.8477499124003315`*^9}, {3.847750039455857*^9, 
   3.847750043767111*^9}, {3.8477506417837086`*^9, 3.847750675743762*^9}, {
   3.847751799923839*^9, 3.847751852831386*^9}, {3.8477519319779835`*^9, 
   3.847751970498906*^9}, {3.847752028872591*^9, 3.8477521635736656`*^9}, {
   3.847752199429863*^9, 3.8477522174543357`*^9}, {3.8477526513111506`*^9, 
   3.8477526543404493`*^9}, {3.8477527390483017`*^9, 
   3.8477527451486177`*^9}, {3.8477527957562203`*^9, 
   3.8477528842597747`*^9}, {3.8477529227727385`*^9, 3.847752937683753*^9}, {
   3.847753366422142*^9, 3.8477533774520493`*^9}, {3.8477534408632793`*^9, 
   3.847753459118499*^9}, {3.847754158107231*^9, 3.8477542190469875`*^9}, {
   3.847787031677307*^9, 3.847787104739391*^9}, {3.847787143128831*^9, 
   3.8477872320000396`*^9}, {3.8477874853557625`*^9, 
   3.8477876188582034`*^9}, {3.8477876909199743`*^9, 3.847787757843085*^9}, {
   3.8477878874543257`*^9, 3.847787979993074*^9}, {3.8477880371545877`*^9, 
   3.8477880374513702`*^9}, {3.847788311714882*^9, 3.8477883432913027`*^9}, {
   3.8477886403185396`*^9, 3.847788720931843*^9}, {3.8477887631930356`*^9, 
   3.847788880268156*^9}, {3.8478006390280914`*^9, 3.8478006460460997`*^9}, {
   3.847800697010212*^9, 3.8478007849393525`*^9}, {3.8478008597874823`*^9, 
   3.8478008811391087`*^9}, {3.8478010189732904`*^9, 3.847801034635039*^9}, 
   3.847801225138802*^9, {3.847801887043112*^9, 3.847801929132553*^9}, {
   3.8478021054178057`*^9, 3.8478021271135626`*^9}, {3.847892765275541*^9, 
   3.847892777661953*^9}, {3.847902894832335*^9, 3.847902905888077*^9}, {
   3.847904111160709*^9, 3.8479041190457783`*^9}, 3.847904248077074*^9, {
   3.847905709238676*^9, 3.8479057113828907`*^9}, {3.847905829942378*^9, 
   3.8479058339980116`*^9}, {3.854503399699957*^9, 3.854503407429813*^9}, {
   3.8545045046041965`*^9, 3.8545045064246025`*^9}, {3.8546686730960526`*^9, 
   3.8546687778832064`*^9}, {3.8546704349001923`*^9, 3.854670470365327*^9}, {
   3.854670511098651*^9, 3.8546705238515778`*^9}, 3.8546712980421257`*^9, {
   3.8580031652093954`*^9, 3.858003236122137*^9}, {3.858003416636072*^9, 
   3.8580034190562906`*^9}, {3.8863868140589676`*^9, 3.886386857015539*^9}, {
   3.886456440983572*^9, 3.8864564887077155`*^9}, {3.8864565218743057`*^9, 
   3.886456529236988*^9}, {3.8864566814300137`*^9, 3.886456687024975*^9}, {
   3.8864569360042825`*^9, 3.886457005604251*^9}, {3.88645705193421*^9, 
   3.8864570527445984`*^9}, {3.886474090637862*^9, 3.886474099832364*^9}, {
   3.886474657276188*^9, 3.8864746592825623`*^9}, {3.89276378495142*^9, 
   3.8927637871302967`*^9}, 3.892764563808448*^9, 3.893979422595126*^9, {
   3.8939795259814253`*^9, 3.893979535261064*^9}, {3.893979834050516*^9, 
   3.893979836481594*^9}, {3.893981363482517*^9, 3.8939813689727287`*^9}, 
   3.8939820198378744`*^9, {3.893982061355859*^9, 3.893982161645256*^9}, 
   3.895837605735575*^9, {3.896055546772706*^9, 3.896055573255626*^9}, {
   3.896055612632722*^9, 3.8960556425176444`*^9}, {3.8960557985028405`*^9, 
   3.896055803675684*^9}, {3.896055890536403*^9, 3.896055897555989*^9}, {
   3.896069802392536*^9, 3.896069810945363*^9}, {3.8960699319278584`*^9, 
   3.896069935028936*^9}, 3.8960699654982195`*^9, {3.8960700176143155`*^9, 
   3.8960700367588243`*^9}, {3.8960700862874193`*^9, 3.896070086662429*^9}, {
   3.8960701840589685`*^9, 3.8960703097779245`*^9}, {3.8960703450873375`*^9, 
   3.8960704312350903`*^9}, 3.8960705185830574`*^9, {3.8960705599722414`*^9, 
   3.896070585188568*^9}, {3.8960706494503345`*^9, 3.896070663179276*^9}, {
   3.8960707285814524`*^9, 3.896070767006935*^9}, {3.896070916618703*^9, 
   3.896070919415579*^9}, {3.896071009794321*^9, 3.8960710655964613`*^9}, {
   3.8960711244063945`*^9, 3.8960712358975525`*^9}, {3.896093966712827*^9, 
   3.896093968253095*^9}, {3.8960940044026318`*^9, 3.896094081775652*^9}, {
   3.8960950613276005`*^9, 3.8960950618276005`*^9}, {3.896095935044676*^9, 
   3.896095965764129*^9}, {3.8961402589302187`*^9, 3.896140303719612*^9}, {
   3.896140338896342*^9, 3.8961403397103186`*^9}, {3.896140398908975*^9, 
   3.8961404060675516`*^9}, {3.8961407130220966`*^9, 
   3.8961408383868723`*^9}, {3.896140880234333*^9, 3.8961408881737766`*^9}, {
   3.8961409340439715`*^9, 3.8961409355789375`*^9}, {3.8961409835463867`*^9, 
   3.8961410087583456`*^9}, {3.896141560293703*^9, 3.896141563253687*^9}, {
   3.8967424817870183`*^9, 3.8967425694799047`*^9}, {3.8967427177370872`*^9, 
   3.8967427251283073`*^9}, {3.8967427724918084`*^9, 
   3.8967427891200547`*^9}, {3.896742819453012*^9, 3.8967429107071476`*^9}, {
   3.896743488789355*^9, 3.896743489401479*^9}, {3.8967435587881174`*^9, 
   3.896743561178507*^9}, {3.896743700294944*^9, 3.8967437173518734`*^9}, {
   3.896743761387968*^9, 3.896743786569131*^9}, {3.896743930500347*^9, 
   3.896743930858862*^9}, {3.896744042100503*^9, 3.896744060670375*^9}, {
   3.8967444474587965`*^9, 3.8967444528977084`*^9}, {3.8967444828997445`*^9, 
   3.896744537901908*^9}, {3.896744585896675*^9, 3.896744630050929*^9}, {
   3.897018303983884*^9, 3.8970183076458955`*^9}, {3.897018633323949*^9, 
   3.897018635887433*^9}, 3.8970191015486975`*^9, {3.897103434328393*^9, 
   3.8971034729083977`*^9}, {3.8971041191058393`*^9, 3.897104138161485*^9}, {
   3.897104249267996*^9, 3.89710426283926*^9}, 3.897104525165263*^9, {
   3.8971045841978254`*^9, 3.897104592402886*^9}, {3.8971049532687693`*^9, 
   3.89710495535107*^9}, {3.897105076067884*^9, 3.8971051467037754`*^9}, {
   3.897105206331421*^9, 3.8971052492471404`*^9}, {3.897105421792366*^9, 
   3.8971054393397207`*^9}, {3.897332911326271*^9, 3.897332998780019*^9}, {
   3.8974413723390083`*^9, 3.8974413728714886`*^9}, {3.8978555307333484`*^9, 
   3.8978556632645483`*^9}, {3.897855830984475*^9, 3.89785600183053*^9}, {
   3.8978560378264284`*^9, 3.8978560461467333`*^9}, {3.8978567549842076`*^9, 
   3.8978567618005104`*^9}, {3.8978568984152594`*^9, 
   3.8978569009707174`*^9}, {3.8978570443723187`*^9, 
   3.8978570518224087`*^9}, {3.8978576927085314`*^9, 3.8978576971408997`*^9}},
 CellLabel->"In[99]:=",ExpressionUUID->"5fa0cc44-7388-47c7-b179-75ce38116667"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "f4NL", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"f4NL", ",", "HoldAll"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f4NL", "[", 
    RowBox[{"mAll_", ",", "wInc_", ",", 
     RowBox[{"iterative_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"m0", ",", "mSub", ",", "nM", ",", "w", ",", 
       RowBox[{"kF1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"kF2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"EF1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"EF2", "=", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"wF1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB1", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1F1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2F2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1F2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB1B1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB2B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wB1B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2B1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF1B1Inh", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"wF2B2Inh", "=", 
        RowBox[{"{", "}"}]}], ",", "wInh", ",", "wRs", ",", "wRp", ",", "wTs",
        ",", "wTp", ",", "\[IndentingNewLine]", "wFHomo", ",", "wBHomo", ",", 
       "wFInh", ",", "wBInh", ",", "wSInh", ",", "wR1", ",", "wR2", ",", 
       "wT1", ",", "wT2", ",", "unknowns", ",", "sol", ",", "equ", ",", 
       "meds", ",", "wavs", ",", "i", ",", "wMed", ",", "wF1tmp", ",", 
       "wF2tmp", ",", "wB1tmp", ",", "wB2tmp", ",", "\[IndentingNewLine]", 
       "sollinear", ",", "wFtmp", ",", "wBtmp", ",", "wF1F1Inhtmp", ",", 
       "wF2F2Inhtmp", ",", "wF1F2Inhtmp", ",", "wB1B1Inhtmp", ",", 
       "wB2B2Inhtmp", ",", "wB1B2Inhtmp", ",", "wF1B1Inhtmp", ",", 
       "wF1B2Inhtmp", ",", "wF2B1Inhtmp", ",", "wF2B2Inhtmp", ",", 
       "thickness", ",", "\[Theta]tmp"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"(", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"ValueQ", "[", "m0", "]"}], "&&"}], "*)"}], 
          RowBox[{
           RowBox[{"ValueQ", "[", "mAll", "]"}], 
           RowBox[{"(*", 
            RowBox[{"&&", 
             RowBox[{"ValueQ", "[", "mSub", "]"}]}], "*)"}], "&&", 
           RowBox[{"ValueQ", "[", "wInc", "]"}]}], ")"}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Unvalued arguments detected when calling the function! \
Abort!\>\"", "]"}], ";", 
         RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"wInc", "[", "\[Omega]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m0", "=", 
       RowBox[{"mAll", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mSub", "=", 
       RowBox[{"mAll", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nM", "=", 
       RowBox[{
        RowBox[{"Length", "[", "mAll", "]"}], "-", "2"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Setup", " ", "wave", " ", "names"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "nM"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kF1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0F1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]F1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EF1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kF2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0F2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]F2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EF2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB1", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kB1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0B1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]B1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EB1\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB2", ",", 
           RowBox[{"setWave", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "w"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<kB2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<k0B2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<\[Theta]B2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<EB2\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "]"}]}], 
             "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wR1", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kR1", ",", "k0R1", ",", "\[Theta]R1", ",",
           "ER1"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wR2", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kR2", ",", "k0R2", ",", "\[Theta]R2", ",",
           "ER2"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wT1", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kT1", ",", "k0T1", ",", "\[Theta]T1", ",",
           "ET1"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wT2", "=", 
       RowBox[{"setWave", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", "w"}], ",", "kT2", ",", "k0T2", ",", "\[Theta]T2", ",",
           "ET2"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Solve", " ", "wave", " ", "angles", " ", "by", " ", 
        RowBox[{"Snell", "'"}], "s", " ", "law", " ", "for", " ", "each", " ",
         "layer"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", "nM"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"solveSnell", "[", 
          RowBox[{
           RowBox[{"mAll", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "wInc", ",", 
           RowBox[{"wF1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"wF2", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"solveSnell", "[", 
          RowBox[{
           RowBox[{"mAll", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
           RowBox[{"wF1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"wB1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"wB2", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", "True"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"solveSnell", "[", 
       RowBox[{"mSub", ",", "wInc", ",", "wT1", ",", "wT2"}], "]"}], ";", 
      RowBox[{"(*", "transmission", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"solveSnell", "[", 
       RowBox[{"m0", ",", "wInc", ",", "wR1", ",", "wR2", ",", "True"}], 
       "]"}], ";", 
      RowBox[{"(*", "reflection", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"solve", " ", "the", " ", "linear", " ", "problem"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"sollinear", "=", 
       RowBox[{"f4L", "[", 
        RowBox[{"mAll", ",", "wInc", ",", "iterative"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Store", " ", "the", " ", "w", " ", "waves", " ", "in", " ", "tmp"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"wBtmp", "=", 
       RowBox[{"sollinear", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wFtmp", "=", 
       RowBox[{"sollinear", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Setup", " ", "inhomo", " ", "wave", " ", "names"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "nM"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wF1F1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wFtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C11", ",", "C21", ",", "C31"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF2F2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wFtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C12", ",", "C22", ",", "C32"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"\[Theta]tmp", "=", 
          RowBox[{"VectorAngle", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
              ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
               "+", 
               RowBox[{
                RowBox[{"wFtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
              ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wF1F2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C13", ",", "C23", ",", "C33"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"wB1B1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wBtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C14", ",", "C24", ",", "C34"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wB2B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{"2", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{"wBtmp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "\[Theta]", "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"C15", ",", "C25", ",", "C35"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"\[Theta]tmp", "=", 
          RowBox[{"VectorAngle", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
              ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
               "+", 
               RowBox[{
                RowBox[{"wBtmp", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
              ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wB1B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C16", ",", "C26", ",", "C36"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0"}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF1B1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C17", ",", "C27", ",", "C37"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0"}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0"}], ",", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF2B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C18", ",", "C28", ",", "C38"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0"}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF1B2Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C19", ",", "C29", ",", "C39"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ")"}], "==", "0"}], ",", 
           RowBox[{"\[Theta]tmp", "=", "0"}], ",", 
           RowBox[{"\[Theta]tmp", "=", 
            RowBox[{"VectorAngle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
                ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wFtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], 
                 "+", 
                 RowBox[{
                  RowBox[{"wBtmp", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}],
                 ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"wF2B1Inhtmp", "=", 
          RowBox[{"setWave", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "w"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k", "]"}]}], 
             ",", 
             RowBox[{
              RowBox[{
               RowBox[{"wFtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", "k0", "]"}], "+", 
              RowBox[{
               RowBox[{"wBtmp", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", "k0", "]"}]}], 
             ",", "\[Theta]tmp", ",", 
             RowBox[{"{", 
              RowBox[{"C110", ",", "C210", ",", "C310"}], "}"}]}], "}"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "consider", " ", "both", " ", "backward", " ", "and", " ", 
           "standing", " ", "waves"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"solveInhom", "[", 
          RowBox[{
           RowBox[{"mAll", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wFtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"wFtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"wBtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"wBtmp", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp", ",", 
             "wB1B1Inhtmp", ",", "wB2B2Inhtmp", ",", "wB1B2Inhtmp", ",", 
             "wF1B1Inhtmp", ",", "wF2B2Inhtmp", ",", "wF1B2Inhtmp", ",", 
             "wF2B1Inhtmp"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1B1Inh", ",", "wF1B1Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2B2Inh", ",", "wF2B2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1B2Inh", ",", "wF1B2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2B1Inh", ",", "wF2B1Inhtmp"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB1B1Inh", ",", "wB1B1Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB2B2Inh", ",", "wB2B2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wB1B2Inh", ",", "wB1B2Inhtmp"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1F1Inh", ",", "wF1F1Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF2F2Inh", ",", "wF2F2Inhtmp"}], "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"wF1F2Inh", ",", "wF1F2Inhtmp"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"wFHomo", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wBHomo", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wFInh", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wF1F1Inh", ",", "wF2F2Inh", ",", "wF1F2Inh"}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wBInh", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"wB1B1Inh", ",", "wB2B2Inh", ",", "wB1B2Inh"}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wSInh", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{
         "wF1B1Inh", ",", "wF2B2Inh", ",", "wF1B2Inh", ",", "wF2B1Inh"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"flagBackward", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{"flagStandingWave", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wMed", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{
                "wFHomo", ",", "wBHomo", ",", "wFInh", ",", "wBInh", ",", 
                 "wSInh"}], "}"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"wInh", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"wFInh", ",", "wBInh", ",", "wSInh"}], "}"}], 
               "]"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"wMed", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"wFHomo", ",", "wBHomo", ",", "wFInh", ",", "wBInh"}],
                 "}"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"wInh", "=", 
             RowBox[{"Flatten", "/@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"wFInh", ",", "wBInh"}], "}"}], "]"}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wMed", "=", 
          RowBox[{"Flatten", "/@", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"wFHomo", ",", "wBHomo", ",", "wFInh"}], "}"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wInh", "=", "wFInh"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"thickness", "=", 
       RowBox[{
        RowBox[{"Key", "[", "h", "]"}], "/@", 
        RowBox[{"mAll", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"!", "flagHH"}], ")"}], "&&", "flagJK"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "layer", " ", "by", " ", "layer"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"unknowns", "=", 
          RowBox[{
           RowBox[{"Key", "[", "EE", "]"}], "/@", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2", ",", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wF1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "unknowns"}], 
          "]"}], ";", 
         RowBox[{"(*", "top", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"add", " ", "phase", " ", "shift"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"wF1tmp", "=", 
          RowBox[{"wF1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wF2tmp", "=", 
          RowBox[{"wF2", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wB1tmp", "=", 
          RowBox[{"wB1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wB2tmp", "=", 
          RowBox[{"wB2", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], 
           "}"}], "=", 
          RowBox[{"wFInh", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wF1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wF1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wF2", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wF2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wB1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"wB2", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"wB2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1F1Inhtmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF2F2Inhtmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1F2Inhtmp", "[", "EE", "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", "EE", "]"}], " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", "k", "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                RowBox[{"thickness", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wF1tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wF2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wF2tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wB1tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wB2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "wB2tmp"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"wFInh", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], 
           "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "<", "nM"}], ",", 
           RowBox[{"i", "++"}], ",", 
           RowBox[{"(*", "middle", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"unknowns", "=", 
             RowBox[{
              RowBox[{"Key", "[", "EE", "]"}], "/@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wB1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wB2", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wF1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wF2", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"unknowns", "=", 
             RowBox[{"DeleteDuplicates", "@", 
              RowBox[{"Cases", "[", 
               RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"solveFresnel", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "wF1tmp", ",", "wF2tmp", ",", "wF1F1Inhtmp", ",", 
                "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wB1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wB2", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wF1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wF2", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}], ",", 
              "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"wF1tmp", "=", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wF2tmp", "=", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wB1tmp", "=", 
             RowBox[{"wB1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wB2tmp", "=", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}],
               "}"}], "=", 
             RowBox[{"wFInh", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wF1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wF1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF2tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wF2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wF2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB1tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wB1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wB1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB2tmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"wB2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"wB2", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", "k", "]"}], 
                 ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1F1Inhtmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"wFInh", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", "k", "]"}], ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF2F2Inhtmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"wFInh", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", "k", "]"}], ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1F2Inhtmp", "[", "EE", "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", "EE", "]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"wFInh", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "[", "k", "]"}], ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}], 
                   RowBox[{"thickness", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF1tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wF2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wF2tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB1tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wB2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", "wB2tmp"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wFInh", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", 
             RowBox[{"{", 
              RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}],
               "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{
           RowBox[{"Key", "[", "EE", "]"}], "/@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", "wT1", ",", "wT2"}], 
            "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "wF1tmp", ",", "wF2tmp", ",", "wF1F1Inhtmp", ",", "wF2F2Inhtmp", 
             ",", "wF1F2Inhtmp"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "nM", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "unknowns"}], "]"}], ";", 
         RowBox[{"(*", "bottom", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"wFHomo", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wBHomo", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wInh", "=", "wFInh"}], ";"}]}], 
       RowBox[{"(*", 
        RowBox[{"just", " ", "for", " ", "output"}], "*)"}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"!", "flagJK"}], ")"}], "&&", "flagHH"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "layer", " ", "by", " ", "layer"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "all", " ", "waves", " ", "at", " ", "once"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wMed", "=", 
          RowBox[{"Flatten", "/@", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"wFHomo", ",", "wBHomo", ",", "wFInh"}], "}"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wInh", "=", "wFInh"}], ";", "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{"wFHomo", ",", "wBHomo"}], "}"}]}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnelN", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", "wMed", ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "thickness", ",", 
           "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"wFHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wBHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"3", ";;", "4"}]}], "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"unknowns", "=", 
          RowBox[{
           RowBox[{"Key", "[", "EE", "]"}], "/@", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2", ",", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wF1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"wFInh", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "unknowns"}], 
          "]"}], ";", 
         RowBox[{"(*", "top", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"DO", " ", "NOT", " ", "add", " ", "phase", " ", "shift"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"wF1tmp", "=", 
          RowBox[{"wF1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wF2tmp", "=", 
          RowBox[{"wF2", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wB1tmp", "=", 
          RowBox[{"wB1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wB2tmp", "=", 
          RowBox[{"wB2", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], 
           "}"}], "=", 
          RowBox[{"wFInh", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "<", "nM"}], ",", 
           RowBox[{"i", "++"}], ",", 
           RowBox[{"(*", "middle", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"unknowns", "=", 
             RowBox[{
              RowBox[{"Key", "[", "EE", "]"}], "/@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wB1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wB2", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wF1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wF2", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"unknowns", "=", 
             RowBox[{"DeleteDuplicates", "@", 
              RowBox[{"Cases", "[", 
               RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"solveFresnel", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "wF1tmp", ",", "wF2tmp", ",", "wF1F1Inhtmp", ",", 
                "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wB1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"wB2", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"wF1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wF2", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"wFInh", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}], ",", 
              "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"wF1tmp", "=", 
             RowBox[{"wF1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wF2tmp", "=", 
             RowBox[{"wF2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wB1tmp", "=", 
             RowBox[{"wB1", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"wB2tmp", "=", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"wF1F1Inhtmp", ",", "wF2F2Inhtmp", ",", "wF1F2Inhtmp"}],
               "}"}], "=", 
             RowBox[{"wFInh", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{
           RowBox[{"Key", "[", "EE", "]"}], "/@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", "wT1", ",", "wT2"}], 
            "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnel", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "wF1tmp", ",", "wF2tmp", ",", "wF1F1Inhtmp", ",", "wF2F2Inhtmp", 
             ",", "wF1F2Inhtmp"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"wB1", "[", 
              RowBox[{"[", "nM", "]"}], "]"}], ",", 
             RowBox[{"wB2", "[", 
              RowBox[{"[", "nM", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "unknowns"}], "]"}], ";", 
         RowBox[{"(*", "bottom", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"wFHomo", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wF1", ",", "wF2"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wBHomo", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"wB1", ",", "wB2"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wInh", "=", "wFInh"}], ";"}], 
        RowBox[{"(*", 
         RowBox[{"just", " ", "for", " ", "output"}], "*)"}], 
        "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"!", "flagJK"}], ")"}], "&&", 
         RowBox[{"(", 
          RowBox[{"!", "flagHH"}], ")"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Solve", " ", "all", " ", "waves", " ", "at", " ", "once"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"unknowns", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wR1", ",", "wR2"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{"wFHomo", ",", "wBHomo"}], "}"}]}]}], ",", 
            RowBox[{
             RowBox[{"Key", "[", "EE", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"wT1", ",", "wT2"}], "}"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"unknowns", "=", 
          RowBox[{"DeleteDuplicates", "@", 
           RowBox[{"Cases", "[", 
            RowBox[{"unknowns", ",", "_Symbol", ",", "Infinity"}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"solveFresnelN", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wR1", ",", "wR2"}], "}"}], ",", "wMed", ",", 
           RowBox[{"{", 
            RowBox[{"wT1", ",", "wT2"}], "}"}], ",", "thickness", ",", 
           "unknowns"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"wFHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"wBHomo", "=", 
          RowBox[{"wMed", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"3", ";;", "4"}]}], "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "distinguish", " ", "s", " ", "and", " ", "p", " ", "from", " ", "R1",
          " ", "and", " ", "R2"}], ",", 
        RowBox[{"T1", " ", "and", " ", "T2"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "no", " ", "need", " ", "to", " ", "distinguish", " ", "them", " ", 
        "for", " ", "B", " ", "and", " ", "F", " ", "waves", " ", "cause", 
        " ", "they", " ", 
        RowBox[{"don", "'"}], "t", " ", "have", " ", "to", " ", "be", " ", 
        "s", " ", "and", " ", "p"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"wRs", "=", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
           "|>"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wRp", "=", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wR1", ",", "wR2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
           "|>"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wTs", "=", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
           "|>"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wTp", "=", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wT1", ",", "wT2"}], "}"}], ",", 
          RowBox[{"<|", 
           RowBox[{"__", ",", 
            RowBox[{"EE", "->", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Except", "[", "0", "]"}], ",", "0"}], "}"}]}]}], 
           "|>"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"sollinear", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"wRs", ",", "wRp"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"wTs", ",", "wTp"}], "}"}], ",", "wBHomo", ",", "wFHomo", 
          ",", "wInh"}], "}"}]}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.847904021337448*^9, 3.847904079863578*^9}, {
   3.8479041340489798`*^9, 3.8479042110755568`*^9}, {3.8479042620754294`*^9, 
   3.8479044186440964`*^9}, {3.8479044494529495`*^9, 
   3.8479045498011155`*^9}, {3.8479046076243896`*^9, 3.847904754159469*^9}, {
   3.8479048081100693`*^9, 3.847904888729932*^9}, {3.847905003974305*^9, 
   3.8479050377665234`*^9}, {3.8479050741899157`*^9, 
   3.8479052217836285`*^9}, {3.8479054624631352`*^9, 
   3.8479054737539687`*^9}, {3.8479055039898276`*^9, 
   3.8479055182659173`*^9}, {3.847905745467016*^9, 3.8479057720299916`*^9}, {
   3.847905809728097*^9, 3.847905811641218*^9}, {3.8479058563819485`*^9, 
   3.84790592493198*^9}, {3.847905955468961*^9, 3.8479061110302687`*^9}, {
   3.847906278944174*^9, 3.8479063205585904`*^9}, {3.8479262196663213`*^9, 
   3.847926231860385*^9}, 3.8479275360377665`*^9, {3.8545034138271947`*^9, 
   3.8545034261290674`*^9}, {3.8545045368777275`*^9, 3.854504555604375*^9}, {
   3.854668427462703*^9, 3.854668665380283*^9}, {3.854668739984418*^9, 
   3.8546687476133366`*^9}, {3.8546687834943895`*^9, 3.854668784344531*^9}, {
   3.854670481240612*^9, 3.854670485394778*^9}, {3.854670527241098*^9, 
   3.8546705361153264`*^9}, 3.8546713028070726`*^9, {3.8580033133074417`*^9, 
   3.8580033321862173`*^9}, {3.8863868680975037`*^9, 3.886386888652254*^9}, {
   3.8864576461524773`*^9, 3.8864577128829083`*^9}, {3.886458066783598*^9, 
   3.8864580672786474`*^9}, {3.8864582081827836`*^9, 3.886458210980225*^9}, {
   3.886458404692974*^9, 3.8864584049273586`*^9}, {3.8864591408821077`*^9, 
   3.8864591461215506`*^9}, {3.8864740066819334`*^9, 
   3.8864740631320124`*^9}, {3.887929935262846*^9, 3.8879299531330147`*^9}, {
   3.887930001806389*^9, 3.8879300502043905`*^9}, {3.8879313369374638`*^9, 
   3.887931339028023*^9}, {3.8924647128094177`*^9, 3.8924648321152134`*^9}, {
   3.8925010810223055`*^9, 3.8925011113602667`*^9}, {3.8925011448185987`*^9, 
   3.8925011622238083`*^9}, {3.8925012140053043`*^9, 3.892501363509116*^9}, {
   3.8927637736446347`*^9, 3.8927637762734118`*^9}, 3.892764574740513*^9, {
   3.892765028010311*^9, 3.8927650379900904`*^9}, 3.893979452009078*^9, {
   3.8939794883516207`*^9, 3.893979496395278*^9}, {3.8939798628228226`*^9, 
   3.8939798637835937`*^9}, {3.893981301241152*^9, 3.89398130695002*^9}, 
   3.893982242065725*^9, {3.893982285607934*^9, 3.8939822880791125`*^9}, {
   3.893984380858761*^9, 3.8939843810267534`*^9}, {3.896046497890092*^9, 
   3.896046514936823*^9}, {3.896046548319895*^9, 3.896046549387146*^9}, {
   3.8960466403885727`*^9, 3.8960466442719765`*^9}, 3.8960466830886383`*^9, {
   3.8960468807376747`*^9, 3.896046980743018*^9}, {3.896047039099717*^9, 
   3.8960470449912233`*^9}, {3.896047075204921*^9, 3.8960471102443037`*^9}, {
   3.8960471965375767`*^9, 3.8960472595066137`*^9}, {3.8960473045866127`*^9, 
   3.896047686950677*^9}, {3.8960547286844635`*^9, 3.896054738947447*^9}, {
   3.8960547911826696`*^9, 3.896054791581339*^9}, {3.896054927103295*^9, 
   3.8960549615113134`*^9}, {3.896055113763972*^9, 3.8960551154394712`*^9}, {
   3.896057185802869*^9, 3.8960572326057196`*^9}, {3.8960576782529383`*^9, 
   3.8960577276536427`*^9}, {3.896057763654771*^9, 3.8960577989637566`*^9}, {
   3.8960578362673817`*^9, 3.896057917332243*^9}, {3.8960579727728834`*^9, 
   3.8960580348043356`*^9}, {3.8960580661473694`*^9, 
   3.8960583761554704`*^9}, {3.8960586033410416`*^9, 
   3.8960586175209665`*^9}, {3.8960586589894*^9, 3.8960586846076508`*^9}, 
   3.896058730960905*^9, {3.8960592138268623`*^9, 3.89605922077227*^9}, 
   3.896059637389407*^9, {3.8960596715503473`*^9, 3.8960597016027822`*^9}, {
   3.896060907215351*^9, 3.8960610005317383`*^9}, {3.896061125958097*^9, 
   3.8960613278791075`*^9}, {3.8960613660002337`*^9, 
   3.8960613934055166`*^9}, {3.896061473325368*^9, 3.896061514645944*^9}, {
   3.8960616420987854`*^9, 3.896061642260931*^9}, {3.896065411491273*^9, 
   3.8960654161897473`*^9}, {3.8960954029567447`*^9, 3.8960954047613816`*^9}, 
   3.896095492932169*^9, {3.896095575014002*^9, 3.896095622595947*^9}, {
   3.8960957134284773`*^9, 3.896095722556875*^9}, {3.8960957823361588`*^9, 
   3.896095791273837*^9}, {3.8960958233663073`*^9, 3.8960958265718937`*^9}, 
   3.896096042069668*^9, {3.896096077099732*^9, 3.8960960784206524`*^9}, {
   3.8960961120920486`*^9, 3.896096115791517*^9}, 3.896097014188428*^9, {
   3.896107319784792*^9, 3.896107341386264*^9}, {3.8961074500863457`*^9, 
   3.8961074564175005`*^9}, {3.8961414814703746`*^9, 
   3.8961415420218296`*^9}, {3.896141579571952*^9, 3.896141677371272*^9}, {
   3.896141716294585*^9, 3.896141718260524*^9}, {3.896142305518067*^9, 
   3.8961424408203344`*^9}, {3.896664559489291*^9, 3.8966645632468567`*^9}, {
   3.8966651361557283`*^9, 3.8966651363084483`*^9}, {3.8966662399739447`*^9, 
   3.8966662403123074`*^9}, {3.8966664663799596`*^9, 
   3.8966664828062263`*^9}, {3.896666556465587*^9, 3.8966666476100364`*^9}, {
   3.896667100909322*^9, 3.8966671285496845`*^9}, {3.896667176848914*^9, 
   3.8966671996922493`*^9}, {3.896668579909505*^9, 3.896668611313341*^9}, {
   3.896668645082497*^9, 3.8966686800832553`*^9}, {3.896668717044568*^9, 
   3.896668738554902*^9}, {3.8967429205210595`*^9, 3.8967429793004665`*^9}, 
   3.896743793823578*^9, 3.896745133372715*^9, {3.8971033647458663`*^9, 
   3.8971034181625943`*^9}, {3.8971034808274593`*^9, 
   3.8971034861391616`*^9}, {3.8971038743115582`*^9, 
   3.8971039103376493`*^9}, {3.8971040200012555`*^9, 3.897104105932486*^9}, 
   3.8971044047974806`*^9, {3.897104450409124*^9, 3.8971044519066114`*^9}, 
   3.8971044913709*^9, {3.8971046029168434`*^9, 3.897104608518504*^9}, {
   3.8971046806482773`*^9, 3.8971047038195105`*^9}, 3.897105094217064*^9, {
   3.897105524102663*^9, 3.8971056982761354`*^9}, {3.897105743053919*^9, 
   3.897105779661152*^9}, {3.8971058154936185`*^9, 3.8971058817552595`*^9}, {
   3.8971064532253036`*^9, 3.8971064556918507`*^9}, {3.8971066455554886`*^9, 
   3.8971066615166025`*^9}, {3.897106798045481*^9, 3.8971068129004626`*^9}, {
   3.8971070947785945`*^9, 3.897107105993081*^9}, {3.897107248452628*^9, 
   3.8971072578300714`*^9}, {3.897107330233627*^9, 3.8971073383603473`*^9}, {
   3.897174524741563*^9, 3.897174525506693*^9}, {3.8971745772871447`*^9, 
   3.8971745800331087`*^9}, {3.8973329934159813`*^9, 
   3.8973330194233265`*^9}, {3.897333107839645*^9, 3.8973331085803337`*^9}, {
   3.8973331400087724`*^9, 3.8973331440215178`*^9}, {3.897333193040944*^9, 
   3.8973332000141172`*^9}, {3.8973332345464087`*^9, 3.897333547650926*^9}, {
   3.8973336142512646`*^9, 3.897333663610487*^9}, 3.897334148902088*^9, {
   3.8973374721705475`*^9, 3.897337477521264*^9}, {3.8974413903222923`*^9, 
   3.8974413945473213`*^9}, {3.8978556759902453`*^9, 
   3.8978557667276726`*^9}, {3.89785579848901*^9, 3.8978558040135736`*^9}, {
   3.8978560640409837`*^9, 3.8978561973318095`*^9}, {3.897856238266096*^9, 
   3.8978562572234273`*^9}, {3.897856298048241*^9, 3.897856298296916*^9}, {
   3.8978563300181656`*^9, 3.897856399572016*^9}, {3.8978570591570005`*^9, 
   3.897857093863719*^9}, {3.8978572252512894`*^9, 3.8978572296111245`*^9}, 
   3.8978572639289722`*^9, {3.897857295453887*^9, 3.897857304578474*^9}, {
   3.897857630366929*^9, 3.897857645945857*^9}, {3.8978577580691805`*^9, 
   3.897857758217182*^9}, {3.9067438849720974`*^9, 3.906744043311474*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"b3fd9750-a54b-4182-8c39-820f6425e529"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Other preset functions for GUI", "Title",
 CellChangeTimes->{{3.8933481280005827`*^9, 3.8933481316914787`*^9}, {
  3.8933527638958845`*^9, 
  3.893352765059311*^9}},ExpressionUUID->"9042ff58-e452-4ecb-88e6-\
13f19a0537e6"],

Cell[CellGroupData[{

Cell["for preprocessing (inputs, conversion, etc) ", "Chapter",
 CellChangeTimes->{{3.8933788114223633`*^9, 
  3.893378825966983*^9}},ExpressionUUID->"1ec80b5a-86c5-422b-a529-\
432dbf698fdd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"generatingdfun1", ",", "generatingdfun2", ",", "indexfun1"}], 
    "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"generatingdfun1", " ", "is", " ", "for", " ", "read"}], "-", 
     RowBox[{
     "in", " ", "the", " ", "independent", " ", "d", " ", "components", " ", 
      "and", " ", "for", " ", "displaying", " ", "inn", " ", "the", " ", 
      "control", " ", "panel"}]}], ";", " ", 
    RowBox[{
    "use", " ", "generatingfun1", " ", "to", " ", "create", " ", "dlist", " ",
      "for", " ", "displaying"}], ";"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generatingdfun1", "[", "matindex_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"indiceslist", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "6"}], "}"}]}], "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "==", "0"}], ",", 
          "\[IndentingNewLine]", "\"\<0\>\"", ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "==", 
              RowBox[{
               RowBox[{"IntegerDigits", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "\[And]", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "==", 
              RowBox[{
               RowBox[{"IntegerDigits", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"InputField", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"FieldSize", "->", "6"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Dynamic", "[", 
             RowBox[{
              RowBox[{"Sign", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"allmaterials", "[", 
                   RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "*", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"IntegerDigits", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"IntegerDigits", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], 
           "\[IndentingNewLine]", "]"}]}], "]"}], "&"}], ",", "indiceslist", 
       ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"indexfun1", "[", "tempindex_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"generatingdfun2", "[", 
      RowBox[{"tempindex", ",", "#"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "6"}], "}"}]}], "]"}], ",", "1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generatingdfun2", "[", 
    RowBox[{"matindex_", ",", "indices_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "\[NotEqual]", 
       RowBox[{
        RowBox[{"IntegerDigits", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"allmaterials", "[", 
              RowBox[{"[", "matindex", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"indices", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "\[Or]", 
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "\[NotEqual]", 
       RowBox[{
        RowBox[{"IntegerDigits", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"allmaterials", "[", 
              RowBox[{"[", "matindex", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"indices", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allmaterials", "[", 
           RowBox[{"[", "matindex", "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"indices", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"indices", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "==", "0"}], ",", 
         "0", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Sign", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"allmaterials", "[", 
                RowBox[{"[", "matindex", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"indices", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "*", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"allmaterials", "[", 
              RowBox[{"[", "matindex", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"Key", "[", "dC", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"IntegerDigits", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"allmaterials", "[", 
                    RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"indices", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"IntegerDigits", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"allmaterials", "[", 
                   RowBox[{"[", "matindex", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"indices", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"indices", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}]}], "]"}]}], 
      ";"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.89333099562446*^9, 3.893331012471932*^9}, {
   3.8933311509972844`*^9, 3.8933311561753006`*^9}, {3.893331445423029*^9, 
   3.893331585637816*^9}, {3.8933340883388443`*^9, 3.8933341113448844`*^9}, {
   3.8933341828077126`*^9, 3.8933341925466948`*^9}, {3.893334591586525*^9, 
   3.893334662443522*^9}, {3.89333469326283*^9, 3.893334719985879*^9}, {
   3.8933347788541*^9, 3.8933349364958873`*^9}, {3.893335012514936*^9, 
   3.8933350412256174`*^9}, 3.8933353041510973`*^9, {3.8933354700059404`*^9, 
   3.8933354715704684`*^9}, {3.893336070595887*^9, 3.8933360982696676`*^9}, 
   3.8933361957526193`*^9, {3.89333623445137*^9, 3.89333624252839*^9}, {
   3.8937223121381936`*^9, 3.893722317212073*^9}, 3.8953649205340967`*^9, 
   3.895859953699232*^9, 3.8958600206318083`*^9, {3.895865177085079*^9, 
   3.8958652548222017`*^9}, {3.8958653749579344`*^9, 3.895865397604021*^9}, {
   3.8958654277214985`*^9, 3.8958654586193275`*^9}, {3.89586549707895*^9, 
   3.8958655896259594`*^9}, 3.8960378929527073`*^9},
 CellLabel->
  "In[105]:=",ExpressionUUID->"94e87d36-2b94-458c-9d74-6870a346fef5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "clearFigs", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"clearFigs", "[", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"heterostructureschematic", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fig12d", "=", "placeHolderFigs"}], ";", "\[IndentingNewLine]", 
     RowBox[{"fig13d", "=", "placeHolderFigs"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ellipticityfig", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"plot2geometry2d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"plot2geometry3d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"polarizationplot2d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"polarizationplot3d", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"figfresnel", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"figmakerfringespar", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"figmakerfringesperp", "=", "placeHolderFigs"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"figRs", ",", "figRp", ",", "figTs", ",", "figTp"}], "}"}], 
      "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"placeHolderFigs", ",", "4"}], "]"}]}]}], 
    "\[IndentingNewLine]", ")"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.895881144875887*^9, 3.8958811470363464`*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"ad125409-1df9-479b-8433-6fee9c508f3e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "ruihklfun", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"ruihklfun", ",", "HoldAll"}], "]"}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ruihklfun", "[", "matindex_", "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "clatticex", ",", "clatticey", ",", "clatticez", ",", "aZTohkl11", ",",
         "aZTohkl21", ",", "aZTohkl31", ",", "aZTohkl12", ",", "aZTohkl22", 
        ",", "aZTohkl32", ",", "aZTohkl13", ",", "aZTohkl23", ",", 
        "aZTohkl33", ",", "Valattice", ",", "Vblattice", ",", "Vclattice", 
        ",", "latticeSolve", ",", "b1", ",", "b2", ",", "b3", ",", "Z1", ",", 
        "Z2", ",", "Z3", ",", "VInput1", ",", "VInput2", ",", "VInput3", ",", 
        "aZTohkl", ",", "CryOrienSolve", ",", "a", ",", "b1lab", ",", "b2lab",
         ",", "b3lab", ",", "Valatticelab", ",", "Vblatticelab", ",", 
        "Vclatticelab", ",", "PlanehSolve", ",", "PlanekSolve", ",", 
        "PlanelSolve", ",", "VerticalhSolve", ",", "VerticalkSolve", ",", 
        "VerticallSolve", ",", "o1", ",", "o2", ",", "o3", ",", 
        "\[IndentingNewLine]", "Orientation", ",", "PointGroup", ",", 
        "\[IndentingNewLine]", "ori", ",", "alattice", ",", "blattice", ",", 
        "clattice", ",", "alphalattice", ",", "betalattice", ",", 
        "gamalattice", ",", 
        RowBox[{"DebugFlag", "=", "False"}], ",", "Verticalh", ",", 
        "Verticalk", ",", "Verticall", ",", "Planeh", ",", "Planek", ",", 
        "Planel", ",", "rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Orientation", "=", 
        RowBox[{
         RowBox[{"allmaterials", "[", 
          RowBox[{"[", "matindex", "]"}], "]"}], "[", "orientation", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"PointGroup", "=", 
        RowBox[{
         RowBox[{"allmaterials", "[", 
          RowBox[{"[", "matindex", "]"}], "]"}], "[", "pg", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "alattice", ",", "blattice", ",", "clattice", ",", "alphalattice", 
          ",", "betalattice", ",", "gamalattice"}], "}"}], "=", 
        RowBox[{
         RowBox[{"allmaterials", "[", 
          RowBox[{"[", "matindex", "]"}], "]"}], "[", "latcon", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ori", "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Planeh", ",", "Planek", ",", "Planel"}], "}"}], "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Verticalh", ",", "Verticalk", ",", "Verticall"}], "}"}], 
        "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], "=", 
        RowBox[{"Orientation", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Valattice", "=", 
        RowBox[{"alattice", "*", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]}], ";", " ", 
       RowBox[{"Vblattice", "=", 
        RowBox[{"blattice", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"gamalattice", "*", 
             RowBox[{"Pi", "/", "180"}]}], "]"}], ",", 
           RowBox[{"Sin", "[", 
            RowBox[{"gamalattice", "*", 
             RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0"}], "}"}]}]}], ";", 
       " ", 
       RowBox[{"Vclattice", "=", 
        RowBox[{"clattice", "*", 
         RowBox[{"{", 
          RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"latticeSolve", " ", "=", " ", 
        RowBox[{"Quiet", "[", 
         RowBox[{"NSolve", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"clatticez", ">", "0"}], "&&", " ", 
             RowBox[{
              RowBox[{"VectorAngle", "[", 
               RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "\[Equal]", 
              " ", 
              RowBox[{"betalattice", "*", 
               RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", 
             RowBox[{
              RowBox[{"VectorAngle", "[", 
               RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "\[Equal]", 
              " ", 
              RowBox[{"alphalattice", "*", 
               RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"clatticex", "^", "2"}], "+", 
               RowBox[{"clatticey", "^", "2"}], "+", 
               RowBox[{"clatticez", "^", "2"}]}], "\[Equal]", "1"}]}], "}"}], 
           " ", ",", 
           RowBox[{"{", 
            RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], "}"}], 
           ",", "Reals"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"clatticex", "=", " ", 
        RowBox[{"clatticex", "/.", 
         RowBox[{"latticeSolve", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"clatticey", "=", " ", 
        RowBox[{"clatticey", "/.", 
         RowBox[{"latticeSolve", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"clatticez", "=", " ", 
        RowBox[{"clatticez", "/.", 
         RowBox[{"latticeSolve", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b1", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"Valattice", ".", 
           RowBox[{"Cross", "[", 
            RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b2", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{"Vclattice", ",", "Valattice"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"Valattice", ".", 
           RowBox[{"Cross", "[", 
            RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b3", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{"Valattice", ",", "Vblattice"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"Valattice", ".", 
           RowBox[{"Cross", "[", 
            RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<clatticex = \>\"", ",", "clatticex", ",", 
           "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
           "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", "b2", 
           ",", "\"\< , b3 = \>\"", ",", "b3"}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<1\>\""}], "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(1\), \(_\)]\)\>\""}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m\>\""}], "||", 
          " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<2/m\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", 
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", " ", 
           RowBox[{"Z1", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<mm2\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<222\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<mmm\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
           RowBox[{"Z3", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<3\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<32\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<3m\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)m\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]2\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]m\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]\>\""}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
           RowBox[{"Z2", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<4\>\""}], 
          " ", "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4mm\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<422\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)2m\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/m\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/mmm\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
           RowBox[{"Z2", "=", 
            RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
           RowBox[{"Z3", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<6\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6mm\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<622\>\""}], "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/m\>\""}], " ", 
          "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/mmm\>\""}], 
          " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]/mm\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]/m\>\""}]}], "  ", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
           RowBox[{"Z2", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", 
           "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\""}], " ", "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<23\>\""}], " ", "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]\[Infinity]m\>\""}], "||", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           "\"\<\[Infinity]\[Infinity]\>\""}], "||", " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3\>\""}], "||", 
          " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<432\>\""}], "||",
           " ", 
          RowBox[{
           RowBox[{"PointGroup", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3m\>\""}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Z3", "=", 
            RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
           RowBox[{"Z1", "=", 
            RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
           RowBox[{"Z2", " ", "=", " ", 
            RowBox[{"Normalize", "[", 
             RowBox[{"Cross", "[", 
              RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<clatticex = \>\"", ",", "clatticex", ",", 
             "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
             "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", 
             RowBox[{"b2", "\"\< , b3 = \>\""}], ",", "b3"}], "]"}], ";"}], 
          "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ori", "==", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"VInput3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Planeh", "*", "b1"}], "+", 
             RowBox[{"Planek", "*", "b2"}], "+", 
             RowBox[{"Planel", "*", "b3"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"VInput2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Verticalh", "*", "Valattice"}], "+", 
             RowBox[{"Verticalk", "*", "Vblattice"}], "+", 
             RowBox[{"Verticall", "*", "Vclattice"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"VInput1", " ", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"VInput2", ",", "VInput3"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<Z1 = \>\"", ",", "Z1", ",", "\"\< , Z2 = \>\"", ",", "Z2",
                 ",", "\"\< , Z3 = \>\"", ",", "Z3"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<VInput1 = \>\"", ",", "VInput1", ",", 
                "\"\< , VInput2 = \>\"", ",", "VInput2", ",", 
                "\"\< , VInput3 = \>\"", ",", "VInput3"}], "]"}], ";"}], 
             "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"aZTohkl", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], 
              "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"CryOrienSolve", " ", "=", " ", 
           RowBox[{"Quiet", "[", 
            RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"aZTohkl", ".", 
                 RowBox[{"{", 
                  RowBox[{"Z1", ",", "Z2", ",", "Z3"}], "}"}]}], "\[Equal]", 
                " ", 
                RowBox[{"{", 
                 RowBox[{"VInput1", ",", "VInput2", ",", "VInput3"}], "}"}]}],
                "}"}], " ", ",", 
              RowBox[{"{", 
               RowBox[{
               "aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13", ",", 
                "aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23", ",", 
                "aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], "}"}]}], 
             "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", " ", "[", 
           RowBox[{"DebugFlag", ",", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<latticeSolve = \>\"", ",", "latticeSolve"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<CryOrienSolve = \>\"", ",", "CryOrienSolve"}], 
               " ", "]"}], ";"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"aZTohkl11", "=", " ", 
           RowBox[{"aZTohkl11", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl12", "=", " ", 
           RowBox[{"aZTohkl12", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl13", "=", " ", 
           RowBox[{"aZTohkl13", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"aZTohkl21", "=", " ", 
           RowBox[{"aZTohkl21", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "4"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl22", "=", " ", 
           RowBox[{"aZTohkl22", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "5"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl23", "=", " ", 
           RowBox[{"aZTohkl23", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"aZTohkl31", "=", " ", 
           RowBox[{"aZTohkl31", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "7"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl32", "=", " ", 
           RowBox[{"aZTohkl32", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "8"}], "]"}], "]"}]}]}], ";", 
          RowBox[{"aZTohkl33", "=", " ", 
           RowBox[{"aZTohkl33", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "9"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"o1", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Chop", "[", 
             RowBox[{"aZTohkl", ".", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]}], 
          ";", " ", 
          RowBox[{"o2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Chop", "[", 
             RowBox[{"aZTohkl", ".", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "]"}]}], 
          ";", " ", 
          RowBox[{"o3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Chop", "[", 
             RowBox[{"aZTohkl", ".", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"DebugFlag", ",", 
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\<Cry1 = \>\"", ",", "rCry1", ",", "\"\< , Cry2 = \>\"", ",", 
              "rCry2", ",", "\"\< , Cry3 = \>\"", ",", "rCry3"}], "]"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"{", 
            RowBox[{"o1", ",", "o2", ",", "o3"}], "}"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "=", "o1"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "=", "o2"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "=", "o3"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"allmaterials", "[", 
             RowBox[{"[", "matindex", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab1", ".", "o1"}], ",", 
               RowBox[{"Lab1", ".", "o2"}], ",", 
               RowBox[{"Lab1", ".", "o3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab2", ".", "o1"}], ",", 
               RowBox[{"Lab2", ".", "o2"}], ",", 
               RowBox[{"Lab2", ".", "o3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab3", ".", "o1"}], ",", 
               RowBox[{"Lab3", ".", "o2"}], ",", 
               RowBox[{"Lab3", ".", "o3"}]}], "}"}]}], "}"}]}], ";"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"EndofIfHKL", ",", 
           RowBox[{"UseDireciton", "=", "Miller"}]}], "*)"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"a", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab1", ".", "rCry1"}], ",", 
               RowBox[{"Lab1", ".", "rCry2"}], ",", 
               RowBox[{"Lab1", ".", "rCry3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab2", ".", "rCry1"}], ",", 
               RowBox[{"Lab2", ".", "rCry2"}], ",", 
               RowBox[{"Lab2", ".", "rCry3"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "       ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Lab3", ".", "rCry1"}], ",", 
               RowBox[{"Lab3", ".", "rCry2"}], ",", 
               RowBox[{"Lab3", ".", "rCry3"}]}], "}"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"allmaterials", "[", 
             RowBox[{"[", "matindex", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", "a"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"b1lab", "=", 
           RowBox[{"a", ".", "b1"}]}], ";", " ", 
          RowBox[{"b2lab", "=", 
           RowBox[{"a", ".", "b2"}]}], ";", " ", 
          RowBox[{"b3lab", "=", 
           RowBox[{"a", ".", "b3"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Valatticelab", "=", 
           RowBox[{"a", ".", "Valattice"}]}], ";", " ", 
          RowBox[{"Vblatticelab", "=", 
           RowBox[{"a", ".", "Vblattice"}]}], ";", " ", 
          RowBox[{"Vclatticelab", "=", 
           RowBox[{"a", ".", "Vclattice"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"b1lab", ",", "b2lab", ",", "b3lab"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{
             "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                 RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                 RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                 RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                 RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                "\[Equal]", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], "]"}], 
            ";"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"CryOrienSolve", " ", "=", " ", 
           RowBox[{"Quiet", "[", 
            RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                  RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                  RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                  RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                  RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                 "\[Equal]", " ", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], " ", 
              ",", 
              RowBox[{"{", 
               RowBox[{
               "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve", ",", 
                "VerticalhSolve", ",", "VerticalkSolve", ",", 
                "VerticallSolve"}], "}"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{
             "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"MatrixForm", "@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                  RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                  RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                  RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                  RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                 "\[Equal]", " ", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}]}], " ", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", "CryOrienSolve", "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"PlanehSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"PlanehSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PlanekSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"PlanekSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PlanelSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"PlanelSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "3"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"VerticalhSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"VerticalhSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
          RowBox[{"VerticalkSolve", "=", 
           RowBox[{"Chop", "[", " ", 
            RowBox[{"VerticalkSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "5"}], "]"}], "]"}]}], "]"}]}], ";", 
          RowBox[{"VerticallSolve", "=", " ", 
           RowBox[{"Chop", "[", 
            RowBox[{"VerticallSolve", "/.", 
             RowBox[{"CryOrienSolve", " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "6"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"o1", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Rationalize", "[", 
              RowBox[{
               RowBox[{"Normalize", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                  "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve"}], 
                  "}"}], ",", 
                 RowBox[{"Composition", "[", 
                  RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"o2", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{
             RowBox[{"Rationalize", "[", 
              RowBox[{
               RowBox[{"Normalize", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                  "VerticalhSolve", ",", "VerticalkSolve", ",", 
                   "VerticallSolve"}], "}"}], ",", 
                 RowBox[{"Composition", "[", 
                  RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"{", 
            RowBox[{"o1", ",", "o2"}], "}"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "=", "o1"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"allmaterials", "[", 
               RowBox[{"[", "matindex", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "=", "o2"}], ";"}]}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Print", "[", 
          RowBox[{"o1", ",", "o2"}], "]"}], "*)"}], 
        RowBox[{"(*", " ", 
         RowBox[{"EndofIfHKL", ",", 
          RowBox[{"UseDireciton", "=", "CrystalPhysics"}]}], "*)"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  RowBox[{"(*", " ", "EndofIfHKL", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.893332232910041*^9, 3.8933322524001656`*^9}, 
   3.893333034370672*^9, {3.893333196848257*^9, 3.893333243415746*^9}, {
   3.8933332843869762`*^9, 3.893333317909128*^9}, {3.893333360735362*^9, 
   3.893333365269149*^9}, {3.8933334194537163`*^9, 3.8933334755436754`*^9}, {
   3.8933335847817636`*^9, 3.893333650382358*^9}, {3.893333757699297*^9, 
   3.8933337695259094`*^9}, {3.8933338051072807`*^9, 3.893333939377002*^9}, {
   3.8933370820525045`*^9, 3.893337093875702*^9}, {3.8933372986554327`*^9, 
   3.8933373289874043`*^9}, 3.8933394815611258`*^9, {3.8944086221472845`*^9, 
   3.8944087016188517`*^9}, {3.894408748767632*^9, 3.894408751864159*^9}, {
   3.8944088324358644`*^9, 3.894408990407784*^9}, {3.894636519616379*^9, 
   3.8946365403574867`*^9}, {3.8946386695090837`*^9, 
   3.8946387419334126`*^9}, {3.895837978693138*^9, 3.8958379835264235`*^9}, {
   3.8959316241612687`*^9, 3.8959316261480813`*^9}, {3.8959316784827523`*^9, 
   3.8959317071432285`*^9}, {3.895931770238307*^9, 3.8959318569088087`*^9}, {
   3.8959321134651833`*^9, 3.895932114985832*^9}, 3.895932271715277*^9, {
   3.8970115872608976`*^9, 3.897011589142701*^9}, {3.897172961727069*^9, 
   3.8971729619970627`*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"d9ded69a-2a0e-4e42-9380-ffecf28be5f8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "hklConvert", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"hklConvert", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hklConvert", "[", "mat_", "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "clatticex", ",", "clatticey", ",", "clatticez", ",", "aZTohkl11", ",", 
       "aZTohkl21", ",", "aZTohkl31", ",", "aZTohkl12", ",", "aZTohkl22", ",",
        "aZTohkl32", ",", "aZTohkl13", ",", "aZTohkl23", ",", "aZTohkl33", 
       ",", "Valattice", ",", "Vblattice", ",", "Vclattice", ",", 
       "latticeSolve", ",", "b1", ",", "b2", ",", "b3", ",", "Z1", ",", "Z2", 
       ",", "Z3", ",", "VInput1", ",", "VInput2", ",", "VInput3", ",", 
       "aZTohkl", ",", "CryOrienSolve", ",", "a", ",", "b1lab", ",", "b2lab", 
       ",", "b3lab", ",", "Valatticelab", ",", "Vblatticelab", ",", 
       "Vclatticelab", ",", "PlanehSolve", ",", "PlanekSolve", ",", 
       "PlanelSolve", ",", "VerticalhSolve", ",", "VerticalkSolve", ",", 
       "VerticallSolve", ",", "o1", ",", "o2", ",", "o3", ",", 
       "\[IndentingNewLine]", "Orientation", ",", "PointGroup", ",", 
       "\[IndentingNewLine]", "ori", ",", "alattice", ",", "blattice", ",", 
       "clattice", ",", "alphalattice", ",", "betalattice", ",", 
       "gamalattice", ",", 
       RowBox[{"DebugFlag", "=", "False"}], ",", "Verticalh", ",", 
       "Verticalk", ",", "Verticall", ",", "Planeh", ",", "Planek", ",", 
       "Planel", ",", "rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Orientation", "=", 
       RowBox[{"mat", "[", "orientation", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PointGroup", "=", 
       RowBox[{"mat", "[", "pg", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "alattice", ",", "blattice", ",", "clattice", ",", "alphalattice", 
         ",", "betalattice", ",", "gamalattice"}], "}"}], "=", 
       RowBox[{"mat", "[", "latcon", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ori", "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Planeh", ",", "Planek", ",", "Planel"}], "}"}], "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Verticalh", ",", "Verticalk", ",", "Verticall"}], "}"}], "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rCry1", ",", "rCry2", ",", "rCry3"}], "}"}], "=", 
       RowBox[{"Orientation", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Valattice", "=", 
       RowBox[{"alattice", "*", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]}], ";", " ", 
      RowBox[{"Vblattice", "=", 
       RowBox[{"blattice", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"gamalattice", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}], ",", 
          RowBox[{"Sin", "[", 
           RowBox[{"gamalattice", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0"}], "}"}]}]}], ";", 
      " ", 
      RowBox[{"Vclattice", "=", 
       RowBox[{"clattice", "*", 
        RowBox[{"{", 
         RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], "}"}]}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"latticeSolve", " ", "=", " ", 
       RowBox[{"Quiet", "[", 
        RowBox[{"NSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"clatticez", ">", "0"}], "&&", " ", 
            RowBox[{
             RowBox[{"VectorAngle", "[", 
              RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "\[Equal]", " ", 
             RowBox[{"betalattice", "*", 
              RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", 
            RowBox[{
             RowBox[{"VectorAngle", "[", 
              RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "\[Equal]", " ", 
             RowBox[{"alphalattice", "*", 
              RowBox[{"Pi", "/", "180"}]}]}], " ", "&&", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"clatticex", "^", "2"}], "+", 
              RowBox[{"clatticey", "^", "2"}], "+", 
              RowBox[{"clatticez", "^", "2"}]}], "\[Equal]", "1"}]}], "}"}], 
          " ", ",", 
          RowBox[{"{", 
           RowBox[{"clatticex", ",", "clatticey", ",", "clatticez"}], "}"}], 
          ",", "Reals"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"clatticex", "=", " ", 
       RowBox[{"clatticex", "/.", 
        RowBox[{"latticeSolve", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"clatticey", "=", " ", 
       RowBox[{"clatticey", "/.", 
        RowBox[{"latticeSolve", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"clatticez", "=", " ", 
       RowBox[{"clatticez", "/.", 
        RowBox[{"latticeSolve", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b1", " ", "=", " ", 
       RowBox[{
        RowBox[{"Cross", "[", 
         RowBox[{"Vblattice", ",", "Vclattice"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"Valattice", ".", 
          RowBox[{"Cross", "[", 
           RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b2", " ", "=", " ", 
       RowBox[{
        RowBox[{"Cross", "[", 
         RowBox[{"Vclattice", ",", "Valattice"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"Valattice", ".", 
          RowBox[{"Cross", "[", 
           RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b3", " ", "=", " ", 
       RowBox[{
        RowBox[{"Cross", "[", 
         RowBox[{"Valattice", ",", "Vblattice"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"Valattice", ".", 
          RowBox[{"Cross", "[", 
           RowBox[{"Vblattice", ",", "Vclattice"}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<clatticex = \>\"", ",", "clatticex", ",", 
          "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
          "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", "b2", ",", 
          "\"\< , b3 = \>\"", ",", "b3"}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<1\>\""}], "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(1\), \(_\)]\)\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Valattice", ",", "Vclattice"}], "]"}], "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<2\>\""}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<2/m\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", 
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", " ", 
          RowBox[{"Z1", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z2", ",", "Z3"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<mm2\>\""}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<222\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<mmm\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
          RowBox[{"Z3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<3\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<32\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<3m\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)m\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]2\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]m\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
          RowBox[{"Z2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<4\>\""}], 
         " ", "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4mm\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<422\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)2m\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/m\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<4/mmm\>\""}]}], 
        ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", 
          RowBox[{"Z2", "=", 
           RowBox[{"Normalize", "[", "Vblattice", "]"}]}], ";", " ", 
          RowBox[{"Z3", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z1", ",", "Z2"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<6\>\""}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6mm\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<622\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/m\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<6/mmm\>\""}], " ",
          "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]/mm\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]/m\>\""}]}], "  ", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
          RowBox[{"Z2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", 
          "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\""}], " ", "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<23\>\""}], " ", "||",
          " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]\[Infinity]m\>\""}], "||", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          "\"\<\[Infinity]\[Infinity]\>\""}], "||", " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<432\>\""}], "||", 
         " ", 
         RowBox[{
          RowBox[{"PointGroup", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<m3m\>\""}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Z3", "=", 
           RowBox[{"Normalize", "[", "Vclattice", "]"}]}], ";", 
          RowBox[{"Z1", "=", 
           RowBox[{"Normalize", "[", "Valattice", "]"}]}], ";", " ", 
          RowBox[{"Z2", " ", "=", " ", 
           RowBox[{"Normalize", "[", 
            RowBox[{"Cross", "[", 
             RowBox[{"Z3", ",", "Z1"}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<clatticex = \>\"", ",", "clatticex", ",", 
            "\"\< , clatticey = \>\"", ",", "clatticey", ",", 
            "\"\< , clatticez = \>\"", ",", "clatticez"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<b1 = \>\"", ",", "b1", ",", "\"\< , b2 = \>\"", ",", 
            RowBox[{"b2", "\"\< , b3 = \>\""}], ",", "b3"}], "]"}], ";"}], 
         "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ori", "==", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"VInput3", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Planeh", "*", "b1"}], "+", 
            RowBox[{"Planek", "*", "b2"}], "+", 
            RowBox[{"Planel", "*", "b3"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"VInput2", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Verticalh", "*", "Valattice"}], "+", 
            RowBox[{"Verticalk", "*", "Vblattice"}], "+", 
            RowBox[{"Verticall", "*", "Vclattice"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"VInput1", " ", "=", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Cross", "[", 
            RowBox[{"VInput2", ",", "VInput3"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"DebugFlag", ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<Z1 = \>\"", ",", "Z1", ",", "\"\< , Z2 = \>\"", ",", "Z2", 
               ",", "\"\< , Z3 = \>\"", ",", "Z3"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<VInput1 = \>\"", ",", "VInput1", ",", 
               "\"\< , VInput2 = \>\"", ",", "VInput2", ",", 
               "\"\< , VInput3 = \>\"", ",", "VInput3"}], "]"}], ";"}], 
            "}"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"aZTohkl", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13"}], "}"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23"}], "}"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], 
             "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"CryOrienSolve", " ", "=", " ", 
          RowBox[{"Quiet", "[", 
           RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"aZTohkl", ".", 
                RowBox[{"{", 
                 RowBox[{"Z1", ",", "Z2", ",", "Z3"}], "}"}]}], "\[Equal]", 
               " ", 
               RowBox[{"{", 
                RowBox[{"VInput1", ",", "VInput2", ",", "VInput3"}], "}"}]}], 
              "}"}], " ", ",", 
             RowBox[{"{", 
              RowBox[{
              "aZTohkl11", ",", "aZTohkl12", ",", "aZTohkl13", ",", 
               "aZTohkl21", ",", "aZTohkl22", ",", "aZTohkl23", ",", 
               "aZTohkl31", ",", "aZTohkl32", ",", "aZTohkl33"}], "}"}]}], 
            "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", " ", "[", 
          RowBox[{"DebugFlag", ",", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<latticeSolve = \>\"", ",", "latticeSolve"}], "]"}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<CryOrienSolve = \>\"", ",", "CryOrienSolve"}], " ",
               "]"}], ";"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"aZTohkl11", "=", " ", 
          RowBox[{"aZTohkl11", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl12", "=", " ", 
          RowBox[{"aZTohkl12", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl13", "=", " ", 
          RowBox[{"aZTohkl13", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"aZTohkl21", "=", " ", 
          RowBox[{"aZTohkl21", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "4"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl22", "=", " ", 
          RowBox[{"aZTohkl22", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl23", "=", " ", 
          RowBox[{"aZTohkl23", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "6"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"aZTohkl31", "=", " ", 
          RowBox[{"aZTohkl31", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "7"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl32", "=", " ", 
          RowBox[{"aZTohkl32", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "8"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"aZTohkl33", "=", " ", 
          RowBox[{"aZTohkl33", "/.", 
           RowBox[{"CryOrienSolve", " ", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "9"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"o1", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Chop", "[", 
            RowBox[{"aZTohkl", ".", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], "]"}]}], ";",
          " ", 
         RowBox[{"o2", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Chop", "[", 
            RowBox[{"aZTohkl", ".", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "]"}]}], ";",
          " ", 
         RowBox[{"o3", " ", "=", " ", 
          RowBox[{"Normalize", "[", 
           RowBox[{"Chop", "[", 
            RowBox[{"aZTohkl", ".", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"DebugFlag", ",", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<Cry1 = \>\"", ",", "rCry1", ",", "\"\< , Cry2 = \>\"", ",", 
             "rCry2", ",", "\"\< , Cry3 = \>\"", ",", "rCry3"}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"{", 
           RowBox[{"o1", ",", "o2", ",", "o3"}], "}"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"ori", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Planeh", ",", "Planek", ",", "Planel"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Verticalh", ",", "Verticalk", ",", "Verticall"}], 
               "}"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"o1", ",", "o2", ",", "o3"}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab1", ".", "o1"}], ",", 
              RowBox[{"Lab1", ".", "o2"}], ",", 
              RowBox[{"Lab1", ".", "o3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab2", ".", "o1"}], ",", 
              RowBox[{"Lab2", ".", "o2"}], ",", 
              RowBox[{"Lab2", ".", "o3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab3", ".", "o1"}], ",", 
              RowBox[{"Lab3", ".", "o2"}], ",", 
              RowBox[{"Lab3", ".", "o3"}]}], "}"}]}], "}"}]}], ";"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"EndofIfHKL", ",", 
          RowBox[{"UseDireciton", "=", "Miller"}]}], "*)"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"a", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab1", ".", "rCry1"}], ",", 
              RowBox[{"Lab1", ".", "rCry2"}], ",", 
              RowBox[{"Lab1", ".", "rCry3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab2", ".", "rCry1"}], ",", 
              RowBox[{"Lab2", ".", "rCry2"}], ",", 
              RowBox[{"Lab2", ".", "rCry3"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "       ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Lab3", ".", "rCry1"}], ",", 
              RowBox[{"Lab3", ".", "rCry2"}], ",", 
              RowBox[{"Lab3", ".", "rCry3"}]}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "QC", "]"}], "]"}], "]"}], "=", "a"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b1lab", "=", 
          RowBox[{"a", ".", "b1"}]}], ";", " ", 
         RowBox[{"b2lab", "=", 
          RowBox[{"a", ".", "b2"}]}], ";", " ", 
         RowBox[{"b3lab", "=", 
          RowBox[{"a", ".", "b3"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Valatticelab", "=", 
          RowBox[{"a", ".", "Valattice"}]}], ";", " ", 
         RowBox[{"Vblatticelab", "=", 
          RowBox[{"a", ".", "Vblattice"}]}], ";", " ", 
         RowBox[{"Vclatticelab", "=", 
          RowBox[{"a", ".", "Vclattice"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"b1lab", ",", "b2lab", ",", "b3lab"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{
            "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], "\[Equal]",
                " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"CryOrienSolve", " ", "=", " ", 
          RowBox[{"Quiet", "[", 
           RowBox[{"NSolve", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                 RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                 RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                 RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                 RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                "\[Equal]", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], " ", 
             ",", 
             RowBox[{"{", 
              RowBox[{
              "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve", ",", 
               "VerticalhSolve", ",", "VerticalkSolve", ",", 
               "VerticallSolve"}], "}"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "a", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{
            "Valatticelab", ",", "Vblatticelab", ",", "Vclatticelab"}], "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"MatrixForm", "@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"PlanehSolve", "*", "b1lab"}], "+", 
                 RowBox[{"PlanekSolve", "*", "b2lab"}], "+", 
                 RowBox[{"PlanelSolve", "*", "b3lab"}]}], "\[Equal]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"VerticalhSolve", "*", "Valatticelab"}], "+", 
                 RowBox[{"VerticalkSolve", "*", "Vblatticelab"}], "+", 
                 RowBox[{"VerticallSolve", "*", "Vclatticelab"}]}], 
                "\[Equal]", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}]}], " ", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", "CryOrienSolve", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"PlanehSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"PlanehSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PlanekSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"PlanekSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PlanelSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"PlanelSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"VerticalhSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"VerticalhSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "4"}], "]"}], "]"}]}], "]"}]}], ";", 
         RowBox[{"VerticalkSolve", "=", 
          RowBox[{"Chop", "[", " ", 
           RowBox[{"VerticalkSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "5"}], "]"}], "]"}]}], "]"}]}], ";", 
         RowBox[{"VerticallSolve", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{"VerticallSolve", "/.", 
            RowBox[{"CryOrienSolve", " ", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"o1", "=", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Rationalize", "[", 
             RowBox[{
              RowBox[{"Normalize", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "PlanehSolve", ",", "PlanekSolve", ",", "PlanelSolve"}], 
                 "}"}], ",", 
                RowBox[{"Composition", "[", 
                 RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"o2", "=", 
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Rationalize", "[", 
             RowBox[{
              RowBox[{"Normalize", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "VerticalhSolve", ",", "VerticalkSolve", ",", 
                  "VerticallSolve"}], "}"}], ",", 
                RowBox[{"Composition", "[", 
                 RowBox[{"Max", ",", "Abs"}], "]"}]}], "]"}], ",", "0.01"}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"GCD", "@@", "#"}], "&"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"{", 
           RowBox[{"o1", ",", "o2"}], "}"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mat", "[", 
           RowBox[{"[", 
            RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"ori", ",", 
            RowBox[{"{", 
             RowBox[{"o1", ",", "o2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"rCry1", ",", "rCry2", ",", "rCry3"}], "}"}]}], "}"}]}], 
         ";"}]}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Print", "[", 
         RowBox[{"o1", ",", "o2"}], "]"}], "*)"}], 
       RowBox[{"(*", " ", 
        RowBox[{"EndofIfHKL", ",", 
         RowBox[{"UseDireciton", "=", "CrystalPhysics"}]}], "*)"}], "]"}]}]}],
     "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.897011633135688*^9, 3.8970118461794777`*^9}, {
  3.89701187962759*^9, 3.8970118826053762`*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"10446bcd-584a-48a4-8540-2d9a165131e4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["for Fresnel and Maker fringes", "Chapter",
 CellChangeTimes->{{3.893382529142957*^9, 
  3.8933825350293636`*^9}},ExpressionUUID->"7bda4879-c1f5-4657-b1f0-\
1d230c3921d8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"Fresnel", ",", "MF", ",", "MFandFresnel", ",", "SampleRotate"}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Fresnel", "[", 
    RowBox[{"mats_", ",", "thetatemp_", ",", 
     RowBox[{"assumption_", ":", "0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "wIncLocal", ",", "wavLLocal", ",", "wavNLLocal", ",", "tmpw1Local", 
       ",", "tmpw2Local", ",", "rmpw1Local", ",", "rmpw2Local", ",", "rEtemp",
        ",", "tEtemp", ",", "m1", ",", "m2", ",", "m3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wIncLocal", "=", 
       RowBox[{"setwInc", "[", 
        RowBox[{"\[Omega]0", ",", 
         RowBox[{"N", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"thetatemp", "/", "180"}], " ", "Pi"}], ")"}]}], ",", 
         "\[CapitalDelta]\[Delta]", ",", "\[CurlyPhi]", ",", "n0"}], "]"}]}], 
      ";", 
      RowBox[{"extWave", "@", "wIncLocal"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"assumption", "==", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wavLLocal", "=", 
          RowBox[{"f4L", "[", 
           RowBox[{"mats", ",", "wIncLocal"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"assumption", "==", "1"}], "||", 
           RowBox[{"assumption", "==", "2"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"wavLLocal", "=", 
            RowBox[{"f4L", "[", 
             RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], 
           ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rmpw1Local", ",", "rmpw2Local"}], "}"}], "=", 
       RowBox[{"wavLLocal", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmpw1Local", ",", "tmpw2Local"}], "}"}], "=", 
       RowBox[{"wavLLocal", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "is", " ", "for", " ", 
         "reflected"}], ",", " ", 
        RowBox[{
         RowBox[{"[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "is", " ", "for", " ", 
         "transmitted"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"extWave", "@", "rmpw1Local"}], ";", 
      RowBox[{"extWave", "@", "rmpw2Local"}], ";", 
      RowBox[{"extWave", "@", "tmpw1Local"}], ";", 
      RowBox[{"extWave", "@", "tmpw2Local"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"rEtemp", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"rmpw1Local", "[", "A", "]"}], "+", 
          RowBox[{"rmpw2Local", "[", "A", "]"}]}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tEtemp", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"tmpw1Local", "[", "A", "]"}], "+", 
          RowBox[{"tmpw2Local", "[", "A", "]"}]}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"thetatemp", ",", 
        RowBox[{
         RowBox[{"rEtemp", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"rEtemp", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"rEtemp", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"rEtemp", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"tEtemp", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"tEtemp", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"tEtemp", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "*", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"tEtemp", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MF", "[", 
     RowBox[{"mats_", ",", "thetatemp_", ",", 
      RowBox[{"assumption_", ":", "0"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "wIncLocal", ",", "wavLLocal", ",", "wavNLLocal", ",", "tmpw1Local", 
        ",", "tmpw2Local", ",", "tEboLocal", ",", "tEruiLocal", ",", "m1", 
        ",", "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"wIncLocal", "=", 
        RowBox[{"setwInc", "[", 
         RowBox[{"\[Omega]0", ",", 
          RowBox[{"N", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"thetatemp", "/", "180"}], " ", "Pi"}], ")"}]}], ",", 
          "\[CapitalDelta]\[Delta]", ",", "\[CurlyPhi]", ",", "n0"}], "]"}]}],
        ";", 
       RowBox[{"extWave", "@", "wIncLocal"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"assumption", "==", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"flagJK", "=", "False"}], ";", 
          RowBox[{"flagHH", "=", "False"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
           RowBox[{"f4NL", "[", 
            RowBox[{"mats", ",", "wIncLocal"}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"assumption", "==", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"flagBackward", "=", "False"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"flagStandingWave", "=", "False"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"flagJK", "=", "True"}], ";", 
             RowBox[{"flagHH", "=", "False"}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
              RowBox[{"f4NL", "[", 
               RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], 
             ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"assumption", "==", "2"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"flagBackward", "=", "False"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"flagStandingWave", "=", "False"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"flagJK", "=", "False"}], ";", 
                RowBox[{"flagHH", "=", "True"}], ";", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
                 RowBox[{"f4NL", "[", 
                  RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], 
                ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"tmpw1Local", ",", "tmpw2Local"}], "}"}], "=", 
        RowBox[{"wavNLLocal", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "is", " ", "for", " ", 
          "reflected"}], ",", " ", 
         RowBox[{
          RowBox[{"[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", "is", " ", "for", " ", 
          "transmitted"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"extWave", "@", "tmpw1Local"}], ";", 
       RowBox[{"extWave", "@", "tmpw2Local"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"tEboLocal", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"tmpw2Local", "[", "A", "]"}], "+", 
           RowBox[{"tmpw1Local", "[", "A", "]"}]}], ")"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tEruiLocal", "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", 
             RowBox[{"Sin", "[", "\[Psi]", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Sin", "[", "\[Psi]", "]"}]}], ",", 
             RowBox[{"Cos", "[", "\[Psi]", "]"}]}], "}"}]}], "}"}], ".", " ", 
         "tEboLocal"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"thetatemp", ",", 
         RowBox[{
          RowBox[{"tEruiLocal", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"Conjugate", "[", 
           RowBox[{"tEruiLocal", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"tEruiLocal", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "*", 
          RowBox[{"Conjugate", "[", 
           RowBox[{"tEruiLocal", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"SampleRotate", ",", "HoldAll"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SampleRotate", "[", 
     RowBox[{
     "mats_", ",", "thetatemp_", ",", "rotatetemp_", ",", "rotatesteptemp_", 
      ",", 
      RowBox[{"assumption_", ":", "0"}], ",", "totalmats_", ",", 
      "\[CapitalDelta]\[Delta]_", ",", "\[CurlyPhi]temp_", ",", "\[Psi]_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "wIncLocal", ",", "wavLLocal", ",", "wavNLLocal", ",", "tmpw1Local", 
        ",", "tmpw2Local", ",", "tEboLocal", ",", "tEruiLocal", ",", 
        "tEruiLocal1", ",", "tEruiLocal2", ",", "m1", ",", "m2", ",", "m3", 
        ",", "matstemp", ",", "rmpw1Local", ",", "rmpw2Local", ",", 
        "rEboLocal", ",", "rEruiLocal", ",", "rEruiLocal1", ",", 
        "rEruiLocal2", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"wIncLocal", "=", 
        RowBox[{"setwInc", "[", 
         RowBox[{"\[Omega]0", ",", 
          RowBox[{"N", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"thetatemp", "/", "180"}], " ", "Pi"}], ")"}]}], ",", 
          "\[CapitalDelta]\[Delta]", ",", "\[CurlyPhi]", ",", "n0"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"extWave", "@", "wIncLocal"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"rotatetemp", "!=", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "2"}], ",", 
           RowBox[{"i", "<=", 
            RowBox[{"(", 
             RowBox[{"totalmats", "+", "1"}], ")"}]}], ",", 
           RowBox[{"i", "=", 
            RowBox[{"i", "+", "1"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"matstemp", "=", 
             RowBox[{"mats", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", " ", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"matstemp", "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "==", "1"}], ",", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"matstemp", "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "=", " ", "2"}]}], " ", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"matstemp", "[", 
                RowBox[{"[", 
                 RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "=", " ", 
             RowBox[{"Chop", "[", 
              RowBox[{"(", 
               RowBox[{"N", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}]}], ",", 
                    "0"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    "0"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ".", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"matstemp", "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], 
                   "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ")"}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"matstemp", "[", 
                RowBox[{"[", 
                 RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], " ", "=", " ", 
             RowBox[{"Chop", "[", 
              RowBox[{"(", 
               RowBox[{"N", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}]}], ",", 
                    "0"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    "0"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ".", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"matstemp", "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], 
                   "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ")"}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"matstemp", "[", 
                RowBox[{"[", 
                 RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], " ", "=", " ", 
             RowBox[{"Chop", "[", 
              RowBox[{"(", 
               RowBox[{"N", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}]}], ",", 
                    "0"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"rotatesteptemp", " ", "Degree"}], "]"}], ",", 
                    "0"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ".", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"matstemp", "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], 
                   "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ")"}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"hklConvert", "[", "matstemp", "]"}], ";", 
            RowBox[{"(*", 
             RowBox[{"update", " ", "the", " ", "orientation"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"extMater", "@", "matstemp"}], ";", 
            RowBox[{"(*", 
             RowBox[{"update", " ", "the", " ", "material"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"mats", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", "matstemp"}], ";"}]}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"If", " ", "[", 
          RowBox[{
           RowBox[{"i", "==", "2"}], ",", " ", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<angle = \>\"", ",", "rotatetemp", ",", "\"\<; \>\"", ",", 
             RowBox[{"mats", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"rotatetemp", ",", "\"\<   \>\"", ",", 
           RowBox[{"mats", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"assumption", "==", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"flagJK", "=", "False"}], ";", 
          RowBox[{"flagHH", "=", "False"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
           RowBox[{"f4NL", "[", 
            RowBox[{"mats", ",", "wIncLocal"}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"assumption", "==", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"flagBackward", "=", "False"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"flagStandingWave", "=", "False"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"flagJK", "=", "True"}], ";", 
             RowBox[{"flagHH", "=", "False"}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
              RowBox[{"f4NL", "[", 
               RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], 
             ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"assumption", "==", "2"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"flagBackward", "=", "False"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"flagStandingWave", "=", "False"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"flagJK", "=", "False"}], ";", 
                RowBox[{"flagHH", "=", "True"}], ";", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"wavLLocal", ",", "wavNLLocal"}], "}"}], "=", 
                 RowBox[{"f4NL", "[", 
                  RowBox[{"mats", ",", "wIncLocal", ",", "True"}], "]"}]}], 
                ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rmpw1Local", ",", "rmpw2Local"}], "}"}], "=", 
        RowBox[{"wavNLLocal", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"tmpw1Local", ",", "tmpw2Local"}], "}"}], "=", 
        RowBox[{"wavNLLocal", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "is", " ", "for", " ", 
          "reflected"}], ",", " ", 
         RowBox[{
          RowBox[{"[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", "is", " ", "for", " ", 
          "transmitted"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"extWave", "@", "rmpw1Local"}], ";", 
       RowBox[{"extWave", "@", "rmpw2Local"}], ";", "\[IndentingNewLine]", 
       RowBox[{"extWave", "@", "tmpw1Local"}], ";", 
       RowBox[{"extWave", "@", "tmpw2Local"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"rEboLocal", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"rmpw2Local", "[", "A", "]"}], "+", 
           RowBox[{"rmpw1Local", "[", "A", "]"}]}], ")"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"rEruiLocal", "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", 
             RowBox[{"-", 
              RowBox[{"Sin", "[", "\[Psi]", "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Sin", "[", "\[Psi]", "]"}], ",", 
             RowBox[{"Cos", "[", "\[Psi]", "]"}]}], "}"}]}], "}"}], ".", " ", 
         "rEboLocal"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"rEruiLocal1", "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", 
               RowBox[{"-", 
                RowBox[{"Sin", "[", "\[Psi]", "]"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sin", "[", "\[Psi]", "]"}], ",", 
               RowBox[{"Cos", "[", "\[Psi]", "]"}]}], "}"}]}], "}"}], ".", 
           " ", "rEboLocal"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rEruiLocal2", "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"\[Psi]", "+", "Pi"}], "]"}], ",", 
               RowBox[{"-", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Psi]", "+", "Pi"}], "]"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sin", "[", 
                RowBox[{"\[Psi]", "+", "Pi"}], "]"}], ",", 
               RowBox[{"Cos", "[", 
                RowBox[{"\[Psi]", "+", "Pi"}], "]"}]}], "}"}]}], "}"}], ".", 
           " ", "rEboLocal"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"tEboLocal", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"tmpw2Local", "[", "A", "]"}], "+", 
           RowBox[{"tmpw1Local", "[", "A", "]"}]}], ")"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tEruiLocal", "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", 
             RowBox[{"Sin", "[", "\[Psi]", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Sin", "[", "\[Psi]", "]"}]}], ",", 
             RowBox[{"Cos", "[", "\[Psi]", "]"}]}], "}"}]}], "}"}], ".", " ", 
         "tEboLocal"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"tEruiLocal1", "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", 
               RowBox[{"Sin", "[", "\[Psi]", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Sin", "[", "\[Psi]", "]"}]}], ",", 
               RowBox[{"Cos", "[", "\[Psi]", "]"}]}], "}"}]}], "}"}], ".", 
           " ", "tEboLocal"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tEruiLocal2", "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"\[Psi]", "+", "Pi"}], "]"}], ",", 
               RowBox[{"Sin", "[", 
                RowBox[{"\[Psi]", "+", "Pi"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Psi]", "+", "Pi"}], "]"}]}], ",", 
               RowBox[{"Cos", "[", 
                RowBox[{"\[Psi]", "+", "Pi"}], "]"}]}], "}"}]}], "}"}], ".", 
           " ", "tEboLocal"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"{", 
         RowBox[{"rotatetemp", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"rEruiLocal1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"rEruiLocal1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "+", 
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"rEruiLocal2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"rEruiLocal2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"rEruiLocal1", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"rEruiLocal1", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], "+", 
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"rEruiLocal2", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"rEruiLocal2", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"tEruiLocal1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"tEruiLocal1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "+", 
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"tEruiLocal2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"tEruiLocal2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"tEruiLocal1", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"tEruiLocal1", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], "+", 
           RowBox[{"Re", "[", 
            RowBox[{
             RowBox[{"tEruiLocal2", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"tEruiLocal2", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}]}], "}"}], 
        "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"rotatetemp", " ", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"rEruiLocal", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"rEruiLocal", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
               "]"}]}], "]"}], "+", 
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"rEruiLocal", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", 
                 RowBox[{"(", 
                  RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"rEruiLocal", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", 
                  RowBox[{"(", 
                   RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
               "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"rEruiLocal", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"rEruiLocal", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
               "]"}]}], "]"}], "+", 
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"rEruiLocal", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", 
                 RowBox[{"(", 
                  RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"rEruiLocal", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", 
                  RowBox[{"(", 
                   RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
               "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tEruiLocal", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tEruiLocal", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
               "]"}]}], "]"}], "+", 
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tEruiLocal", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", 
                 RowBox[{"(", 
                  RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tEruiLocal", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", 
                  RowBox[{"(", 
                   RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
               "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tEruiLocal", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tEruiLocal", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], 
               "]"}]}], "]"}], "+", 
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tEruiLocal", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "/.", 
                RowBox[{"\[CurlyPhi]", "->", 
                 RowBox[{"(", 
                  RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
              "*", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tEruiLocal", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "/.", 
                 RowBox[{"\[CurlyPhi]", "->", 
                  RowBox[{"(", 
                   RowBox[{"\[CurlyPhi]temp", "+", "Pi"}], ")"}]}]}], ")"}], 
               "]"}]}], "]"}]}]}], "}"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"{", 
         RowBox[{"rotatetemp", " ", ",", "\[IndentingNewLine]", 
          RowBox[{"Re", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"rEruiLocal", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ")"}], "*", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"(", 
              RowBox[{"rEruiLocal", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ")"}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Re", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"rEruiLocal", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ")"}], "*", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"(", 
              RowBox[{"rEruiLocal", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ")"}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Re", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"tEruiLocal", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ")"}], "*", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"(", 
              RowBox[{"tEruiLocal", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ")"}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Re", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"tEruiLocal", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ")"}], "*", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"(", 
              RowBox[{"tEruiLocal", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ")"}], "]"}]}], "]"}]}], "}"}],
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"rotatetemp", " ", ",", "\[IndentingNewLine]", 
         RowBox[{"Re", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"rEruiLocal", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], "*", 
           RowBox[{"Conjugate", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"rEruiLocal", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ")"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], "]"}]}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Re", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"rEruiLocal", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], "*", 
           RowBox[{"Conjugate", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"rEruiLocal", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ")"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], "]"}]}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Re", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tEruiLocal", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], "*", 
           RowBox[{"Conjugate", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"tEruiLocal", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ")"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], "]"}]}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Re", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tEruiLocal", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], ")"}], "*", 
           RowBox[{"Conjugate", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"tEruiLocal", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ")"}], "/.", 
             RowBox[{"\[CurlyPhi]", "->", "\[CurlyPhi]temp"}]}], "]"}]}], 
          "]"}]}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8933471619492044`*^9, 3.8933471857246885`*^9}, {
   3.893358307691169*^9, 3.893358317636998*^9}, 3.893378202753617*^9, {
   3.893378668612151*^9, 3.8933786804940205`*^9}, {3.895371202000575*^9, 
   3.895371396552465*^9}, {3.8953714587032814`*^9, 3.895371468619602*^9}, {
   3.8958607445034423`*^9, 3.8958607462263527`*^9}, {3.895861311559941*^9, 
   3.8958613123844333`*^9}, {3.89586791930539*^9, 3.895867965399525*^9}, {
   3.895868006059975*^9, 3.895868039898413*^9}, {3.8960651005540705`*^9, 
   3.896065106044956*^9}, {3.8960656242234597`*^9, 3.896065659494779*^9}, {
   3.8960657087843876`*^9, 3.8960657112141485`*^9}, {3.896068944386587*^9, 
   3.896068952543131*^9}, {3.896098115659069*^9, 3.8960981295502305`*^9}, {
   3.896660074698949*^9, 3.8966601292474775`*^9}, {3.8967508047036996`*^9, 
   3.8967508574092455`*^9}, {3.896750888680524*^9, 3.896750926793042*^9}, 
   3.896751861922112*^9, {3.897173980044154*^9, 3.8971740510181*^9}, {
   3.9159287778305798`*^9, 3.915928802314067*^9}, 3.915929082145852*^9, {
   3.9159291228664494`*^9, 3.9159291320435476`*^9}, {3.915929200721386*^9, 
   3.915929207842579*^9}, {3.915929287769853*^9, 3.915929393692802*^9}, {
   3.915929467788686*^9, 3.915929528303983*^9}, {3.9159295615885496`*^9, 
   3.9159297568054695`*^9}, {3.9159297995570707`*^9, 3.915929937171959*^9}, {
   3.9159299895157022`*^9, 3.9159300692563353`*^9}, {3.9159301886593027`*^9, 
   3.9159302227627087`*^9}, {3.915931962614545*^9, 3.9159319714581847`*^9}, {
   3.9159320471786623`*^9, 3.9159320496116176`*^9}, {3.915932408474871*^9, 
   3.9159324119490027`*^9}, {3.915934104144888*^9, 3.915934106834806*^9}, {
   3.9159342152006736`*^9, 3.915934222070325*^9}, {3.915935172278681*^9, 
   3.9159351745104866`*^9}, {3.9159352205380287`*^9, 3.915935226298435*^9}, {
   3.915935621513867*^9, 3.915935659791416*^9}, {3.915935695664338*^9, 
   3.9159357063214984`*^9}, {3.9159359974271135`*^9, 3.915936050588442*^9}, {
   3.9159360953573694`*^9, 3.915936110188181*^9}, {3.915936799066156*^9, 
   3.915936836606245*^9}, {3.915937444206193*^9, 3.9159374475488033`*^9}, {
   3.915937997069048*^9, 3.9159380213078003`*^9}, {3.9159392727230716`*^9, 
   3.9159393008152866`*^9}, {3.9170415089102383`*^9, 
   3.9170415162586336`*^9}, {3.91704155475397*^9, 3.9170415548747187`*^9}, {
   3.917041755282954*^9, 3.9170417592127733`*^9}, {3.9170417948811255`*^9, 
   3.917041860170946*^9}, {3.9170420013582325`*^9, 3.9170420069649696`*^9}, {
   3.917042161407235*^9, 3.917042338941671*^9}, {3.9170427777889156`*^9, 
   3.917042781966761*^9}, {3.917042815354342*^9, 3.9170428923574934`*^9}, {
   3.917042943111644*^9, 3.917043109012706*^9}, {3.9170437341488714`*^9, 
   3.9170437833686595`*^9}, {3.917044214241977*^9, 3.9170442168427925`*^9}, {
   3.917044394947277*^9, 3.91704439822231*^9}, {3.917045695311986*^9, 
   3.917045707468069*^9}, {3.9170460651353855`*^9, 3.9170460812639675`*^9}, {
   3.917049019089794*^9, 3.917049032392767*^9}, {3.917049159252241*^9, 
   3.917049160990608*^9}, 3.9170493115597177`*^9, {3.9170504292529597`*^9, 
   3.917050464544403*^9}, {3.9172197936218166`*^9, 3.9172198558464622`*^9}, {
   3.9172198996475677`*^9, 3.9172199398041444`*^9}, {3.917220283869191*^9, 
   3.9172203540761046`*^9}, {3.9172212362553244`*^9, 3.917221274457179*^9}, {
   3.9172214520074797`*^9, 3.9172214955419483`*^9}, {3.917221742040794*^9, 
   3.917221789798908*^9}, 3.9173844175617285`*^9, 3.9173845847988014`*^9, 
   3.9173846178034363`*^9},
 CellLabel->
  "In[116]:=",ExpressionUUID->"2230f45f-45b4-4d76-8d79-23f7995e3866"]
}, Open  ]],

Cell[CellGroupData[{

Cell["for plotting ", "Chapter",
 CellChangeTimes->{{3.8933787971006303`*^9, 3.893378798881888*^9}, 
   3.8971741381874633`*^9},ExpressionUUID->"feeeed14-16c8-4403-a121-\
6d703a0e1425"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"options", " ", "for", " ", "wave", " ", "vector", " ", "plots"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"options2d", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ViewProjection", "\[Rule]", "\"\<Orthographic\>\""}], ",", 
       RowBox[{"ViewPoint", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity", ",", "0"}], "}"}]}], ",", 
       RowBox[{"ViewVertical", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "0", ",", " ", 
          RowBox[{"-", "1"}]}], "}"}]}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", "Automatic"}], 
         "}"}]}], ",", 
       RowBox[{"ImageSize", "->", "300"}], ",", 
       RowBox[{"BoxRatios", "->", 
        RowBox[{"{", 
         RowBox[{"1", ",", ".1", ",", "1"}], "}"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"for", " ", "polarplot"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"options2", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"PolarAxesOrigin", "\[Rule]", "Automatic"}], 
        RowBox[{"(*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Pi", "/", "2"}], ",", "1.0"}], " ", "}"}], "*)"}], ",", 
        RowBox[{"PolarGridLines", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"PolarAxes", "\[Rule]", "True"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"PlotLegends", "\[Rule]", 
           RowBox[{"\"\<Iy x\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"Round", "@", 
              RowBox[{"(", 
               RowBox[{"1", "/", "Imax"}], ")"}]}], "]"}]}]}], ","}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"PolarTicks", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{"i", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "0", ",", 
                 RowBox[{"2", " ", "Pi"}], ",", 
                 RowBox[{"Pi", "/", "6"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"-", "1"}]}], "]"}], ",", "None"}], "}"}]}], ",", 
        RowBox[{"TicksStyle", "->", "White"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{
                  RowBox[{"Pi", "/", "6"}], " ", "i"}], "]"}], ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"i", "\[NotEqual]", "3"}], ",", 
                  RowBox[{
                   RowBox[{"ToString", "[", 
                    RowBox[{"30", " ", "i"}], "]"}], "<>", 
                   "\"\<\[Degree]\>\""}], ",", 
                  RowBox[{"Style", "[", 
                   RowBox[{
                   "\"\<90\[Degree](\!\(\*SubscriptBox[\(y\), \
\(lab\)]\))\>\"", ",", "14"}], "]"}]}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", 
            "None"}], "}"}], ","}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Frame", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"True", ",", "False"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"True", ",", "True"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"FrameTicksStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Directive", "[", 
              RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}], ",", 
             "None"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"None", ",", "None"}], "}"}]}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"FrameStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Thick", ",", "Thick"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Directive", "[", "White", "]"}], ",", 
             RowBox[{"Directive", "[", "White", "]"}]}], "}"}]}], "}"}]}], 
        ",", 
        RowBox[{"ImageSize", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"350", ",", "350"}], "}"}]}]}], "}"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"options2", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"PolarAxesOrigin", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Pi", "/", "2"}], ",", "1.0"}], " ", "}"}]}], ",", 
       RowBox[{"PolarGridLines", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"PolarAxes", "\[Rule]", "True"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", "1.1"}], ",", "\[IndentingNewLine]", 
       RowBox[{"PolarTicks", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"N", "[", 
               RowBox[{
                RowBox[{"Pi", "/", "4"}], "+", 
                RowBox[{
                 RowBox[{"Pi", "/", "2"}], " ", "i"}]}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"i", "\[NotEqual]", "4"}], ",", 
                  RowBox[{
                   RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"90", "*", "i"}], "+", "45"}], "]"}], "<>", 
                   "\"\<\[Degree]\>\""}], ",", "\"\<\>\""}], "]"}], ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
                ",", "16"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "3"}], "}"}]}], "]"}], ",", "None"}],
          "}"}]}], ",", 
       RowBox[{"Frame", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"True", ",", "False"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"True", ",", "True"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"FrameTicksStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "20"}], "]"}], ",", "None"}],
            "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"None", ",", "None"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"FrameStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Thick", ",", "Thick"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", "White", "]"}], ",", 
            RowBox[{"Directive", "[", "White", "]"}]}], "}"}]}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"350", ",", "350"}], "}"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"samplecolors", "=", 
     RowBox[{"{", 
      RowBox[{
      "Black", ",", "LightBlue", ",", "LightRed", ",", "LightYellow", ",", 
       "LightGreen", ",", "LightOrange", ",", "LightPurple", ",", "LightBlue",
        ",", "LightRed", ",", "LightYellow", ",", "LightGreen", ",", 
       "LightOrange", ",", "LightPurple", ",", "LightBlue", ",", "LightRed", 
       ",", "LightYellow"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"schematicfun", "[", "pos_", "]"}], ":=", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"samplecolors", "[", 
         RowBox[{"[", 
          RowBox[{"pos", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"EdgeForm", "[", 
         RowBox[{"Directive", "[", "Black", "]"}], "]"}], ",", 
        RowBox[{"Rectangle", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "-", "1"}]}], "}"}]}], "]"}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"Text", "[", 
         RowBox[{
          RowBox[{"Style", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "name", "]"}], "]"}], "]"}], 
                "\[NotEqual]", "\"\<Enter Name Here\>\""}], "\[And]", 
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "name", "]"}], "]"}], "]"}], 
                "\[NotEqual]", "\"\<\>\""}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"allmaterials", "[", 
                 RowBox[{"[", 
                  RowBox[{"pos", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"Key", "[", "name", "]"}], "]"}], "]"}], "<>", 
               "\"\<  \>\"", "<>", "\"\<(\>\"", "<>", 
               RowBox[{"StringDelete", "[", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"allmaterials", "[", 
                    RowBox[{"[", 
                    RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"\"\<{\>\"", ",", "\"\<}\>\""}], "}"}]}], "]"}], 
               "<>", "\"\<)\>\"", "<>", "\"\<,  \>\"", "<>", 
               RowBox[{
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "pg", "]"}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"\"\<Layer \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "]"}], ",", "15", 
            ",", "Black", ",", "Bold"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"4.5", ",", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Text", "[", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", "1"}], "]"}], ",", "15", 
            ",", "Black", ",", "Bold"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"pos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "==", "1"}], "\[Or]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "==", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"\"\<thickness = \>\"", "<>", "\"\<\[Infinity]\>\""}], 
              ",", "15", ",", "Black", ",", "Bold"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"8", ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"\"\<thickness = \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{
                 RowBox[{"allmaterials", "[", 
                  RowBox[{"[", 
                   RowBox[{"pos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Key", "[", "h", "]"}], "]"}], "]"}], "]"}], "<>", 
               "\"\< \[Mu]m\>\""}], ",", "15", ",", "Black", ",", "Bold"}], 
             "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"8", ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "-", "0.5"}]}], "}"}]}], 
           "]"}]}], "]"}]}], "\[IndentingNewLine]", "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"options3", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Orange", ",", 
          RowBox[{"Darker", "[", "Green", "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"Axes", "->", "False"}], ",", 
       RowBox[{"FrameLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<\!\(\*SubscriptBox[\(E\), \(s\)]\)\>\"", " ", ",", "22", 
              ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Black"}], "]"}], ",", "None"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<\!\(\*SubscriptBox[\(E\), \(p\)]\)\>\"", " ", ",", "22", 
              ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Black"}], "]"}], ",", "None"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"FrameStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Thick", ",", "Thick"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Thick", ",", "Thick"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"FrameTicksStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}], ",", 
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}], ",", 
            RowBox[{"Directive", "[", 
             RowBox[{"Thick", ",", "Black", ",", "14"}], "]"}]}], "}"}]}], 
         "}"}]}], ",", 
       RowBox[{"FrameTicks", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Automatic", ",", "Automatic"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Automatic", ",", "Automatic"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Ellipticity\>\"", ",", "Black", ",", 
          RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
          "22"}], "]"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"300", ",", "300"}], "}"}]}], ",", 
       RowBox[{"AxesStyle", "\[Rule]", 
        RowBox[{"Directive", "[", "LightGray", "]"}]}], ",", 
       RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"Method", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<AxesInFront\>\"", "->", "False"}], "}"}]}], ",", 
       RowBox[{"PlotLegends", "->", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"SwatchLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Black", ",", "Orange", ",", 
              RowBox[{"Darker", "[", "Green", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<Incident \!\(\*SuperscriptBox[\(E\), \(i, \
\[Omega]\)]\)\>\"", ",", 
              "\"\<Reflected \!\(\*SuperscriptBox[\(E\), \(R, 2  \
\[Omega]\)]\)\>\"", ",", 
              "\"\<Transmitted \!\(\*SuperscriptBox[\(E\), \(T, 2  \
\[Omega]\)]\)\>\""}], "}"}]}], 
           RowBox[{"(*", 
            RowBox[{",", 
             RowBox[{"LegendFunction", "->", "\"\<Panel\>\""}]}], "*)"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.7", ",", "0.85"}], "}"}]}], "]"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"placeHolderFigs", "=", 
     RowBox[{"Framed", "[", 
      RowBox[{"Style", "[", 
       RowBox[{
       "\"\<Press 'Update' to Generate Figure\>\"", ",", "Bold", ",", "18", 
        ",", 
        RowBox[{"FontFamily", "->", "\"\<Times New Roman\>\""}]}], "]"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"placeHolderEqus", "=", 
     RowBox[{"Framed", "[", 
      RowBox[{"Style", "[", 
       RowBox[{
       "\"\<Press 'Update' to Generate Expression\>\"", ",", "Bold", ",", 
        "18", ",", 
        RowBox[{"FontFamily", "->", "\"\<Times New Roman\>\""}]}], "]"}], 
      "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8933486120835743`*^9, 3.8933486183008385`*^9}, {
   3.8933502591111736`*^9, 3.893350265924114*^9}, {3.893354645846586*^9, 
   3.893354664557826*^9}, {3.89335578664895*^9, 3.8933558057270465`*^9}, {
   3.893400611360826*^9, 3.89340065309416*^9}, {3.8934006982178073`*^9, 
   3.893400706624937*^9}, {3.893400737025715*^9, 3.8934007402164345`*^9}, {
   3.894407816016934*^9, 3.8944078629148526`*^9}, {3.8944079007332253`*^9, 
   3.894407947392223*^9}, {3.8944081285469713`*^9, 3.8944081926374116`*^9}, {
   3.894408385623866*^9, 3.8944084024149065`*^9}, 3.894589376903339*^9, {
   3.894589484180315*^9, 3.8945895039885483`*^9}, 3.894589545157735*^9, {
   3.8945896133858695`*^9, 3.8945896360452185`*^9}, {3.8945897077627068`*^9, 
   3.894589710422588*^9}, {3.8945898266462283`*^9, 3.8945898604802012`*^9}, {
   3.894592640197791*^9, 3.8945926438127384`*^9}, {3.8945937719847016`*^9, 
   3.894593805543951*^9}, {3.895414005022328*^9, 3.895414067154997*^9}, {
   3.895414170536589*^9, 3.8954142106264524`*^9}, {3.895414264465515*^9, 
   3.8954142656886845`*^9}, {3.895414497926609*^9, 3.895414517843151*^9}, {
   3.895414557487856*^9, 3.8954145713423786`*^9}, {3.895414607967214*^9, 
   3.8954146594744177`*^9}, 3.895414724304675*^9, {3.895414835853051*^9, 
   3.8954148435508623`*^9}, {3.89541489782485*^9, 3.8954149626481934`*^9}, {
   3.89541522391429*^9, 3.895415225234209*^9}, {3.895416734850176*^9, 
   3.895416736104639*^9}, {3.895419613538356*^9, 3.895419646964218*^9}, {
   3.8957583024916935`*^9, 3.895758358800396*^9}, {3.895759702560421*^9, 
   3.8957597170784593`*^9}, 3.895759844080161*^9, {3.895759884922897*^9, 
   3.895759886102124*^9}, {3.895839755525236*^9, 3.895839787117711*^9}, 
   3.895922968991507*^9, {3.8959232158171988`*^9, 3.8959232174450145`*^9}, 
   3.896038427232528*^9, {3.896209147442976*^9, 3.8962091691599092`*^9}, {
   3.8962092070844216`*^9, 3.8962092215692835`*^9}, {3.896209310246527*^9, 
   3.896209311243024*^9}, {3.8962099765966654`*^9, 3.8962099781529245`*^9}, {
   3.8962276985598135`*^9, 3.896227722456881*^9}, {3.8962279094984508`*^9, 
   3.896227909558445*^9}, {3.8962280471417704`*^9, 3.8962280686627984`*^9}, 
   3.896230721829651*^9},
 CellLabel->
  "In[121]:=",ExpressionUUID->"8826940e-c654-46fe-990e-f7d58f72b8c5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fzvecplots2d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fzvecplots2d", "[", "mat_", "]"}], ":=", 
  RowBox[{"Show", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Orange", ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Cyan", ",", 
       RowBox[{"Opacity", "[", "0.1", "]"}], ",", 
       RowBox[{"EdgeForm", "[", "]"}], ",", 
       RowBox[{"HalfPlane", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
          RowBox[{"[", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "]"}]}], "}"}], 
     "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Black", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "Dashed", ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"-", "1"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], "]"}]}], 
      "}"}], "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Black", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", 
            RowBox[{"Lab1", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", 
              RowBox[{"Lab2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
          "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", 
            RowBox[{"Lab3", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}]}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.7", "*", 
           RowBox[{"Lab1", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"(*", 
        RowBox[{"Text", "[", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{"Row", "[", 
             RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}],
              "]"}], ",", "26", ",", 
            RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",",
             "Bold"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0.6", "*", 
            RowBox[{"Lab2", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}], "*)"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", 
           RowBox[{"Lab3", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"\"\<\[TensorProduct]\>\"", ",", "25", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", 
           RowBox[{"Lab2", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "0.1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{"{", 
      RowBox[{"Blue", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{"0.5", "*", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{"0.5", "*", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{"0.5", "*", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", "Blue", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{"0.7", "*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(Z\), \(2\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{"0.6", "*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1.5"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(Z\), \(3\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", "Blue", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{"0.6", "*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
    RowBox[{"ImageSize", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"300", ",", "300"}], "}"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.893351012815014*^9, 3.893351033551047*^9}, {
   3.8933510684306636`*^9, 3.893351112653323*^9}, {3.893351196443209*^9, 
   3.8933512003050814`*^9}, 3.893352788454318*^9, {3.8956808687320704`*^9, 
   3.8956808780216312`*^9}, {3.895680963368698*^9, 3.8956809898087354`*^9}, {
   3.895681036820758*^9, 3.8956810387193103`*^9}, {3.895681117359395*^9, 
   3.895681119129198*^9}, {3.8956811530880117`*^9, 3.8956811548479576`*^9}, {
   3.8956812319908123`*^9, 3.895681246980226*^9}, {3.8956813593650093`*^9, 
   3.895681383743298*^9}, {3.895681537911544*^9, 3.8956815408680396`*^9}},
 CellLabel->
  "In[128]:=",ExpressionUUID->"430fb27d-99f8-41d5-8a4a-835e12847cce"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fzvecplots3d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fzvecplots3d", "[", "mat_", "]"}], ":=", 
  RowBox[{"Show", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Orange", ",", 
       RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
       RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
       RowBox[{"HalfSpace", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", 
           RowBox[{"-", "0.01"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Blue", ",", 
       RowBox[{"Arrowheads", "[", "0.07", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "Dashed", ",", 
       RowBox[{"EdgeForm", "[", " ", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<\!\(\*SubscriptBox[StyleBox[\\\"Z\\\",FontSlant->\\\"Italic\\\"\
], \\\"1\\\"]\)\>\"", ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold", ",", "Blue"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.7", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "+", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<\!\(\*SubscriptBox[StyleBox[\\\"Z\\\",FontSlant->\\\"Italic\\\"\
], \\\"2\\\"]\)\>\"", ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold", ",", "Blue"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.8", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "+", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<\!\(\*SubscriptBox[StyleBox[\\\"Z\\\",FontSlant->\\\"Italic\\\"\
], \\\"3\\\"]\)\>\"", ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold", ",", "Blue"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.8", "*", 
           RowBox[{
            RowBox[{
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{"Key", "[", "orientation", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "+", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Black", ",", 
       RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", "Lab1"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", "Lab2"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
          RowBox[{
           RowBox[{"0.5", "*", "Lab3"}], "+", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.9"}], ",", 
             RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.7", "*", "Lab1"}], "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.9"}], ",", 
            RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], 
            "]"}], ",", "26", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", "Lab2"}], "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.9"}], ",", 
            RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
            "]"}], ",", "30", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
           "Bold"}], "]"}], ",", 
         RowBox[{
          RowBox[{"0.6", "*", "Lab3"}], "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.9"}], ",", 
            RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{"{", 
      RowBox[{"Cyan", ",", 
       RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
       RowBox[{"EdgeForm", "[", "]"}], ",", 
       RowBox[{"HalfPlane", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.5"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
    RowBox[{"ViewPoint", "->", 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
    RowBox[{"ImageSize", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"300", ",", "300"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.893351012815014*^9, 3.893351033551047*^9}, {
   3.8933510684306636`*^9, 3.893351112653323*^9}, {3.893351196443209*^9, 
   3.8933512003050814`*^9}, 3.893352788454318*^9},
 CellLabel->
  "In[130]:=",ExpressionUUID->"e2b0f133-3c5e-4178-b645-c608c913bf9b"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "fplot2geometry2d", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fplot2geometry2d", "[", "theta_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"rtheta", "=", "0.5"}], ",", "CylinTopBase1", ",", "t1", ",", 
      "\[Eta]"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CylinTopBase1", " ", "=", 
      RowBox[{"0.8", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t1", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Orange", ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Cyan", ",", 
          RowBox[{"Opacity", "[", "0.1", "]"}], ",", 
          RowBox[{"EdgeForm", "[", "]"}], ",", 
          RowBox[{"HalfPlane", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "]"}]}], "}"}],
         "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "Dashed", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{"-", "1"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], 
           "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"0.5", "*", 
               RowBox[{"Lab1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Arrow", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "0.9"}], ",", 
                   RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"0.5", "*", 
                 RowBox[{"Lab2", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "0.9"}], ",", 
                   RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
             "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"0.5", "*", 
               RowBox[{"Lab3", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}], ",", 
                 RowBox[{"-", "0.9"}]}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
               "]"}], ",", "30", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"0.7", "*", 
              RowBox[{"Lab1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"Row", "[", 
                 RowBox[{
                 "{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], 
                 "]"}], ",", "26", ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
                ",", "Bold"}], "]"}], ",", 
              RowBox[{
               RowBox[{"0.6", "*", 
                RowBox[{"Lab2", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "0.9"}], ",", 
                  RowBox[{"-", "0.9"}], ",", "0"}], "}"}], "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"-", "1"}]}], "}"}]}], "]"}], ","}], "*)"}], 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
               "]"}], ",", "30", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"0.6", "*", 
              RowBox[{"Lab3", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<\[TensorProduct]\>\"", ",", "25", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"0.6", "*", 
              RowBox[{"Lab2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}], ",", 
                RowBox[{"-", "0.9"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "0.1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"theta", "*", 
                   RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}], "]"}], 
          ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<\!\(\*SuperscriptBox[\(k\), \(\[Omega]\)]\)\>\"", ",", "30",
               ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Sin", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
               RowBox[{"Cos", "[", 
                RowBox[{"theta", "*", 
                 RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Dashed", ","}], "*)"}], 
          RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"BSplineCurve", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"rtheta", "*", 
               RowBox[{"Lab3", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], " ", ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rtheta", "*", 
                RowBox[{"t1", "[", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
               RowBox[{"\[Eta]", "->", " ", 
                RowBox[{"theta", "*", 
                 RowBox[{"8", "/", "8"}], " ", "Degree"}]}]}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SuperscriptBox[\(\[Theta]\), \(i\)]\)\>\"", 
                "}"}], "]"}], ",", "20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{"rtheta", "*", 
             RowBox[{
              RowBox[{"RotationTransform", "[", 
               RowBox[{"2", "*", 
                RowBox[{"theta", "/", "4"}], " ", "Degree"}], "]"}], "[", 
              RowBox[{"Lab3", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Arrowheads", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "0.04"}], ",", "0.04"}], "}"}], "]"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Dashed", ","}], "*)"}], 
          RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
          RowBox[{"Arrow", "[", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"CylinTopBase1", " ", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "-", 
              RowBox[{"0.3", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"CylinTopBase1", " ", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{"0.3", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}]}], 
            "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(E\), \(p\)]\)\>\"", "}"}], 
               "]"}], ",", "20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"CylinTopBase1", " ", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "-", 
             RowBox[{"0.3", 
              RowBox[{
               RowBox[{"Cross", "[", 
                RowBox[{"CylinTopBase1", ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<\[TensorProduct]\>\"", ",", "25", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{"CylinTopBase1", " ", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(E\), \(s\)]\)\>\"", "}"}], 
               "]"}], ",", "20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{"CylinTopBase1", " ", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "0.3"}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"300", ",", "300"}], "}"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8933512831319823`*^9, 3.8933513830490522`*^9}, {
   3.8933514543917203`*^9, 3.893351458497405*^9}, {3.8933515301246185`*^9, 
   3.893351572957464*^9}, 3.8933527927492*^9, {3.8933538380625877`*^9, 
   3.8933538481539526`*^9}, {3.8933541616011205`*^9, 
   3.8933541641404996`*^9}, {3.8958616941490545`*^9, 3.8958616943053045`*^9}},
 CellLabel->
  "In[132]:=",ExpressionUUID->"979d47e3-561f-4f83-b76c-7bb5f3fb996d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fplot2geometry3d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fplot2geometry3d", "[", "theta_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Show", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Orange", ",", 
         RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
         RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
         RowBox[{"HalfSpace", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"-", "0.01"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Black", ",", 
         RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
         RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", "Lab1"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", "Lab2"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{
             RowBox[{"0.5", "*", "Lab3"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "0.9"}], ",", 
               RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Row", "[", 
              RowBox[{
              "{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], "]"}],
              ",", "30", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
             ",", "Bold"}], "]"}], ",", 
           RowBox[{
            RowBox[{"0.7", "*", "Lab1"}], "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Row", "[", 
              RowBox[{
              "{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], "]"}],
              ",", "26", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
             ",", "Bold"}], "]"}], ",", 
           RowBox[{
            RowBox[{"0.6", "*", "Lab2"}], "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Row", "[", 
              RowBox[{
              "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], "]"}],
              ",", "30", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
             ",", "Bold"}], "]"}], ",", 
           RowBox[{
            RowBox[{"0.6", "*", "Lab3"}], "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "0.9"}], ",", 
              RowBox[{"-", "0.9"}], ",", "0"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Red", ",", 
         RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
         RowBox[{"Arrow", "[", 
          RowBox[{"Tube", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"theta", "*", 
                   RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
            "0.03"}], "]"}], "]"}], ",", 
         RowBox[{"Text", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<\!\(\*SuperscriptBox[\(k\), \(\[Omega]\)]\)\>\"", ",", "30", 
             ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Sin", "[", 
               RowBox[{"theta", "*", 
                RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
             RowBox[{"Cos", "[", 
              RowBox[{"theta", "*", 
               RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{"Cyan", ",", 
         RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
         RowBox[{"EdgeForm", "[", "]"}], ",", 
         RowBox[{"HalfPlane", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}],
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "0.5"}], ",", "1.1"}], "}"}]}], "}"}]}], ",", 
      RowBox[{"ViewPoint", "->", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"-", "2"}], ",", "1.5"}], "}"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"300", ",", "300"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8933512831319823`*^9, 3.8933513830490522`*^9}, {
  3.8933514543917203`*^9, 3.893351458497405*^9}, {3.8933515301246185`*^9, 
  3.893351572957464*^9}, {3.8933527927492*^9, 3.8933527980390654`*^9}},
 CellLabel->
  "In[134]:=",ExpressionUUID->"f5aa71d2-e846-4c4f-aa94-bff7bcb05b8d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fpolarizationplot3d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fpolarizationplot3d", "[", 
   RowBox[{
   "theta_", ",", "phi_", ",", "psi_", ",", "RotatePolarizer_", ",", 
    "RotateAnalyzer_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "CylinTopBase1", ",", "CylinTopBase2", ",", "CylinBotBase1", ",", 
      "CylinBotBase2", ",", "rCylin", ",", "t1", ",", "t2", ",", "\[Eta]"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CylinTopBase1", " ", "=", " ", 
      RowBox[{"1.8", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CylinBotBase1", " ", "=", 
      RowBox[{"1.7", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CylinTopBase2", " ", "=", " ", 
      RowBox[{"1.8", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CylinBotBase2", " ", "=", 
      RowBox[{"1.7", "*", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "*", 
           RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rCylin", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"t1", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", 
            RowBox[{"theta", "*", 
             RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t2", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
          RowBox[{"Cos", "[", 
           RowBox[{"theta", "*", 
            RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", "Lab1"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", "Lab2"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", "Lab3"}], "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(1\)]\)\>\"", "}"}], 
               "]"}], ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1.3", "*", "Lab1"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.3"}], ",", 
               RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}]}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(2\)]\)\>\"", "}"}], 
               "]"}], ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1.1", "*", "Lab2"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.5"}], ",", 
               RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Row", "[", 
               RowBox[{
               "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
               "]"}], ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1.1", "*", "Lab3"}], "+", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.3"}], ",", 
               RowBox[{"-", "1.3"}], ",", "0"}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Orange", ",", 
          RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
          RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
          RowBox[{"HalfSpace", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"-", "0.01"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"Cylinder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"CylinTopBase1", ",", "CylinBotBase1"}], "}"}], ",", 
          "rCylin"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"Cylinder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"CylinTopBase2", ",", "CylinBotBase2"}], "}"}], ",", 
          "rCylin"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinTopBase1", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinTopBase1", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinBotBase1", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinBotBase1", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinTopBase2", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinTopBase2", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Dashed", ",", 
          RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CylinBotBase2", " ", "+", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
             ",", 
             RowBox[{"CylinBotBase2", " ", "-", 
              RowBox[{"Cross", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
             "}"}], "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotatePolarizer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase1", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase1", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t1", "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \[Omega]\)]\)\>\
\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                  "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"CylinTopBase1", " ", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t1", "[", 
                    RowBox[{"CylinTopBase1", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"15", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t1", "[", 
                    RowBox[{"CylinTopBase1", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"30", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t1", "[", 
                    RowBox[{"CylinTopBase1", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"40", " ", "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                  "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                   RowBox[{"0.75", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"20", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{"{", 
            RowBox[{"Black", ",", 
             RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
             RowBox[{"GeometricTransformation", "[", 
              RowBox[{
               RowBox[{"Arrow", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                   RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                  ",", 
                  RowBox[{"CylinTopBase1", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                  "}"}], "]"}], ",", 
               RowBox[{"t1", "/.", 
                RowBox[{"\[Eta]", "->", 
                 RowBox[{"phi", " ", "Degree"}]}]}]}], "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{"Row", "[", 
                  RowBox[{
                  "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \
\[Omega]\)]\)\>\"", "}"}], "]"}], ",", "20", ",", 
                 RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}],
                  ",", "Bold"}], "]"}], ",", 
               RowBox[{
                RowBox[{"t1", "[", 
                 RowBox[{"CylinTopBase1", "+", 
                  RowBox[{"0.05", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                  RowBox[{"Cross", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                 "]"}], "/.", 
                RowBox[{"\[Eta]", "->", " ", 
                 RowBox[{"phi", " ", "Degree"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], 
          "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotateAnalyzer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[DoubleVerticalBar]\)\(\\\ \)\(Analyzer\)\(\\\ \)\), \(2  \[Omega]\)]\)\>\"",
                     "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}], ",",
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"CylinTopBase2", " ", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t2", "[", 
                    RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"15", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t2", "[", 
                    RowBox[{"CylinTopBase2", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"30", " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t2", "[", 
                    RowBox[{"CylinTopBase2", " ", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"0.6", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                     "]"}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"40", " ", "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                  "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "  ", "+", 
                   RowBox[{"1.1", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"10", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.08", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"135", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[Perpendicular]\)\(\\\ \)\(Analyzer\)\), \(2  \[Omega]\)]\)\>\"", "}"}], 
                   "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"135", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{"psi", " ", "Degree"}]}]}]}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[DoubleVerticalBar]\)\(\\\ \)\(Analyzer\)\(\\\ \)\), \(2  \[Omega]\)]\)\>\"",
                     "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{"psi", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"GeometricTransformation", "[", 
               RowBox[{
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "-", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}], 
                   ",", 
                   RowBox[{"CylinTopBase2", "+", 
                    RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "}"}], "]"}], ",", 
                RowBox[{"t2", "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], " ", "Degree"}]}]}]}], 
               "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SubsuperscriptBox[\(E\), \(\(\
\[Perpendicular]\)\(\\\ \)\(Analyzer\)\), \(2  \[Omega]\)]\)\>\"", "}"}], 
                   "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t2", "[", 
                  RowBox[{"CylinTopBase2", "+", 
                   RowBox[{"0.05", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], " ", "+", 
                   RowBox[{"1.3", 
                    RowBox[{"Cross", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "rCylin", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], "]"}]}]}],
                   "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], " ", "Degree"}]}]}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"2.7", "*", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"Sin", "[", 
                    RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
             "0.05"}], "]"}], "]"}]}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Te", "|", 
            RowBox[{"xt", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
               "\"\<(\!\(\*SuperscriptBox[\(k\), \
\(\[Omega]\)]\)\!\(\*SubscriptBox[\()\), \(in\)]\)\>\"", ",", "30", ",", 
                RowBox[{
                "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"theta", "*", 
                   RowBox[{"Pi", "/", "180"}]}], "]"}]}], ",", "0", ",", 
                RowBox[{"Cos", "[", 
                 RowBox[{"theta", "*", 
                  RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{"-", "1"}]}], "}"}]}], "]"}]}]}], "*)"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"Arrowheads", "[", "0.1", "]"}], ",", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"2.7", "*", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sin", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"theta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}]}]}], "}"}], 
             ",", "0.05"}], "]"}], "]"}]}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<(\!\(\*SuperscriptBox[\(k\), \
\(\[Omega]\)]\)\!\(\*SubscriptBox[\()\), \(in\)]\)\>\"", ",", "30", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}]}],
               "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sin", "[", 
                RowBox[{"theta", "*", 
                 RowBox[{"Pi", "/", "180"}]}], "]"}], ",", "0", ",", 
               RowBox[{"Cos", "[", 
                RowBox[{"theta", "*", 
                 RowBox[{"Pi", "/", "180"}]}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "*)"}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Graphics3D", "[", 
          RowBox[{"{", 
           RowBox[{"Cyan", ",", 
            RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
            RowBox[{"EdgeForm", "[", "]"}], ",", 
            RowBox[{"HalfPlane", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
          "]"}], ","}], "*)"}], 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.5"}], ",", "2.5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1.5"}], ",", "1.5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.5"}], ",", "2.5"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"ViewPoint", "->", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"-", "5"}], ",", "20"}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"300", ",", "300"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8933516130657015`*^9, 3.8933517338360224`*^9}, {
   3.8933517927322655`*^9, 3.893351794208815*^9}, 3.893354192094846*^9, {
   3.8933542371259975`*^9, 3.89335425178049*^9}, {3.8933575554088554`*^9, 
   3.8933575577519913`*^9}, {3.8958614480480146`*^9, 
   3.8958614517763233`*^9}, {3.895861711419704*^9, 3.8958617116853275`*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"b62bbf99-2ade-4958-85bd-fb423878e6a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "fpolarizationplot2d", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fpolarizationplot2d", "[", 
   RowBox[{
   "theta_", ",", "phi_", ",", "psi_", ",", "RotatePolarizer_", ",", 
    "RotateAnalyzer_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"AnalyzerBase", ",", "t1", ",", 
      RowBox[{"rtheta", "=", "0.5"}], ",", "\[Eta]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"t1", "=", 
      RowBox[{"RotationTransform", "[", 
       RowBox[{"\[Eta]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"AnalyzerBase", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"2.5", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"Arrowheads", "[", "0.06", "]"}], ",", 
          RowBox[{"Thickness", "[", "0.01", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", 
               RowBox[{"Lab1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"1", "*", 
               RowBox[{"Lab2", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1.5"}], ",", 
                 RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], "}"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Arrow", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2.5"}], ",", 
                   RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"1", "*", 
                 RowBox[{"Lab3", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2.5"}], ",", 
                   RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], "}"}], 
             "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<p\>\"", ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1", "*", 
              RowBox[{"Lab1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1.5"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<s\>\"", ",", "22", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
              ",", "Bold"}], "]"}], ",", 
            RowBox[{
             RowBox[{"1", "*", 
              RowBox[{"Lab2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1.5"}], ",", 
                RowBox[{"-", "1.5"}], ",", "0"}], "}"}], "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], "]"}]}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{"Row", "[", 
                RowBox[{
                "{", "\"\<\!\(\*SubscriptBox[\(L\), \(3\)]\)\>\"", "}"}], 
                "]"}], ",", "22", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
               ",", "Bold"}], "]"}], ",", 
             RowBox[{
              RowBox[{"1.1", "*", 
               RowBox[{"Lab3", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "2.3"}], ",", 
                 RowBox[{"-", "1.3"}], ",", "0"}], "}"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "*)"}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotatePolarizer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"-", "1"}]}], "}"}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"45", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \[Omega]\)]\)\>\
\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"Lab1", "[", 
                   RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"rtheta", "*", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                  "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{"rtheta", "*", 
                 RowBox[{
                  RowBox[{"RotationTransform", "[", 
                   RowBox[{"2", "*", 
                    RowBox[{"45", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                  RowBox[{"Lab1", "[", 
                   RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "2"}], ",", "0"}], "}"}]}], "]"}]}], "}"}], 
            "]"}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "0.5"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0.5", ",", "0"}], "}"}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"-", "1"}]}], "}"}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"phi", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(i, \[Omega]\)]\)\>\
\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"t1", "[", 
                  RowBox[{"Lab1", "[", 
                   RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"phi", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"rtheta", "*", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", 
                    RowBox[{"phi", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"phi", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                   RowBox[{"\[Eta]", "->", 
                    RowBox[{"phi", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}]}], 
             RowBox[{"(*", 
              RowBox[{",", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"Row", "[", 
                    RowBox[{"{", "\"\<\[CurlyPhi]\>\"", "}"}], "]"}], ",", 
                   "20", ",", 
                   RowBox[{
                   "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                   "Bold"}], "]"}], ",", 
                 RowBox[{"rtheta", "*", 
                  RowBox[{
                   RowBox[{"RotationTransform", "[", 
                    RowBox[{"2", "*", 
                    RowBox[{"phi", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2"}], ",", "0"}], "}"}]}], "]"}]}], "*)"}], 
             "}"}], "]"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"RotateAnalyzer", ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"45", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \[Omega]\)]\)(\
\[Psi])\>\"", "}"}], "]"}], ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"45", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"rtheta", "*", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"45", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", "\"\<\[Psi]=\[CurlyPhi]\>\"", "}"}], "]"}], 
                  ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{"AnalyzerBase", "+", 
                 RowBox[{"rtheta", "*", 
                  RowBox[{
                   RowBox[{"RotationTransform", "[", 
                    RowBox[{"2", "*", 
                    RowBox[{"45", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "2"}], ",", "0"}], "}"}]}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"45", "+", "90"}], ")"}], " ", "Degree"}]}]}]}], 
                "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                 "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \
\[Omega]\)]\)(\[Psi]+\!\(\*FractionBox[\(\[Pi]\), \(2\)]\))\>\"", ",", "20", 
                  ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"45", "+", "90"}], ")"}], "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Black", ",", "Dashed", ",", 
              RowBox[{"Thickness", "[", "0.005", "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0"}], "}"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1"}], "}"}]}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}]}], "}"}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{"psi", " ", "Degree"}]}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                 "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \
\[Omega]\)]\)(\[Psi])\>\"", ",", "20", ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{"psi", " ", "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1.5"}], ",", "0"}], "}"}]}], "]"}]}], "}"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"AnalyzerBase", ",", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                  RowBox[{"\[Eta]", "->", " ", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], " ", "Degree"}]}]}]}], 
                "}"}], "]"}], ",", 
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{
                   "{", "\"\<\!\(\*SuperscriptBox[\(E\), \(2  \[Omega]\)]\)(\
\[Psi]+\!\(\*FractionBox[\(\[Pi]\), \(2\)]\))\>\"", "}"}], "]"}], ",", "20", 
                  ",", 
                  RowBox[{
                  "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                  "Bold"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"t1", "[", 
                   RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}], "/.", 
                 RowBox[{"\[Eta]", "->", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"psi", "+", "90"}], ")"}], "Degree"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1.5"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", "0.04", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"Dashed", ","}], "*)"}], 
              RowBox[{"Thickness", "[", "0.008", "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"BSplineCurve", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AnalyzerBase", "+", 
                   RowBox[{"rtheta", "*", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"1", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"2", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"3", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"4", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"5", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"6", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"7", "/", "8"}], " ", "Degree"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AnalyzerBase", "+", 
                    RowBox[{"rtheta", "*", 
                    RowBox[{"t1", "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], "/.", 
                   RowBox[{"\[Eta]", "->", " ", 
                    RowBox[{"psi", "*", 
                    RowBox[{"8", "/", "8"}], "Degree"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}]}], 
             RowBox[{"(*", 
              RowBox[{",", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ToString", "[", "psi", "]"}], ",", 
                    "\"\<SuperscriptBox[\\\\,o]\>\""}], "}"}], "]"}], ",", 
                   "16", ",", 
                   RowBox[{
                   "FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], ",", 
                   "Bold"}], "]"}], ",", 
                 RowBox[{"AnalyzerBase", "+", 
                  RowBox[{"rtheta", "*", 
                   RowBox[{
                    RowBox[{"RotationTransform", "[", 
                    RowBox[{"2", "*", 
                    RowBox[{"psi", "/", "4"}], " ", "Degree"}], "]"}], "[", 
                    RowBox[{"Lab1", "[", 
                    RowBox[{"[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}], "]"}], "]"}], "]"}]}]}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1.5"}], ",", 
                   RowBox[{"-", "1"}]}], "}"}], ",", 
                 RowBox[{"Background", "\[Rule]", "None"}]}], "]"}]}], "*)"}],
              "}"}], "]"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{"{", 
           RowBox[{"Orange", ",", 
            RowBox[{"Opacity", "[", "0.2", "]"}], ",", 
            RowBox[{"EdgeForm", "[", " ", "]"}], ",", 
            RowBox[{"HalfPlane", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1.7"}], ",", 
                  RowBox[{"-", "1.7"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"4.5", ",", 
                  RowBox[{"-", "1.5"}]}], "}"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}], ","}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"AspectRatio", "->", "1"}], ","}], "*)"}], 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1.7"}], ",", "4.8"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1.7"}], ",", "1.7"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", 
        RowBox[{"Style", "[", 
         RowBox[{
         "\"\<Polarization Relation\>\"", ",", "\"\<Times New Roman\>\"", ",",
           "20", ",", "Bold", ",", "Black"}], "]"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8933541304991055`*^9, 3.893354151994541*^9}, 
   3.8933542079044275`*^9, {3.8933542667795577`*^9, 3.8933542842991447`*^9}, {
   3.893354329107746*^9, 3.8933543409985175`*^9}, {3.8933575346458993`*^9, 
   3.8933575374267936`*^9}, {3.8958614525705757`*^9, 3.895861458193517*^9}, {
   3.895861735759055*^9, 3.895861735962182*^9}, 3.896920990213098*^9, {
   3.8969210479631724`*^9, 3.8969210537727823`*^9}, {3.8969211014724464`*^9, 
   3.89692111137949*^9}, {3.8969211472863226`*^9, 3.896921158954214*^9}, {
   3.8969211938493214`*^9, 3.89692121707345*^9}, {3.8971795813693604`*^9, 
   3.897179582731943*^9}, {3.8971798159718094`*^9, 3.897179823244879*^9}, {
   3.8971798912684536`*^9, 3.8971799173866577`*^9}},
 CellLabel->
  "In[138]:=",ExpressionUUID->"66808810-386d-4202-ba22-b2d66e02143c"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Headers in control panel", "Chapter"]], "Chapter",
 CellChangeTimes->{{3.8933787480396223`*^9, 
  3.893378754589144*^9}},ExpressionUUID->"0abe504e-5574-4ace-ab71-\
ae25b7bbd0e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   StyleBox["header1", "Input"], 
   StyleBox["=", "Input"], 
   RowBox[{
    StyleBox["Row", "Input"], 
    StyleBox["[", "Input"], 
    RowBox[{
     StyleBox["{", "Input"], 
     RowBox[{
      StyleBox[
       RowBox[{"Style", "[", 
        RowBox[{"\"\<   \>\"", ",", "30"}], "]"}], "Input"], 
      StyleBox[",", "Input"], 
      RowBox[{
       StyleBox["Column", "Input"], 
       StyleBox["[", "Input"], 
       RowBox[{
        RowBox[{
         StyleBox["{", "Input"], 
         RowBox[{
          StyleBox[
           RowBox[{"If", "[", 
            RowBox[{"LogoExists", ",", "Logo", ",", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<\[Sharp] SHAARP.ml\>\"", ",", "Bold", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Castellar\>\""}], ",", 
               "70"}], "]"}]}], "]"}], "Input"], ",", "\"\<\>\"", ",", 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<S\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<econd \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<H\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<armonic \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<A\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<nalysis of\>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<A\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<nisotropic \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<R\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<otational \>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<P\>\"", ",", "Bold", ",", 
                RowBox[{"FontFamily", "->", "\"\<Castellar\>\""}], ",", 
                "30"}], "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<olarimetry\>\"", ",", 
                RowBox[{"FontFamily", "->", "\"\<Centaur\>\""}], ",", "30"}], 
               "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\< \>\"", ",", "20"}], "]"}], "Input"]}], 
         StyleBox["}", "Input"]}], 
        StyleBox[",", "Input"], 
        StyleBox[
         RowBox[{"Alignment", "->", "Center"}], "Input"]}], 
       StyleBox["]", "Input"]}], 
      StyleBox[",", "Input"], 
      StyleBox[
       RowBox[{"Style", "[", 
        RowBox[{"\"\<   \>\"", ",", "60"}], "]"}], "Input"], 
      StyleBox[",", "Input"], 
      StyleBox[" ", "Input"], 
      RowBox[{
       StyleBox["Column", "Input"], 
       StyleBox["[", "Input"], 
       RowBox[{
        RowBox[{
         StyleBox["{", "Input"], 
         StyleBox["\[IndentingNewLine]", "Input"], 
         RowBox[{
          RowBox[{
           StyleBox["Style", "Input"], "[", 
           RowBox[{"\"\<Version 1.00\>\"", 
            StyleBox[",", "Input"], 
            StyleBox[" ", "Input"], 
            StyleBox[
             RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], "Input"], 
            StyleBox[",", "Input"], 
            StyleBox["25", "Input"]}], 
           StyleBox["]", "Input"]}], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<\>\"", ",", "8"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<Copyright (C) 2023\>\"", ",", " ", 
             RowBox[{"FontFamily", "->", "\"\<Arial\>\""}], ",", "16"}], 
            "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<\>\"", ",", "8"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<          Bo Wang, Rui Zu, Lincoln Weber, Akash Saha,\\n     \
      Long-Qing Chen, and Venkatraman Gopalan\>\"", ",", " ", 
             RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
             "16"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<\>\"", ",", "15"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Tutorial video:\>\"", ",", 
               RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
               "18"}], "]"}], ",", 
             RowBox[{"Hyperlink", "[", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"\"\< Youtube\>\"", ",", " ", 
                 RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",",
                  "14"}], "]"}], ",", 
               "\"\<https://www.youtube.com/watch?v=YiKRm6i7kNs\>\""}], 
              "]"}]}], "}"}], "]"}], ",", 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
               "\"\<This program comes with ABSOLUTELY NO WARRANTY; for \
details, \>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "18"}], "]"}], ",", 
              RowBox[{"Hyperlink", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<click here\>\"", ",", " ", 
                  RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], 
                  ",", "14"}], "]"}], ",", 
                "\"\<https://www.gnu.org/licenses/gpl-3.0.en.html\>\""}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<.\>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "14"}], "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<This is free software, and you are welcome to redistribute \
it\>\"", ",", " ", 
             RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
             "14"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<under certain conditions; \>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "14"}], "]"}], ",", 
              RowBox[{"Hyperlink", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<click here\>\"", ",", " ", 
                  RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], 
                  ",", "14"}], "]"}], ",", 
                "\"\<https://www.gnu.org/licenses/gpl-3.0.en.html\>\""}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\< for details.\>\"", ",", " ", 
                RowBox[{"FontFamily", "->", "\"\<Franklin Gothic\>\""}], ",", 
                "14"}], "]"}]}], "}"}], "]"}], "Input"], 
          StyleBox[",", "Input"], 
          StyleBox["\[IndentingNewLine]", "Input"], 
          StyleBox[
           RowBox[{"Style", "[", 
            RowBox[{"\"\<    \>\"", ",", "20"}], "]"}], "Input"], 
          StyleBox[",", "Input"], "\[IndentingNewLine]", 
          RowBox[{"Row", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
              "Style", "[", 
               "\"\<If you used \[Sharp]SHAARP for your publications, please \
kindly cite us:  \\n\>\"", "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Hyperlink", "[", 
               RowBox[{
                RowBox[{
                "Style", "[", 
                 "\"\<\[Sharp]SHAARP.\!\(\*StyleBox[\\\"ml\\\",FontSlant->\\\"\
Italic\\\"]\)\>\"", "]"}], ",", 
                "\"\<https://www.nature.com/articles/s41524-024-01229-2\>\""}]\
, "]"}], ",", 
              RowBox[{"Style", "[", "\"\<, \>\"", "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Hyperlink", "[", 
               RowBox[{
                RowBox[{
                "Style", "[", 
                 "\"\<\[Sharp]SHAARP.\!\(\*StyleBox[\\\"si\\\",FontSlant->\\\"\
Italic\\\"]\)\>\"", "]"}], ",", 
                "\"\<https://www.nature.com/articles/s41524-022-00930-4\>\""}]\
, "]"}], ",", "\"\<.\>\""}], "}"}], ",", 
            RowBox[{"BaseStyle", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"FontSize", "->", "16"}], ",", "Bold"}], "}"}]}]}], 
           "]"}]}], 
         StyleBox["}", "Input"]}], 
        StyleBox[",", "Input"], 
        StyleBox["\[IndentingNewLine]", "Input"], 
        StyleBox[
         RowBox[{"Alignment", "->", "Center"}], "Input"]}], 
       StyleBox["]", "Input"]}]}], 
     StyleBox["}", "Input"]}], 
    StyleBox["]", "Input"]}]}], 
  StyleBox[";", "Input"]}]], "Input",
 CellChangeTimes->{{3.893378762852874*^9, 3.893378767735992*^9}, 
   3.8933861440487432`*^9, 3.8934006639799156`*^9, {3.8943994287182302`*^9, 
   3.8943994303839164`*^9}, {3.894399460720805*^9, 3.8943994617601166`*^9}, {
   3.894399667595615*^9, 3.8943996692534328`*^9}, 3.894620115259054*^9, {
   3.8954131220397825`*^9, 3.895413122229064*^9}, {3.8956782333593283`*^9, 
   3.895678233786956*^9}, {3.8959244428450317`*^9, 3.895924444015365*^9}, {
   3.8959254726917763`*^9, 3.8959254803629413`*^9}, {3.895932770681795*^9, 
   3.895932797303816*^9}, {3.8959377622393374`*^9, 3.895937762415495*^9}, {
   3.8972653885206413`*^9, 3.897265391024664*^9}, {3.897608305304435*^9, 
   3.8976083270376825`*^9}, {3.897608359030423*^9, 3.8976084011681175`*^9}, {
   3.89760843309146*^9, 3.8976084582852297`*^9}, {3.897608500263793*^9, 
   3.89760850096371*^9}, {3.941976281270523*^9, 3.941976291804024*^9}, {
   3.941976470072546*^9, 3.9419764853633103`*^9}, 3.941976520421524*^9, {
   3.941976677484421*^9, 3.941976688224311*^9}, {3.9419767272209363`*^9, 
   3.9419767542114253`*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"b2c6d5f6-b19f-4328-a932-26312a25d4dd"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tooltip Explain", "Chapter",
 CellChangeTimes->{{3.895753423866798*^9, 
  3.895753428771045*^9}},ExpressionUUID->"a540b90a-bd51-4e5a-95e3-\
63d41e29e66c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ZSysExplain", "[", "pg_", "]"}], ":=", " ", 
   RowBox[{"Which", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"pg", "==", "\"\<1\>\""}], "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(1\), \(_\)]\)\>\""}]}], 
     ",", "\"\<\!\(\*SubscriptBox[\(Z\), \(3\)]\) is chosen parallel to \
\!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\). \!\(\*SubscriptBox[\(Z\), \(2\)]\) is normal to the \!\(\*StyleBox[\\\"ac\
\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\) plane(010). The \
\!\(\*SubscriptBox[\(Z\), \(1\)]\) lies in (010) plane and is perpendicular \
to \!\(\*SubscriptBox[\(Z\), \(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\).\
\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<2\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<m\>\""}], "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<2/m\>\""}]}], " ", ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(2\)]\) is chosen parallel to \
\!\(\*StyleBox[\\\"b\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\)[010]. \!\(\*SubscriptBox[\(Z\), \(3\)]\) is parallel along \!\(\*StyleBox[\
\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\). \
\!\(\*SubscriptBox[\(Z\), \(1\)]\) is perpendicular to \!\(\*SubscriptBox[\(Z\
\), \(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\).\>\"", ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<mm2\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<222\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<mmm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)3m\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<23\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<m3\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<432\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<m3m\>\""}]}], ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are parallel to \
\!\(\*StyleBox[\\\"a\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\), \!\(\*StyleBox[\\\"b\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\
\\\"]\) and \!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\
\"Italic\\\"]\).\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<4\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<4mm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<422\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)2m\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(4\), \(_\)]\)\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<4/m\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<4/mmm\>\""}]}], ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are parallel to \
\!\(\*StyleBox[\\\"a\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\), \!\(\*StyleBox[\\\"b\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\
\\\"]\) and \!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\
\"Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\)(Four-fold axis).\
\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pg", "==", "\"\<6\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<6mm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<622\>\""}], "  ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)\>\""}], 
      " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<6/m\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(6\), \(_\)]\)m2\>\""}], 
      "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<6/mmm\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<3\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<32\>\""}], " ", "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<3m\>\""}], "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)\>\""}], 
      "\[Or]", " ", 
      RowBox[{"pg", "==", "\"\<\!\(\*OverscriptBox[\(3\), \(_\)]\)m\>\""}]}], 
     ",", "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\) and \
\!\(\*SubscriptBox[\(Z\), \(3\)]\) are parallel to \
\!\(\*StyleBox[\\\"a\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\)[100]\!\(\*StyleBox[\\\" \
\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\)and \
\!\(\*StyleBox[\\\"c\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\"]\
\)\!\(\*StyleBox[\\\",\\\",FontWeight->\\\"Normal\\\",FontSlant->\\\"Italic\\\
\"]\)respectively. \!\(\*SubscriptBox[\(Z\), \(2\)]\) is perpendicular to \
\!\(\*SubscriptBox[\(Z\), \(1\)]\) and \!\(\*SubscriptBox[\(Z\), \
\(3\)]\).\>\"", ",", "\[IndentingNewLine]", "True", ",", 
     "\[IndentingNewLine]", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are arbitrary\>\""}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ZExplain", "[", "pg_", "]"}], ":=", 
   RowBox[{"StringJoin", "[", 
    RowBox[{
    "\"\<Point group : \>\"", ",", "pg", ",", 
     "\"\<\\nThe crystal physics basis vectors must be orthogonal and \
right-handed.\\n\>\"", ",", 
     "\"\<\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \
\(2\)]\) and \!\(\*SubscriptBox[\(Z\), \(3\)]\) are given in the lab \
coordinate basis \!\(\*SubscriptBox[\(L\), \(1\)]\), \
\!\(\*SubscriptBox[\(L\), \(2\)]\), and \!\(\*SubscriptBox[\(L\), \
\(3\)]\).\\n\>\"", ",", 
     RowBox[{"ZSysExplain", "[", "pg", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PropagationExplain", "=", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<Waves propagation in the system. Red is fundamental light \
(\!\(\*SuperscriptBox[\(\[Lambda]\), \(\[Omega]\)]\)),orange is bound waves \
(inhomogeneous waves at 2\[Omega]), blue is the SHG light \
(\!\(\*SuperscriptBox[\(\[Lambda]\), \(2  \[Omega]\)]\), homogeneous waves at \
2\[Omega]). In this plot, both ordinary and extraordinary wavevctors are \
shown in each layer. The wavevectors are displaced for better \
visability.\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EllipticityExplain", "=", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<The ellipticity plot shows the ellipticity of incident light at \
\[Omega] frequency, corresponding reflected and transmitted light at \
2\[Omega] frequency.\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hklExplain", " ", "=", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<(hkl) refers to Miller indices of planes.\\nIn trigonal and \
hexagonal system, four-indices notation are commonly aplied. (hkl) -> (h k \
-(h+k) l)\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MTIExplain", " ", "=", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<According to MTI notation,\\nX-cut \!\(\*SubscriptBox[\(LiNbO\), \
\(3\)]\) refers to surface plane (110)=(11-20).\\nY-cut (100)=(10-10)\\nZ-cut \
(001)=(0001)\>\"", ",", "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolarPlotExplain", " ", "=", " ", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<Polar plots as a function of azimuthal angle \[CurlyPhi], \[Psi], \
where \[CurlyPhi], \[Psi] describe incident polarization (\[Omega]) and \
output polarization (2\[Omega]) directions.\\nIn the program, \[Psi] can \
either be set equal to \[CurlyPhi] (Rotate Analyzer tab) or a fixed \
value(Fixed Analyzer tab).\\nTwo polar plots with orthogonal output \
polarizations (\!\(\*SuperscriptBox[\(I\), \(2  \[Omega]\)]\)(\[CurlyPhi],\
\[Psi]) and \!\(\*SuperscriptBox[\(I\), \(2  \
\[Omega]\)]\)(\[CurlyPhi],\[Psi]+\!\(\*FractionBox[\(\[Pi]\), \(2\)]\))) are \
given to reveal the full anisotropy.\>\"", ",", "\"\<Times New Roman\>\"", 
     ",", "20"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GeometryExplain", " ", "=", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<Orange plane: Surface plane; Blue plane: Plane of incidence; \
\!\(\*SuperscriptBox[\(k\), \(\[Omega]\)]\): Incident wave vector; \
\!\(\*SubscriptBox[\(Z\), \(1\)]\), \!\(\*SubscriptBox[\(Z\), \(2\)]\) and \!\
\(\*SubscriptBox[\(Z\), \(3\)]\): Crystal physcis coordinates; \
\!\(\*SubscriptBox[\(L\), \(1\)]\), \!\(\*SubscriptBox[\(L\), \(2\)]\) and \!\
\(\*SubscriptBox[\(L\), \(3\)]\): Lab coordinates;\>\"", ",", 
     "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Plot2RealnExplain", " ", "=", " ", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<1 and 2 refer to two Eigen refractive indices. One is ordinary \
(remains the same value as a function of incident angle) and the other is \
extraordinary (varies as a function of incident angle).\>\"", ",", 
     "\"\<Times New Roman\>\"", ",", "20"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PresetExplain", " ", "=", 
   RowBox[{"Style", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<Presets currently set:   \>\"", "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval1", "]"}], ",", "\"\<1   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval2", "]"}], ",", "\"\<2   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval3", "]"}], ",", "\"\<3   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", "presetval4", "]"}], ",", "\"\<4   \>\"", ",", 
        "\"\<\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ValueQ", "[", "presetval1", "]"}], "\[Or]", 
         RowBox[{"ValueQ", "[", "presetval2", "]"}], "\[Or]", 
         RowBox[{"ValueQ", "[", "presetval3", "]"}], "\[Or]", 
         RowBox[{"ValueQ", "[", "presetval4", "]"}]}], ",", "\"\<\>\"", ",", 
        "\"\<None.\>\""}], "]"}], "<>", "\[IndentingNewLine]", 
      "\"\<\\nUpdate and press any of the preset buttons to save a material's \
\\ninformation to that preset. \\nPress the button again and update to apply \
those values.\\nHide and show this message to refresh.\>\""}], 
     "\[IndentingNewLine]", ",", "\"\<Times New Roman\>\"", ",", "12"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\"\<setup done\>\"", ";"}]}], "Input",
 CellChangeTimes->{{3.895753455927518*^9, 3.895753460362939*^9}, 
   3.895753724764985*^9, 3.895753805346786*^9, 3.895753947698242*^9, {
   3.895754020338092*^9, 3.8957541571157627`*^9}, {3.8957542635482264`*^9, 
   3.895754293951646*^9}, {3.8957544050600653`*^9, 3.895754422062916*^9}, {
   3.895754466282419*^9, 3.8957546054152803`*^9}, {3.8957546362160387`*^9, 
   3.8957547393051496`*^9}, {3.8957549406885395`*^9, 3.895754943614787*^9}, {
   3.895757709731511*^9, 3.8957578858615713`*^9}, {3.8957579484276867`*^9, 
   3.8957579756775875`*^9}, {3.895758007950823*^9, 3.895758129076806*^9}, {
   3.895758176453224*^9, 3.8957581811526318`*^9}, {3.8958387393422775`*^9, 
   3.8958387741170006`*^9}, {3.8958388256048365`*^9, 
   3.8958388266829586`*^9}, {3.8971796048980646`*^9, 
   3.8971796825971823`*^9}, {3.8973364959124804`*^9, 
   3.8973365157230015`*^9}, {3.8973365535400686`*^9, 3.8973365744227114`*^9}},
 CellLabel->
  "In[141]:=",ExpressionUUID->"eb90e4c9-dab8-4c3b-9305-4612cbb54fac"]
}, Closed]]
}, Closed]]
},
WindowSize->{1920, 1017.75},
WindowMargins->{{-6, Automatic}, {Automatic, -6}},
DockedCells->{},
TaggingRules-><|"TryRealOnly" -> False|>,
Magnification:>1. Inherited,
FrontEndVersion->"13.3 for Microsoft Windows (64-bit) (June 3, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"40d7173d-3bfa-425c-8bd7-c438af42d0d7"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 10007, 196, 561, "Input",ExpressionUUID->"ed974761-9dcc-4ef1-9668-ef13d8042673"],
Cell[CellGroupData[{
Cell[10590, 220, 503, 7, 98, "Title",ExpressionUUID->"88d8a200-e326-437a-a2b1-0a7877842aa5"],
Cell[11096, 229, 8116, 173, 619, "Input",ExpressionUUID->"51b750df-eb29-443b-bf24-7fd7f2ec808e"],
Cell[19215, 404, 559, 9, 48, "Input",ExpressionUUID->"c90f9cda-7762-43b7-9062-eed522c003c5"]
}, Closed]],
Cell[CellGroupData[{
Cell[19811, 418, 211, 4, 72, "Title",ExpressionUUID->"2da296c2-29d5-4aef-b5be-57b13251ffe6"],
Cell[CellGroupData[{
Cell[20047, 426, 166, 3, 69, "Chapter",ExpressionUUID->"9aede281-19c4-4f37-b5d7-bf6c4ce47068"],
Cell[20216, 431, 5262, 137, 181, "Input",ExpressionUUID->"14f2bc0a-ec4e-4c7b-9794-7aa3b3a234d3"],
Cell[25481, 570, 11620, 255, 676, "Input",ExpressionUUID->"05d4e82c-14bc-4894-b398-d36d23b22167"],
Cell[37104, 827, 3007, 75, 219, "Input",ExpressionUUID->"24039ff0-d77e-4d2b-8ea7-48805393bf98"],
Cell[40114, 904, 4799, 104, 181, "Input",ExpressionUUID->"03473d21-890c-40c2-aa2c-6155a0c7e300"],
Cell[44916, 1010, 7916, 204, 504, "Input",ExpressionUUID->"f1fff8d2-bdfa-4a84-abc8-6acb06a5406e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52869, 1219, 161, 3, 69, "Chapter",ExpressionUUID->"f675d733-5e58-4b94-9785-948947b52d1d"],
Cell[53033, 1224, 7882, 172, 398, "Input",ExpressionUUID->"6901761b-5a2a-4c42-9da7-8a0b80534fbd"],
Cell[60918, 1398, 6176, 150, 436, "Input",ExpressionUUID->"adb0f516-59df-4b0f-a7ad-3612735eacfa"],
Cell[67097, 1550, 6262, 152, 458, "Input",ExpressionUUID->"423403c9-ffce-4ced-b379-9ac057f69afe"],
Cell[73362, 1704, 8104, 180, 436, "Input",ExpressionUUID->"3eb09a4c-65d5-4c80-a5a5-6df6f7eacfd7"],
Cell[81469, 1886, 15187, 385, 566, "Input",ExpressionUUID->"ffe736ff-305b-4fe9-b58a-df11515970fb"],
Cell[96659, 2273, 14042, 369, 566, "Input",ExpressionUUID->"eda09f38-171f-486c-861e-2ef0036d1ecf"],
Cell[110704, 2644, 9422, 237, 528, "Input",ExpressionUUID->"282025b0-d1ba-4d84-aa03-7c5c8beff868"],
Cell[120129, 2883, 9417, 238, 528, "Input",ExpressionUUID->"a2056cca-1ec8-4bef-8b38-d6985ff4b1e4"],
Cell[129549, 3123, 9511, 231, 569, "Input",ExpressionUUID->"9981114f-ed8d-496c-a589-3cac37e71ab9"],
Cell[139063, 3356, 6700, 160, 417, "Input",ExpressionUUID->"a377865e-d91b-4b72-bcbc-7ba18c1e943b"],
Cell[145766, 3518, 6573, 157, 417, "Input",ExpressionUUID->"aa7e4467-99fe-495d-8e26-34dab5319814"],
Cell[152342, 3677, 7017, 166, 455, "Input",ExpressionUUID->"c6b72c7a-8011-4118-b60d-4c51f1e44794"],
Cell[159362, 3845, 19489, 484, 648, "Input",ExpressionUUID->"346979b3-54f5-4a44-b833-82392ea2670b"],
Cell[178854, 4331, 6620, 159, 436, "Input",ExpressionUUID->"d3f1f024-15ad-4152-8c84-cca002cb4693"],
Cell[185477, 4492, 7968, 200, 537, "Input",ExpressionUUID->"e656aca1-870f-40c0-9b93-4b128951c607"],
Cell[193448, 4694, 6787, 161, 531, "Input",ExpressionUUID->"f020739b-0177-430b-bd1b-e2d44d46dc07"],
Cell[200238, 4857, 8697, 188, 439, "Input",ExpressionUUID->"189a9a34-e96d-4c88-b4fb-962a05f5a3ae"]
}, Open  ]],
Cell[CellGroupData[{
Cell[208972, 5050, 260, 4, 69, "Chapter",ExpressionUUID->"6c361ee8-c60a-4774-93ea-8e8a4864c6a7"],
Cell[209235, 5056, 2750, 54, 66, "Input",ExpressionUUID->"b6ae3fa6-73c0-476f-92c5-395265f1e96b"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[212034, 5116, 215, 4, 72, "Title",ExpressionUUID->"1a7c80c2-7a75-461d-b5f3-4f54257b8e10"],
Cell[CellGroupData[{
Cell[212274, 5124, 442, 6, 69, "Chapter",ExpressionUUID->"ba179bfb-303a-47b6-8653-fccc4defc35a"],
Cell[212719, 5132, 44555, 974, 2620, "Input",ExpressionUUID->"97649922-01c2-4c2d-bfce-4d5a98b082b0"]
}, Closed]],
Cell[CellGroupData[{
Cell[257311, 6111, 320, 5, 58, "Chapter",ExpressionUUID->"5b8a343e-1607-4b4e-83d0-2845b6a33fb9"],
Cell[257634, 6118, 12310, 272, 885, "Input",ExpressionUUID->"39d1645c-06da-4289-ab26-9fba6e886f8f"],
Cell[269947, 6392, 25387, 524, 1094, "Input",ExpressionUUID->"7ebd4447-fc3c-4eb0-9e76-dd514f64b86e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[295371, 6921, 372, 6, 69, "Chapter",ExpressionUUID->"9a9bd620-7b4a-46b2-9824-74024f07f572"],
Cell[295746, 6929, 2715, 73, 67, "Input",ExpressionUUID->"8ad8b392-0009-4cba-81ca-2369903c7c44"],
Cell[298464, 7004, 67134, 1542, 3842, "Input",ExpressionUUID->"e7e53672-7a55-40ac-b67a-b6ba1f919ac7"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[365647, 8552, 220, 4, 72, "Title",ExpressionUUID->"aa85a36c-2768-4639-8d0e-decaa9e87b85"],
Cell[CellGroupData[{
Cell[365892, 8560, 609, 9, 69, "Chapter",ExpressionUUID->"8eefb35c-18b2-43e7-8ef4-d903250f5053"],
Cell[366504, 8571, 7112, 149, 523, "Input",ExpressionUUID->"4041f397-63fa-4a4c-b9ff-708b0870e6b7"],
Cell[373619, 8722, 21580, 419, 1056, "Input",ExpressionUUID->"8049ebf4-e382-440c-9e43-393236a21c0e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[395236, 9146, 387, 6, 69, "Chapter",ExpressionUUID->"da61b590-48e7-40ee-a0f3-2608c5196b8b"],
Cell[395626, 9154, 43050, 929, 2179, "Input",ExpressionUUID->"5fa0cc44-7388-47c7-b179-75ce38116667"],
Cell[438679, 10085, 82125, 1965, 4120, "Input",ExpressionUUID->"b3fd9750-a54b-4182-8c39-820f6425e529"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[520853, 12056, 228, 4, 72, "Title",ExpressionUUID->"9042ff58-e452-4ecb-88e6-13f19a0537e6"],
Cell[CellGroupData[{
Cell[521106, 12064, 191, 3, 69, "Chapter",ExpressionUUID->"1ec80b5a-86c5-422b-a529-432dbf698fdd"],
Cell[521300, 12069, 13524, 331, 333, "Input",ExpressionUUID->"94e87d36-2b94-458c-9d74-6870a346fef5"],
Cell[534827, 12402, 1650, 37, 295, "Input",ExpressionUUID->"ad125409-1df9-479b-8433-6fee9c508f3e"],
Cell[536480, 12441, 39765, 929, 2037, "Input",ExpressionUUID->"d9ded69a-2a0e-4e42-9380-ffecf28be5f8"],
Cell[576248, 13372, 36033, 859, 1961, "Input",ExpressionUUID->"10446bcd-584a-48a4-8540-2d9a165131e4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[612318, 14236, 176, 3, 69, "Chapter",ExpressionUUID->"7bda4879-c1f5-4657-b1f0-1d230c3921d8"],
Cell[612497, 14241, 43252, 1010, 2426, "Input",ExpressionUUID->"2230f45f-45b4-4d76-8d79-23f7995e3866"]
}, Open  ]],
Cell[CellGroupData[{
Cell[655786, 15256, 185, 3, 69, "Chapter",ExpressionUUID->"feeeed14-16c8-4403-a121-6d703a0e1425"],
Cell[655974, 15261, 21505, 523, 762, "Input",ExpressionUUID->"8826940e-c654-46fe-990e-f7d58f72b8c5"],
Cell[677482, 15786, 17011, 456, 523, "Input",ExpressionUUID->"430fb27d-99f8-41d5-8a4a-835e12847cce"],
Cell[694496, 16244, 10868, 289, 503, "Input",ExpressionUUID->"e2b0f133-3c5e-4178-b645-c608c913bf9b"],
Cell[705367, 16535, 26068, 649, 921, "Input",ExpressionUUID->"979d47e3-561f-4f83-b76c-7bb5f3fb996d"],
Cell[731438, 17186, 8484, 222, 371, "Input",ExpressionUUID->"f5aa71d2-e846-4c4f-aa94-bff7bcb05b8d"],
Cell[739925, 17410, 64023, 1486, 2345, "Input",ExpressionUUID->"b62bbf99-2ade-4958-85bd-fb423878e6a3"],
Cell[803951, 18898, 50535, 1170, 1761, "Input",ExpressionUUID->"66808810-386d-4202-ba22-b2d66e02143c"]
}, Closed]],
Cell[CellGroupData[{
Cell[854523, 20073, 202, 3, 58, "Chapter",ExpressionUUID->"0abe504e-5574-4ace-ab71-ae25b7bbd0e7"],
Cell[854728, 20078, 12332, 284, 409, "Input",ExpressionUUID->"b2c6d5f6-b19f-4328-a932-26312a25d4dd"]
}, Closed]],
Cell[CellGroupData[{
Cell[867097, 20367, 160, 3, 58, "Chapter",ExpressionUUID->"a540b90a-bd51-4e5a-95e3-63d41e29e66c"],
Cell[867260, 20372, 12085, 229, 1370, "Input",ExpressionUUID->"eb90e4c9-dab8-4c3b-9305-4612cbb54fac"]
}, Closed]]
}, Closed]]
}
]
*)

